{"instance_id": "PostgreSQL_37", "dialect": "PostgreSQL", "version": "14.12", "db_id": "financial", "query": "We have a large transaction table in our financial database with over 180 million rows and 20 GB in size. The table is structured to store detailed transaction records for various accounts. We are running a query to retrieve specific transactions based on a list of account IDs, a specific bank, and a range of transaction types. The query is taking an unexpectedly long time to execute when the shared buffers are cold, around 9 seconds, but only 25 ms when the data is cached. We suspect that the query planner is not choosing the most optimal execution plan. We have tried adding a covering index and forcing a Bitmap Heap Scan, but we would like to understand why the planner is not making the best choice and find a more permanent solution to improve performance to around 1-2 seconds.", "issue_sql": ["SELECT t.trans_id,       t.account_id,       t.date,       t.type,       t.amount  FROM trans t  JOIN account a    ON t.account_id = a.account_id WHERE a.district_id = 18   AND t.bank = 'AB'  AND t.type IN ('PRIJEM', 'VYDAJ')"], "preprocess_sql": [], "clean_up_sql": [], "category": "Efficiency", "original_schema": "CREATE TABLE \"account\" (\naccount_id bigint NOT NULL DEFAULT '0'::bigint,\ndistrict_id bigint NULL DEFAULT '0'::bigint,\nfrequency text NULL,\ndate date NULL,\n    PRIMARY KEY (account_id),\n    FOREIGN KEY (district_id) REFERENCES district(district_id)\n);\n\nFirst 3 rows:\n  account_id    district_id  frequency         date\n------------  -------------  ----------------  ----------\n           1             18  POPLATEK MESICNE  1995-03-24\n           2              1  POPLATEK MESICNE  1993-02-26\n           3              5  POPLATEK MESICNE  1997-07-07\n...\n\n\nCREATE TABLE \"card\" (\ncard_id bigint NOT NULL DEFAULT '0'::bigint,\ndisp_id bigint NULL,\ntype text NULL,\nissued date NULL,\n    PRIMARY KEY (card_id),\n    FOREIGN KEY (disp_id) REFERENCES disp(disp_id)\n);\n\nFirst 3 rows:\n  card_id    disp_id  type     issued\n---------  ---------  -------  ----------\n        1          9  gold     1998-10-16\n        2         19  classic  1998-03-13\n        3         41  gold     1995-09-03\n...\n\n\nCREATE TABLE \"client\" (\nclient_id bigint NOT NULL,\ngender text NULL,\nbirth_date date NULL,\ndistrict_id bigint NULL,\n    PRIMARY KEY (client_id),\n    FOREIGN KEY (district_id) REFERENCES district(district_id)\n);\n\nFirst 3 rows:\n  client_id  gender    birth_date      district_id\n-----------  --------  ------------  -------------\n          1  F         1970-12-13               18\n          2  M         1945-02-04                1\n          3  F         1940-10-09                1\n...\n\n\nCREATE TABLE \"disp\" (\ndisp_id bigint NOT NULL,\nclient_id bigint NULL,\naccount_id bigint NULL,\ntype text NULL,\n    PRIMARY KEY (disp_id),\n    FOREIGN KEY (account_id) REFERENCES account(account_id),\n    FOREIGN KEY (client_id) REFERENCES client(client_id)\n);\n\nFirst 3 rows:\n  disp_id    client_id    account_id  type\n---------  -----------  ------------  ---------\n        1            1             1  OWNER\n        2            2             2  OWNER\n        3            3             2  DISPONENT\n...\n\n\nCREATE TABLE \"district\" (\ndistrict_id bigint NOT NULL DEFAULT '0'::bigint,\na2 text NULL,\na3 text NULL,\na4 text NULL,\na5 text NULL,\na6 text NULL,\na7 text NULL,\na8 bigint NULL,\na9 bigint NULL,\na10 real NULL,\na11 bigint NULL,\na12 real NULL,\na13 real NULL,\na14 bigint NULL,\na15 bigint NULL,\na16 bigint NULL,\n    PRIMARY KEY (district_id)\n);\n\nFirst 3 rows:\n  district_id  a2           a3                    a4    a5    a6    a7    a8    a9    a10    a11    a12    a13    a14    a15    a16\n-------------  -----------  ---------------  -------  ----  ----  ----  ----  ----  -----  -----  -----  -----  -----  -----  -----\n            1  Hl.m. Praha  Prague           1204953     0     0     0     1     1  100    12541    0.2   0.43    167  85677  99107\n            2  Benesov      central Bohemia    88884    80    26     6     2     5   46.7   8507    1.6   1.85    132   2159   2674\n            3  Beroun       central Bohemia    75232    55    26     4     1     5   41.7   8980    1.9   2.21    111   2824   2813\n...\n\n\nCREATE TABLE \"loan\" (\nloan_id bigint NOT NULL DEFAULT '0'::bigint,\naccount_id bigint NULL,\ndate date NULL,\namount bigint NULL,\nduration bigint NULL,\npayments real NULL,\nstatus text NULL,\n    PRIMARY KEY (loan_id),\n    FOREIGN KEY (account_id) REFERENCES account(account_id)\n);\n\nFirst 3 rows:\n  loan_id    account_id  date          amount    duration    payments  status\n---------  ------------  ----------  --------  ----------  ----------  --------\n     4959             2  1994-01-05     80952          24        3373  A\n     4961            19  1996-04-29     30276          12        2523  B\n     4962            25  1997-12-08     30276          12        2523  A\n...\n\n\nCREATE TABLE \"order\" (\norder_id bigint NOT NULL DEFAULT '0'::bigint,\naccount_id bigint NULL,\nbank_to text NULL,\naccount_to bigint NULL,\namount real NULL,\nk_symbol text NULL,\n    PRIMARY KEY (order_id),\n    FOREIGN KEY (account_id) REFERENCES account(account_id)\n);\n\nFirst 3 rows:\n  order_id    account_id  bank_to      account_to    amount  k_symbol\n----------  ------------  ---------  ------------  --------  ----------\n     29401             1  YZ             87144583    2452    SIPO\n     29402             2  ST             89597016    3372.7  UVER\n     29403             2  QR             13943797    7266    SIPO\n...\n\n\nCREATE TABLE \"trans\" (\ntrans_id bigint NOT NULL DEFAULT '0'::bigint,\naccount_id bigint NULL DEFAULT '0'::bigint,\ndate date NULL,\ntype text NULL,\noperation text NULL,\namount bigint NULL,\nbalance bigint NULL,\nk_symbol text NULL,\nbank text NULL,\naccount bigint NULL,\n    PRIMARY KEY (trans_id),\n    FOREIGN KEY (account_id) REFERENCES account(account_id)\n);\n\nFirst 3 rows:\n  trans_id    account_id  date        type    operation        amount    balance  k_symbol    bank          account\n----------  ------------  ----------  ------  -------------  --------  ---------  ----------  ------  -------------\n         1             1  1995-03-24  PRIJEM  VKLAD              1000       1000                      nan\n         5             1  1995-04-13  PRIJEM  PREVOD Z UCTU      3679       4679              AB        4.14033e+07\n         6             1  1995-05-13  PRIJEM  PREVOD Z UCTU      3679      20977              AB        4.14033e+07\n...\n", "preprocess_schema": "CREATE TABLE \"account\" (\naccount_id bigint NOT NULL DEFAULT '0'::bigint,\ndistrict_id bigint NULL DEFAULT '0'::bigint,\nfrequency text NULL,\ndate date NULL,\n    PRIMARY KEY (account_id),\n    FOREIGN KEY (district_id) REFERENCES district(district_id)\n);\n\nFirst 3 rows:\n  account_id    district_id  frequency         date\n------------  -------------  ----------------  ----------\n           1             18  POPLATEK MESICNE  1995-03-24\n           2              1  POPLATEK MESICNE  1993-02-26\n           3              5  POPLATEK MESICNE  1997-07-07\n...\n\n\nCREATE TABLE \"card\" (\ncard_id bigint NOT NULL DEFAULT '0'::bigint,\ndisp_id bigint NULL,\ntype text NULL,\nissued date NULL,\n    PRIMARY KEY (card_id),\n    FOREIGN KEY (disp_id) REFERENCES disp(disp_id)\n);\n\nFirst 3 rows:\n  card_id    disp_id  type     issued\n---------  ---------  -------  ----------\n        1          9  gold     1998-10-16\n        2         19  classic  1998-03-13\n        3         41  gold     1995-09-03\n...\n\n\nCREATE TABLE \"client\" (\nclient_id bigint NOT NULL,\ngender text NULL,\nbirth_date date NULL,\ndistrict_id bigint NULL,\n    PRIMARY KEY (client_id),\n    FOREIGN KEY (district_id) REFERENCES district(district_id)\n);\n\nFirst 3 rows:\n  client_id  gender    birth_date      district_id\n-----------  --------  ------------  -------------\n          1  F         1970-12-13               18\n          2  M         1945-02-04                1\n          3  F         1940-10-09                1\n...\n\n\nCREATE TABLE \"disp\" (\ndisp_id bigint NOT NULL,\nclient_id bigint NULL,\naccount_id bigint NULL,\ntype text NULL,\n    PRIMARY KEY (disp_id),\n    FOREIGN KEY (account_id) REFERENCES account(account_id),\n    FOREIGN KEY (client_id) REFERENCES client(client_id)\n);\n\nFirst 3 rows:\n  disp_id    client_id    account_id  type\n---------  -----------  ------------  ---------\n        1            1             1  OWNER\n        2            2             2  OWNER\n        3            3             2  DISPONENT\n...\n\n\nCREATE TABLE \"district\" (\ndistrict_id bigint NOT NULL DEFAULT '0'::bigint,\na2 text NULL,\na3 text NULL,\na4 text NULL,\na5 text NULL,\na6 text NULL,\na7 text NULL,\na8 bigint NULL,\na9 bigint NULL,\na10 real NULL,\na11 bigint NULL,\na12 real NULL,\na13 real NULL,\na14 bigint NULL,\na15 bigint NULL,\na16 bigint NULL,\n    PRIMARY KEY (district_id)\n);\n\nFirst 3 rows:\n  district_id  a2           a3                    a4    a5    a6    a7    a8    a9    a10    a11    a12    a13    a14    a15    a16\n-------------  -----------  ---------------  -------  ----  ----  ----  ----  ----  -----  -----  -----  -----  -----  -----  -----\n            1  Hl.m. Praha  Prague           1204953     0     0     0     1     1  100    12541    0.2   0.43    167  85677  99107\n            2  Benesov      central Bohemia    88884    80    26     6     2     5   46.7   8507    1.6   1.85    132   2159   2674\n            3  Beroun       central Bohemia    75232    55    26     4     1     5   41.7   8980    1.9   2.21    111   2824   2813\n...\n\n\nCREATE TABLE \"loan\" (\nloan_id bigint NOT NULL DEFAULT '0'::bigint,\naccount_id bigint NULL,\ndate date NULL,\namount bigint NULL,\nduration bigint NULL,\npayments real NULL,\nstatus text NULL,\n    PRIMARY KEY (loan_id),\n    FOREIGN KEY (account_id) REFERENCES account(account_id)\n);\n\nFirst 3 rows:\n  loan_id    account_id  date          amount    duration    payments  status\n---------  ------------  ----------  --------  ----------  ----------  --------\n     4959             2  1994-01-05     80952          24        3373  A\n     4961            19  1996-04-29     30276          12        2523  B\n     4962            25  1997-12-08     30276          12        2523  A\n...\n\n\nCREATE TABLE \"order\" (\norder_id bigint NOT NULL DEFAULT '0'::bigint,\naccount_id bigint NULL,\nbank_to text NULL,\naccount_to bigint NULL,\namount real NULL,\nk_symbol text NULL,\n    PRIMARY KEY (order_id),\n    FOREIGN KEY (account_id) REFERENCES account(account_id)\n);\n\nFirst 3 rows:\n  order_id    account_id  bank_to      account_to    amount  k_symbol\n----------  ------------  ---------  ------------  --------  ----------\n     29401             1  YZ             87144583    2452    SIPO\n     29402             2  ST             89597016    3372.7  UVER\n     29403             2  QR             13943797    7266    SIPO\n...\n\n\nCREATE TABLE \"trans\" (\ntrans_id bigint NOT NULL DEFAULT '0'::bigint,\naccount_id bigint NULL DEFAULT '0'::bigint,\ndate date NULL,\ntype text NULL,\noperation text NULL,\namount bigint NULL,\nbalance bigint NULL,\nk_symbol text NULL,\nbank text NULL,\naccount bigint NULL,\n    PRIMARY KEY (trans_id),\n    FOREIGN KEY (account_id) REFERENCES account(account_id)\n);\n\nFirst 3 rows:\n  trans_id    account_id  date        type    operation        amount    balance  k_symbol    bank          account\n----------  ------------  ----------  ------  -------------  --------  ---------  ----------  ------  -------------\n         1             1  1995-03-24  PRIJEM  VKLAD              1000       1000                      nan\n         5             1  1995-04-13  PRIJEM  PREVOD Z UCTU      3679       4679              AB        4.14033e+07\n         6             1  1995-05-13  PRIJEM  PREVOD Z UCTU      3679      20977              AB        4.14033e+07\n...\n", "sol_sql": ["DROP INDEX IF EXISTS idx_trans_covering; CREATE INDEX idx_trans_covering ON trans (account_id, bank, type) INCLUDE (trans_id, date, amount); SELECT t.trans_id, t.account_id, t.date, t.type, t.amount FROM trans t WHERE t.bank = 'AB' AND t.type IN ('PRIJEM','VYDAJ') AND EXISTS (SELECT 1 FROM account a WHERE a.account_id = t.account_id AND a.district_id = 18);"], "test_cases": ["\ndef test_case(pred_sqls, sol_sqls, db_name, conn):\n    result = ex_base(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"ex_base returned {result} but expected 1.\"\n    result = performance_compare_by_qep(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"performance_check returned {result} but expected 1.\"\n    return result\n    "]}
{"instance_id": "PostgreSQL_41", "dialect": "PostgreSQL", "version": "14.12", "db_id": "student_club", "query": "\nI have an event_attendance table and what I am trying to build should be one row for each member.\\nColumn definitions of the expected output:\\nGame_AttendanceDate : Latest attendance date based on date where EventType = 'Game'\\nGame_Attendances: Total number of Game events attended by each member.\\nWorkshop_AttendanceDate: Latest attendance date based on date where EventType = 'Workshop'\\nWorkshop_Attendances: Total number of Workshop events attended by each member.\\nTotal_Attendances: Total events attended by each member. I tried on one categories but I have to do this calculation for another 2 categories then that will add up another 2 sub queries. Is there anyway to optimize the SQL code?\n", "issue_sql": ["SELECT\n    COALESCE(a.MemberID, b.MemberID) AS MemberID,\n    a.AttendanceDate AS Latest_Game_Date,\n    a.Game_Attendance AS Total_Game_Attendance,\n    b.AttendanceDate AS Latest_Workshop_Date,\n    b.Workshop_Attendance AS Total_Workshop_Attendance,\n    a.Game_Attendance + b.Workshop_Attendance AS Total_Attendance\nFROM\n(\n    SELECT\n        MemberID,\n        EventType,\n        AttendanceDate,\n        COUNT(EventID) OVER(PARTITION BY MemberID, EventType) AS Game_Attendance,\n        ROW_NUMBER() OVER(PARTITION BY MemberID, EventType ORDER BY AttendanceDate DESC) AS RNUM\n    FROM event_attendance\n    WHERE EventType = 'Game'\n) a\nFULL JOIN\n(\n    SELECT\n        MemberID,\n        EventType,\n        AttendanceDate,\n        COUNT(EventID) OVER(PARTITION BY MemberID, EventType) AS Workshop_Attendance,\n        ROW_NUMBER() OVER(PARTITION BY MemberID, EventType ORDER BY AttendanceDate DESC) AS RNUM\n    FROM event_attendance\n    WHERE EventType = 'Workshop'\n) b\nON a.MemberID = b.MemberID\nWHERE (a.RNUM = 1 OR a.RNUM IS NULL) AND (b.RNUM = 1 OR b.RNUM IS NULL);"], "preprocess_sql": ["\nCREATE TABLE event_attendance (MemberID int, EventID int, EventType text, AttendanceDate date); INSERT INTO event_attendance (MemberID, EventID, EventType, AttendanceDate) VALUES (1, 101, 'Game', '2023-01-01'), (1, 102, 'Game', '2023-01-10'), (1, 103, 'Game', '2023-02-15'), (1, 104, 'Game', '2023-02-20'), (1, 105, 'Workshop', '2023-03-01'), (1, 106, 'Workshop', '2023-03-20'), (2, 107, 'Game', '2023-01-15'), (2, 108, 'Workshop', '2023-02-06');\n"], "clean_up_sql": ["DROP TABLE event_attendance;"], "category": "Efficiency", "original_schema": "CREATE TABLE \"attendance\" (\nlink_to_event text NOT NULL,\nlink_to_member text NOT NULL,\n    PRIMARY KEY (link_to_event, link_to_member),\n    FOREIGN KEY (link_to_event) REFERENCES event(event_id),\n    FOREIGN KEY (link_to_member) REFERENCES member(member_id)\n);\n\nFirst 3 rows:\nlink_to_event      link_to_member\n-----------------  -----------------\nrec2N69DMcrqN9PJC  recD078PnS3x2doBe\nrec2N69DMcrqN9PJC  recP6DJPyi5donvXL\nrec2N69DMcrqN9PJC  rec28ORZgcm1dtqBZ\n...\n\n\nCREATE TABLE \"budget\" (\nbudget_id text NOT NULL,\ncategory text NULL,\nspent real NULL,\nremaining real NULL,\namount bigint NULL,\nevent_status text NULL,\nlink_to_event text NULL,\n    PRIMARY KEY (budget_id),\n    FOREIGN KEY (link_to_event) REFERENCES event(event_id)\n);\n\nFirst 3 rows:\nbudget_id          category         spent    remaining    amount  event_status    link_to_event\n-----------------  -------------  -------  -----------  --------  --------------  -----------------\nrec0QmEc3cSQFQ6V2  Advertisement    67.81         7.19        75  Closed          recI43CzsZ0Q625ma\nrec1bG6HSft7XIvTP  Food            121.14        28.86       150  Closed          recggMW2eyCYceNcy\nrec1z6ISJU2HdIsVm  Food             20.2         -0.2         20  Closed          recJ4Witp9tpjaugn\n...\n\n\nCREATE TABLE \"event\" (\nevent_id text NOT NULL,\nevent_name text NULL,\nevent_date text NULL,\ntype text NULL,\nnotes text NULL,\nlocation text NULL,\nstatus text NULL,\n    PRIMARY KEY (event_id)\n);\n\nFirst 3 rows:\nevent_id           event_name                  event_date           type      location    status\n-----------------  --------------------------  -------------------  --------  ----------  --------\nrec0Si5cQ4rJRVzd6  March Meeting               2020-03-10T12:00:00  Meeting   MU 215      Open\nrec0akZnLLpGUloLH  Officers meeting - January  2020-01-14T09:30:00  Meeting               Open\nrec0dZPcWXF0QjNnE  Spring Elections            2019-11-24T09:00:00  Election  MU 215      Open\n...\n\n\nCREATE TABLE \"expense\" (\nexpense_id text NOT NULL,\nexpense_description text NULL,\nexpense_date text NULL,\ncost real NULL,\napproved text NULL,\nlink_to_member text NULL,\nlink_to_budget text NULL,\n    PRIMARY KEY (expense_id),\n    FOREIGN KEY (link_to_budget) REFERENCES budget(budget_id),\n    FOREIGN KEY (link_to_member) REFERENCES member(member_id)\n);\n\nFirst 3 rows:\nexpense_id         expense_description    expense_date      cost  approved    link_to_member     link_to_budget\n-----------------  ---------------------  --------------  ------  ----------  -----------------  -----------------\nrec017x6R3hQqkLAo  Post Cards, Posters    2019-08-20      122.06  true        rec4BLdZHS2Blfp4v  recvKTAWAFKkVNnXQ\nrec1nIjoZKTYayqZ6  Water, Cookies         2019-10-08       20.2   true        recro8T1MPMwRadVH  recy8KY5bUdzF81vv\nrec1oMgNFt7Y0G40x  Pizza                  2019-09-10       51.81  true        recD078PnS3x2doBe  recwXIiKoBMjXJsGZ\n...\n\n\nCREATE TABLE \"income\" (\nincome_id text NOT NULL,\ndate_received text NULL,\namount bigint NULL,\nsource text NULL,\nnotes text NULL,\nlink_to_member text NULL,\n    PRIMARY KEY (income_id),\n    FOREIGN KEY (link_to_member) REFERENCES member(member_id)\n);\n\nFirst 3 rows:\nincome_id          date_received      amount  source    notes    link_to_member\n-----------------  ---------------  --------  --------  -------  -----------------\nrec0s9ZrO15zhzUeE  2019-10-17             50  Dues               reccW7q1KkhSKZsea\nrec7f5XMQZexgtQJo  2019-09-04             50  Dues               recTjHY5xXhvkCdVT\nrec8BUJa8GXUjiglg  2019-10-08             50  Dues               recUdRhbhcEO1Hk5r\n...\n\n\nCREATE TABLE \"major\" (\nmajor_id text NOT NULL,\nmajor_name text NULL,\ndepartment text NULL,\ncollege text NULL,\n    PRIMARY KEY (major_id)\n);\n\nFirst 3 rows:\nmajor_id           major_name                              department                                            college\n-----------------  --------------------------------------  ----------------------------------------------------  -------------------------------------------\nrec06DF6vZ1CyPKpc  Outdoor Product Design and Development  School of Applied Sciences, Technology and Education  College of Agriculture and Applied Sciences\nrec09LedkREyskCNv  Agricultural Communication              School of Applied Sciences, Technology and Education  College of Agriculture and Applied Sciences\nrec0Eanv576RhQllI  Fisheries and Aquatic Sciences          Watershed Sciences Department                         College of Natural Resources\n...\n\n\nCREATE TABLE \"member\" (\nmember_id text NOT NULL,\nfirst_name text NULL,\nlast_name text NULL,\nemail text NULL,\nposition text NULL,\nt_shirt_size text NULL,\nphone text NULL,\nzip bigint NULL,\nlink_to_major text NULL,\n    PRIMARY KEY (member_id),\n    FOREIGN KEY (link_to_major) REFERENCES major(major_id),\n    FOREIGN KEY (zip) REFERENCES zip_code(zip_code)\n);\n\nFirst 3 rows:\nmember_id          first_name    last_name    email                   position    t_shirt_size    phone             zip  link_to_major\n-----------------  ------------  -----------  ----------------------  ----------  --------------  --------------  -----  -----------------\nrec1x5zBFIqoOuPW8  Angela        Sanders      angela.sanders@lpu.edu  Member      Medium          (651) 928-4507  55108  recxK3MHQFbR9J5uO\nrec280Sk7o31iG0Tx  Grant         Gilmour      grant.gilmour@lpu.edu   Member      X-Large         403-555-1310    29440  rec7BxKpjJ7bNph3O\nrec28ORZgcm1dtqBZ  Luisa         Guidi        luisa.guidi@lpu.edu     Member      Medium          442-555-5882    10002  recdIBgeU38UbV2sy\n...\n\n\nCREATE TABLE \"zip_code\" (\nzip_code bigint NOT NULL,\ntype text NULL,\ncity text NULL,\ncounty text NULL,\nstate text NULL,\nshort_state text NULL,\n    PRIMARY KEY (zip_code)\n);\n\nFirst 3 rows:\n  zip_code  type      city        county              state        short_state\n----------  --------  ----------  ------------------  -----------  -------------\n       501  Unique    Holtsville  Suffolk County      New York     NY\n       544  Unique    Holtsville  Suffolk County      New York     NY\n       601  Standard  Adjuntas    Adjuntas Municipio  Puerto Rico  PR\n...\n", "preprocess_schema": "CREATE TABLE \"attendance\" (\nlink_to_event text NOT NULL,\nlink_to_member text NOT NULL,\n    PRIMARY KEY (link_to_event, link_to_member),\n    FOREIGN KEY (link_to_event) REFERENCES event(event_id),\n    FOREIGN KEY (link_to_member) REFERENCES member(member_id)\n);\n\nFirst 3 rows:\nlink_to_event      link_to_member\n-----------------  -----------------\nrec2N69DMcrqN9PJC  recD078PnS3x2doBe\nrec2N69DMcrqN9PJC  recP6DJPyi5donvXL\nrec2N69DMcrqN9PJC  rec28ORZgcm1dtqBZ\n...\n\n\nCREATE TABLE \"budget\" (\nbudget_id text NOT NULL,\ncategory text NULL,\nspent real NULL,\nremaining real NULL,\namount bigint NULL,\nevent_status text NULL,\nlink_to_event text NULL,\n    PRIMARY KEY (budget_id),\n    FOREIGN KEY (link_to_event) REFERENCES event(event_id)\n);\n\nFirst 3 rows:\nbudget_id          category         spent    remaining    amount  event_status    link_to_event\n-----------------  -------------  -------  -----------  --------  --------------  -----------------\nrec0QmEc3cSQFQ6V2  Advertisement    67.81         7.19        75  Closed          recI43CzsZ0Q625ma\nrec1bG6HSft7XIvTP  Food            121.14        28.86       150  Closed          recggMW2eyCYceNcy\nrec1z6ISJU2HdIsVm  Food             20.2         -0.2         20  Closed          recJ4Witp9tpjaugn\n...\n\n\nCREATE TABLE \"event\" (\nevent_id text NOT NULL,\nevent_name text NULL,\nevent_date text NULL,\ntype text NULL,\nnotes text NULL,\nlocation text NULL,\nstatus text NULL,\n    PRIMARY KEY (event_id)\n);\n\nFirst 3 rows:\nevent_id           event_name                  event_date           type      location    status\n-----------------  --------------------------  -------------------  --------  ----------  --------\nrec0Si5cQ4rJRVzd6  March Meeting               2020-03-10T12:00:00  Meeting   MU 215      Open\nrec0akZnLLpGUloLH  Officers meeting - January  2020-01-14T09:30:00  Meeting               Open\nrec0dZPcWXF0QjNnE  Spring Elections            2019-11-24T09:00:00  Election  MU 215      Open\n...\n\n\nCREATE TABLE \"event_attendance\" (\nmemberid integer NULL,\neventid integer NULL,\neventtype text NULL,\nattendancedate date NULL\n);\n\nFirst 3 rows:\n  memberid    eventid  eventtype    attendancedate\n----------  ---------  -----------  ----------------\n         1        101  Game         2023-01-01\n         1        102  Game         2023-01-10\n         1        103  Game         2023-02-15\n...\n\n\nCREATE TABLE \"expense\" (\nexpense_id text NOT NULL,\nexpense_description text NULL,\nexpense_date text NULL,\ncost real NULL,\napproved text NULL,\nlink_to_member text NULL,\nlink_to_budget text NULL,\n    PRIMARY KEY (expense_id),\n    FOREIGN KEY (link_to_budget) REFERENCES budget(budget_id),\n    FOREIGN KEY (link_to_member) REFERENCES member(member_id)\n);\n\nFirst 3 rows:\nexpense_id         expense_description    expense_date      cost  approved    link_to_member     link_to_budget\n-----------------  ---------------------  --------------  ------  ----------  -----------------  -----------------\nrec017x6R3hQqkLAo  Post Cards, Posters    2019-08-20      122.06  true        rec4BLdZHS2Blfp4v  recvKTAWAFKkVNnXQ\nrec1nIjoZKTYayqZ6  Water, Cookies         2019-10-08       20.2   true        recro8T1MPMwRadVH  recy8KY5bUdzF81vv\nrec1oMgNFt7Y0G40x  Pizza                  2019-09-10       51.81  true        recD078PnS3x2doBe  recwXIiKoBMjXJsGZ\n...\n\n\nCREATE TABLE \"income\" (\nincome_id text NOT NULL,\ndate_received text NULL,\namount bigint NULL,\nsource text NULL,\nnotes text NULL,\nlink_to_member text NULL,\n    PRIMARY KEY (income_id),\n    FOREIGN KEY (link_to_member) REFERENCES member(member_id)\n);\n\nFirst 3 rows:\nincome_id          date_received      amount  source    notes    link_to_member\n-----------------  ---------------  --------  --------  -------  -----------------\nrec0s9ZrO15zhzUeE  2019-10-17             50  Dues               reccW7q1KkhSKZsea\nrec7f5XMQZexgtQJo  2019-09-04             50  Dues               recTjHY5xXhvkCdVT\nrec8BUJa8GXUjiglg  2019-10-08             50  Dues               recUdRhbhcEO1Hk5r\n...\n\n\nCREATE TABLE \"major\" (\nmajor_id text NOT NULL,\nmajor_name text NULL,\ndepartment text NULL,\ncollege text NULL,\n    PRIMARY KEY (major_id)\n);\n\nFirst 3 rows:\nmajor_id           major_name                              department                                            college\n-----------------  --------------------------------------  ----------------------------------------------------  -------------------------------------------\nrec06DF6vZ1CyPKpc  Outdoor Product Design and Development  School of Applied Sciences, Technology and Education  College of Agriculture and Applied Sciences\nrec09LedkREyskCNv  Agricultural Communication              School of Applied Sciences, Technology and Education  College of Agriculture and Applied Sciences\nrec0Eanv576RhQllI  Fisheries and Aquatic Sciences          Watershed Sciences Department                         College of Natural Resources\n...\n\n\nCREATE TABLE \"member\" (\nmember_id text NOT NULL,\nfirst_name text NULL,\nlast_name text NULL,\nemail text NULL,\nposition text NULL,\nt_shirt_size text NULL,\nphone text NULL,\nzip bigint NULL,\nlink_to_major text NULL,\n    PRIMARY KEY (member_id),\n    FOREIGN KEY (link_to_major) REFERENCES major(major_id),\n    FOREIGN KEY (zip) REFERENCES zip_code(zip_code)\n);\n\nFirst 3 rows:\nmember_id          first_name    last_name    email                   position    t_shirt_size    phone             zip  link_to_major\n-----------------  ------------  -----------  ----------------------  ----------  --------------  --------------  -----  -----------------\nrec1x5zBFIqoOuPW8  Angela        Sanders      angela.sanders@lpu.edu  Member      Medium          (651) 928-4507  55108  recxK3MHQFbR9J5uO\nrec280Sk7o31iG0Tx  Grant         Gilmour      grant.gilmour@lpu.edu   Member      X-Large         403-555-1310    29440  rec7BxKpjJ7bNph3O\nrec28ORZgcm1dtqBZ  Luisa         Guidi        luisa.guidi@lpu.edu     Member      Medium          442-555-5882    10002  recdIBgeU38UbV2sy\n...\n\n\nCREATE TABLE \"zip_code\" (\nzip_code bigint NOT NULL,\ntype text NULL,\ncity text NULL,\ncounty text NULL,\nstate text NULL,\nshort_state text NULL,\n    PRIMARY KEY (zip_code)\n);\n\nFirst 3 rows:\n  zip_code  type      city        county              state        short_state\n----------  --------  ----------  ------------------  -----------  -------------\n       501  Unique    Holtsville  Suffolk County      New York     NY\n       544  Unique    Holtsville  Suffolk County      New York     NY\n       601  Standard  Adjuntas    Adjuntas Municipio  Puerto Rico  PR\n...\n", "sol_sql": ["\nSELECT\n    ea.MemberID,\n    MAX(CASE WHEN ea.EventType = 'Game' THEN ea.AttendanceDate END) AS Latest_Game_Date,\n    SUM(CASE WHEN ea.EventType = 'Game' THEN 1 ELSE 0 END) AS Total_Game_Attendance,\n    MAX(CASE WHEN ea.EventType = 'Workshop' THEN ea.AttendanceDate END) AS Latest_Workshop_Date,\n    SUM(CASE WHEN ea.EventType = 'Workshop' THEN 1 ELSE 0 END) AS Total_Workshop_Attendance,\n    COUNT(*) AS Total_Attendance\nFROM (\n    SELECT MemberID, EventType, AttendanceDate\n    FROM event_attendance\n    WHERE EventType IN ('Game', 'Workshop')\n) ea\nGROUP BY ea.MemberID\nORDER BY ea.MemberID;\n"], "test_cases": ["def test_case(pred_sqls, sol_sqls, db_name, conn):\n    assert len(pred_query_result) == 2, f'Expected 2 rows, but found {len(pred_query_result)} rows'\n\n    ", "\nimport datetime\ndef test_case(pred_sqls, sol_sqls, db_name, conn):\n    assert pred_query_result[0][0] == 1, f'Expected MemberID 1 in the first row, but found {pred_query_result[0][0]}'\n    pred_game_date = pred_query_result[0][1]\n    pred_game_date_str = pred_game_date.strftime('%Y-%m-%d')\n    expected_date_str = '2023-02-20'\n    assert pred_game_date_str == expected_date_str, f'Expected Game_AttendanceDate 2023-02-20 for MemberID 1, but found {pred_game_date_str}'\n    assert pred_query_result[1][4] == 1, f'Expected Workshop_Attendances 1 for MemberID 2, but found {pred_query_result[1][4]}'\n\n    assert pred_query_result[0][5] == 6, f'Expected Total_Attendances 6 for MemberID 1, but found {pred_query_result[0][5]}'\n    ", "\ndef test_case(pred_sqls, sol_sqls, db_name, conn):\n    result = ex_base(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"ex_base returned {result} but expected 1.\"\n    result = performance_compare_by_qep(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"performance_check returned {result} but expected 1.\"\n    return result"]}
{"instance_id": "PostgreSQL_47", "dialect": "PostgreSQL", "version": "14.12", "db_id": "thrombosis_prediction", "query": "In the thrombosis_prediction database, we have a set of normalized tables representing patients, medications, and their prescriptions. Each patient can be prescribed multiple medications, and each medication can be prescribed to multiple patients. For reporting purposes, we need a highly denormalized view that shows each patient's name and a list of all medications they are prescribed. However, when we filter the list to show only patients who are prescribed a specific medication (e.g., Aspirin), we lose the information about other medications those patients are prescribed. We want to filter by a specific medication but still get a list of all medications that a patient is prescribed in one row.", "issue_sql": ["WITH aspirin_patients AS ( SELECT DISTINCT patient_id FROM prescriptions WHERE medication_id = 1 ) SELECT p.patient_id, array_agg(DISTINCT p.medication_id ORDER BY p.medication_id) AS medications FROM prescriptions p JOIN aspirin_patients ap ON p.patient_id = ap.patient_id GROUP BY p.patient_id;"], "preprocess_sql": ["CREATE TABLE patients ( patient_id SERIAL PRIMARY KEY, patient_name TEXT NOT NULL );", "CREATE TABLE medications ( medication_id SERIAL PRIMARY KEY, medication_name TEXT NOT NULL );", "CREATE TABLE prescriptions ( patient_id INT REFERENCES patients (patient_id), medication_id INT REFERENCES medications (medication_id), PRIMARY KEY (patient_id, medication_id) );", "INSERT INTO patients (patient_name) VALUES ('Alice'), ('Bob'), ('Charlie');", "INSERT INTO medications (medication_name) VALUES ('Aspirin'), ('Ibuprofen'), ('Paracetamol'), ('Warfarin');", "INSERT INTO prescriptions (patient_id, medication_id) VALUES (1, 1), (1, 2), (1, 3);", "INSERT INTO prescriptions (patient_id, medication_id) VALUES (2, 2);", "INSERT INTO prescriptions (patient_id, medication_id) VALUES (3, 2), (3, 1), (3, 3), (3, 4);"], "clean_up_sql": [], "category": "Efficiency", "original_schema": "CREATE TABLE \"examination\" (\nid bigint NULL,\nExamination Date date NULL,\naCL IgG real NULL,\naCL IgM real NULL,\nana bigint NULL,\nANA Pattern text NULL,\naCL IgA bigint NULL,\ndiagnosis text NULL,\nkct text NULL,\nrvvt text NULL,\nlac text NULL,\nsymptoms text NULL,\nthrombosis bigint NULL,\n    FOREIGN KEY (id) REFERENCES patient(id)\n);\n\nFirst 3 rows:\n    id  Examination Date      aCL IgG    aCL IgM    ana  ANA Pattern      aCL IgA  diagnosis    kct    rvvt    lac    symptoms      thrombosis\n------  ------------------  ---------  ---------  -----  -------------  ---------  -----------  -----  ------  -----  ----------  ------------\n 14872  1997-05-27                1.3        1.6    256  P                      0  MCTD, AMI                   -      AMI                    1\n 48473  1992-12-21                4.3        4.6    256  P,S                    3  SLE          -      -       -                             0\n102490  1995-04-20                2.3        2.5      0                         4  PSS                                                       0\n...\n\n\nCREATE TABLE \"laboratory\" (\nid bigint NULL DEFAULT '0'::bigint,\ndate date NULL,\ngot bigint NULL,\ngpt bigint NULL,\nldh bigint NULL,\nalp bigint NULL,\ntp real NULL,\nalb real NULL,\nua real NULL,\nun bigint NULL,\ncre real NULL,\nT-BIL real NULL,\nT-CHO bigint NULL,\ntg bigint NULL,\ncpk bigint NULL,\nglu bigint NULL,\nwbc real NULL,\nrbc real NULL,\nhgb real NULL,\nhct real NULL,\nplt bigint NULL,\npt real NULL,\naptt bigint NULL,\nfg real NULL,\npic bigint NULL,\ntat bigint NULL,\ntat2 bigint NULL,\nU-PRO text NULL,\nigg bigint NULL,\niga bigint NULL,\nigm bigint NULL,\ncrp text NULL,\nra text NULL,\nrf text NULL,\nc3 bigint NULL,\nc4 bigint NULL,\nrnp text NULL,\nsm text NULL,\nsc170 text NULL,\nssa text NULL,\nssb text NULL,\ncentromea text NULL,\ndna text NULL,\nDNA-II bigint NULL,\n    FOREIGN KEY (id) REFERENCES patient(id)\n);\n\nFirst 3 rows:\n   id  date          got    gpt    ldh    alp    tp    alb    ua    un    cre    T-BIL    T-CHO  tg      cpk    glu    wbc    rbc    hgb    hct    plt  pt    aptt    fg    pic    tat    tat2    U-PRO      igg    iga    igm    crp  ra    rf    c3    c4    rnp    sm    sc170    ssa    ssb    centromea    dna    DNA-II\n-----  ----------  -----  -----  -----  -----  ----  -----  ----  ----  -----  -------  -------  ----  -----  -----  -----  -----  -----  -----  -----  ----  ------  ----  -----  -----  ------  -------  -----  -----  -----  -----  ----  ----  ----  ----  -----  ----  -------  -----  -----  -----------  -----  --------\n27654  1991-09-11     34     36    567    166   4.5    3.3   3.8    29    0.8      0.3      165            9    nan    5      2.6    6.4   20.3    227                                                       339    145     46    0.6\n27654  1991-09-17     29     31    579    154   5.1    3.4   4.2    36    0.8    nan        nan          nan    nan   10.4    2.9    6.7   21.6    242                                                       771    188    132    0.6\n27654  1991-09-19     26     22    684    138   5.5    3.6   4.9    34    0.9    nan        nan          nan     88   10.5    3.4    7.9   24.7    233                                                       nan    nan    nan    2.7\n...\n\n\nCREATE TABLE \"patient\" (\nid bigint NOT NULL DEFAULT '0'::bigint,\nsex text NULL,\nbirthday date NULL,\ndescription date NULL,\nFirst Date date NULL,\nadmission text NULL,\ndiagnosis text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n   id  sex    birthday    description    First Date    admission    diagnosis\n-----  -----  ----------  -------------  ------------  -----------  -----------\n 2110  F      1934-02-13  1994-02-14     1993-02-10    +            RA susp.\n11408  F      1937-05-02  1996-12-01     1973-01-01    +            PSS\n12052  F      1956-04-14  1991-08-13                   +            SLE\n...\n", "preprocess_schema": "CREATE TABLE \"examination\" (\nid bigint NULL,\nExamination Date date NULL,\naCL IgG real NULL,\naCL IgM real NULL,\nana bigint NULL,\nANA Pattern text NULL,\naCL IgA bigint NULL,\ndiagnosis text NULL,\nkct text NULL,\nrvvt text NULL,\nlac text NULL,\nsymptoms text NULL,\nthrombosis bigint NULL,\n    FOREIGN KEY (id) REFERENCES patient(id)\n);\n\nFirst 3 rows:\n    id  Examination Date      aCL IgG    aCL IgM    ana  ANA Pattern      aCL IgA  diagnosis    kct    rvvt    lac    symptoms      thrombosis\n------  ------------------  ---------  ---------  -----  -------------  ---------  -----------  -----  ------  -----  ----------  ------------\n 14872  1997-05-27                1.3        1.6    256  P                      0  MCTD, AMI                   -      AMI                    1\n 48473  1992-12-21                4.3        4.6    256  P,S                    3  SLE          -      -       -                             0\n102490  1995-04-20                2.3        2.5      0                         4  PSS                                                       0\n...\n\n\nCREATE TABLE \"laboratory\" (\nid bigint NULL DEFAULT '0'::bigint,\ndate date NULL,\ngot bigint NULL,\ngpt bigint NULL,\nldh bigint NULL,\nalp bigint NULL,\ntp real NULL,\nalb real NULL,\nua real NULL,\nun bigint NULL,\ncre real NULL,\nT-BIL real NULL,\nT-CHO bigint NULL,\ntg bigint NULL,\ncpk bigint NULL,\nglu bigint NULL,\nwbc real NULL,\nrbc real NULL,\nhgb real NULL,\nhct real NULL,\nplt bigint NULL,\npt real NULL,\naptt bigint NULL,\nfg real NULL,\npic bigint NULL,\ntat bigint NULL,\ntat2 bigint NULL,\nU-PRO text NULL,\nigg bigint NULL,\niga bigint NULL,\nigm bigint NULL,\ncrp text NULL,\nra text NULL,\nrf text NULL,\nc3 bigint NULL,\nc4 bigint NULL,\nrnp text NULL,\nsm text NULL,\nsc170 text NULL,\nssa text NULL,\nssb text NULL,\ncentromea text NULL,\ndna text NULL,\nDNA-II bigint NULL,\n    FOREIGN KEY (id) REFERENCES patient(id)\n);\n\nFirst 3 rows:\n   id  date          got    gpt    ldh    alp    tp    alb    ua    un    cre    T-BIL    T-CHO  tg      cpk    glu    wbc    rbc    hgb    hct    plt  pt    aptt    fg    pic    tat    tat2    U-PRO      igg    iga    igm    crp  ra    rf    c3    c4    rnp    sm    sc170    ssa    ssb    centromea    dna    DNA-II\n-----  ----------  -----  -----  -----  -----  ----  -----  ----  ----  -----  -------  -------  ----  -----  -----  -----  -----  -----  -----  -----  ----  ------  ----  -----  -----  ------  -------  -----  -----  -----  -----  ----  ----  ----  ----  -----  ----  -------  -----  -----  -----------  -----  --------\n27654  1991-09-11     34     36    567    166   4.5    3.3   3.8    29    0.8      0.3      165            9    nan    5      2.6    6.4   20.3    227                                                       339    145     46    0.6\n27654  1991-09-17     29     31    579    154   5.1    3.4   4.2    36    0.8    nan        nan          nan    nan   10.4    2.9    6.7   21.6    242                                                       771    188    132    0.6\n27654  1991-09-19     26     22    684    138   5.5    3.6   4.9    34    0.9    nan        nan          nan     88   10.5    3.4    7.9   24.7    233                                                       nan    nan    nan    2.7\n...\n\n\nCREATE TABLE \"medications\" (\nmedication_id integer NOT NULL DEFAULT nextval('medications_medication_id_seq'::regclass),\nmedication_name text NOT NULL,\n    PRIMARY KEY (medication_id)\n);\n\nFirst 3 rows:\n  medication_id  medication_name\n---------------  -----------------\n              1  Aspirin\n              2  Ibuprofen\n              3  Paracetamol\n...\n\n\nCREATE TABLE \"patient\" (\nid bigint NOT NULL DEFAULT '0'::bigint,\nsex text NULL,\nbirthday date NULL,\ndescription date NULL,\nFirst Date date NULL,\nadmission text NULL,\ndiagnosis text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n   id  sex    birthday    description    First Date    admission    diagnosis\n-----  -----  ----------  -------------  ------------  -----------  -----------\n 2110  F      1934-02-13  1994-02-14     1993-02-10    +            RA susp.\n11408  F      1937-05-02  1996-12-01     1973-01-01    +            PSS\n12052  F      1956-04-14  1991-08-13                   +            SLE\n...\n\n\nCREATE TABLE \"patients\" (\npatient_id integer NOT NULL DEFAULT nextval('patients_patient_id_seq'::regclass),\npatient_name text NOT NULL,\n    PRIMARY KEY (patient_id)\n);\n\nFirst 3 rows:\n  patient_id  patient_name\n------------  --------------\n           1  Alice\n           2  Bob\n           3  Charlie\n...\n\n\nCREATE TABLE \"prescriptions\" (\npatient_id integer NOT NULL,\nmedication_id integer NOT NULL,\n    PRIMARY KEY (patient_id, medication_id),\n    FOREIGN KEY (patient_id) REFERENCES patients(patient_id),\n    FOREIGN KEY (medication_id) REFERENCES medications(medication_id)\n);\n\nFirst 3 rows:\n  patient_id    medication_id\n------------  ---------------\n           1                1\n           1                2\n           1                3\n...\n", "sol_sql": ["SELECT p.patient_id, array_agg(DISTINCT p.medication_id ORDER BY p.medication_id) AS medications FROM prescriptions p WHERE p.patient_id IN (SELECT patient_id FROM prescriptions WHERE medication_id = 1)GROUP BY p.patient_id;"], "test_cases": ["\ndef test_case(pred_sqls, sol_sqls, db_name, conn):\n    pred_sqls_result = execute_queries(pred_sqls, db_name, conn)\n    sol_sqls_result = execute_queries(sol_sqls, db_name, conn)\n    assert pred_sqls_result == sol_sqls_result, f\"Expected pred_result and sol_result are the same but pred_result is {pred_sqls_result} and sol_result is {sol_sqls_result}.\"\n    result = performance_compare_by_qep(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"performance_check returned {result} but expected 1.\"\n    return result\n    "]}
{"instance_id": "PostgreSQL_55", "dialect": "PostgreSQL", "version": "14.12", "db_id": "debit_card_specializing", "query": "In the table clients_to_groups, we need to identify clients who have made transactions at gas stations that belong to specific groups. Specifically, we want to find clients who have made transactions at gas stations that are either in the group 1 or 3 AND also in group 5 or 6. For example, a client who has made transactions at a gas station in the group 5 and another transaction at a gas station in the group 1 should be included in the results, but a client who has only made transactions at gas stations in the group 5 should not be included.", "issue_sql": ["SELECT DISTINCT c.id FROM clients c INNER JOIN clients_to_groups at1 ON c.id = at1.client_id INNER JOIN clients_to_groups at2 ON c.id = at2.client_id WHERE at1.group_id IN (5, 6) AND at2.group_id IN (1, 3);"], "preprocess_sql": ["CREATE TABLE clients (id INT NOT NULL);", "CREATE TABLE groups (id INT NOT NULL);", "CREATE TABLE clients_to_groups (id serial, group_id INT, client_id INT);", "INSERT INTO clients(id) VALUES (0), (1), (2), (3);", "INSERT INTO groups(id) VALUES (1), (3), (5), (6);", "INSERT INTO clients_to_groups(client_id, group_id) VALUES (0, 1), (0, 5), (1, 1), (1, 90), (2, 1), (3, 3), (3, 5), (3, 90);", "INSERT INTO clients (id) SELECT random() from generate_series(1,2000);", "INSERT INTO clients_to_groups(client_id, group_id) SELECT random(), random() from generate_series(1,2000);"], "clean_up_sql": ["DROP TABLE clients;", "DROP TABLE groups;", "DROP TABLE clients_to_groups;"], "category": "Efficiency", "original_schema": "CREATE TABLE \"customers\" (\ncustomerid bigint NOT NULL,\nsegment text NULL,\ncurrency text NULL,\n    PRIMARY KEY (customerid)\n);\n\nFirst 3 rows:\n  customerid  segment    currency\n------------  ---------  ----------\n           3  SME        EUR\n           5  LAM        EUR\n           6  SME        EUR\n...\n\n\nCREATE TABLE \"gasstations\" (\ngasstationid bigint NOT NULL,\nchainid bigint NULL,\ncountry text NULL,\nsegment text NULL,\n    PRIMARY KEY (gasstationid)\n);\n\nFirst 3 rows:\n  gasstationid    chainid  country    segment\n--------------  ---------  ---------  ---------------\n            44         13  CZE        Value for money\n            45          6  CZE        Premium\n            46         23  CZE        Other\n...\n\n\nCREATE TABLE \"products\" (\nproductid bigint NOT NULL,\ndescription text NULL,\n    PRIMARY KEY (productid)\n);\n\nFirst 3 rows:\n  productid  description\n-----------  -------------\n          1  Rucní zadání\n          2  Nafta\n          3  Special\n...\n\n\nCREATE TABLE \"transactions_1k\" (\ntransactionid bigint NOT NULL DEFAULT nextval('transactions_1k_transactionid_seq'::regclass),\ndate date NULL,\ntime text NULL,\ncustomerid bigint NULL,\ncardid bigint NULL,\ngasstationid bigint NULL,\nproductid bigint NULL,\namount bigint NULL,\nprice real NULL,\n    PRIMARY KEY (transactionid)\n);\n\nFirst 3 rows:\n  transactionid  date        time        customerid    cardid    gasstationid    productid    amount    price\n---------------  ----------  --------  ------------  --------  --------------  -----------  --------  -------\n              1  2012-08-24  09:41:00         31543    486621            3704            2        28   672.64\n              2  2012-08-24  10:03:00         46707    550134            3704            2        18   430.72\n              3  2012-08-24  10:03:00         46707    550134            3704           23         1   121.99\n...\n\n\nCREATE TABLE \"yearmonth\" (\ncustomerid bigint NULL,\ndate text NULL,\nconsumption real NULL\n);\n\nFirst 3 rows:\n  customerid    date    consumption\n------------  ------  -------------\n           5  201207         528.3\n           5  201302        1598.28\n           5  201303        1931.36\n...\n", "preprocess_schema": "CREATE TABLE \"clients\" (\nid integer NOT NULL\n);\n\nFirst 3 rows:\n  id\n----\n   0\n   1\n   2\n...\n\n\nCREATE TABLE \"clients_to_groups\" (\nid integer NOT NULL DEFAULT nextval('clients_to_groups_id_seq'::regclass),\ngroup_id integer NULL,\nclient_id integer NULL\n);\n\nFirst 3 rows:\n  id    group_id    client_id\n----  ----------  -----------\n   1           1            0\n   2           5            0\n   3           1            1\n...\n\n\nCREATE TABLE \"customers\" (\ncustomerid bigint NOT NULL,\nsegment text NULL,\ncurrency text NULL,\n    PRIMARY KEY (customerid)\n);\n\nFirst 3 rows:\n  customerid  segment    currency\n------------  ---------  ----------\n           3  SME        EUR\n           5  LAM        EUR\n           6  SME        EUR\n...\n\n\nCREATE TABLE \"gasstations\" (\ngasstationid bigint NOT NULL,\nchainid bigint NULL,\ncountry text NULL,\nsegment text NULL,\n    PRIMARY KEY (gasstationid)\n);\n\nFirst 3 rows:\n  gasstationid    chainid  country    segment\n--------------  ---------  ---------  ---------------\n            44         13  CZE        Value for money\n            45          6  CZE        Premium\n            46         23  CZE        Other\n...\n\n\nCREATE TABLE \"groups\" (\nid integer NOT NULL\n);\n\nFirst 3 rows:\n  id\n----\n   1\n   3\n   5\n...\n\n\nCREATE TABLE \"products\" (\nproductid bigint NOT NULL,\ndescription text NULL,\n    PRIMARY KEY (productid)\n);\n\nFirst 3 rows:\n  productid  description\n-----------  -------------\n          1  Rucní zadání\n          2  Nafta\n          3  Special\n...\n\n\nCREATE TABLE \"transactions_1k\" (\ntransactionid bigint NOT NULL DEFAULT nextval('transactions_1k_transactionid_seq'::regclass),\ndate date NULL,\ntime text NULL,\ncustomerid bigint NULL,\ncardid bigint NULL,\ngasstationid bigint NULL,\nproductid bigint NULL,\namount bigint NULL,\nprice real NULL,\n    PRIMARY KEY (transactionid)\n);\n\nFirst 3 rows:\n  transactionid  date        time        customerid    cardid    gasstationid    productid    amount    price\n---------------  ----------  --------  ------------  --------  --------------  -----------  --------  -------\n              1  2012-08-24  09:41:00         31543    486621            3704            2        28   672.64\n              2  2012-08-24  10:03:00         46707    550134            3704            2        18   430.72\n              3  2012-08-24  10:03:00         46707    550134            3704           23         1   121.99\n...\n\n\nCREATE TABLE \"yearmonth\" (\ncustomerid bigint NULL,\ndate text NULL,\nconsumption real NULL\n);\n\nFirst 3 rows:\n  customerid    date    consumption\n------------  ------  -------------\n           5  201207         528.3\n           5  201302        1598.28\n           5  201303        1931.36\n...\n", "sol_sql": ["SELECT c.id  FROM clients c INNER JOIN clients_to_groups ctg ON c.id = ctg.client_id AND ctg.group_id IN (1,3,5,6) GROUP BY c.id HAVING  COUNT(CASE WHEN ctg.group_id IN (1,3) THEN 1 END) > 0 AND COUNT(CASE WHEN ctg.group_id IN (5,6) THEN 1 END) > 0;"], "test_cases": ["\ndef test_case(pred_sqls, sol_sqls, db_name, conn):\n    result = ex_base(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"ex_base returned {result} but expected 1.\"\n    result = performance_compare_by_qep(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"performance_check returned {result} but expected 1.\"\n    return result\n    "]}
{"instance_id": "PostgreSQL_58", "dialect": "PostgreSQL", "version": "14.12", "db_id": "toxicology", "query": "In the toxicology database, we have a table named 'atom_edits' that records updates to the 'atom' table. Users can update the 'element' or 'molecule_id' of an atom. If a field is not updated, it retains a NULL value. Here's an example of four edits touching two separate atoms. Atom with ID 'TR000_1' received two updates: the first one is updating the 'element' field, the second one touches the 'molecule_id'. Atom with ID 'TR000_2' received one update that changes the 'element'. We need to merge this table such that in the resulting table there's one row per atom, giving the cumulative edits.", "issue_sql": ["SELECT atom_id, (ARRAY_REMOVE(ARRAY_AGG(element ORDER BY edit_id DESC), NULL))[1] AS element, (ARRAY_REMOVE(ARRAY_AGG(molecule_id ORDER BY edit_id DESC), NULL))[1] AS molecule_id FROM atom_edits GROUP BY atom_id;"], "preprocess_sql": ["CREATE TABLE atom_edits (edit_id SERIAL PRIMARY KEY, atom_id TEXT, element TEXT, molecule_id TEXT, created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP, modified_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP, edit_type VARCHAR(50) DEFAULT 'standard', edit_status VARCHAR(20) DEFAULT 'pending', edit_source VARCHAR(100) DEFAULT 'manual', edit_notes TEXT DEFAULT NULL, edit_version INTEGER DEFAULT 1, is_approved BOOLEAN DEFAULT FALSE, approval_date TIMESTAMP WITH TIME ZONE DEFAULT NULL, approved_by VARCHAR(100) DEFAULT NULL, metadata JSONB DEFAULT '{}'::jsonb, priority INTEGER DEFAULT 5, batch_id UUID DEFAULT gen_random_uuid(), processing_time NUMERIC(10,2) DEFAULT 0.0, is_deleted BOOLEAN DEFAULT FALSE, deletion_date TIMESTAMP WITH TIME ZONE DEFAULT NULL);", "INSERT INTO atom_edits (atom_id, element, molecule_id, created_at, modified_at, edit_type, edit_status, edit_source, edit_notes, edit_version, is_approved, approval_date, approved_by, metadata, priority, batch_id, processing_time, is_deleted, deletion_date) VALUES ('TR000_1', 'cl', NULL, '2023-01-01 10:00:00+00', '2023-01-01 10:00:00+00', 'element_update', 'completed', 'system', 'Initial element update', 1, TRUE, '2023-01-01 10:30:00+00', 'admin', '{\"reason\": \"element correction\", \"previous_value\": null}'::jsonb, 3, 'a1b2c3d4-e5f6-4a5b-8c7d-9e0f1a2b3c4d', 1.25, FALSE, NULL), ('TR000_1', NULL, 'TR001', '2023-01-02 11:15:00+00', '2023-01-02 11:15:00+00', 'molecule_reassignment', 'completed', 'lab_tech', 'Molecule reassignment for structural analysis', 2, TRUE, '2023-01-02 12:00:00+00', 'supervisor', '{\"reason\": \"structural analysis\", \"previous_value\": \"TR000\"}'::jsonb, 2, 'b2c3d4e5-f6a7-5b6c-9d0e-1f2a3b4c5d6e', 2.50, FALSE, NULL), ('TR000_2', 'c', NULL, '2023-01-03 09:30:00+00', '2023-01-03 09:30:00+00', 'element_update', 'completed', 'automated', 'Carbon element verification', 1, TRUE, '2023-01-03 10:15:00+00', 'system', '{\"reason\": \"verification\", \"confidence\": 0.95}'::jsonb, 4, 'c3d4e5f6-a7b8-6c7d-0e1f-2a3b4c5d6e7f', 0.75, FALSE, NULL);"], "clean_up_sql": ["DROP TABLE atom_edits;"], "category": "Efficiency", "original_schema": "CREATE TABLE \"atom\" (\natom_id text NOT NULL,\nmolecule_id text NULL,\nelement text NULL,\n    PRIMARY KEY (atom_id),\n    FOREIGN KEY (molecule_id) REFERENCES molecule(molecule_id)\n);\n\nFirst 3 rows:\natom_id    molecule_id    element\n---------  -------------  ---------\nTR000_1    TR000          cl\nTR000_2    TR000          c\nTR000_3    TR000          cl\n...\n\n\nCREATE TABLE \"bond\" (\nbond_id text NOT NULL,\nmolecule_id text NULL,\nbond_type text NULL,\n    PRIMARY KEY (bond_id),\n    FOREIGN KEY (molecule_id) REFERENCES molecule(molecule_id)\n);\n\nFirst 3 rows:\nbond_id    molecule_id    bond_type\n---------  -------------  -----------\nTR000_1_2  TR000          -\nTR000_2_3  TR000          -\nTR000_2_4  TR000          -\n...\n\n\nCREATE TABLE \"connected\" (\natom_id text NOT NULL,\natom_id2 text NOT NULL,\nbond_id text NULL,\n    PRIMARY KEY (atom_id, atom_id2),\n    FOREIGN KEY (atom_id2) REFERENCES atom(atom_id),\n    FOREIGN KEY (atom_id) REFERENCES atom(atom_id),\n    FOREIGN KEY (bond_id) REFERENCES bond(bond_id)\n);\n\nFirst 3 rows:\natom_id    atom_id2    bond_id\n---------  ----------  ---------\nTR000_1    TR000_2     TR000_1_2\nTR000_2    TR000_1     TR000_1_2\nTR000_2    TR000_3     TR000_2_3\n...\n\n\nCREATE TABLE \"molecule\" (\nmolecule_id text NOT NULL,\nlabel text NULL,\n    PRIMARY KEY (molecule_id)\n);\n\nFirst 3 rows:\nmolecule_id    label\n-------------  -------\nTR000          +\nTR001          +\nTR002          -\n...\n", "preprocess_schema": "CREATE TABLE \"atom\" (\natom_id text NOT NULL,\nmolecule_id text NULL,\nelement text NULL,\n    PRIMARY KEY (atom_id),\n    FOREIGN KEY (molecule_id) REFERENCES molecule(molecule_id)\n);\n\nFirst 3 rows:\natom_id    molecule_id    element\n---------  -------------  ---------\nTR000_1    TR000          cl\nTR000_2    TR000          c\nTR000_3    TR000          cl\n...\n\n\nCREATE TABLE \"atom_edits\" (\nedit_id integer NOT NULL DEFAULT nextval('atom_edits_edit_id_seq'::regclass),\natom_id text NULL,\nelement text NULL,\nmolecule_id text NULL,\ncreated_at timestamp with time zone NULL DEFAULT CURRENT_TIMESTAMP,\nmodified_at timestamp with time zone NULL DEFAULT CURRENT_TIMESTAMP,\nedit_type character varying NULL DEFAULT 'standard'::character varying,\nedit_status character varying NULL DEFAULT 'pending'::character varying,\nedit_source character varying NULL DEFAULT 'manual'::character varying,\nedit_notes text NULL,\nedit_version integer NULL DEFAULT 1,\nis_approved boolean NULL DEFAULT false,\napproval_date timestamp with time zone NULL,\napproved_by character varying NULL DEFAULT NULL::character varying,\nmetadata jsonb NULL DEFAULT '{}'::jsonb,\npriority integer NULL DEFAULT 5,\nbatch_id uuid NULL DEFAULT gen_random_uuid(),\nprocessing_time numeric NULL DEFAULT 0.0,\nis_deleted boolean NULL DEFAULT false,\ndeletion_date timestamp with time zone NULL,\n    PRIMARY KEY (edit_id)\n);\n\nFirst 3 rows:\n  edit_id  atom_id    element    molecule_id    created_at                 modified_at                edit_type              edit_status    edit_source    edit_notes                                       edit_version  is_approved    approval_date              approved_by    metadata                                                        priority  batch_id                                processing_time  is_deleted    deletion_date\n---------  ---------  ---------  -------------  -------------------------  -------------------------  ---------------------  -------------  -------------  ---------------------------------------------  --------------  -------------  -------------------------  -------------  ------------------------------------------------------------  ----------  ------------------------------------  -----------------  ------------  ---------------\n        1  TR000_1    cl                        2023-01-01 18:00:00+08:00  2023-01-01 18:00:00+08:00  element_update         completed      system         Initial element update                                      1  True           2023-01-01 18:30:00+08:00  admin          {'reason': 'element correction', 'previous_value': None}               3  a1b2c3d4-e5f6-4a5b-8c7d-9e0f1a2b3c4d               1.25  False\n        2  TR000_1               TR001          2023-01-02 19:15:00+08:00  2023-01-02 19:15:00+08:00  molecule_reassignment  completed      lab_tech       Molecule reassignment for structural analysis               2  True           2023-01-02 20:00:00+08:00  supervisor     {'reason': 'structural analysis', 'previous_value': 'TR000'}           2  b2c3d4e5-f6a7-5b6c-9d0e-1f2a3b4c5d6e               2.5   False\n        3  TR000_2    c                         2023-01-03 17:30:00+08:00  2023-01-03 17:30:00+08:00  element_update         completed      automated      Carbon element verification                                 1  True           2023-01-03 18:15:00+08:00  system         {'reason': 'verification', 'confidence': 0.95}                         4  c3d4e5f6-a7b8-6c7d-0e1f-2a3b4c5d6e7f               0.75  False\n...\n\n\nCREATE TABLE \"bond\" (\nbond_id text NOT NULL,\nmolecule_id text NULL,\nbond_type text NULL,\n    PRIMARY KEY (bond_id),\n    FOREIGN KEY (molecule_id) REFERENCES molecule(molecule_id)\n);\n\nFirst 3 rows:\nbond_id    molecule_id    bond_type\n---------  -------------  -----------\nTR000_1_2  TR000          -\nTR000_2_3  TR000          -\nTR000_2_4  TR000          -\n...\n\n\nCREATE TABLE \"connected\" (\natom_id text NOT NULL,\natom_id2 text NOT NULL,\nbond_id text NULL,\n    PRIMARY KEY (atom_id, atom_id2),\n    FOREIGN KEY (atom_id2) REFERENCES atom(atom_id),\n    FOREIGN KEY (atom_id) REFERENCES atom(atom_id),\n    FOREIGN KEY (bond_id) REFERENCES bond(bond_id)\n);\n\nFirst 3 rows:\natom_id    atom_id2    bond_id\n---------  ----------  ---------\nTR000_1    TR000_2     TR000_1_2\nTR000_2    TR000_1     TR000_1_2\nTR000_2    TR000_3     TR000_2_3\n...\n\n\nCREATE TABLE \"molecule\" (\nmolecule_id text NOT NULL,\nlabel text NULL,\n    PRIMARY KEY (molecule_id)\n);\n\nFirst 3 rows:\nmolecule_id    label\n-------------  -------\nTR000          +\nTR001          +\nTR002          -\n...\n", "sol_sql": ["SELECT atom_id,(ARRAY_AGG(element ORDER BY edit_id DESC) FILTER (WHERE element IS NOT NULL))[1] AS element,(ARRAY_AGG(molecule_id ORDER BY edit_id DESC)FILTER (WHERE molecule_id IS NOT NULL))[1] AS molecule_id FROM atom_edits GROUP BY atom_id"], "test_cases": ["def test_case(pred_sqls, sol_sqls, db_name, conn):\n    result = ex_base(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"ex_base returned {result} but expected 1.\"\n    result = performance_compare_by_qep(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"performance_check returned {result} but expected 1.\"\n    return result"]}
{"instance_id": "PostgreSQL_68", "dialect": "PostgreSQL", "version": "14.12", "db_id": "superhero", "query": "In the superhero database, we have a directed acyclic graph representing the lineage of superheroes. Each superhero has a unique identifier and a parent identifier, which points to their predecessor in the lineage. Given two superheroes, 'Superhero A' and 'Superhero B', we need to find their common ancestor in the lineage. The provided query is inefficient as it traverses the entire lineage until it finds the root, which is not optimal when the common segment of the lineage is large. We need to find an efficient way to determine the common ancestor with a complexity of O(A+B) where A and B are the number of nodes in the lineages of 'Superhero A' and 'Superhero B', respectively.", "issue_sql": ["WITH RECURSIVE linked_list(id, parent_id) AS (SELECT id, parent_id FROM lineage WHERE id = 1001 OR id = 1201 UNION ALL SELECT g.id, g.parent_id FROM lineage g INNER JOIN linked_list ll ON ll.parent_id = g.id) SELECT string_agg(id::TEXT, ',') AS ids, parent_id FROM linked_list GROUP BY parent_id HAVING COUNT(DISTINCT id) > 1;"], "preprocess_sql": ["CREATE TABLE lineage (id INT PRIMARY KEY, parent_id INT, created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP, is_active BOOLEAN DEFAULT TRUE, lineage_depth INT DEFAULT 0, lineage_path TEXT DEFAULT '', version_number INT DEFAULT 1, last_verified_date DATE DEFAULT CURRENT_DATE, metadata JSONB DEFAULT '{}'::jsonb, notes TEXT DEFAULT '', status VARCHAR(50) DEFAULT 'active', visibility_level INT DEFAULT 0, external_reference_id UUID DEFAULT gen_random_uuid(), modification_count INT DEFAULT 0, importance_score NUMERIC(5,2) DEFAULT 0.0);", "INSERT INTO lineage (id, parent_id, created_at, updated_at, is_active, lineage_depth, lineage_path, version_number, last_verified_date, metadata, notes, status, visibility_level, external_reference_id, modification_count, importance_score) SELECT i, CASE WHEN i = 1 THEN NULL ELSE i - 1 END, CURRENT_TIMESTAMP - (random() * interval '365 days'), CURRENT_TIMESTAMP - (random() * interval '30 days'), TRUE, CASE WHEN i = 1 THEN 0 ELSE floor(ln(i)::numeric) END, CASE WHEN i = 1 THEN i::text ELSE '1/' || i::text END, ceil(random() * 5), CURRENT_DATE - (random() * 180)::integer, jsonb_build_object('origin', 'system', 'batch', floor(random() * 100)), 'Automatically generated lineage record ' || i, CASE WHEN random() > 0.9 THEN 'archived' ELSE 'active' END, floor(random() * 3), gen_random_uuid(), floor(random() * 10), 5.0 - (random() * 4.5) FROM generate_series(1, 1000) AS i;", "INSERT INTO lineage (id, parent_id, created_at, updated_at, is_active, lineage_depth, lineage_path, version_number, last_verified_date, metadata, notes, status, visibility_level, external_reference_id, modification_count, importance_score) SELECT 1000 + i, 1000 + i - 1, CURRENT_TIMESTAMP - (random() * interval '180 days'), CURRENT_TIMESTAMP - (random() * interval '15 days'), TRUE, 1000 + floor(ln(i)::numeric), '1/1000/' || (1000+i)::text, ceil(random() * 5), CURRENT_DATE - (random() * 90)::integer, jsonb_build_object('origin', 'branch_a', 'batch', floor(random() * 100)), 'Branch A lineage record ' || i, CASE WHEN random() > 0.85 THEN 'pending' WHEN random() > 0.95 THEN 'archived' ELSE 'active' END, floor(random() * 3), gen_random_uuid(), floor(random() * 8), 7.5 - (random() * 3.0) FROM generate_series(1, 200) AS i;", "INSERT INTO lineage (id, parent_id, created_at, updated_at, is_active, lineage_depth, lineage_path, version_number, last_verified_date, metadata, notes, status, visibility_level, external_reference_id, modification_count, importance_score) SELECT 1200 + i, 1000 + i - 1, CURRENT_TIMESTAMP - (random() * interval '90 days'), CURRENT_TIMESTAMP - (random() * interval '7 days'), CASE WHEN random() > 0.95 THEN FALSE ELSE TRUE END, 1000 + floor(ln(i)::numeric), '1/1000/' || (1200+i)::text, ceil(random() * 5), CURRENT_DATE - (random() * 45)::integer, jsonb_build_object('origin', 'branch_b', 'batch', floor(random() * 100)), 'Branch B lineage record ' || i, CASE WHEN random() > 0.9 THEN 'pending' WHEN random() > 0.95 THEN 'archived' ELSE 'active' END, floor(random() * 3), gen_random_uuid(), floor(random() * 5), 8.0 - (random() * 2.5) FROM generate_series(1, 200) AS i;"], "clean_up_sql": ["DROP TABLE lineage;"], "category": "Efficiency", "original_schema": "CREATE TABLE \"alignment\" (\nid bigint NOT NULL,\nalignment text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  alignment\n----  -----------\n   1  Good\n   2  Bad\n   3  Neutral\n...\n\n\nCREATE TABLE \"attribute\" (\nid bigint NOT NULL,\nattribute_name text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  attribute_name\n----  ----------------\n   1  Intelligence\n   2  Strength\n   3  Speed\n...\n\n\nCREATE TABLE \"colour\" (\nid bigint NOT NULL,\ncolour text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  colour\n----  ---------\n   1  No Colour\n   2  Amber\n   3  Auburn\n...\n\n\nCREATE TABLE \"gender\" (\nid bigint NOT NULL,\ngender text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  gender\n----  --------\n   1  Male\n   2  Female\n   3  N/A\n...\n\n\nCREATE TABLE \"hero_attribute\" (\nhero_id bigint NULL,\nattribute_id bigint NULL,\nattribute_value bigint NULL,\n    FOREIGN KEY (attribute_id) REFERENCES attribute(id),\n    FOREIGN KEY (hero_id) REFERENCES superhero(id)\n);\n\nFirst 3 rows:\n  hero_id    attribute_id    attribute_value\n---------  --------------  -----------------\n        1               1                 80\n        2               1                 75\n        3               1                 95\n...\n\n\nCREATE TABLE \"hero_power\" (\nhero_id bigint NULL,\npower_id bigint NULL,\n    FOREIGN KEY (hero_id) REFERENCES superhero(id),\n    FOREIGN KEY (power_id) REFERENCES superpower(id)\n);\n\nFirst 3 rows:\n  hero_id    power_id\n---------  ----------\n        1           1\n        1          18\n        1          26\n...\n\n\nCREATE TABLE \"publisher\" (\nid bigint NOT NULL,\npublisher_name text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  publisher_name\n----  -----------------\n   1\n   2  ABC Studios\n   3  Dark Horse Comics\n...\n\n\nCREATE TABLE \"race\" (\nid bigint NOT NULL,\nrace text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  race\n----  ------\n   1  -\n   2  Alien\n   3  Alpha\n...\n\n\nCREATE TABLE \"superhero\" (\nid bigint NOT NULL,\nsuperhero_name text NULL,\nfull_name text NULL,\ngender_id bigint NULL,\neye_colour_id bigint NULL,\nhair_colour_id bigint NULL,\nskin_colour_id bigint NULL,\nrace_id bigint NULL,\npublisher_id bigint NULL,\nalignment_id bigint NULL,\nheight_cm bigint NULL,\nweight_kg bigint NULL,\n    PRIMARY KEY (id),\n    FOREIGN KEY (alignment_id) REFERENCES alignment(id),\n    FOREIGN KEY (eye_colour_id) REFERENCES colour(id),\n    FOREIGN KEY (gender_id) REFERENCES gender(id),\n    FOREIGN KEY (hair_colour_id) REFERENCES colour(id),\n    FOREIGN KEY (publisher_id) REFERENCES publisher(id),\n    FOREIGN KEY (race_id) REFERENCES race(id),\n    FOREIGN KEY (skin_colour_id) REFERENCES colour(id)\n);\n\nFirst 3 rows:\n  id  superhero_name    full_name                 gender_id    eye_colour_id    hair_colour_id    skin_colour_id    race_id    publisher_id    alignment_id    height_cm    weight_kg\n----  ----------------  ----------------------  -----------  ---------------  ----------------  ----------------  ---------  --------------  --------------  -----------  -----------\n   1  3-D Man           Charles Chandler                  1                9                13                 1          1              13               1          188           90\n   2  A-Bomb            Richard Milhouse Jones            1               33                 1                 1         24              13               1          203          441\n   3  Abe Sapien        Abraham Sapien                    1                7                 1                 7         33               3               1          191           65\n...\n\n\nCREATE TABLE \"superpower\" (\nid bigint NOT NULL,\npower_name text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  power_name\n----  -------------------\n   1  Agility\n   2  Accelerated Healing\n   3  Lantern Power Ring\n...\n", "preprocess_schema": "CREATE TABLE \"alignment\" (\nid bigint NOT NULL,\nalignment text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  alignment\n----  -----------\n   1  Good\n   2  Bad\n   3  Neutral\n...\n\n\nCREATE TABLE \"attribute\" (\nid bigint NOT NULL,\nattribute_name text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  attribute_name\n----  ----------------\n   1  Intelligence\n   2  Strength\n   3  Speed\n...\n\n\nCREATE TABLE \"colour\" (\nid bigint NOT NULL,\ncolour text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  colour\n----  ---------\n   1  No Colour\n   2  Amber\n   3  Auburn\n...\n\n\nCREATE TABLE \"gender\" (\nid bigint NOT NULL,\ngender text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  gender\n----  --------\n   1  Male\n   2  Female\n   3  N/A\n...\n\n\nCREATE TABLE \"hero_attribute\" (\nhero_id bigint NULL,\nattribute_id bigint NULL,\nattribute_value bigint NULL,\n    FOREIGN KEY (attribute_id) REFERENCES attribute(id),\n    FOREIGN KEY (hero_id) REFERENCES superhero(id)\n);\n\nFirst 3 rows:\n  hero_id    attribute_id    attribute_value\n---------  --------------  -----------------\n        1               1                 80\n        2               1                 75\n        3               1                 95\n...\n\n\nCREATE TABLE \"hero_power\" (\nhero_id bigint NULL,\npower_id bigint NULL,\n    FOREIGN KEY (hero_id) REFERENCES superhero(id),\n    FOREIGN KEY (power_id) REFERENCES superpower(id)\n);\n\nFirst 3 rows:\n  hero_id    power_id\n---------  ----------\n        1           1\n        1          18\n        1          26\n...\n\n\nCREATE TABLE \"lineage\" (\nid integer NOT NULL,\nparent_id integer NULL,\ncreated_at timestamp with time zone NULL DEFAULT CURRENT_TIMESTAMP,\nupdated_at timestamp with time zone NULL DEFAULT CURRENT_TIMESTAMP,\nis_active boolean NULL DEFAULT true,\nlineage_depth integer NULL DEFAULT 0,\nlineage_path text NULL DEFAULT ''::text,\nversion_number integer NULL DEFAULT 1,\nlast_verified_date date NULL DEFAULT CURRENT_DATE,\nmetadata jsonb NULL DEFAULT '{}'::jsonb,\nnotes text NULL DEFAULT ''::text,\nstatus character varying NULL DEFAULT 'active'::character varying,\nvisibility_level integer NULL DEFAULT 0,\nexternal_reference_id uuid NULL DEFAULT gen_random_uuid(),\nmodification_count integer NULL DEFAULT 0,\nimportance_score numeric NULL DEFAULT 0.0,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id    parent_id  created_at                        updated_at                        is_active      lineage_depth  lineage_path      version_number  last_verified_date    metadata                           notes                                     status      visibility_level  external_reference_id                   modification_count    importance_score\n----  -----------  --------------------------------  --------------------------------  -----------  ---------------  --------------  ----------------  --------------------  ---------------------------------  ----------------------------------------  --------  ------------------  ------------------------------------  --------------------  ------------------\n   1          nan  2024-06-01 07:48:24.033577+08:00  2025-04-01 18:51:24.643865+08:00  True                       0  1                              5  2025-03-30            {'batch': 25, 'origin': 'system'}  Automatically generated lineage record 1  archived                   1  cd609ba9-504b-431d-985d-11a4b4f48039                     8                4.44\n   2            1  2025-01-25 13:46:10.105707+08:00  2025-04-11 00:30:28.014783+08:00  True                       0  1/2                            2  2025-03-10            {'batch': 31, 'origin': 'system'}  Automatically generated lineage record 2  active                     0  31d861f9-7461-46b1-b727-213bed9d1b55                     8                4.82\n   3            2  2024-08-04 05:42:19.337844+08:00  2025-04-10 03:15:58.082071+08:00  True                       1  1/3                            1  2024-11-03            {'batch': 38, 'origin': 'system'}  Automatically generated lineage record 3  active                     2  b557accc-b8ca-4a84-afd4-b99d80117ac7                     2                4\n...\n\n\nCREATE TABLE \"publisher\" (\nid bigint NOT NULL,\npublisher_name text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  publisher_name\n----  -----------------\n   1\n   2  ABC Studios\n   3  Dark Horse Comics\n...\n\n\nCREATE TABLE \"race\" (\nid bigint NOT NULL,\nrace text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  race\n----  ------\n   1  -\n   2  Alien\n   3  Alpha\n...\n\n\nCREATE TABLE \"superhero\" (\nid bigint NOT NULL,\nsuperhero_name text NULL,\nfull_name text NULL,\ngender_id bigint NULL,\neye_colour_id bigint NULL,\nhair_colour_id bigint NULL,\nskin_colour_id bigint NULL,\nrace_id bigint NULL,\npublisher_id bigint NULL,\nalignment_id bigint NULL,\nheight_cm bigint NULL,\nweight_kg bigint NULL,\n    PRIMARY KEY (id),\n    FOREIGN KEY (alignment_id) REFERENCES alignment(id),\n    FOREIGN KEY (eye_colour_id) REFERENCES colour(id),\n    FOREIGN KEY (gender_id) REFERENCES gender(id),\n    FOREIGN KEY (hair_colour_id) REFERENCES colour(id),\n    FOREIGN KEY (publisher_id) REFERENCES publisher(id),\n    FOREIGN KEY (race_id) REFERENCES race(id),\n    FOREIGN KEY (skin_colour_id) REFERENCES colour(id)\n);\n\nFirst 3 rows:\n  id  superhero_name    full_name                 gender_id    eye_colour_id    hair_colour_id    skin_colour_id    race_id    publisher_id    alignment_id    height_cm    weight_kg\n----  ----------------  ----------------------  -----------  ---------------  ----------------  ----------------  ---------  --------------  --------------  -----------  -----------\n   1  3-D Man           Charles Chandler                  1                9                13                 1          1              13               1          188           90\n   2  A-Bomb            Richard Milhouse Jones            1               33                 1                 1         24              13               1          203          441\n   3  Abe Sapien        Abraham Sapien                    1                7                 1                 7         33               3               1          191           65\n...\n\n\nCREATE TABLE \"superpower\" (\nid bigint NOT NULL,\npower_name text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  power_name\n----  -------------------\n   1  Agility\n   2  Accelerated Healing\n   3  Lantern Power Ring\n...\n", "sol_sql": ["WITH RECURSIVE linked_list(id, parent_id, depth) AS (SELECT id, parent_id, 0 FROM lineage WHERE id = 1001 OR id = 1201 UNION ALL SELECT g.id, g.parent_id, ll.depth + 1 FROM lineage g INNER JOIN linked_list ll ON ll.parent_id = g.id WHERE depth < 10000) SELECT string_agg(id::TEXT, ',') AS ids, parent_id FROM linked_list GROUP BY parent_id HAVING COUNT(DISTINCT id) > 1;"], "test_cases": ["\ndef test_case(pred_sqls, sol_sqls, db_name, conn):\n    pred_sqls_result = execute_queries(pred_sqls, db_name, conn)[0]\n    sol_sqls_result = execute_queries(sol_sqls, db_name, conn)[0]\n    assert pred_sqls_result == sol_sqls_result, f\"Expected pred_result and sol_result are the same but pred_result is {pred_sqls_result} and sol_result is {sol_sqls_result}.\"\n    result = performance_compare_by_qep(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"performance_check returned {result} but expected 1.\"\n    return result\n    "]}
{"instance_id": "PostgreSQL_81", "dialect": "PostgreSQL", "version": "14.12", "db_id": "debit_card_specializing", "query": "I have a table of transactions for multiple customers, where each transaction has a unique transaction id, along with amount, type, and transaction record. Some transactions for a single customerid share the same combination of these attributes. I want to update a first_transaction column with the transaction of the earliest transaction for each unique combination of attributes within each customer. My current method uses a LATERAL JOIN but is extremely slow on my small server. I process one customer at a time and commit after each iteration, but the query remains inefficient. How can I optimize this process?", "issue_sql": ["SELECT a.customerid, a.transaction, (SELECT b.transaction FROM transaction_info b WHERE b.customerid = a.customerid AND b.amount = a.amount AND b.type = a.type ORDER BY b.transaction LIMIT 1) AS first_transaction, a.amount, a.type, a.transactionid FROM transaction_info a ORDER BY a.customerid, a.transaction"], "preprocess_sql": ["CREATE TABLE transaction_info (\n  customerid int,\n  transaction int,\n  first_transaction varchar(10),\n  amount numeric,\n  type numeric,\n  transactionid text,\n  -- New columns\n  transaction_date TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,\n  transaction_status VARCHAR(20) DEFAULT 'completed',\n  payment_method VARCHAR(50) DEFAULT 'card',\n  currency_code CHAR(3) DEFAULT 'USD',\n  exchange_rate NUMERIC(10, 6) DEFAULT 1.000000,\n  is_flagged BOOLEAN DEFAULT false,\n  metadata JSONB DEFAULT '{}'::jsonb,\n  processing_time_ms INTEGER DEFAULT 250,\n  retry_count SMALLINT DEFAULT 0,\n  last_modified_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,\n  created_by VARCHAR(100) DEFAULT 'system',\n  transaction_source VARCHAR(50) DEFAULT 'web',\n  batch_id UUID DEFAULT gen_random_uuid(),\n  notes TEXT DEFAULT NULL,\n  tax_amount NUMERIC(12, 4) DEFAULT 0.0000\n);", "INSERT INTO transaction_info (customerid, transaction, first_transaction, amount, type, transactionid, transaction_date, transaction_status, payment_method, currency_code, exchange_rate, is_flagged, metadata, processing_time_ms, retry_count, last_modified_at, created_by, transaction_source, batch_id, notes, tax_amount) VALUES\n(1, 1, 'na', 65250.78, 700000.52, '01010000206A0000000000F0C02E458A4400000000F03F', '2022-01-01 08:30:45+00', 'completed', 'credit_card', 'USD', 1.000000, false, '{\"device_id\": \"d-12345\", \"ip\": \"192.168.1.1\"}'::jsonb, 125, 0, '2022-01-01 08:30:45+00', 'system', 'pos', 'a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11', 'Regular transaction', 5220.06),\n(1, 2, 'na', 65250.78, 700000.52, '01010000206A0000000000F0C02E458A4400000000F03F', '2022-01-02 09:15:22+00', 'completed', 'credit_card', 'USD', 1.000000, false, '{\"device_id\": \"d-12345\", \"ip\": \"192.168.1.1\"}'::jsonb, 130, 0, '2022-01-02 09:15:22+00', 'system', 'pos', 'b1eebc99-9c0b-4ef8-bb6d-6bb9bd380a12', 'Regular transaction', 5220.06),\n(1, 3, 'na', 65250.78, 700000.52, '01010000206A0000000000F0C02E458A4400000000F03F', '2022-01-03 10:45:33+00', 'completed', 'credit_card', 'USD', 1.000000, false, '{\"device_id\": \"d-12345\", \"ip\": \"192.168.1.1\"}'::jsonb, 118, 0, '2022-01-03 10:45:33+00', 'system', 'pos', 'c2eebc99-9c0b-4ef8-bb6d-6bb9bd380a13', 'Regular transaction', 5220.06),\n(1, 4, 'na', 65999.00, 700555.00, '01010000455A000000000010C03F478A4400000010F03F', '2022-01-04 11:20:15+00', 'completed', 'debit_card', 'USD', 1.000000, false, '{\"device_id\": \"d-67890\", \"ip\": \"192.168.1.2\"}'::jsonb, 142, 0, '2022-01-04 11:20:15+00', 'system', 'web', 'd3eebc99-9c0b-4ef8-bb6d-6bb9bd380a14', 'Premium transaction', 5279.92),\n(1, 5, 'na', 65999.00, 700555.00, '01010000455A000000000010C03F478A4400000010F03F', '2022-01-05 14:05:38+00', 'completed', 'debit_card', 'USD', 1.000000, false, '{\"device_id\": \"d-67890\", \"ip\": \"192.168.1.2\"}'::jsonb, 135, 0, '2022-01-05 14:05:38+00', 'system', 'web', 'e4eebc99-9c0b-4ef8-bb6d-6bb9bd380a15', 'Premium transaction', 5279.92),\n(1, 6, 'na', 65999.00, 700555.00, '01010000455A000000000010C03F478A4400000010F03F', '2022-01-06 16:30:42+00', 'completed', 'debit_card', 'USD', 1.000000, false, '{\"device_id\": \"d-67890\", \"ip\": \"192.168.1.2\"}'::jsonb, 128, 0, '2022-01-06 16:30:42+00', 'system', 'web', 'f5eebc99-9c0b-4ef8-bb6d-6bb9bd380a16', 'Premium transaction', 5279.92);"], "clean_up_sql": ["\nDROP TABLE test;\n"], "category": "Efficiency", "original_schema": "CREATE TABLE \"customers\" (\ncustomerid bigint NOT NULL,\nsegment text NULL,\ncurrency text NULL,\n    PRIMARY KEY (customerid)\n);\n\nFirst 3 rows:\n  customerid  segment    currency\n------------  ---------  ----------\n           3  SME        EUR\n           5  LAM        EUR\n           6  SME        EUR\n...\n\n\nCREATE TABLE \"gasstations\" (\ngasstationid bigint NOT NULL,\nchainid bigint NULL,\ncountry text NULL,\nsegment text NULL,\n    PRIMARY KEY (gasstationid)\n);\n\nFirst 3 rows:\n  gasstationid    chainid  country    segment\n--------------  ---------  ---------  ---------------\n            44         13  CZE        Value for money\n            45          6  CZE        Premium\n            46         23  CZE        Other\n...\n\n\nCREATE TABLE \"products\" (\nproductid bigint NOT NULL,\ndescription text NULL,\n    PRIMARY KEY (productid)\n);\n\nFirst 3 rows:\n  productid  description\n-----------  -------------\n          1  Rucní zadání\n          2  Nafta\n          3  Special\n...\n\n\nCREATE TABLE \"transactions_1k\" (\ntransactionid bigint NOT NULL DEFAULT nextval('transactions_1k_transactionid_seq'::regclass),\ndate date NULL,\ntime text NULL,\ncustomerid bigint NULL,\ncardid bigint NULL,\ngasstationid bigint NULL,\nproductid bigint NULL,\namount bigint NULL,\nprice real NULL,\n    PRIMARY KEY (transactionid)\n);\n\nFirst 3 rows:\n  transactionid  date        time        customerid    cardid    gasstationid    productid    amount    price\n---------------  ----------  --------  ------------  --------  --------------  -----------  --------  -------\n              1  2012-08-24  09:41:00         31543    486621            3704            2        28   672.64\n              2  2012-08-24  10:03:00         46707    550134            3704            2        18   430.72\n              3  2012-08-24  10:03:00         46707    550134            3704           23         1   121.99\n...\n\n\nCREATE TABLE \"yearmonth\" (\ncustomerid bigint NULL,\ndate text NULL,\nconsumption real NULL\n);\n\nFirst 3 rows:\n  customerid    date    consumption\n------------  ------  -------------\n           5  201207         528.3\n           5  201302        1598.28\n           5  201303        1931.36\n...\n", "preprocess_schema": "CREATE TABLE \"customers\" (\ncustomerid bigint NOT NULL,\nsegment text NULL,\ncurrency text NULL,\n    PRIMARY KEY (customerid)\n);\n\nFirst 3 rows:\n  customerid  segment    currency\n------------  ---------  ----------\n           3  SME        EUR\n           5  LAM        EUR\n           6  SME        EUR\n...\n\n\nCREATE TABLE \"gasstations\" (\ngasstationid bigint NOT NULL,\nchainid bigint NULL,\ncountry text NULL,\nsegment text NULL,\n    PRIMARY KEY (gasstationid)\n);\n\nFirst 3 rows:\n  gasstationid    chainid  country    segment\n--------------  ---------  ---------  ---------------\n            44         13  CZE        Value for money\n            45          6  CZE        Premium\n            46         23  CZE        Other\n...\n\n\nCREATE TABLE \"products\" (\nproductid bigint NOT NULL,\ndescription text NULL,\n    PRIMARY KEY (productid)\n);\n\nFirst 3 rows:\n  productid  description\n-----------  -------------\n          1  Rucní zadání\n          2  Nafta\n          3  Special\n...\n\n\nCREATE TABLE \"transaction_info\" (\ncustomerid integer NULL,\ntransaction integer NULL,\nfirst_transaction character varying NULL,\namount numeric NULL,\ntype numeric NULL,\ntransactionid text NULL,\ntransaction_date timestamp with time zone NULL DEFAULT CURRENT_TIMESTAMP,\ntransaction_status character varying NULL DEFAULT 'completed'::character varying,\npayment_method character varying NULL DEFAULT 'card'::character varying,\ncurrency_code character NULL DEFAULT 'USD'::bpchar,\nexchange_rate numeric NULL DEFAULT 1.000000,\nis_flagged boolean NULL DEFAULT false,\nmetadata jsonb NULL DEFAULT '{}'::jsonb,\nprocessing_time_ms integer NULL DEFAULT 250,\nretry_count smallint NULL DEFAULT 0,\nlast_modified_at timestamp with time zone NULL DEFAULT CURRENT_TIMESTAMP,\ncreated_by character varying NULL DEFAULT 'system'::character varying,\ntransaction_source character varying NULL DEFAULT 'web'::character varying,\nbatch_id uuid NULL DEFAULT gen_random_uuid(),\nnotes text NULL,\ntax_amount numeric NULL DEFAULT 0.0000\n);\n\nFirst 3 rows:\n  customerid    transaction  first_transaction      amount    type  transactionid                                   transaction_date           transaction_status    payment_method    currency_code      exchange_rate  is_flagged    metadata                                         processing_time_ms    retry_count  last_modified_at           created_by    transaction_source    batch_id                              notes                  tax_amount\n------------  -------------  -------------------  --------  ------  ----------------------------------------------  -------------------------  --------------------  ----------------  ---------------  ---------------  ------------  ---------------------------------------------  --------------------  -------------  -------------------------  ------------  --------------------  ------------------------------------  -------------------  ------------\n           1              1  na                    65250.8  700001  01010000206A0000000000F0C02E458A4400000000F03F  2022-01-01 16:30:45+08:00  completed             credit_card       USD                            1  False         {'ip': '192.168.1.1', 'device_id': 'd-12345'}                   125              0  2022-01-01 16:30:45+08:00  system        pos                   a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11  Regular transaction       5220.06\n           1              2  na                    65250.8  700001  01010000206A0000000000F0C02E458A4400000000F03F  2022-01-02 17:15:22+08:00  completed             credit_card       USD                            1  False         {'ip': '192.168.1.1', 'device_id': 'd-12345'}                   130              0  2022-01-02 17:15:22+08:00  system        pos                   b1eebc99-9c0b-4ef8-bb6d-6bb9bd380a12  Regular transaction       5220.06\n           1              3  na                    65250.8  700001  01010000206A0000000000F0C02E458A4400000000F03F  2022-01-03 18:45:33+08:00  completed             credit_card       USD                            1  False         {'ip': '192.168.1.1', 'device_id': 'd-12345'}                   118              0  2022-01-03 18:45:33+08:00  system        pos                   c2eebc99-9c0b-4ef8-bb6d-6bb9bd380a13  Regular transaction       5220.06\n...\n\n\nCREATE TABLE \"transactions_1k\" (\ntransactionid bigint NOT NULL DEFAULT nextval('transactions_1k_transactionid_seq'::regclass),\ndate date NULL,\ntime text NULL,\ncustomerid bigint NULL,\ncardid bigint NULL,\ngasstationid bigint NULL,\nproductid bigint NULL,\namount bigint NULL,\nprice real NULL,\n    PRIMARY KEY (transactionid)\n);\n\nFirst 3 rows:\n  transactionid  date        time        customerid    cardid    gasstationid    productid    amount    price\n---------------  ----------  --------  ------------  --------  --------------  -----------  --------  -------\n              1  2012-08-24  09:41:00         31543    486621            3704            2        28   672.64\n              2  2012-08-24  10:03:00         46707    550134            3704            2        18   430.72\n              3  2012-08-24  10:03:00         46707    550134            3704           23         1   121.99\n...\n\n\nCREATE TABLE \"yearmonth\" (\ncustomerid bigint NULL,\ndate text NULL,\nconsumption real NULL\n);\n\nFirst 3 rows:\n  customerid    date    consumption\n------------  ------  -------------\n           5  201207         528.3\n           5  201302        1598.28\n           5  201303        1931.36\n...\n", "sol_sql": ["SELECT customerid, transaction, FIRST_VALUE(transaction) OVER (PARTITION BY customerid, transactionid ORDER BY transaction RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS first_transaction, amount, type, transactionid FROM transaction_info WHERE customerid = 1 ORDER BY customerid, transaction"], "test_cases": ["\ndef test_case(pred_sqls, sol_sqls, db_name, conn):\n    result = ex_base(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"ex_base returned {result} but expected 1.\"\n    result = performance_compare_by_qep(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"performance_check returned {result} but expected 1.\"\n    return result\n    "]}
{"instance_id": "PostgreSQL_85", "dialect": "PostgreSQL", "version": "14.12", "db_id": "superhero", "query": "In the superhero database, a user is allowed to view details of a superhero if their user_id matches the superhero's publisher_id or if there is an entry in the 'hero_access' table where their user_id is in the 'read_acl' column (array using gin index). Both tables have about 2 million rows. The query is slow, especially when using an OR clause. Is there a way that improves the performance significantly?", "issue_sql": ["select * from superhero where publisher_id = 1 or exists (select * from hero_access f where superhero.id = f.superhero_id and '{1}' && read_acl) order by superhero.id limit 10;"], "preprocess_sql": ["CREATE TABLE hero_access (superhero_id bigint, read_acl text[], created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP, access_level VARCHAR(50) DEFAULT 'standard', is_active BOOLEAN DEFAULT TRUE, access_count INTEGER DEFAULT 0, last_accessed_at TIMESTAMP WITH TIME ZONE, access_notes TEXT, metadata JSONB DEFAULT '{}'::jsonb, expiration_date DATE, access_uuid UUID DEFAULT gen_random_uuid(), access_score NUMERIC(5,2) DEFAULT 0.0, created_by VARCHAR(100) DEFAULT 'system', version INTEGER DEFAULT 1, access_tags TEXT[] DEFAULT '{}'::text[]);", "CREATE INDEX idx_hero_access_read_acl ON hero_access USING gin (read_acl);", "CREATE INDEX idx_hero_access_access_tags ON hero_access USING gin (access_tags);", "CREATE INDEX idx_hero_access_created_at ON hero_access (created_at);", "CREATE INDEX idx_hero_access_is_active ON hero_access (is_active);", "INSERT INTO hero_access (superhero_id, read_acl, created_at, updated_at, access_level, is_active, access_count, last_accessed_at, access_notes, metadata, expiration_date, access_uuid, access_score, created_by, version, access_tags) SELECT id, ARRAY['1'], CURRENT_TIMESTAMP - (random() * interval '365 days'), CURRENT_TIMESTAMP - (random() * interval '30 days'), CASE WHEN random() > 0.7 THEN 'premium' ELSE 'standard' END, TRUE, floor(random() * 100)::INTEGER, CURRENT_TIMESTAMP - (random() * interval '7 days'), CASE WHEN random() > 0.5 THEN 'Automatically granted access' ELSE 'Manual access approval' END, jsonb_build_object('source', 'system_migration', 'reason', 'initial_setup'), CURRENT_DATE + (random() * 365)::INTEGER, gen_random_uuid(), (random() * 100)::NUMERIC(5,2), CASE WHEN random() > 0.8 THEN 'admin' ELSE 'system' END, 1, ARRAY[CASE WHEN random() > 0.5 THEN 'important' ELSE 'regular' END, 'initial'] FROM superhero ORDER BY random() LIMIT 10;"], "clean_up_sql": ["DROP TABLE hero_access;"], "category": "Efficiency", "original_schema": "CREATE TABLE \"alignment\" (\nid bigint NOT NULL,\nalignment text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  alignment\n----  -----------\n   1  Good\n   2  Bad\n   3  Neutral\n...\n\n\nCREATE TABLE \"attribute\" (\nid bigint NOT NULL,\nattribute_name text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  attribute_name\n----  ----------------\n   1  Intelligence\n   2  Strength\n   3  Speed\n...\n\n\nCREATE TABLE \"colour\" (\nid bigint NOT NULL,\ncolour text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  colour\n----  ---------\n   1  No Colour\n   2  Amber\n   3  Auburn\n...\n\n\nCREATE TABLE \"gender\" (\nid bigint NOT NULL,\ngender text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  gender\n----  --------\n   1  Male\n   2  Female\n   3  N/A\n...\n\n\nCREATE TABLE \"hero_attribute\" (\nhero_id bigint NULL,\nattribute_id bigint NULL,\nattribute_value bigint NULL,\n    FOREIGN KEY (attribute_id) REFERENCES attribute(id),\n    FOREIGN KEY (hero_id) REFERENCES superhero(id)\n);\n\nFirst 3 rows:\n  hero_id    attribute_id    attribute_value\n---------  --------------  -----------------\n        1               1                 80\n        2               1                 75\n        3               1                 95\n...\n\n\nCREATE TABLE \"hero_power\" (\nhero_id bigint NULL,\npower_id bigint NULL,\n    FOREIGN KEY (hero_id) REFERENCES superhero(id),\n    FOREIGN KEY (power_id) REFERENCES superpower(id)\n);\n\nFirst 3 rows:\n  hero_id    power_id\n---------  ----------\n        1           1\n        1          18\n        1          26\n...\n\n\nCREATE TABLE \"publisher\" (\nid bigint NOT NULL,\npublisher_name text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  publisher_name\n----  -----------------\n   1\n   2  ABC Studios\n   3  Dark Horse Comics\n...\n\n\nCREATE TABLE \"race\" (\nid bigint NOT NULL,\nrace text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  race\n----  ------\n   1  -\n   2  Alien\n   3  Alpha\n...\n\n\nCREATE TABLE \"superhero\" (\nid bigint NOT NULL,\nsuperhero_name text NULL,\nfull_name text NULL,\ngender_id bigint NULL,\neye_colour_id bigint NULL,\nhair_colour_id bigint NULL,\nskin_colour_id bigint NULL,\nrace_id bigint NULL,\npublisher_id bigint NULL,\nalignment_id bigint NULL,\nheight_cm bigint NULL,\nweight_kg bigint NULL,\n    PRIMARY KEY (id),\n    FOREIGN KEY (alignment_id) REFERENCES alignment(id),\n    FOREIGN KEY (eye_colour_id) REFERENCES colour(id),\n    FOREIGN KEY (gender_id) REFERENCES gender(id),\n    FOREIGN KEY (hair_colour_id) REFERENCES colour(id),\n    FOREIGN KEY (publisher_id) REFERENCES publisher(id),\n    FOREIGN KEY (race_id) REFERENCES race(id),\n    FOREIGN KEY (skin_colour_id) REFERENCES colour(id)\n);\n\nFirst 3 rows:\n  id  superhero_name    full_name                 gender_id    eye_colour_id    hair_colour_id    skin_colour_id    race_id    publisher_id    alignment_id    height_cm    weight_kg\n----  ----------------  ----------------------  -----------  ---------------  ----------------  ----------------  ---------  --------------  --------------  -----------  -----------\n   1  3-D Man           Charles Chandler                  1                9                13                 1          1              13               1          188           90\n   2  A-Bomb            Richard Milhouse Jones            1               33                 1                 1         24              13               1          203          441\n   3  Abe Sapien        Abraham Sapien                    1                7                 1                 7         33               3               1          191           65\n...\n\n\nCREATE TABLE \"superpower\" (\nid bigint NOT NULL,\npower_name text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  power_name\n----  -------------------\n   1  Agility\n   2  Accelerated Healing\n   3  Lantern Power Ring\n...\n", "preprocess_schema": "CREATE TABLE \"alignment\" (\nid bigint NOT NULL,\nalignment text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  alignment\n----  -----------\n   1  Good\n   2  Bad\n   3  Neutral\n...\n\n\nCREATE TABLE \"attribute\" (\nid bigint NOT NULL,\nattribute_name text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  attribute_name\n----  ----------------\n   1  Intelligence\n   2  Strength\n   3  Speed\n...\n\n\nCREATE TABLE \"colour\" (\nid bigint NOT NULL,\ncolour text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  colour\n----  ---------\n   1  No Colour\n   2  Amber\n   3  Auburn\n...\n\n\nCREATE TABLE \"gender\" (\nid bigint NOT NULL,\ngender text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  gender\n----  --------\n   1  Male\n   2  Female\n   3  N/A\n...\n\n\nCREATE TABLE \"hero_access\" (\nsuperhero_id bigint NULL,\nread_acl ARRAY NULL,\ncreated_at timestamp with time zone NULL DEFAULT CURRENT_TIMESTAMP,\nupdated_at timestamp with time zone NULL DEFAULT CURRENT_TIMESTAMP,\naccess_level character varying NULL DEFAULT 'standard'::character varying,\nis_active boolean NULL DEFAULT true,\naccess_count integer NULL DEFAULT 0,\nlast_accessed_at timestamp with time zone NULL,\naccess_notes text NULL,\nmetadata jsonb NULL DEFAULT '{}'::jsonb,\nexpiration_date date NULL,\naccess_uuid uuid NULL DEFAULT gen_random_uuid(),\naccess_score numeric NULL DEFAULT 0.0,\ncreated_by character varying NULL DEFAULT 'system'::character varying,\nversion integer NULL DEFAULT 1,\naccess_tags ARRAY NULL DEFAULT '{}'::text[]\n);\n\nFirst 3 rows:\n  superhero_id  read_acl    created_at                        updated_at                        access_level    is_active      access_count  last_accessed_at                  access_notes            metadata                                                   expiration_date    access_uuid                             access_score  created_by      version  access_tags\n--------------  ----------  --------------------------------  --------------------------------  --------------  -----------  --------------  --------------------------------  ----------------------  ---------------------------------------------------------  -----------------  ------------------------------------  --------------  ------------  ---------  ----------------------\n           170  ['1']       2025-04-14 07:02:21.795942+08:00  2025-04-14 19:34:58.115282+08:00  standard        True                      0  2025-04-14 20:26:38.399893+08:00  Manual access approval  {'reason': 'initial_setup', 'source': 'system_migration'}  2025-04-15         7218a216-20cd-4079-93ee-7a38fdc7c58e            0.16  system                1  ['regular', 'initial']\n           321  ['1']       2025-04-14 02:03:28.898932+08:00  2025-04-14 19:10:24.178541+08:00  standard        True                      0  2025-04-14 20:20:54.481320+08:00  Manual access approval  {'reason': 'initial_setup', 'source': 'system_migration'}  2025-04-15         b0e884f5-fcb1-4021-9245-306e96cd16ea            0.21  system                1  ['regular', 'initial']\n           698  ['1']       2025-04-11 03:59:55.138180+08:00  2025-04-14 13:24:54.280397+08:00  standard        True                      1  2025-04-14 19:00:17.505087+08:00  Manual access approval  {'reason': 'initial_setup', 'source': 'system_migration'}  2025-04-18         7e6a9b56-51ee-4abc-89c5-5ac664df0861            1.01  system                1  ['regular', 'initial']\n...\n\n\nCREATE TABLE \"hero_attribute\" (\nhero_id bigint NULL,\nattribute_id bigint NULL,\nattribute_value bigint NULL,\n    FOREIGN KEY (attribute_id) REFERENCES attribute(id),\n    FOREIGN KEY (hero_id) REFERENCES superhero(id)\n);\n\nFirst 3 rows:\n  hero_id    attribute_id    attribute_value\n---------  --------------  -----------------\n        1               1                 80\n        2               1                 75\n        3               1                 95\n...\n\n\nCREATE TABLE \"hero_power\" (\nhero_id bigint NULL,\npower_id bigint NULL,\n    FOREIGN KEY (hero_id) REFERENCES superhero(id),\n    FOREIGN KEY (power_id) REFERENCES superpower(id)\n);\n\nFirst 3 rows:\n  hero_id    power_id\n---------  ----------\n        1           1\n        1          18\n        1          26\n...\n\n\nCREATE TABLE \"publisher\" (\nid bigint NOT NULL,\npublisher_name text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  publisher_name\n----  -----------------\n   1\n   2  ABC Studios\n   3  Dark Horse Comics\n...\n\n\nCREATE TABLE \"race\" (\nid bigint NOT NULL,\nrace text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  race\n----  ------\n   1  -\n   2  Alien\n   3  Alpha\n...\n\n\nCREATE TABLE \"superhero\" (\nid bigint NOT NULL,\nsuperhero_name text NULL,\nfull_name text NULL,\ngender_id bigint NULL,\neye_colour_id bigint NULL,\nhair_colour_id bigint NULL,\nskin_colour_id bigint NULL,\nrace_id bigint NULL,\npublisher_id bigint NULL,\nalignment_id bigint NULL,\nheight_cm bigint NULL,\nweight_kg bigint NULL,\n    PRIMARY KEY (id),\n    FOREIGN KEY (alignment_id) REFERENCES alignment(id),\n    FOREIGN KEY (eye_colour_id) REFERENCES colour(id),\n    FOREIGN KEY (gender_id) REFERENCES gender(id),\n    FOREIGN KEY (hair_colour_id) REFERENCES colour(id),\n    FOREIGN KEY (publisher_id) REFERENCES publisher(id),\n    FOREIGN KEY (race_id) REFERENCES race(id),\n    FOREIGN KEY (skin_colour_id) REFERENCES colour(id)\n);\n\nFirst 3 rows:\n  id  superhero_name    full_name                 gender_id    eye_colour_id    hair_colour_id    skin_colour_id    race_id    publisher_id    alignment_id    height_cm    weight_kg\n----  ----------------  ----------------------  -----------  ---------------  ----------------  ----------------  ---------  --------------  --------------  -----------  -----------\n   1  3-D Man           Charles Chandler                  1                9                13                 1          1              13               1          188           90\n   2  A-Bomb            Richard Milhouse Jones            1               33                 1                 1         24              13               1          203          441\n   3  Abe Sapien        Abraham Sapien                    1                7                 1                 7         33               3               1          191           65\n...\n\n\nCREATE TABLE \"superpower\" (\nid bigint NOT NULL,\npower_name text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  power_name\n----  -------------------\n   1  Agility\n   2  Accelerated Healing\n   3  Lantern Power Ring\n...\n", "sol_sql": ["select * from superhero where publisher_id = 1 union select * from superhero where id in (select superhero_id from hero_access f where '{1}' && read_acl) order by id limit 10;"], "test_cases": ["\ndef test_case(pred_sqls, sol_sqls, db_name, conn):\n    result = ex_base(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"ex_base returned {result} but expected 1.\"\n    result = performance_compare_by_qep(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"performance_check returned {result} but expected 1.\"\n    return result\n    "]}
{"instance_id": "PostgreSQL_91", "dialect": "PostgreSQL", "version": "14.12", "db_id": "california_schools", "query": "In the context of the 'california_schools' database, we have three tables: 'schools', 'satscores', and 'frpm'. The 'schools' table contains detailed information about each school, the 'satscores' table contains SAT scores for each school, and the 'frpm' table contains information about the free and reduced-price meal eligibility for each school. We want to determine for each school in the 'satscores' table, whether there is any corresponding entry in the 'frpm' table for the same school. The user has written a query that checks for the existence of such entries but believes it is inefficient as it traverses the 'frpm' table twice. Is there a better way?", "issue_sql": ["SELECT s.cds, true FROM satscores s WHERE EXISTS (SELECT 1 FROM frpm f WHERE s.cds = f.cdscode) UNION SELECT s.cds, false FROM satscores s WHERE NOT EXISTS (SELECT 1 FROM frpm f WHERE s.cds = f.cdscode) ORDER BY cds"], "preprocess_sql": [], "clean_up_sql": [], "category": "Efficiency", "original_schema": "CREATE TABLE \"frpm\" (\ncdscode text NULL,\nAcademic Year text NULL,\nCounty Code text NULL,\nDistrict Code bigint NULL,\nSchool Code text NULL,\nCounty Name text NULL,\nDistrict Name text NULL,\nSchool Name text NULL,\nDistrict Type text NULL,\nSchool Type text NULL,\nEducational Option Type text NULL,\nNSLP Provision Status text NULL,\nCharter School (Y/N) bigint NULL,\nCharter School Number text NULL,\nCharter Funding Type text NULL,\nirc bigint NULL,\nLow Grade text NULL,\nHigh Grade text NULL,\nEnrollment (K-12) real NULL,\nFree Meal Count (K-12) real NULL,\nPercent (%) Eligible Free (K-12) real NULL,\nFRPM Count (K-12) real NULL,\nPercent (%) Eligible FRPM (K-12) real NULL,\nEnrollment (Ages 5-17) real NULL,\nFree Meal Count (Ages 5-17) real NULL,\nPercent (%) Eligible Free (Ages 5-17) real NULL,\nFRPM Count (Ages 5-17) real NULL,\nPercent (%) Eligible FRPM (Ages 5-17) real NULL,\n2013-14 CALPADS Fall 1 Certification Status bigint NULL,\n    FOREIGN KEY (cdscode) REFERENCES schools(cdscode)\n);\n\nFirst 3 rows:\n       cdscode  Academic Year      County Code    District Code    School Code  County Name    District Name                       School Name                                    District Type                     School Type            Educational Option Type    NSLP Provision Status      Charter School (Y/N)    Charter School Number  Charter Funding Type      irc  Low Grade      High Grade    Enrollment (K-12)    Free Meal Count (K-12)    Percent (%) Eligible Free (K-12)    FRPM Count (K-12)    Percent (%) Eligible FRPM (K-12)    Enrollment (Ages 5-17)    Free Meal Count (Ages 5-17)    Percent (%) Eligible Free (Ages 5-17)    FRPM Count (Ages 5-17)    Percent (%) Eligible FRPM (Ages 5-17)    2013-14 CALPADS Fall 1 Certification Status\n--------------  ---------------  -------------  ---------------  -------------  -------------  ----------------------------------  ---------------------------------------------  --------------------------------  ---------------------  -------------------------  -----------------------  ----------------------  -----------------------  ----------------------  -----  -----------  ------------  -------------------  ------------------------  ----------------------------------  -------------------  ----------------------------------  ------------------------  -----------------------------  ---------------------------------------  ------------------------  ---------------------------------------  ---------------------------------------------\n01100170109835  2014-2015                   01            10017        0109835  Alameda        Alameda County Office of Education  FAME Public Charter                            County Office of Education (COE)  K-12 Schools (Public)  Traditional                                                              1                     0728  Directly funded             1  K                      12                 1087                       565                            0.519779                  715                            0.657774                      1070                            553                                 0.516822                       702                                 0.656075                                              1\n01100170112607  2014-2015                   01            10017        0112607  Alameda        Alameda County Office of Education  Envision Academy for Arts & Technology         County Office of Education (COE)  High Schools (Public)  Traditional                                                              1                     0811  Directly funded             1  9                      12                  395                       186                            0.470886                  186                            0.470886                       376                            182                                 0.484043                       182                                 0.484043                                              1\n01100170118489  2014-2015                   01            10017        0118489  Alameda        Alameda County Office of Education  Aspire California College Preparatory Academy  County Office of Education (COE)  High Schools (Public)  Traditional                                                              1                     1049  Directly funded             1  9                      12                  244                       134                            0.54918                   175                            0.717213                       230                            128                                 0.556522                       168                                 0.730435                                              1\n...\n\n\nCREATE TABLE \"satscores\" (\ncds text NOT NULL,\nrtype text NULL,\nsname text NULL,\ndname text NULL,\ncname text NULL,\nenroll12 bigint NULL,\nnumtsttakr bigint NULL,\navgscrread bigint NULL,\navgscrmath bigint NULL,\navgscrwrite bigint NULL,\nnumge1500 bigint NULL,\n    PRIMARY KEY (cds),\n    FOREIGN KEY (cds) REFERENCES schools(cdscode)\n);\n\nFirst 3 rows:\n           cds  rtype    sname                         dname                              cname      enroll12    numtsttakr    avgscrread    avgscrmath    avgscrwrite    numge1500\n--------------  -------  ----------------------------  ---------------------------------  -------  ----------  ------------  ------------  ------------  -------------  -----------\n03100330000000  D                                      Amador County Office of Education  Amador           16             0           nan           nan            nan          nan\n03739810000000  D                                      Amador County Unified              Amador          317            97           525           514            503           60\n03739810330050  S        North Star Independent Study  Amador County Unified              Amador           17             0           nan           nan            nan          nan\n...\n\n\nCREATE TABLE \"schools\" (\ncdscode text NULL,\nncesdist text NULL,\nncesschool text NULL,\nstatustype text NULL,\ncounty text NULL,\ndistrict text NULL,\nschool text NULL,\nstreet text NULL,\nstreetabr text NULL,\ncity text NULL,\nzip text NULL,\nstate text NULL,\nmailstreet text NULL,\nmailstrabr text NULL,\nmailcity text NULL,\nmailzip text NULL,\nmailstate text NULL,\nphone text NULL,\next text NULL,\nwebsite text NULL,\nopendate date NULL,\ncloseddate date NULL,\ncharter bigint NULL,\ncharternum text NULL,\nfundingtype text NULL,\ndoc text NULL,\ndoctype text NULL,\nsoc text NULL,\nsoctype text NULL,\nedopscode text NULL,\nedopsname text NULL,\neilcode text NULL,\neilname text NULL,\ngsoffered text NULL,\ngsserved text NULL,\nvirtual text NULL,\nmagnet bigint NULL,\nlatitude real NULL,\nlongitude real NULL,\nadmfname1 text NULL,\nadmlname1 text NULL,\nadmemail1 text NULL,\nadmfname2 text NULL,\nadmlname2 text NULL,\nadmemail2 text NULL,\nadmfname3 text NULL,\nadmlname3 text NULL,\nadmemail3 text NULL,\nlastupdate date NULL\n);\n\nFirst 3 rows:\n       cdscode    ncesdist    ncesschool  statustype    county    district                            school                                  street                            streetabr                      city     zip         state    mailstreet                        mailstrabr                     mailcity    mailzip     mailstate    phone           ext    website                   opendate    closeddate      charter    charternum  fundingtype        doc  doctype                             soc  soctype                edopscode    edopsname    eilcode    eilname                      gsoffered    gsserved    virtual      magnet    latitude    longitude  admfname1    admlname1    admemail1                  admfname2    admlname2    admemail2    admfname3    admlname3    admemail3    lastupdate\n--------------  ----------  ------------  ------------  --------  ----------------------------------  --------------------------------------  --------------------------------  -----------------------------  -------  ----------  -------  --------------------------------  -----------------------------  ----------  ----------  -----------  --------------  -----  ------------------------  ----------  ------------  ---------  ------------  ---------------  -----  --------------------------------  -----  ---------------------  -----------  -----------  ---------  ---------------------------  -----------  ----------  ---------  --------  ----------  -----------  -----------  -----------  -------------------------  -----------  -----------  -----------  -----------  -----------  -----------  ------------\n01100170000000     0691051                Active        Alameda   Alameda County Office of Education                                          313 West Winton Avenue            313 West Winton Ave.           Hayward  94544-1136  CA       313 West Winton Avenue            313 West Winton Ave.           Hayward     94544-1136  CA           (510) 887-0152         www.acoe.org                                              nan                                    00  County Office of Education (COE)                                                                                                                                           nan     37.6582     -122.097  L Karen      Monroe       lkmonroe@acoe.org                                                                                        2015-06-23\n01100170109835     0691051         10546  Closed        Alameda   Alameda County Office of Education  FAME Public Charter                     39899 Balentine Drive, Suite 335  39899 Balentine Dr., Ste. 335  Newark   94560-5359  CA       39899 Balentine Drive, Suite 335  39899 Balentine Dr., Ste. 335  Newark      94560-5359  CA                                                            2005-08-29  2015-07-31            1          0728  Directly funded     00  County Office of Education (COE)     65  K-12 Schools (Public)  TRAD         Traditional  ELEMHIGH   Elementary-High Combination  K-12         K-12        P                 0     37.5214     -121.994                                                                                                                                     2015-09-01\n01100170112607     0691051         10947  Active        Alameda   Alameda County Office of Education  Envision Academy for Arts & Technology  1515 Webster Street               1515 Webster St.               Oakland  94612-3355  CA       1515 Webster Street               1515 Webster St.               Oakland     94612       CA           (510) 596-8901         www.envisionacademy.org/  2006-08-28                        1          0811  Directly funded     00  County Office of Education (COE)     66  High Schools (Public)  TRAD         Traditional  HS         High School                  9-12         9-12        N                 0     37.8045     -122.268  Laura        Robell       laura@envisionacademy.org                                                                                2015-06-18\n...\n", "preprocess_schema": "CREATE TABLE \"frpm\" (\ncdscode text NULL,\nAcademic Year text NULL,\nCounty Code text NULL,\nDistrict Code bigint NULL,\nSchool Code text NULL,\nCounty Name text NULL,\nDistrict Name text NULL,\nSchool Name text NULL,\nDistrict Type text NULL,\nSchool Type text NULL,\nEducational Option Type text NULL,\nNSLP Provision Status text NULL,\nCharter School (Y/N) bigint NULL,\nCharter School Number text NULL,\nCharter Funding Type text NULL,\nirc bigint NULL,\nLow Grade text NULL,\nHigh Grade text NULL,\nEnrollment (K-12) real NULL,\nFree Meal Count (K-12) real NULL,\nPercent (%) Eligible Free (K-12) real NULL,\nFRPM Count (K-12) real NULL,\nPercent (%) Eligible FRPM (K-12) real NULL,\nEnrollment (Ages 5-17) real NULL,\nFree Meal Count (Ages 5-17) real NULL,\nPercent (%) Eligible Free (Ages 5-17) real NULL,\nFRPM Count (Ages 5-17) real NULL,\nPercent (%) Eligible FRPM (Ages 5-17) real NULL,\n2013-14 CALPADS Fall 1 Certification Status bigint NULL,\n    FOREIGN KEY (cdscode) REFERENCES schools(cdscode)\n);\n\nFirst 3 rows:\n       cdscode  Academic Year      County Code    District Code    School Code  County Name    District Name                       School Name                                    District Type                     School Type            Educational Option Type    NSLP Provision Status      Charter School (Y/N)    Charter School Number  Charter Funding Type      irc  Low Grade      High Grade    Enrollment (K-12)    Free Meal Count (K-12)    Percent (%) Eligible Free (K-12)    FRPM Count (K-12)    Percent (%) Eligible FRPM (K-12)    Enrollment (Ages 5-17)    Free Meal Count (Ages 5-17)    Percent (%) Eligible Free (Ages 5-17)    FRPM Count (Ages 5-17)    Percent (%) Eligible FRPM (Ages 5-17)    2013-14 CALPADS Fall 1 Certification Status\n--------------  ---------------  -------------  ---------------  -------------  -------------  ----------------------------------  ---------------------------------------------  --------------------------------  ---------------------  -------------------------  -----------------------  ----------------------  -----------------------  ----------------------  -----  -----------  ------------  -------------------  ------------------------  ----------------------------------  -------------------  ----------------------------------  ------------------------  -----------------------------  ---------------------------------------  ------------------------  ---------------------------------------  ---------------------------------------------\n01100170109835  2014-2015                   01            10017        0109835  Alameda        Alameda County Office of Education  FAME Public Charter                            County Office of Education (COE)  K-12 Schools (Public)  Traditional                                                              1                     0728  Directly funded             1  K                      12                 1087                       565                            0.519779                  715                            0.657774                      1070                            553                                 0.516822                       702                                 0.656075                                              1\n01100170112607  2014-2015                   01            10017        0112607  Alameda        Alameda County Office of Education  Envision Academy for Arts & Technology         County Office of Education (COE)  High Schools (Public)  Traditional                                                              1                     0811  Directly funded             1  9                      12                  395                       186                            0.470886                  186                            0.470886                       376                            182                                 0.484043                       182                                 0.484043                                              1\n01100170118489  2014-2015                   01            10017        0118489  Alameda        Alameda County Office of Education  Aspire California College Preparatory Academy  County Office of Education (COE)  High Schools (Public)  Traditional                                                              1                     1049  Directly funded             1  9                      12                  244                       134                            0.54918                   175                            0.717213                       230                            128                                 0.556522                       168                                 0.730435                                              1\n...\n\n\nCREATE TABLE \"satscores\" (\ncds text NOT NULL,\nrtype text NULL,\nsname text NULL,\ndname text NULL,\ncname text NULL,\nenroll12 bigint NULL,\nnumtsttakr bigint NULL,\navgscrread bigint NULL,\navgscrmath bigint NULL,\navgscrwrite bigint NULL,\nnumge1500 bigint NULL,\n    PRIMARY KEY (cds),\n    FOREIGN KEY (cds) REFERENCES schools(cdscode)\n);\n\nFirst 3 rows:\n           cds  rtype    sname                         dname                              cname      enroll12    numtsttakr    avgscrread    avgscrmath    avgscrwrite    numge1500\n--------------  -------  ----------------------------  ---------------------------------  -------  ----------  ------------  ------------  ------------  -------------  -----------\n03100330000000  D                                      Amador County Office of Education  Amador           16             0           nan           nan            nan          nan\n03739810000000  D                                      Amador County Unified              Amador          317            97           525           514            503           60\n03739810330050  S        North Star Independent Study  Amador County Unified              Amador           17             0           nan           nan            nan          nan\n...\n\n\nCREATE TABLE \"schools\" (\ncdscode text NULL,\nncesdist text NULL,\nncesschool text NULL,\nstatustype text NULL,\ncounty text NULL,\ndistrict text NULL,\nschool text NULL,\nstreet text NULL,\nstreetabr text NULL,\ncity text NULL,\nzip text NULL,\nstate text NULL,\nmailstreet text NULL,\nmailstrabr text NULL,\nmailcity text NULL,\nmailzip text NULL,\nmailstate text NULL,\nphone text NULL,\next text NULL,\nwebsite text NULL,\nopendate date NULL,\ncloseddate date NULL,\ncharter bigint NULL,\ncharternum text NULL,\nfundingtype text NULL,\ndoc text NULL,\ndoctype text NULL,\nsoc text NULL,\nsoctype text NULL,\nedopscode text NULL,\nedopsname text NULL,\neilcode text NULL,\neilname text NULL,\ngsoffered text NULL,\ngsserved text NULL,\nvirtual text NULL,\nmagnet bigint NULL,\nlatitude real NULL,\nlongitude real NULL,\nadmfname1 text NULL,\nadmlname1 text NULL,\nadmemail1 text NULL,\nadmfname2 text NULL,\nadmlname2 text NULL,\nadmemail2 text NULL,\nadmfname3 text NULL,\nadmlname3 text NULL,\nadmemail3 text NULL,\nlastupdate date NULL\n);\n\nFirst 3 rows:\n       cdscode    ncesdist    ncesschool  statustype    county    district                            school                                  street                            streetabr                      city     zip         state    mailstreet                        mailstrabr                     mailcity    mailzip     mailstate    phone           ext    website                   opendate    closeddate      charter    charternum  fundingtype        doc  doctype                             soc  soctype                edopscode    edopsname    eilcode    eilname                      gsoffered    gsserved    virtual      magnet    latitude    longitude  admfname1    admlname1    admemail1                  admfname2    admlname2    admemail2    admfname3    admlname3    admemail3    lastupdate\n--------------  ----------  ------------  ------------  --------  ----------------------------------  --------------------------------------  --------------------------------  -----------------------------  -------  ----------  -------  --------------------------------  -----------------------------  ----------  ----------  -----------  --------------  -----  ------------------------  ----------  ------------  ---------  ------------  ---------------  -----  --------------------------------  -----  ---------------------  -----------  -----------  ---------  ---------------------------  -----------  ----------  ---------  --------  ----------  -----------  -----------  -----------  -------------------------  -----------  -----------  -----------  -----------  -----------  -----------  ------------\n01100170000000     0691051                Active        Alameda   Alameda County Office of Education                                          313 West Winton Avenue            313 West Winton Ave.           Hayward  94544-1136  CA       313 West Winton Avenue            313 West Winton Ave.           Hayward     94544-1136  CA           (510) 887-0152         www.acoe.org                                              nan                                    00  County Office of Education (COE)                                                                                                                                           nan     37.6582     -122.097  L Karen      Monroe       lkmonroe@acoe.org                                                                                        2015-06-23\n01100170109835     0691051         10546  Closed        Alameda   Alameda County Office of Education  FAME Public Charter                     39899 Balentine Drive, Suite 335  39899 Balentine Dr., Ste. 335  Newark   94560-5359  CA       39899 Balentine Drive, Suite 335  39899 Balentine Dr., Ste. 335  Newark      94560-5359  CA                                                            2005-08-29  2015-07-31            1          0728  Directly funded     00  County Office of Education (COE)     65  K-12 Schools (Public)  TRAD         Traditional  ELEMHIGH   Elementary-High Combination  K-12         K-12        P                 0     37.5214     -121.994                                                                                                                                     2015-09-01\n01100170112607     0691051         10947  Active        Alameda   Alameda County Office of Education  Envision Academy for Arts & Technology  1515 Webster Street               1515 Webster St.               Oakland  94612-3355  CA       1515 Webster Street               1515 Webster St.               Oakland     94612       CA           (510) 596-8901         www.envisionacademy.org/  2006-08-28                        1          0811  Directly funded     00  County Office of Education (COE)     66  High Schools (Public)  TRAD         Traditional  HS         High School                  9-12         9-12        N                 0     37.8045     -122.268  Laura        Robell       laura@envisionacademy.org                                                                                2015-06-18\n...\n", "sol_sql": ["SELECT s.cds, s.cds IN (SELECT cdscode FROM frpm) AS frpm_exists FROM satscores s order by cds"], "test_cases": ["\ndef test_case(pred_sqls, sol_sqls, db_name, conn):\n    pred_sqls = remove_distinct(pred_sqls)\n    sol_sqls = remove_distinct(sol_sqls)\n    result = ex_base(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"ex_base returned {result} but expected 1.\"\n    result = performance_compare_by_qep(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"performance_check returned {result} but expected 1.\"\n    return result\n    "]}
{"instance_id": "PostgreSQL_94", "dialect": "PostgreSQL", "version": "14.12", "db_id": "european_football_2", "query": "We have a table named 'player_attributes' that records various performance metrics for players. Each record includes the following metrics: gk_diving, gk_handling, gk_kicking, gk_positioning, gk_reflexes. For example, if a player has gk_diving = 6, gk_handling = 10, gk_kicking = 11, gk_positioning = 8, gk_reflexes = 8, the average after removing the highest (11) and lowest (6) amounts would be (8 + 8 + 10) / 3 = 8.6667. The following is the method I use. It is very bloated and the execution time is too long. Is there a neat way to achieve my needs?", "issue_sql": ["SELECT id, (SUM(gk) - MAX(gk) - MIN(gk)) / (COUNT(gk) - 2) AS adjusted_average FROM (SELECT id, gk_diving AS gk FROM player_attributes UNION ALL SELECT id, gk_handling AS gk FROM player_attributes UNION ALL SELECT id, gk_kicking AS gk FROM player_attributes UNION ALL SELECT id, gk_positioning AS gk FROM player_attributes UNION ALL SELECT id, gk_reflexes AS gk FROM player_attributes) subquery GROUP BY id ORDER BY id;"], "preprocess_sql": [], "clean_up_sql": [], "category": "Efficiency", "original_schema": "CREATE TABLE \"country\" (\nid bigint NOT NULL DEFAULT nextval('country_id_seq'::regclass),\nname text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  name\n----  -------\n   1  Belgium\n1729  England\n4769  France\n...\n\n\nCREATE TABLE \"league\" (\nid bigint NOT NULL DEFAULT nextval('league_id_seq'::regclass),\ncountry_id bigint NULL,\nname text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id    country_id  name\n----  ------------  ----------------------\n   1             1  Belgium Jupiler League\n1729          1729  England Premier League\n4769          4769  France Ligue 1\n...\n\n\nCREATE TABLE \"match\" (\nid bigint NOT NULL DEFAULT nextval('match_id_seq'::regclass),\ncountry_id bigint NULL,\nleague_id bigint NULL,\nseason text NULL,\nstage bigint NULL,\ndate text NULL,\nmatch_api_id bigint NULL,\nhome_team_api_id bigint NULL,\naway_team_api_id bigint NULL,\nhome_team_goal bigint NULL,\naway_team_goal bigint NULL,\nhome_player_x1 bigint NULL,\nhome_player_x2 bigint NULL,\nhome_player_x3 bigint NULL,\nhome_player_x4 bigint NULL,\nhome_player_x5 bigint NULL,\nhome_player_x6 bigint NULL,\nhome_player_x7 bigint NULL,\nhome_player_x8 bigint NULL,\nhome_player_x9 bigint NULL,\nhome_player_x10 bigint NULL,\nhome_player_x11 bigint NULL,\naway_player_x1 bigint NULL,\naway_player_x2 bigint NULL,\naway_player_x3 bigint NULL,\naway_player_x4 bigint NULL,\naway_player_x5 bigint NULL,\naway_player_x6 bigint NULL,\naway_player_x7 bigint NULL,\naway_player_x8 bigint NULL,\naway_player_x9 bigint NULL,\naway_player_x10 bigint NULL,\naway_player_x11 bigint NULL,\nhome_player_y1 bigint NULL,\nhome_player_y2 bigint NULL,\nhome_player_y3 bigint NULL,\nhome_player_y4 bigint NULL,\nhome_player_y5 bigint NULL,\nhome_player_y6 bigint NULL,\nhome_player_y7 bigint NULL,\nhome_player_y8 bigint NULL,\nhome_player_y9 bigint NULL,\nhome_player_y10 bigint NULL,\nhome_player_y11 bigint NULL,\naway_player_y1 bigint NULL,\naway_player_y2 bigint NULL,\naway_player_y3 bigint NULL,\naway_player_y4 bigint NULL,\naway_player_y5 bigint NULL,\naway_player_y6 bigint NULL,\naway_player_y7 bigint NULL,\naway_player_y8 bigint NULL,\naway_player_y9 bigint NULL,\naway_player_y10 bigint NULL,\naway_player_y11 bigint NULL,\nhome_player_1 bigint NULL,\nhome_player_2 bigint NULL,\nhome_player_3 bigint NULL,\nhome_player_4 bigint NULL,\nhome_player_5 bigint NULL,\nhome_player_6 bigint NULL,\nhome_player_7 bigint NULL,\nhome_player_8 bigint NULL,\nhome_player_9 bigint NULL,\nhome_player_10 bigint NULL,\nhome_player_11 bigint NULL,\naway_player_1 bigint NULL,\naway_player_2 bigint NULL,\naway_player_3 bigint NULL,\naway_player_4 bigint NULL,\naway_player_5 bigint NULL,\naway_player_6 bigint NULL,\naway_player_7 bigint NULL,\naway_player_8 bigint NULL,\naway_player_9 bigint NULL,\naway_player_10 bigint NULL,\naway_player_11 bigint NULL,\ngoal text NULL,\nshoton text NULL,\nshotoff text NULL,\nfoulcommit text NULL,\ncard text NULL,\ncross text NULL,\ncorner text NULL,\npossession text NULL,\nb365h real NULL,\nb365d real NULL,\nb365a real NULL,\nbwh real NULL,\nbwd real NULL,\nbwa real NULL,\niwh real NULL,\niwd real NULL,\niwa real NULL,\nlbh real NULL,\nlbd real NULL,\nlba real NULL,\npsh real NULL,\npsd real NULL,\npsa real NULL,\nwhh real NULL,\nwhd real NULL,\nwha real NULL,\nsjh real NULL,\nsjd real NULL,\nsja real NULL,\nvch real NULL,\nvcd real NULL,\nvca real NULL,\ngbh real NULL,\ngbd real NULL,\ngba real NULL,\nbsh real NULL,\nbsd real NULL,\nbsa real NULL,\n    PRIMARY KEY (id),\n    FOREIGN KEY (away_player_10) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_11) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_1) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_2) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_3) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_4) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_5) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_6) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_7) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_8) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_9) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_team_api_id) REFERENCES team(team_api_id),\n    FOREIGN KEY (home_player_10) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_11) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_1) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_2) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_3) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_4) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_5) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_6) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_7) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_8) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_9) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_team_api_id) REFERENCES team(team_api_id)\n);\n\nFirst 3 rows:\n  id    country_id    league_id  season       stage  date                   match_api_id    home_team_api_id    away_team_api_id    home_team_goal    away_team_goal  home_player_x1    home_player_x2    home_player_x3    home_player_x4    home_player_x5    home_player_x6    home_player_x7    home_player_x8    home_player_x9    home_player_x10    home_player_x11    away_player_x1    away_player_x2    away_player_x3    away_player_x4    away_player_x5    away_player_x6    away_player_x7    away_player_x8    away_player_x9    away_player_x10    away_player_x11    home_player_y1    home_player_y2    home_player_y3    home_player_y4    home_player_y5    home_player_y6    home_player_y7    home_player_y8    home_player_y9    home_player_y10    home_player_y11    away_player_y1    away_player_y2    away_player_y3    away_player_y4    away_player_y5    away_player_y6    away_player_y7    away_player_y8    away_player_y9    away_player_y10    away_player_y11    home_player_1    home_player_2    home_player_3    home_player_4    home_player_5    home_player_6    home_player_7    home_player_8    home_player_9    home_player_10    home_player_11    away_player_1    away_player_2    away_player_3    away_player_4    away_player_5    away_player_6    away_player_7    away_player_8    away_player_9    away_player_10    away_player_11      b365h    b365d    b365a    bwh    bwd    bwa    iwh    iwd    iwa    lbh    lbd    lba  psh    psd    psa      whh    whd    wha    sjh    sjd    sja    vch    vcd    vca    gbh    gbd    gba    bsh    bsd    bsa\n----  ------------  -----------  ---------  -------  -------------------  --------------  ------------------  ------------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  -----------------  -----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  -----------------  -----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  -----------------  -----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  -----------------  -----------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ----------------  ----------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ----------------  ----------------  -------  -------  -------  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----\n   1             1            1  2008/2009        1  2008-08-17 00:00:00          492473                9987                9993                 1                 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               1.73      3.4     5      1.75   3.35   4.2    1.85    3.2    3.5    1.8    3.3   3.75                        1.7    3.3    4.33   1.9     3.3    4     1.65   3.4    4.5    1.78   3.25   4      1.73   3.4    4.2\n   2             1            1  2008/2009        1  2008-08-16 00:00:00          492474               10000                9994                 0                 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               1.95      3.2     3.6    1.8    3.3    3.95   1.9     3.2    3.5    1.9    3.2   3.5                         1.83   3.3    3.6    1.95    3.3    3.8   2      3.25   3.25   1.85   3.25   3.75   1.91   3.25   3.6\n   3             1            1  2008/2009        1  2008-08-16 00:00:00          492475                9984                8635                 0                 3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               2.38      3.3     2.75   2.4    3.3    2.55   2.6     3.1    2.3    2.5    3.2   2.5                         2.5    3.25   2.4    2.63    3.3    2.5   2.35   3.25   2.65   2.5    3.2    2.5    2.3    3.2    2.75\n...\n\n\nCREATE TABLE \"player\" (\nid bigint NOT NULL DEFAULT nextval('player_id_seq'::regclass),\nplayer_api_id bigint NULL,\nplayer_name text NULL,\nplayer_fifa_api_id bigint NULL,\nbirthday text NULL,\nheight bigint NULL,\nweight bigint NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id    player_api_id  player_name           player_fifa_api_id  birthday               height    weight\n----  ---------------  ------------------  --------------------  -------------------  --------  --------\n   1           505942  Aaron Appindangoye                218353  1992-02-29 00:00:00       182       187\n   2           155782  Aaron Cresswell                   189615  1989-12-15 00:00:00       170       146\n   3           162549  Aaron Doran                       186170  1991-05-13 00:00:00       170       163\n...\n\n\nCREATE TABLE \"player_attributes\" (\nid bigint NOT NULL DEFAULT nextval('player_attributes_id_seq'::regclass),\nplayer_fifa_api_id bigint NULL,\nplayer_api_id bigint NULL,\ndate text NULL,\noverall_rating bigint NULL,\npotential bigint NULL,\npreferred_foot text NULL,\nattacking_work_rate text NULL,\ndefensive_work_rate text NULL,\ncrossing bigint NULL,\nfinishing bigint NULL,\nheading_accuracy bigint NULL,\nshort_passing bigint NULL,\nvolleys bigint NULL,\ndribbling bigint NULL,\ncurve bigint NULL,\nfree_kick_accuracy bigint NULL,\nlong_passing bigint NULL,\nball_control bigint NULL,\nacceleration bigint NULL,\nsprint_speed bigint NULL,\nagility bigint NULL,\nreactions bigint NULL,\nbalance bigint NULL,\nshot_power bigint NULL,\njumping bigint NULL,\nstamina bigint NULL,\nstrength bigint NULL,\nlong_shots bigint NULL,\naggression bigint NULL,\ninterceptions bigint NULL,\npositioning bigint NULL,\nvision bigint NULL,\npenalties bigint NULL,\nmarking bigint NULL,\nstanding_tackle bigint NULL,\nsliding_tackle bigint NULL,\ngk_diving bigint NULL,\ngk_handling bigint NULL,\ngk_kicking bigint NULL,\ngk_positioning bigint NULL,\ngk_reflexes bigint NULL,\n    PRIMARY KEY (id),\n    FOREIGN KEY (player_api_id) REFERENCES player(player_api_id)\n);\n\nFirst 3 rows:\n  id    player_fifa_api_id    player_api_id  date                   overall_rating    potential  preferred_foot    attacking_work_rate    defensive_work_rate      crossing    finishing    heading_accuracy    short_passing    volleys    dribbling    curve    free_kick_accuracy    long_passing    ball_control    acceleration    sprint_speed    agility    reactions    balance    shot_power    jumping    stamina    strength    long_shots    aggression    interceptions    positioning    vision    penalties    marking    standing_tackle    sliding_tackle    gk_diving    gk_handling    gk_kicking    gk_positioning    gk_reflexes\n----  --------------------  ---------------  -------------------  ----------------  -----------  ----------------  ---------------------  ---------------------  ----------  -----------  ------------------  ---------------  ---------  -----------  -------  --------------------  --------------  --------------  --------------  --------------  ---------  -----------  ---------  ------------  ---------  ---------  ----------  ------------  ------------  ---------------  -------------  --------  -----------  ---------  -----------------  ----------------  -----------  -------------  ------------  ----------------  -------------\n   1                218353           505942  2016-02-18 00:00:00                67           71  right             medium                 medium                         49           44                  71               61         44           51       45                    39              64              49              60              64         59           47         65            55         58         54          76            35            71               70             45        54           48         65                 69                69            6             11            10                 8              8\n   2                218353           505942  2015-11-19 00:00:00                67           71  right             medium                 medium                         49           44                  71               61         44           51       45                    39              64              49              60              64         59           47         65            55         58         54          76            35            71               70             45        54           48         65                 69                69            6             11            10                 8              8\n   3                218353           505942  2015-09-21 00:00:00                62           66  right             medium                 medium                         49           44                  71               61         44           51       45                    39              64              49              60              64         59           47         65            55         58         54          76            35            63               41             45        54           48         65                 66                69            6             11            10                 8              8\n...\n\n\nCREATE TABLE \"team\" (\nid bigint NOT NULL DEFAULT nextval('team_id_seq'::regclass),\nteam_api_id bigint NULL,\nteam_fifa_api_id bigint NULL,\nteam_long_name text NULL,\nteam_short_name text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id    team_api_id    team_fifa_api_id  team_long_name    team_short_name\n----  -------------  ------------------  ----------------  -----------------\n   1           9987                 673  KRC Genk          GEN\n   2           9993                 675  Beerschot AC      BAC\n   3          10000               15005  SV Zulte-Waregem  ZUL\n...\n\n\nCREATE TABLE \"team_attributes\" (\nid bigint NOT NULL DEFAULT nextval('team_attributes_id_seq'::regclass),\nteam_fifa_api_id bigint NULL,\nteam_api_id bigint NULL,\ndate text NULL,\nbuildupplayspeed bigint NULL,\nbuildupplayspeedclass text NULL,\nbuildupplaydribbling bigint NULL,\nbuildupplaydribblingclass text NULL,\nbuildupplaypassing bigint NULL,\nbuildupplaypassingclass text NULL,\nbuildupplaypositioningclass text NULL,\nchancecreationpassing bigint NULL,\nchancecreationpassingclass text NULL,\nchancecreationcrossing bigint NULL,\nchancecreationcrossingclass text NULL,\nchancecreationshooting bigint NULL,\nchancecreationshootingclass text NULL,\nchancecreationpositioningclass text NULL,\ndefencepressure bigint NULL,\ndefencepressureclass text NULL,\ndefenceaggression bigint NULL,\ndefenceaggressionclass text NULL,\ndefenceteamwidth bigint NULL,\ndefenceteamwidthclass text NULL,\ndefencedefenderlineclass text NULL,\n    PRIMARY KEY (id),\n    FOREIGN KEY (team_api_id) REFERENCES team(team_api_id)\n);\n\nFirst 3 rows:\n  id    team_fifa_api_id    team_api_id  date                   buildupplayspeed  buildupplayspeedclass      buildupplaydribbling  buildupplaydribblingclass      buildupplaypassing  buildupplaypassingclass    buildupplaypositioningclass      chancecreationpassing  chancecreationpassingclass      chancecreationcrossing  chancecreationcrossingclass      chancecreationshooting  chancecreationshootingclass    chancecreationpositioningclass      defencepressure  defencepressureclass      defenceaggression  defenceaggressionclass      defenceteamwidth  defenceteamwidthclass    defencedefenderlineclass\n----  ------------------  -------------  -------------------  ------------------  -----------------------  ----------------------  ---------------------------  --------------------  -------------------------  -----------------------------  -----------------------  ----------------------------  ------------------------  -----------------------------  ------------------------  -----------------------------  --------------------------------  -----------------  ----------------------  -------------------  ------------------------  ------------------  -----------------------  --------------------------\n   1                 434           9930  2010-02-22 00:00:00                  60  Balanced                                    nan  Little                                         50  Mixed                      Organised                                           60  Normal                                              65  Normal                                               55  Normal                         Organised                                        50  Medium                                   55  Press                                     45  Normal                   Cover\n   2                 434           9930  2014-09-19 00:00:00                  52  Balanced                                     48  Normal                                         56  Mixed                      Organised                                           54  Normal                                              63  Normal                                               64  Normal                         Organised                                        47  Medium                                   44  Press                                     54  Normal                   Cover\n   3                 434           9930  2015-09-10 00:00:00                  47  Balanced                                     41  Normal                                         54  Mixed                      Organised                                           54  Normal                                              63  Normal                                               64  Normal                         Organised                                        47  Medium                                   44  Press                                     54  Normal                   Cover\n...\n", "preprocess_schema": "CREATE TABLE \"country\" (\nid bigint NOT NULL DEFAULT nextval('country_id_seq'::regclass),\nname text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  name\n----  -------\n   1  Belgium\n1729  England\n4769  France\n...\n\n\nCREATE TABLE \"league\" (\nid bigint NOT NULL DEFAULT nextval('league_id_seq'::regclass),\ncountry_id bigint NULL,\nname text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id    country_id  name\n----  ------------  ----------------------\n   1             1  Belgium Jupiler League\n1729          1729  England Premier League\n4769          4769  France Ligue 1\n...\n\n\nCREATE TABLE \"match\" (\nid bigint NOT NULL DEFAULT nextval('match_id_seq'::regclass),\ncountry_id bigint NULL,\nleague_id bigint NULL,\nseason text NULL,\nstage bigint NULL,\ndate text NULL,\nmatch_api_id bigint NULL,\nhome_team_api_id bigint NULL,\naway_team_api_id bigint NULL,\nhome_team_goal bigint NULL,\naway_team_goal bigint NULL,\nhome_player_x1 bigint NULL,\nhome_player_x2 bigint NULL,\nhome_player_x3 bigint NULL,\nhome_player_x4 bigint NULL,\nhome_player_x5 bigint NULL,\nhome_player_x6 bigint NULL,\nhome_player_x7 bigint NULL,\nhome_player_x8 bigint NULL,\nhome_player_x9 bigint NULL,\nhome_player_x10 bigint NULL,\nhome_player_x11 bigint NULL,\naway_player_x1 bigint NULL,\naway_player_x2 bigint NULL,\naway_player_x3 bigint NULL,\naway_player_x4 bigint NULL,\naway_player_x5 bigint NULL,\naway_player_x6 bigint NULL,\naway_player_x7 bigint NULL,\naway_player_x8 bigint NULL,\naway_player_x9 bigint NULL,\naway_player_x10 bigint NULL,\naway_player_x11 bigint NULL,\nhome_player_y1 bigint NULL,\nhome_player_y2 bigint NULL,\nhome_player_y3 bigint NULL,\nhome_player_y4 bigint NULL,\nhome_player_y5 bigint NULL,\nhome_player_y6 bigint NULL,\nhome_player_y7 bigint NULL,\nhome_player_y8 bigint NULL,\nhome_player_y9 bigint NULL,\nhome_player_y10 bigint NULL,\nhome_player_y11 bigint NULL,\naway_player_y1 bigint NULL,\naway_player_y2 bigint NULL,\naway_player_y3 bigint NULL,\naway_player_y4 bigint NULL,\naway_player_y5 bigint NULL,\naway_player_y6 bigint NULL,\naway_player_y7 bigint NULL,\naway_player_y8 bigint NULL,\naway_player_y9 bigint NULL,\naway_player_y10 bigint NULL,\naway_player_y11 bigint NULL,\nhome_player_1 bigint NULL,\nhome_player_2 bigint NULL,\nhome_player_3 bigint NULL,\nhome_player_4 bigint NULL,\nhome_player_5 bigint NULL,\nhome_player_6 bigint NULL,\nhome_player_7 bigint NULL,\nhome_player_8 bigint NULL,\nhome_player_9 bigint NULL,\nhome_player_10 bigint NULL,\nhome_player_11 bigint NULL,\naway_player_1 bigint NULL,\naway_player_2 bigint NULL,\naway_player_3 bigint NULL,\naway_player_4 bigint NULL,\naway_player_5 bigint NULL,\naway_player_6 bigint NULL,\naway_player_7 bigint NULL,\naway_player_8 bigint NULL,\naway_player_9 bigint NULL,\naway_player_10 bigint NULL,\naway_player_11 bigint NULL,\ngoal text NULL,\nshoton text NULL,\nshotoff text NULL,\nfoulcommit text NULL,\ncard text NULL,\ncross text NULL,\ncorner text NULL,\npossession text NULL,\nb365h real NULL,\nb365d real NULL,\nb365a real NULL,\nbwh real NULL,\nbwd real NULL,\nbwa real NULL,\niwh real NULL,\niwd real NULL,\niwa real NULL,\nlbh real NULL,\nlbd real NULL,\nlba real NULL,\npsh real NULL,\npsd real NULL,\npsa real NULL,\nwhh real NULL,\nwhd real NULL,\nwha real NULL,\nsjh real NULL,\nsjd real NULL,\nsja real NULL,\nvch real NULL,\nvcd real NULL,\nvca real NULL,\ngbh real NULL,\ngbd real NULL,\ngba real NULL,\nbsh real NULL,\nbsd real NULL,\nbsa real NULL,\n    PRIMARY KEY (id),\n    FOREIGN KEY (away_player_10) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_11) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_1) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_2) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_3) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_4) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_5) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_6) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_7) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_8) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_9) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_team_api_id) REFERENCES team(team_api_id),\n    FOREIGN KEY (home_player_10) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_11) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_1) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_2) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_3) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_4) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_5) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_6) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_7) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_8) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_9) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_team_api_id) REFERENCES team(team_api_id)\n);\n\nFirst 3 rows:\n  id    country_id    league_id  season       stage  date                   match_api_id    home_team_api_id    away_team_api_id    home_team_goal    away_team_goal  home_player_x1    home_player_x2    home_player_x3    home_player_x4    home_player_x5    home_player_x6    home_player_x7    home_player_x8    home_player_x9    home_player_x10    home_player_x11    away_player_x1    away_player_x2    away_player_x3    away_player_x4    away_player_x5    away_player_x6    away_player_x7    away_player_x8    away_player_x9    away_player_x10    away_player_x11    home_player_y1    home_player_y2    home_player_y3    home_player_y4    home_player_y5    home_player_y6    home_player_y7    home_player_y8    home_player_y9    home_player_y10    home_player_y11    away_player_y1    away_player_y2    away_player_y3    away_player_y4    away_player_y5    away_player_y6    away_player_y7    away_player_y8    away_player_y9    away_player_y10    away_player_y11    home_player_1    home_player_2    home_player_3    home_player_4    home_player_5    home_player_6    home_player_7    home_player_8    home_player_9    home_player_10    home_player_11    away_player_1    away_player_2    away_player_3    away_player_4    away_player_5    away_player_6    away_player_7    away_player_8    away_player_9    away_player_10    away_player_11      b365h    b365d    b365a    bwh    bwd    bwa    iwh    iwd    iwa    lbh    lbd    lba  psh    psd    psa      whh    whd    wha    sjh    sjd    sja    vch    vcd    vca    gbh    gbd    gba    bsh    bsd    bsa\n----  ------------  -----------  ---------  -------  -------------------  --------------  ------------------  ------------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  -----------------  -----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  -----------------  -----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  -----------------  -----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  -----------------  -----------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ----------------  ----------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ----------------  ----------------  -------  -------  -------  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----\n   1             1            1  2008/2009        1  2008-08-17 00:00:00          492473                9987                9993                 1                 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               1.73      3.4     5      1.75   3.35   4.2    1.85    3.2    3.5    1.8    3.3   3.75                        1.7    3.3    4.33   1.9     3.3    4     1.65   3.4    4.5    1.78   3.25   4      1.73   3.4    4.2\n   2             1            1  2008/2009        1  2008-08-16 00:00:00          492474               10000                9994                 0                 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               1.95      3.2     3.6    1.8    3.3    3.95   1.9     3.2    3.5    1.9    3.2   3.5                         1.83   3.3    3.6    1.95    3.3    3.8   2      3.25   3.25   1.85   3.25   3.75   1.91   3.25   3.6\n   3             1            1  2008/2009        1  2008-08-16 00:00:00          492475                9984                8635                 0                 3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               2.38      3.3     2.75   2.4    3.3    2.55   2.6     3.1    2.3    2.5    3.2   2.5                         2.5    3.25   2.4    2.63    3.3    2.5   2.35   3.25   2.65   2.5    3.2    2.5    2.3    3.2    2.75\n...\n\n\nCREATE TABLE \"player\" (\nid bigint NOT NULL DEFAULT nextval('player_id_seq'::regclass),\nplayer_api_id bigint NULL,\nplayer_name text NULL,\nplayer_fifa_api_id bigint NULL,\nbirthday text NULL,\nheight bigint NULL,\nweight bigint NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id    player_api_id  player_name           player_fifa_api_id  birthday               height    weight\n----  ---------------  ------------------  --------------------  -------------------  --------  --------\n   1           505942  Aaron Appindangoye                218353  1992-02-29 00:00:00       182       187\n   2           155782  Aaron Cresswell                   189615  1989-12-15 00:00:00       170       146\n   3           162549  Aaron Doran                       186170  1991-05-13 00:00:00       170       163\n...\n\n\nCREATE TABLE \"player_attributes\" (\nid bigint NOT NULL DEFAULT nextval('player_attributes_id_seq'::regclass),\nplayer_fifa_api_id bigint NULL,\nplayer_api_id bigint NULL,\ndate text NULL,\noverall_rating bigint NULL,\npotential bigint NULL,\npreferred_foot text NULL,\nattacking_work_rate text NULL,\ndefensive_work_rate text NULL,\ncrossing bigint NULL,\nfinishing bigint NULL,\nheading_accuracy bigint NULL,\nshort_passing bigint NULL,\nvolleys bigint NULL,\ndribbling bigint NULL,\ncurve bigint NULL,\nfree_kick_accuracy bigint NULL,\nlong_passing bigint NULL,\nball_control bigint NULL,\nacceleration bigint NULL,\nsprint_speed bigint NULL,\nagility bigint NULL,\nreactions bigint NULL,\nbalance bigint NULL,\nshot_power bigint NULL,\njumping bigint NULL,\nstamina bigint NULL,\nstrength bigint NULL,\nlong_shots bigint NULL,\naggression bigint NULL,\ninterceptions bigint NULL,\npositioning bigint NULL,\nvision bigint NULL,\npenalties bigint NULL,\nmarking bigint NULL,\nstanding_tackle bigint NULL,\nsliding_tackle bigint NULL,\ngk_diving bigint NULL,\ngk_handling bigint NULL,\ngk_kicking bigint NULL,\ngk_positioning bigint NULL,\ngk_reflexes bigint NULL,\n    PRIMARY KEY (id),\n    FOREIGN KEY (player_api_id) REFERENCES player(player_api_id)\n);\n\nFirst 3 rows:\n  id    player_fifa_api_id    player_api_id  date                   overall_rating    potential  preferred_foot    attacking_work_rate    defensive_work_rate      crossing    finishing    heading_accuracy    short_passing    volleys    dribbling    curve    free_kick_accuracy    long_passing    ball_control    acceleration    sprint_speed    agility    reactions    balance    shot_power    jumping    stamina    strength    long_shots    aggression    interceptions    positioning    vision    penalties    marking    standing_tackle    sliding_tackle    gk_diving    gk_handling    gk_kicking    gk_positioning    gk_reflexes\n----  --------------------  ---------------  -------------------  ----------------  -----------  ----------------  ---------------------  ---------------------  ----------  -----------  ------------------  ---------------  ---------  -----------  -------  --------------------  --------------  --------------  --------------  --------------  ---------  -----------  ---------  ------------  ---------  ---------  ----------  ------------  ------------  ---------------  -------------  --------  -----------  ---------  -----------------  ----------------  -----------  -------------  ------------  ----------------  -------------\n   1                218353           505942  2016-02-18 00:00:00                67           71  right             medium                 medium                         49           44                  71               61         44           51       45                    39              64              49              60              64         59           47         65            55         58         54          76            35            71               70             45        54           48         65                 69                69            6             11            10                 8              8\n   2                218353           505942  2015-11-19 00:00:00                67           71  right             medium                 medium                         49           44                  71               61         44           51       45                    39              64              49              60              64         59           47         65            55         58         54          76            35            71               70             45        54           48         65                 69                69            6             11            10                 8              8\n   3                218353           505942  2015-09-21 00:00:00                62           66  right             medium                 medium                         49           44                  71               61         44           51       45                    39              64              49              60              64         59           47         65            55         58         54          76            35            63               41             45        54           48         65                 66                69            6             11            10                 8              8\n...\n\n\nCREATE TABLE \"team\" (\nid bigint NOT NULL DEFAULT nextval('team_id_seq'::regclass),\nteam_api_id bigint NULL,\nteam_fifa_api_id bigint NULL,\nteam_long_name text NULL,\nteam_short_name text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id    team_api_id    team_fifa_api_id  team_long_name    team_short_name\n----  -------------  ------------------  ----------------  -----------------\n   1           9987                 673  KRC Genk          GEN\n   2           9993                 675  Beerschot AC      BAC\n   3          10000               15005  SV Zulte-Waregem  ZUL\n...\n\n\nCREATE TABLE \"team_attributes\" (\nid bigint NOT NULL DEFAULT nextval('team_attributes_id_seq'::regclass),\nteam_fifa_api_id bigint NULL,\nteam_api_id bigint NULL,\ndate text NULL,\nbuildupplayspeed bigint NULL,\nbuildupplayspeedclass text NULL,\nbuildupplaydribbling bigint NULL,\nbuildupplaydribblingclass text NULL,\nbuildupplaypassing bigint NULL,\nbuildupplaypassingclass text NULL,\nbuildupplaypositioningclass text NULL,\nchancecreationpassing bigint NULL,\nchancecreationpassingclass text NULL,\nchancecreationcrossing bigint NULL,\nchancecreationcrossingclass text NULL,\nchancecreationshooting bigint NULL,\nchancecreationshootingclass text NULL,\nchancecreationpositioningclass text NULL,\ndefencepressure bigint NULL,\ndefencepressureclass text NULL,\ndefenceaggression bigint NULL,\ndefenceaggressionclass text NULL,\ndefenceteamwidth bigint NULL,\ndefenceteamwidthclass text NULL,\ndefencedefenderlineclass text NULL,\n    PRIMARY KEY (id),\n    FOREIGN KEY (team_api_id) REFERENCES team(team_api_id)\n);\n\nFirst 3 rows:\n  id    team_fifa_api_id    team_api_id  date                   buildupplayspeed  buildupplayspeedclass      buildupplaydribbling  buildupplaydribblingclass      buildupplaypassing  buildupplaypassingclass    buildupplaypositioningclass      chancecreationpassing  chancecreationpassingclass      chancecreationcrossing  chancecreationcrossingclass      chancecreationshooting  chancecreationshootingclass    chancecreationpositioningclass      defencepressure  defencepressureclass      defenceaggression  defenceaggressionclass      defenceteamwidth  defenceteamwidthclass    defencedefenderlineclass\n----  ------------------  -------------  -------------------  ------------------  -----------------------  ----------------------  ---------------------------  --------------------  -------------------------  -----------------------------  -----------------------  ----------------------------  ------------------------  -----------------------------  ------------------------  -----------------------------  --------------------------------  -----------------  ----------------------  -------------------  ------------------------  ------------------  -----------------------  --------------------------\n   1                 434           9930  2010-02-22 00:00:00                  60  Balanced                                    nan  Little                                         50  Mixed                      Organised                                           60  Normal                                              65  Normal                                               55  Normal                         Organised                                        50  Medium                                   55  Press                                     45  Normal                   Cover\n   2                 434           9930  2014-09-19 00:00:00                  52  Balanced                                     48  Normal                                         56  Mixed                      Organised                                           54  Normal                                              63  Normal                                               64  Normal                         Organised                                        47  Medium                                   44  Press                                     54  Normal                   Cover\n   3                 434           9930  2015-09-10 00:00:00                  47  Balanced                                     41  Normal                                         54  Mixed                      Organised                                           54  Normal                                              63  Normal                                               64  Normal                         Organised                                        47  Medium                                   44  Press                                     54  Normal                   Cover\n...\n", "sol_sql": ["SELECT id, ((gk_diving + gk_handling + gk_kicking + gk_positioning + gk_reflexes) - GREATEST(gk_diving, gk_handling, gk_kicking, gk_positioning, gk_reflexes) - LEAST(gk_diving, gk_handling, gk_kicking, gk_positioning, gk_reflexes)) / 3.0 AS adjusted_average FROM player_attributes ORDER BY id;"], "test_cases": ["\ndef test_case(pred_sqls, sol_sqls, db_name, conn):\n    result = ex_base(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"ex_base returned {result} but expected 1.\"\n    result = performance_compare_by_qep(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"performance_check returned {result} but expected 1.\"\n    return result\n    "]}
{"instance_id": "PostgreSQL_95", "dialect": "PostgreSQL", "version": "14.12", "db_id": "financial", "query": "In the financial database, there is a table named 'trans' which records all transactions made by clients. Each transaction has a unique transaction ID, the account ID associated with the transaction, the date of the transaction, the type of transaction (credit or debit), the operation performed, the amount involved, the balance after the transaction, and additional details such as the bank and account of the partner. The table has more than 1000000 rows and is growing rapidly. I need to extract the most recent transaction (based on the transaction date) for each account ID. I also tried to avoid using a subquery but did not notice a significant difference. Any idea how I could optimize this query?", "issue_sql": ["DROP INDEX IF EXISTS idx_a;", "SELECT DISTINCT ON (t.account_id) t.trans_id, t.account_id, t.date, t.type, t.amount, t.balance FROM trans t ORDER BY t.account_id, t.date DESC, trans_id;"], "preprocess_sql": [], "clean_up_sql": ["DROP INDEX IF EXISTS idx_a;"], "category": "Efficiency", "original_schema": "CREATE TABLE \"account\" (\naccount_id bigint NOT NULL DEFAULT '0'::bigint,\ndistrict_id bigint NULL DEFAULT '0'::bigint,\nfrequency text NULL,\ndate date NULL,\n    PRIMARY KEY (account_id),\n    FOREIGN KEY (district_id) REFERENCES district(district_id)\n);\n\nFirst 3 rows:\n  account_id    district_id  frequency         date\n------------  -------------  ----------------  ----------\n           1             18  POPLATEK MESICNE  1995-03-24\n           2              1  POPLATEK MESICNE  1993-02-26\n           3              5  POPLATEK MESICNE  1997-07-07\n...\n\n\nCREATE TABLE \"card\" (\ncard_id bigint NOT NULL DEFAULT '0'::bigint,\ndisp_id bigint NULL,\ntype text NULL,\nissued date NULL,\n    PRIMARY KEY (card_id),\n    FOREIGN KEY (disp_id) REFERENCES disp(disp_id)\n);\n\nFirst 3 rows:\n  card_id    disp_id  type     issued\n---------  ---------  -------  ----------\n        1          9  gold     1998-10-16\n        2         19  classic  1998-03-13\n        3         41  gold     1995-09-03\n...\n\n\nCREATE TABLE \"client\" (\nclient_id bigint NOT NULL,\ngender text NULL,\nbirth_date date NULL,\ndistrict_id bigint NULL,\n    PRIMARY KEY (client_id),\n    FOREIGN KEY (district_id) REFERENCES district(district_id)\n);\n\nFirst 3 rows:\n  client_id  gender    birth_date      district_id\n-----------  --------  ------------  -------------\n          1  F         1970-12-13               18\n          2  M         1945-02-04                1\n          3  F         1940-10-09                1\n...\n\n\nCREATE TABLE \"disp\" (\ndisp_id bigint NOT NULL,\nclient_id bigint NULL,\naccount_id bigint NULL,\ntype text NULL,\n    PRIMARY KEY (disp_id),\n    FOREIGN KEY (account_id) REFERENCES account(account_id),\n    FOREIGN KEY (client_id) REFERENCES client(client_id)\n);\n\nFirst 3 rows:\n  disp_id    client_id    account_id  type\n---------  -----------  ------------  ---------\n        1            1             1  OWNER\n        2            2             2  OWNER\n        3            3             2  DISPONENT\n...\n\n\nCREATE TABLE \"district\" (\ndistrict_id bigint NOT NULL DEFAULT '0'::bigint,\na2 text NULL,\na3 text NULL,\na4 text NULL,\na5 text NULL,\na6 text NULL,\na7 text NULL,\na8 bigint NULL,\na9 bigint NULL,\na10 real NULL,\na11 bigint NULL,\na12 real NULL,\na13 real NULL,\na14 bigint NULL,\na15 bigint NULL,\na16 bigint NULL,\n    PRIMARY KEY (district_id)\n);\n\nFirst 3 rows:\n  district_id  a2           a3                    a4    a5    a6    a7    a8    a9    a10    a11    a12    a13    a14    a15    a16\n-------------  -----------  ---------------  -------  ----  ----  ----  ----  ----  -----  -----  -----  -----  -----  -----  -----\n            1  Hl.m. Praha  Prague           1204953     0     0     0     1     1  100    12541    0.2   0.43    167  85677  99107\n            2  Benesov      central Bohemia    88884    80    26     6     2     5   46.7   8507    1.6   1.85    132   2159   2674\n            3  Beroun       central Bohemia    75232    55    26     4     1     5   41.7   8980    1.9   2.21    111   2824   2813\n...\n\n\nCREATE TABLE \"loan\" (\nloan_id bigint NOT NULL DEFAULT '0'::bigint,\naccount_id bigint NULL,\ndate date NULL,\namount bigint NULL,\nduration bigint NULL,\npayments real NULL,\nstatus text NULL,\n    PRIMARY KEY (loan_id),\n    FOREIGN KEY (account_id) REFERENCES account(account_id)\n);\n\nFirst 3 rows:\n  loan_id    account_id  date          amount    duration    payments  status\n---------  ------------  ----------  --------  ----------  ----------  --------\n     4959             2  1994-01-05     80952          24        3373  A\n     4961            19  1996-04-29     30276          12        2523  B\n     4962            25  1997-12-08     30276          12        2523  A\n...\n\n\nCREATE TABLE \"order\" (\norder_id bigint NOT NULL DEFAULT '0'::bigint,\naccount_id bigint NULL,\nbank_to text NULL,\naccount_to bigint NULL,\namount real NULL,\nk_symbol text NULL,\n    PRIMARY KEY (order_id),\n    FOREIGN KEY (account_id) REFERENCES account(account_id)\n);\n\nFirst 3 rows:\n  order_id    account_id  bank_to      account_to    amount  k_symbol\n----------  ------------  ---------  ------------  --------  ----------\n     29401             1  YZ             87144583    2452    SIPO\n     29402             2  ST             89597016    3372.7  UVER\n     29403             2  QR             13943797    7266    SIPO\n...\n\n\nCREATE TABLE \"trans\" (\ntrans_id bigint NOT NULL DEFAULT '0'::bigint,\naccount_id bigint NULL DEFAULT '0'::bigint,\ndate date NULL,\ntype text NULL,\noperation text NULL,\namount bigint NULL,\nbalance bigint NULL,\nk_symbol text NULL,\nbank text NULL,\naccount bigint NULL,\n    PRIMARY KEY (trans_id),\n    FOREIGN KEY (account_id) REFERENCES account(account_id)\n);\n\nFirst 3 rows:\n  trans_id    account_id  date        type    operation        amount    balance  k_symbol    bank          account\n----------  ------------  ----------  ------  -------------  --------  ---------  ----------  ------  -------------\n         1             1  1995-03-24  PRIJEM  VKLAD              1000       1000                      nan\n         5             1  1995-04-13  PRIJEM  PREVOD Z UCTU      3679       4679              AB        4.14033e+07\n         6             1  1995-05-13  PRIJEM  PREVOD Z UCTU      3679      20977              AB        4.14033e+07\n...\n", "preprocess_schema": "CREATE TABLE \"account\" (\naccount_id bigint NOT NULL DEFAULT '0'::bigint,\ndistrict_id bigint NULL DEFAULT '0'::bigint,\nfrequency text NULL,\ndate date NULL,\n    PRIMARY KEY (account_id),\n    FOREIGN KEY (district_id) REFERENCES district(district_id)\n);\n\nFirst 3 rows:\n  account_id    district_id  frequency         date\n------------  -------------  ----------------  ----------\n           1             18  POPLATEK MESICNE  1995-03-24\n           2              1  POPLATEK MESICNE  1993-02-26\n           3              5  POPLATEK MESICNE  1997-07-07\n...\n\n\nCREATE TABLE \"card\" (\ncard_id bigint NOT NULL DEFAULT '0'::bigint,\ndisp_id bigint NULL,\ntype text NULL,\nissued date NULL,\n    PRIMARY KEY (card_id),\n    FOREIGN KEY (disp_id) REFERENCES disp(disp_id)\n);\n\nFirst 3 rows:\n  card_id    disp_id  type     issued\n---------  ---------  -------  ----------\n        1          9  gold     1998-10-16\n        2         19  classic  1998-03-13\n        3         41  gold     1995-09-03\n...\n\n\nCREATE TABLE \"client\" (\nclient_id bigint NOT NULL,\ngender text NULL,\nbirth_date date NULL,\ndistrict_id bigint NULL,\n    PRIMARY KEY (client_id),\n    FOREIGN KEY (district_id) REFERENCES district(district_id)\n);\n\nFirst 3 rows:\n  client_id  gender    birth_date      district_id\n-----------  --------  ------------  -------------\n          1  F         1970-12-13               18\n          2  M         1945-02-04                1\n          3  F         1940-10-09                1\n...\n\n\nCREATE TABLE \"disp\" (\ndisp_id bigint NOT NULL,\nclient_id bigint NULL,\naccount_id bigint NULL,\ntype text NULL,\n    PRIMARY KEY (disp_id),\n    FOREIGN KEY (account_id) REFERENCES account(account_id),\n    FOREIGN KEY (client_id) REFERENCES client(client_id)\n);\n\nFirst 3 rows:\n  disp_id    client_id    account_id  type\n---------  -----------  ------------  ---------\n        1            1             1  OWNER\n        2            2             2  OWNER\n        3            3             2  DISPONENT\n...\n\n\nCREATE TABLE \"district\" (\ndistrict_id bigint NOT NULL DEFAULT '0'::bigint,\na2 text NULL,\na3 text NULL,\na4 text NULL,\na5 text NULL,\na6 text NULL,\na7 text NULL,\na8 bigint NULL,\na9 bigint NULL,\na10 real NULL,\na11 bigint NULL,\na12 real NULL,\na13 real NULL,\na14 bigint NULL,\na15 bigint NULL,\na16 bigint NULL,\n    PRIMARY KEY (district_id)\n);\n\nFirst 3 rows:\n  district_id  a2           a3                    a4    a5    a6    a7    a8    a9    a10    a11    a12    a13    a14    a15    a16\n-------------  -----------  ---------------  -------  ----  ----  ----  ----  ----  -----  -----  -----  -----  -----  -----  -----\n            1  Hl.m. Praha  Prague           1204953     0     0     0     1     1  100    12541    0.2   0.43    167  85677  99107\n            2  Benesov      central Bohemia    88884    80    26     6     2     5   46.7   8507    1.6   1.85    132   2159   2674\n            3  Beroun       central Bohemia    75232    55    26     4     1     5   41.7   8980    1.9   2.21    111   2824   2813\n...\n\n\nCREATE TABLE \"loan\" (\nloan_id bigint NOT NULL DEFAULT '0'::bigint,\naccount_id bigint NULL,\ndate date NULL,\namount bigint NULL,\nduration bigint NULL,\npayments real NULL,\nstatus text NULL,\n    PRIMARY KEY (loan_id),\n    FOREIGN KEY (account_id) REFERENCES account(account_id)\n);\n\nFirst 3 rows:\n  loan_id    account_id  date          amount    duration    payments  status\n---------  ------------  ----------  --------  ----------  ----------  --------\n     4959             2  1994-01-05     80952          24        3373  A\n     4961            19  1996-04-29     30276          12        2523  B\n     4962            25  1997-12-08     30276          12        2523  A\n...\n\n\nCREATE TABLE \"order\" (\norder_id bigint NOT NULL DEFAULT '0'::bigint,\naccount_id bigint NULL,\nbank_to text NULL,\naccount_to bigint NULL,\namount real NULL,\nk_symbol text NULL,\n    PRIMARY KEY (order_id),\n    FOREIGN KEY (account_id) REFERENCES account(account_id)\n);\n\nFirst 3 rows:\n  order_id    account_id  bank_to      account_to    amount  k_symbol\n----------  ------------  ---------  ------------  --------  ----------\n     29401             1  YZ             87144583    2452    SIPO\n     29402             2  ST             89597016    3372.7  UVER\n     29403             2  QR             13943797    7266    SIPO\n...\n\n\nCREATE TABLE \"trans\" (\ntrans_id bigint NOT NULL DEFAULT '0'::bigint,\naccount_id bigint NULL DEFAULT '0'::bigint,\ndate date NULL,\ntype text NULL,\noperation text NULL,\namount bigint NULL,\nbalance bigint NULL,\nk_symbol text NULL,\nbank text NULL,\naccount bigint NULL,\n    PRIMARY KEY (trans_id),\n    FOREIGN KEY (account_id) REFERENCES account(account_id)\n);\n\nFirst 3 rows:\n  trans_id    account_id  date        type    operation        amount    balance  k_symbol    bank          account\n----------  ------------  ----------  ------  -------------  --------  ---------  ----------  ------  -------------\n         1             1  1995-03-24  PRIJEM  VKLAD              1000       1000                      nan\n         5             1  1995-04-13  PRIJEM  PREVOD Z UCTU      3679       4679              AB        4.14033e+07\n         6             1  1995-05-13  PRIJEM  PREVOD Z UCTU      3679      20977              AB        4.14033e+07\n...\n", "sol_sql": ["CREATE INDEX idx_a ON trans (account_id, date DESC, trans_id);", "SELECT DISTINCT ON (t.account_id) t.trans_id, t.account_id, t.date, t.type, t.amount, t.balance FROM trans t;"], "test_cases": ["\ndef test_case(pred_sqls, sol_sqls, db_name, conn):\n    result = ex_base(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"ex_base returned {result} but expected 1.\"\n    result = performance_compare_by_qep(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"performance_check returned {result} but expected 1.\"\n    return result\n    "]}
{"instance_id": "PostgreSQL_102", "dialect": "PostgreSQL", "version": "14.12", "db_id": "california_schools", "query": "In the context of the 'california_schools' database, we need to update the 'table_A' table to deactivate certain items based on their associated records in table 'table_B'. Specifically, we want to find all items in table_A whose associated record in table_B has the 'deleted' set to 'true'. From this set of results, we need to get the 'parent_id' of these items. Then, for any item in the 'table_A' table whose 'id' is part of the 'parent_id' column from the previous result set, we need to check if their 'is_active' is 'true' and if so, make it 'false'. This operation is intended to deactivate items that are part of deleted status but the query gets stuck loading endlessly.", "issue_sql": ["UPDATE table_A A SET is_active = false FROM table_A WHERE A.parent_id IS NULL AND A.is_active = true AND A.id = ANY (SELECT (B.parent_id) FROM table_A B INNER JOIN table_B ON table_A.foreign_id = table_B.id WHERE table_B.deleted = true) RETURNING *;"], "preprocess_sql": ["create table table_B (id int primary key, deleted boolean);", "create table table_A (id serial primary key, parent_id int, is_active boolean default true, foreign_id int, foreign key (foreign_id) references table_B(id));", "insert into table_B (id, deleted) values (1, false), (2, true), (5, true), (3, false), (4, false)", "insert into table_A (parent_id, foreign_id) values (null, 1), (1, 2), (1, 5), (null, 3), (3, 4)"], "clean_up_sql": ["DROP TABLE table_A;", "DROP TABLE table_B;"], "category": "Efficiency", "original_schema": "CREATE TABLE \"frpm\" (\ncdscode text NULL,\nAcademic Year text NULL,\nCounty Code text NULL,\nDistrict Code bigint NULL,\nSchool Code text NULL,\nCounty Name text NULL,\nDistrict Name text NULL,\nSchool Name text NULL,\nDistrict Type text NULL,\nSchool Type text NULL,\nEducational Option Type text NULL,\nNSLP Provision Status text NULL,\nCharter School (Y/N) bigint NULL,\nCharter School Number text NULL,\nCharter Funding Type text NULL,\nirc bigint NULL,\nLow Grade text NULL,\nHigh Grade text NULL,\nEnrollment (K-12) real NULL,\nFree Meal Count (K-12) real NULL,\nPercent (%) Eligible Free (K-12) real NULL,\nFRPM Count (K-12) real NULL,\nPercent (%) Eligible FRPM (K-12) real NULL,\nEnrollment (Ages 5-17) real NULL,\nFree Meal Count (Ages 5-17) real NULL,\nPercent (%) Eligible Free (Ages 5-17) real NULL,\nFRPM Count (Ages 5-17) real NULL,\nPercent (%) Eligible FRPM (Ages 5-17) real NULL,\n2013-14 CALPADS Fall 1 Certification Status bigint NULL,\n    FOREIGN KEY (cdscode) REFERENCES schools(cdscode)\n);\n\nFirst 3 rows:\n       cdscode  Academic Year      County Code    District Code    School Code  County Name    District Name                       School Name                                    District Type                     School Type            Educational Option Type    NSLP Provision Status      Charter School (Y/N)    Charter School Number  Charter Funding Type      irc  Low Grade      High Grade    Enrollment (K-12)    Free Meal Count (K-12)    Percent (%) Eligible Free (K-12)    FRPM Count (K-12)    Percent (%) Eligible FRPM (K-12)    Enrollment (Ages 5-17)    Free Meal Count (Ages 5-17)    Percent (%) Eligible Free (Ages 5-17)    FRPM Count (Ages 5-17)    Percent (%) Eligible FRPM (Ages 5-17)    2013-14 CALPADS Fall 1 Certification Status\n--------------  ---------------  -------------  ---------------  -------------  -------------  ----------------------------------  ---------------------------------------------  --------------------------------  ---------------------  -------------------------  -----------------------  ----------------------  -----------------------  ----------------------  -----  -----------  ------------  -------------------  ------------------------  ----------------------------------  -------------------  ----------------------------------  ------------------------  -----------------------------  ---------------------------------------  ------------------------  ---------------------------------------  ---------------------------------------------\n01100170109835  2014-2015                   01            10017        0109835  Alameda        Alameda County Office of Education  FAME Public Charter                            County Office of Education (COE)  K-12 Schools (Public)  Traditional                                                              1                     0728  Directly funded             1  K                      12                 1087                       565                            0.519779                  715                            0.657774                      1070                            553                                 0.516822                       702                                 0.656075                                              1\n01100170112607  2014-2015                   01            10017        0112607  Alameda        Alameda County Office of Education  Envision Academy for Arts & Technology         County Office of Education (COE)  High Schools (Public)  Traditional                                                              1                     0811  Directly funded             1  9                      12                  395                       186                            0.470886                  186                            0.470886                       376                            182                                 0.484043                       182                                 0.484043                                              1\n01100170118489  2014-2015                   01            10017        0118489  Alameda        Alameda County Office of Education  Aspire California College Preparatory Academy  County Office of Education (COE)  High Schools (Public)  Traditional                                                              1                     1049  Directly funded             1  9                      12                  244                       134                            0.54918                   175                            0.717213                       230                            128                                 0.556522                       168                                 0.730435                                              1\n...\n\n\nCREATE TABLE \"satscores\" (\ncds text NOT NULL,\nrtype text NULL,\nsname text NULL,\ndname text NULL,\ncname text NULL,\nenroll12 bigint NULL,\nnumtsttakr bigint NULL,\navgscrread bigint NULL,\navgscrmath bigint NULL,\navgscrwrite bigint NULL,\nnumge1500 bigint NULL,\n    PRIMARY KEY (cds),\n    FOREIGN KEY (cds) REFERENCES schools(cdscode)\n);\n\nFirst 3 rows:\n           cds  rtype    sname                         dname                              cname      enroll12    numtsttakr    avgscrread    avgscrmath    avgscrwrite    numge1500\n--------------  -------  ----------------------------  ---------------------------------  -------  ----------  ------------  ------------  ------------  -------------  -----------\n03100330000000  D                                      Amador County Office of Education  Amador           16             0           nan           nan            nan          nan\n03739810000000  D                                      Amador County Unified              Amador          317            97           525           514            503           60\n03739810330050  S        North Star Independent Study  Amador County Unified              Amador           17             0           nan           nan            nan          nan\n...\n\n\nCREATE TABLE \"schools\" (\ncdscode text NULL,\nncesdist text NULL,\nncesschool text NULL,\nstatustype text NULL,\ncounty text NULL,\ndistrict text NULL,\nschool text NULL,\nstreet text NULL,\nstreetabr text NULL,\ncity text NULL,\nzip text NULL,\nstate text NULL,\nmailstreet text NULL,\nmailstrabr text NULL,\nmailcity text NULL,\nmailzip text NULL,\nmailstate text NULL,\nphone text NULL,\next text NULL,\nwebsite text NULL,\nopendate date NULL,\ncloseddate date NULL,\ncharter bigint NULL,\ncharternum text NULL,\nfundingtype text NULL,\ndoc text NULL,\ndoctype text NULL,\nsoc text NULL,\nsoctype text NULL,\nedopscode text NULL,\nedopsname text NULL,\neilcode text NULL,\neilname text NULL,\ngsoffered text NULL,\ngsserved text NULL,\nvirtual text NULL,\nmagnet bigint NULL,\nlatitude real NULL,\nlongitude real NULL,\nadmfname1 text NULL,\nadmlname1 text NULL,\nadmemail1 text NULL,\nadmfname2 text NULL,\nadmlname2 text NULL,\nadmemail2 text NULL,\nadmfname3 text NULL,\nadmlname3 text NULL,\nadmemail3 text NULL,\nlastupdate date NULL\n);\n\nFirst 3 rows:\n       cdscode    ncesdist    ncesschool  statustype    county    district                            school                                  street                            streetabr                      city     zip         state    mailstreet                        mailstrabr                     mailcity    mailzip     mailstate    phone           ext    website                   opendate    closeddate      charter    charternum  fundingtype        doc  doctype                             soc  soctype                edopscode    edopsname    eilcode    eilname                      gsoffered    gsserved    virtual      magnet    latitude    longitude  admfname1    admlname1    admemail1                  admfname2    admlname2    admemail2    admfname3    admlname3    admemail3    lastupdate\n--------------  ----------  ------------  ------------  --------  ----------------------------------  --------------------------------------  --------------------------------  -----------------------------  -------  ----------  -------  --------------------------------  -----------------------------  ----------  ----------  -----------  --------------  -----  ------------------------  ----------  ------------  ---------  ------------  ---------------  -----  --------------------------------  -----  ---------------------  -----------  -----------  ---------  ---------------------------  -----------  ----------  ---------  --------  ----------  -----------  -----------  -----------  -------------------------  -----------  -----------  -----------  -----------  -----------  -----------  ------------\n01100170000000     0691051                Active        Alameda   Alameda County Office of Education                                          313 West Winton Avenue            313 West Winton Ave.           Hayward  94544-1136  CA       313 West Winton Avenue            313 West Winton Ave.           Hayward     94544-1136  CA           (510) 887-0152         www.acoe.org                                              nan                                    00  County Office of Education (COE)                                                                                                                                           nan     37.6582     -122.097  L Karen      Monroe       lkmonroe@acoe.org                                                                                        2015-06-23\n01100170109835     0691051         10546  Closed        Alameda   Alameda County Office of Education  FAME Public Charter                     39899 Balentine Drive, Suite 335  39899 Balentine Dr., Ste. 335  Newark   94560-5359  CA       39899 Balentine Drive, Suite 335  39899 Balentine Dr., Ste. 335  Newark      94560-5359  CA                                                            2005-08-29  2015-07-31            1          0728  Directly funded     00  County Office of Education (COE)     65  K-12 Schools (Public)  TRAD         Traditional  ELEMHIGH   Elementary-High Combination  K-12         K-12        P                 0     37.5214     -121.994                                                                                                                                     2015-09-01\n01100170112607     0691051         10947  Active        Alameda   Alameda County Office of Education  Envision Academy for Arts & Technology  1515 Webster Street               1515 Webster St.               Oakland  94612-3355  CA       1515 Webster Street               1515 Webster St.               Oakland     94612       CA           (510) 596-8901         www.envisionacademy.org/  2006-08-28                        1          0811  Directly funded     00  County Office of Education (COE)     66  High Schools (Public)  TRAD         Traditional  HS         High School                  9-12         9-12        N                 0     37.8045     -122.268  Laura        Robell       laura@envisionacademy.org                                                                                2015-06-18\n...\n", "preprocess_schema": "CREATE TABLE \"frpm\" (\ncdscode text NULL,\nAcademic Year text NULL,\nCounty Code text NULL,\nDistrict Code bigint NULL,\nSchool Code text NULL,\nCounty Name text NULL,\nDistrict Name text NULL,\nSchool Name text NULL,\nDistrict Type text NULL,\nSchool Type text NULL,\nEducational Option Type text NULL,\nNSLP Provision Status text NULL,\nCharter School (Y/N) bigint NULL,\nCharter School Number text NULL,\nCharter Funding Type text NULL,\nirc bigint NULL,\nLow Grade text NULL,\nHigh Grade text NULL,\nEnrollment (K-12) real NULL,\nFree Meal Count (K-12) real NULL,\nPercent (%) Eligible Free (K-12) real NULL,\nFRPM Count (K-12) real NULL,\nPercent (%) Eligible FRPM (K-12) real NULL,\nEnrollment (Ages 5-17) real NULL,\nFree Meal Count (Ages 5-17) real NULL,\nPercent (%) Eligible Free (Ages 5-17) real NULL,\nFRPM Count (Ages 5-17) real NULL,\nPercent (%) Eligible FRPM (Ages 5-17) real NULL,\n2013-14 CALPADS Fall 1 Certification Status bigint NULL,\n    FOREIGN KEY (cdscode) REFERENCES schools(cdscode)\n);\n\nFirst 3 rows:\n       cdscode  Academic Year      County Code    District Code    School Code  County Name    District Name                       School Name                                    District Type                     School Type            Educational Option Type    NSLP Provision Status      Charter School (Y/N)    Charter School Number  Charter Funding Type      irc  Low Grade      High Grade    Enrollment (K-12)    Free Meal Count (K-12)    Percent (%) Eligible Free (K-12)    FRPM Count (K-12)    Percent (%) Eligible FRPM (K-12)    Enrollment (Ages 5-17)    Free Meal Count (Ages 5-17)    Percent (%) Eligible Free (Ages 5-17)    FRPM Count (Ages 5-17)    Percent (%) Eligible FRPM (Ages 5-17)    2013-14 CALPADS Fall 1 Certification Status\n--------------  ---------------  -------------  ---------------  -------------  -------------  ----------------------------------  ---------------------------------------------  --------------------------------  ---------------------  -------------------------  -----------------------  ----------------------  -----------------------  ----------------------  -----  -----------  ------------  -------------------  ------------------------  ----------------------------------  -------------------  ----------------------------------  ------------------------  -----------------------------  ---------------------------------------  ------------------------  ---------------------------------------  ---------------------------------------------\n01100170109835  2014-2015                   01            10017        0109835  Alameda        Alameda County Office of Education  FAME Public Charter                            County Office of Education (COE)  K-12 Schools (Public)  Traditional                                                              1                     0728  Directly funded             1  K                      12                 1087                       565                            0.519779                  715                            0.657774                      1070                            553                                 0.516822                       702                                 0.656075                                              1\n01100170112607  2014-2015                   01            10017        0112607  Alameda        Alameda County Office of Education  Envision Academy for Arts & Technology         County Office of Education (COE)  High Schools (Public)  Traditional                                                              1                     0811  Directly funded             1  9                      12                  395                       186                            0.470886                  186                            0.470886                       376                            182                                 0.484043                       182                                 0.484043                                              1\n01100170118489  2014-2015                   01            10017        0118489  Alameda        Alameda County Office of Education  Aspire California College Preparatory Academy  County Office of Education (COE)  High Schools (Public)  Traditional                                                              1                     1049  Directly funded             1  9                      12                  244                       134                            0.54918                   175                            0.717213                       230                            128                                 0.556522                       168                                 0.730435                                              1\n...\n\n\nCREATE TABLE \"satscores\" (\ncds text NOT NULL,\nrtype text NULL,\nsname text NULL,\ndname text NULL,\ncname text NULL,\nenroll12 bigint NULL,\nnumtsttakr bigint NULL,\navgscrread bigint NULL,\navgscrmath bigint NULL,\navgscrwrite bigint NULL,\nnumge1500 bigint NULL,\n    PRIMARY KEY (cds),\n    FOREIGN KEY (cds) REFERENCES schools(cdscode)\n);\n\nFirst 3 rows:\n           cds  rtype    sname                         dname                              cname      enroll12    numtsttakr    avgscrread    avgscrmath    avgscrwrite    numge1500\n--------------  -------  ----------------------------  ---------------------------------  -------  ----------  ------------  ------------  ------------  -------------  -----------\n03100330000000  D                                      Amador County Office of Education  Amador           16             0           nan           nan            nan          nan\n03739810000000  D                                      Amador County Unified              Amador          317            97           525           514            503           60\n03739810330050  S        North Star Independent Study  Amador County Unified              Amador           17             0           nan           nan            nan          nan\n...\n\n\nCREATE TABLE \"schools\" (\ncdscode text NULL,\nncesdist text NULL,\nncesschool text NULL,\nstatustype text NULL,\ncounty text NULL,\ndistrict text NULL,\nschool text NULL,\nstreet text NULL,\nstreetabr text NULL,\ncity text NULL,\nzip text NULL,\nstate text NULL,\nmailstreet text NULL,\nmailstrabr text NULL,\nmailcity text NULL,\nmailzip text NULL,\nmailstate text NULL,\nphone text NULL,\next text NULL,\nwebsite text NULL,\nopendate date NULL,\ncloseddate date NULL,\ncharter bigint NULL,\ncharternum text NULL,\nfundingtype text NULL,\ndoc text NULL,\ndoctype text NULL,\nsoc text NULL,\nsoctype text NULL,\nedopscode text NULL,\nedopsname text NULL,\neilcode text NULL,\neilname text NULL,\ngsoffered text NULL,\ngsserved text NULL,\nvirtual text NULL,\nmagnet bigint NULL,\nlatitude real NULL,\nlongitude real NULL,\nadmfname1 text NULL,\nadmlname1 text NULL,\nadmemail1 text NULL,\nadmfname2 text NULL,\nadmlname2 text NULL,\nadmemail2 text NULL,\nadmfname3 text NULL,\nadmlname3 text NULL,\nadmemail3 text NULL,\nlastupdate date NULL\n);\n\nFirst 3 rows:\n       cdscode    ncesdist    ncesschool  statustype    county    district                            school                                  street                            streetabr                      city     zip         state    mailstreet                        mailstrabr                     mailcity    mailzip     mailstate    phone           ext    website                   opendate    closeddate      charter    charternum  fundingtype        doc  doctype                             soc  soctype                edopscode    edopsname    eilcode    eilname                      gsoffered    gsserved    virtual      magnet    latitude    longitude  admfname1    admlname1    admemail1                  admfname2    admlname2    admemail2    admfname3    admlname3    admemail3    lastupdate\n--------------  ----------  ------------  ------------  --------  ----------------------------------  --------------------------------------  --------------------------------  -----------------------------  -------  ----------  -------  --------------------------------  -----------------------------  ----------  ----------  -----------  --------------  -----  ------------------------  ----------  ------------  ---------  ------------  ---------------  -----  --------------------------------  -----  ---------------------  -----------  -----------  ---------  ---------------------------  -----------  ----------  ---------  --------  ----------  -----------  -----------  -----------  -------------------------  -----------  -----------  -----------  -----------  -----------  -----------  ------------\n01100170000000     0691051                Active        Alameda   Alameda County Office of Education                                          313 West Winton Avenue            313 West Winton Ave.           Hayward  94544-1136  CA       313 West Winton Avenue            313 West Winton Ave.           Hayward     94544-1136  CA           (510) 887-0152         www.acoe.org                                              nan                                    00  County Office of Education (COE)                                                                                                                                           nan     37.6582     -122.097  L Karen      Monroe       lkmonroe@acoe.org                                                                                        2015-06-23\n01100170109835     0691051         10546  Closed        Alameda   Alameda County Office of Education  FAME Public Charter                     39899 Balentine Drive, Suite 335  39899 Balentine Dr., Ste. 335  Newark   94560-5359  CA       39899 Balentine Drive, Suite 335  39899 Balentine Dr., Ste. 335  Newark      94560-5359  CA                                                            2005-08-29  2015-07-31            1          0728  Directly funded     00  County Office of Education (COE)     65  K-12 Schools (Public)  TRAD         Traditional  ELEMHIGH   Elementary-High Combination  K-12         K-12        P                 0     37.5214     -121.994                                                                                                                                     2015-09-01\n01100170112607     0691051         10947  Active        Alameda   Alameda County Office of Education  Envision Academy for Arts & Technology  1515 Webster Street               1515 Webster St.               Oakland  94612-3355  CA       1515 Webster Street               1515 Webster St.               Oakland     94612       CA           (510) 596-8901         www.envisionacademy.org/  2006-08-28                        1          0811  Directly funded     00  County Office of Education (COE)     66  High Schools (Public)  TRAD         Traditional  HS         High School                  9-12         9-12        N                 0     37.8045     -122.268  Laura        Robell       laura@envisionacademy.org                                                                                2015-06-18\n...\n\n\nCREATE TABLE \"table_a\" (\nid integer NOT NULL DEFAULT nextval('table_a_id_seq'::regclass),\nparent_id integer NULL,\nis_active boolean NULL DEFAULT true,\nforeign_id integer NULL,\n    PRIMARY KEY (id),\n    FOREIGN KEY (foreign_id) REFERENCES table_b(id)\n);\n\nFirst 3 rows:\n  id    parent_id  is_active      foreign_id\n----  -----------  -----------  ------------\n   1          nan  True                    1\n   2            1  True                    2\n   3            1  True                    5\n...\n\n\nCREATE TABLE \"table_b\" (\nid integer NOT NULL,\ndeleted boolean NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  deleted\n----  ---------\n   1  False\n   2  True\n   5  True\n...\n", "sol_sql": ["UPDATE table_A SET is_active = false WHERE parent_id IS NULL AND is_active = true AND id = ANY (SELECT a2.parent_id FROM table_A a2 JOIN table_B b ON a2.foreign_id = b.id WHERE b.deleted = true) RETURNING *"], "test_cases": ["\ndef test_case(pred_sqls, sol_sqls, db_name, conn):\n    pred_sqls_result = execute_queries(pred_sqls, db_name, conn)[0]\n    sol_sqls_result = execute_queries(sol_sqls, db_name, conn)[0]\n    assert pred_sqls_result == sol_sqls_result, f\"Expected pred_result and sol_result are the same but pred_result is {pred_sqls_result} and sol_result is {sol_sqls_result}.\"\n    result = performance_compare_by_qep(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"performance_check returned {result} but expected 1.\"\n    return result\n"]}
{"instance_id": "PostgreSQL_106", "dialect": "PostgreSQL", "version": "14.12", "db_id": "financial", "query": "I am trying to speed up a PostgreSQL query to find previous transactions on the same day of the year from the 'trans' table. My current query is as follows:\\nsql \\nselect * from trans \\nwhere date_part('month', date) = date_part('month', now()) \\nand date_part('day', date) = date_part('day', now()) \\norder by date desc; \\n\\nThis query works but is running much slower than desired. Is there a better approach for comparing the current month and day?\\nThe data is time-series in nature, and I am using PostgreSQL as the database.", "issue_sql": ["select * from trans where date_part('month', \"date\") = date_part('month', now()) and date_part('day', \"date\") = date_part('day', now()) order by \"date\" desc;"], "preprocess_sql": ["CREATE INDEX ix1 ON trans (EXTRACT(MONTH FROM date), EXTRACT(DAY FROM date));"], "clean_up_sql": ["drop index if exists ix1;"], "category": "Efficiency", "original_schema": "CREATE TABLE \"account\" (\naccount_id bigint NOT NULL DEFAULT '0'::bigint,\ndistrict_id bigint NULL DEFAULT '0'::bigint,\nfrequency text NULL,\ndate date NULL,\n    PRIMARY KEY (account_id),\n    FOREIGN KEY (district_id) REFERENCES district(district_id)\n);\n\nFirst 3 rows:\n  account_id    district_id  frequency         date\n------------  -------------  ----------------  ----------\n           1             18  POPLATEK MESICNE  1995-03-24\n           2              1  POPLATEK MESICNE  1993-02-26\n           3              5  POPLATEK MESICNE  1997-07-07\n...\n\n\nCREATE TABLE \"card\" (\ncard_id bigint NOT NULL DEFAULT '0'::bigint,\ndisp_id bigint NULL,\ntype text NULL,\nissued date NULL,\n    PRIMARY KEY (card_id),\n    FOREIGN KEY (disp_id) REFERENCES disp(disp_id)\n);\n\nFirst 3 rows:\n  card_id    disp_id  type     issued\n---------  ---------  -------  ----------\n        1          9  gold     1998-10-16\n        2         19  classic  1998-03-13\n        3         41  gold     1995-09-03\n...\n\n\nCREATE TABLE \"client\" (\nclient_id bigint NOT NULL,\ngender text NULL,\nbirth_date date NULL,\ndistrict_id bigint NULL,\n    PRIMARY KEY (client_id),\n    FOREIGN KEY (district_id) REFERENCES district(district_id)\n);\n\nFirst 3 rows:\n  client_id  gender    birth_date      district_id\n-----------  --------  ------------  -------------\n          1  F         1970-12-13               18\n          2  M         1945-02-04                1\n          3  F         1940-10-09                1\n...\n\n\nCREATE TABLE \"disp\" (\ndisp_id bigint NOT NULL,\nclient_id bigint NULL,\naccount_id bigint NULL,\ntype text NULL,\n    PRIMARY KEY (disp_id),\n    FOREIGN KEY (account_id) REFERENCES account(account_id),\n    FOREIGN KEY (client_id) REFERENCES client(client_id)\n);\n\nFirst 3 rows:\n  disp_id    client_id    account_id  type\n---------  -----------  ------------  ---------\n        1            1             1  OWNER\n        2            2             2  OWNER\n        3            3             2  DISPONENT\n...\n\n\nCREATE TABLE \"district\" (\ndistrict_id bigint NOT NULL DEFAULT '0'::bigint,\na2 text NULL,\na3 text NULL,\na4 text NULL,\na5 text NULL,\na6 text NULL,\na7 text NULL,\na8 bigint NULL,\na9 bigint NULL,\na10 real NULL,\na11 bigint NULL,\na12 real NULL,\na13 real NULL,\na14 bigint NULL,\na15 bigint NULL,\na16 bigint NULL,\n    PRIMARY KEY (district_id)\n);\n\nFirst 3 rows:\n  district_id  a2           a3                    a4    a5    a6    a7    a8    a9    a10    a11    a12    a13    a14    a15    a16\n-------------  -----------  ---------------  -------  ----  ----  ----  ----  ----  -----  -----  -----  -----  -----  -----  -----\n            1  Hl.m. Praha  Prague           1204953     0     0     0     1     1  100    12541    0.2   0.43    167  85677  99107\n            2  Benesov      central Bohemia    88884    80    26     6     2     5   46.7   8507    1.6   1.85    132   2159   2674\n            3  Beroun       central Bohemia    75232    55    26     4     1     5   41.7   8980    1.9   2.21    111   2824   2813\n...\n\n\nCREATE TABLE \"loan\" (\nloan_id bigint NOT NULL DEFAULT '0'::bigint,\naccount_id bigint NULL,\ndate date NULL,\namount bigint NULL,\nduration bigint NULL,\npayments real NULL,\nstatus text NULL,\n    PRIMARY KEY (loan_id),\n    FOREIGN KEY (account_id) REFERENCES account(account_id)\n);\n\nFirst 3 rows:\n  loan_id    account_id  date          amount    duration    payments  status\n---------  ------------  ----------  --------  ----------  ----------  --------\n     4959             2  1994-01-05     80952          24        3373  A\n     4961            19  1996-04-29     30276          12        2523  B\n     4962            25  1997-12-08     30276          12        2523  A\n...\n\n\nCREATE TABLE \"order\" (\norder_id bigint NOT NULL DEFAULT '0'::bigint,\naccount_id bigint NULL,\nbank_to text NULL,\naccount_to bigint NULL,\namount real NULL,\nk_symbol text NULL,\n    PRIMARY KEY (order_id),\n    FOREIGN KEY (account_id) REFERENCES account(account_id)\n);\n\nFirst 3 rows:\n  order_id    account_id  bank_to      account_to    amount  k_symbol\n----------  ------------  ---------  ------------  --------  ----------\n     29401             1  YZ             87144583    2452    SIPO\n     29402             2  ST             89597016    3372.7  UVER\n     29403             2  QR             13943797    7266    SIPO\n...\n\n\nCREATE TABLE \"trans\" (\ntrans_id bigint NOT NULL DEFAULT '0'::bigint,\naccount_id bigint NULL DEFAULT '0'::bigint,\ndate date NULL,\ntype text NULL,\noperation text NULL,\namount bigint NULL,\nbalance bigint NULL,\nk_symbol text NULL,\nbank text NULL,\naccount bigint NULL,\n    PRIMARY KEY (trans_id),\n    FOREIGN KEY (account_id) REFERENCES account(account_id)\n);\n\nFirst 3 rows:\n  trans_id    account_id  date        type    operation        amount    balance  k_symbol    bank          account\n----------  ------------  ----------  ------  -------------  --------  ---------  ----------  ------  -------------\n         1             1  1995-03-24  PRIJEM  VKLAD              1000       1000                      nan\n         5             1  1995-04-13  PRIJEM  PREVOD Z UCTU      3679       4679              AB        4.14033e+07\n         6             1  1995-05-13  PRIJEM  PREVOD Z UCTU      3679      20977              AB        4.14033e+07\n...\n", "preprocess_schema": "CREATE TABLE \"account\" (\naccount_id bigint NOT NULL DEFAULT '0'::bigint,\ndistrict_id bigint NULL DEFAULT '0'::bigint,\nfrequency text NULL,\ndate date NULL,\n    PRIMARY KEY (account_id),\n    FOREIGN KEY (district_id) REFERENCES district(district_id)\n);\n\nFirst 3 rows:\n  account_id    district_id  frequency         date\n------------  -------------  ----------------  ----------\n           1             18  POPLATEK MESICNE  1995-03-24\n           2              1  POPLATEK MESICNE  1993-02-26\n           3              5  POPLATEK MESICNE  1997-07-07\n...\n\n\nCREATE TABLE \"card\" (\ncard_id bigint NOT NULL DEFAULT '0'::bigint,\ndisp_id bigint NULL,\ntype text NULL,\nissued date NULL,\n    PRIMARY KEY (card_id),\n    FOREIGN KEY (disp_id) REFERENCES disp(disp_id)\n);\n\nFirst 3 rows:\n  card_id    disp_id  type     issued\n---------  ---------  -------  ----------\n        1          9  gold     1998-10-16\n        2         19  classic  1998-03-13\n        3         41  gold     1995-09-03\n...\n\n\nCREATE TABLE \"client\" (\nclient_id bigint NOT NULL,\ngender text NULL,\nbirth_date date NULL,\ndistrict_id bigint NULL,\n    PRIMARY KEY (client_id),\n    FOREIGN KEY (district_id) REFERENCES district(district_id)\n);\n\nFirst 3 rows:\n  client_id  gender    birth_date      district_id\n-----------  --------  ------------  -------------\n          1  F         1970-12-13               18\n          2  M         1945-02-04                1\n          3  F         1940-10-09                1\n...\n\n\nCREATE TABLE \"disp\" (\ndisp_id bigint NOT NULL,\nclient_id bigint NULL,\naccount_id bigint NULL,\ntype text NULL,\n    PRIMARY KEY (disp_id),\n    FOREIGN KEY (account_id) REFERENCES account(account_id),\n    FOREIGN KEY (client_id) REFERENCES client(client_id)\n);\n\nFirst 3 rows:\n  disp_id    client_id    account_id  type\n---------  -----------  ------------  ---------\n        1            1             1  OWNER\n        2            2             2  OWNER\n        3            3             2  DISPONENT\n...\n\n\nCREATE TABLE \"district\" (\ndistrict_id bigint NOT NULL DEFAULT '0'::bigint,\na2 text NULL,\na3 text NULL,\na4 text NULL,\na5 text NULL,\na6 text NULL,\na7 text NULL,\na8 bigint NULL,\na9 bigint NULL,\na10 real NULL,\na11 bigint NULL,\na12 real NULL,\na13 real NULL,\na14 bigint NULL,\na15 bigint NULL,\na16 bigint NULL,\n    PRIMARY KEY (district_id)\n);\n\nFirst 3 rows:\n  district_id  a2           a3                    a4    a5    a6    a7    a8    a9    a10    a11    a12    a13    a14    a15    a16\n-------------  -----------  ---------------  -------  ----  ----  ----  ----  ----  -----  -----  -----  -----  -----  -----  -----\n            1  Hl.m. Praha  Prague           1204953     0     0     0     1     1  100    12541    0.2   0.43    167  85677  99107\n            2  Benesov      central Bohemia    88884    80    26     6     2     5   46.7   8507    1.6   1.85    132   2159   2674\n            3  Beroun       central Bohemia    75232    55    26     4     1     5   41.7   8980    1.9   2.21    111   2824   2813\n...\n\n\nCREATE TABLE \"loan\" (\nloan_id bigint NOT NULL DEFAULT '0'::bigint,\naccount_id bigint NULL,\ndate date NULL,\namount bigint NULL,\nduration bigint NULL,\npayments real NULL,\nstatus text NULL,\n    PRIMARY KEY (loan_id),\n    FOREIGN KEY (account_id) REFERENCES account(account_id)\n);\n\nFirst 3 rows:\n  loan_id    account_id  date          amount    duration    payments  status\n---------  ------------  ----------  --------  ----------  ----------  --------\n     4959             2  1994-01-05     80952          24        3373  A\n     4961            19  1996-04-29     30276          12        2523  B\n     4962            25  1997-12-08     30276          12        2523  A\n...\n\n\nCREATE TABLE \"order\" (\norder_id bigint NOT NULL DEFAULT '0'::bigint,\naccount_id bigint NULL,\nbank_to text NULL,\naccount_to bigint NULL,\namount real NULL,\nk_symbol text NULL,\n    PRIMARY KEY (order_id),\n    FOREIGN KEY (account_id) REFERENCES account(account_id)\n);\n\nFirst 3 rows:\n  order_id    account_id  bank_to      account_to    amount  k_symbol\n----------  ------------  ---------  ------------  --------  ----------\n     29401             1  YZ             87144583    2452    SIPO\n     29402             2  ST             89597016    3372.7  UVER\n     29403             2  QR             13943797    7266    SIPO\n...\n\n\nCREATE TABLE \"trans\" (\ntrans_id bigint NOT NULL DEFAULT '0'::bigint,\naccount_id bigint NULL DEFAULT '0'::bigint,\ndate date NULL,\ntype text NULL,\noperation text NULL,\namount bigint NULL,\nbalance bigint NULL,\nk_symbol text NULL,\nbank text NULL,\naccount bigint NULL,\n    PRIMARY KEY (trans_id),\n    FOREIGN KEY (account_id) REFERENCES account(account_id)\n);\n\nFirst 3 rows:\n  trans_id    account_id  date        type    operation        amount    balance  k_symbol    bank          account\n----------  ------------  ----------  ------  -------------  --------  ---------  ----------  ------  -------------\n         1             1  1995-03-24  PRIJEM  VKLAD              1000       1000                      nan\n         5             1  1995-04-13  PRIJEM  PREVOD Z UCTU      3679       4679              AB        4.14033e+07\n         6             1  1995-05-13  PRIJEM  PREVOD Z UCTU      3679      20977              AB        4.14033e+07\n...\n", "sol_sql": ["SELECT * FROM trans WHERE EXTRACT(MONTH FROM date) = EXTRACT(MONTH FROM CURRENT_DATE) AND EXTRACT(DAY FROM date) = EXTRACT(DAY FROM CURRENT_DATE) ORDER BY date DESC;"], "test_cases": ["\ndef test_case(pred_sqls, sol_sqls, db_name, conn):\n    result = ex_base(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"ex_base returned {result} but expected 1.\"\n    result = performance_compare_by_qep(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"performance_check returned {result} but expected 1.\"\n    return result\n    "]}
{"instance_id": "PostgreSQL_117", "dialect": "PostgreSQL", "version": "14.12", "db_id": "formula_1", "query": "\nIn the context of Formula 1 racing data, I have two tables: `drivers` and `results`. The `drivers` table contains information about each driver, including their unique `driverId` and `driverRef`. The `results` table records the outcomes of races, including the `driverId` of the participant, their `position` in the race, and the `points` they scored. I want to filter `drivers` by their `position` and `points` in the `results` table. Typically, I filter between 2-5 `position` and `points` values. There are approximately 6-10 `results` entries per driver. Given the large size of the database, I aim to optimize this query for performance, possibly by eliminating the `HAVING` clause. Here's the query I'm currently using:```sql\nSELECT \n    drivers.forename, \n    drivers.surname, \n    jsonb_agg(jsonb_strip_nulls(jsonb_build_object('laps', results.laps, 'position', results.position))) AS race_results\nFROM \n    drivers\nJOIN \n    results\nON \n    drivers.driverid = results.driverid\nGROUP BY \n    drivers.forename, \n    drivers.surname\nHAVING \n    jsonb_agg(jsonb_build_object('laps', results.laps, 'position', results.position)) @? '$[*] ? (@.laps == 56) ? (@.position == 1)';\n```", "issue_sql": ["SELECT\n    drivers.forename,\n    drivers.surname,\n    jsonb_agg(jsonb_strip_nulls(jsonb_build_object('laps', results.laps, 'position', results.position))) AS race_results\nFROM\n    drivers\nJOIN\n    results\nON\n    drivers.driverid = results.driverid\nGROUP BY\n    drivers.forename,\n    drivers.surname\nHAVING\n    jsonb_agg(jsonb_build_object('laps', results.laps, 'position', results.position)) @? '$[*] ? (@.laps == 56) ? (@.position == 1)';"], "preprocess_sql": [], "clean_up_sql": [], "category": "Efficiency", "original_schema": "CREATE TABLE \"circuits\" (\ncircuitid bigint NOT NULL DEFAULT nextval('circuits_circuitid_seq'::regclass),\ncircuitref text NULL DEFAULT ''::text,\nname text NULL DEFAULT ''::text,\nlocation text NULL,\ncountry text NULL,\nlat real NULL,\nlng real NULL,\nalt bigint NULL,\nurl text NULL DEFAULT ''::text,\n    PRIMARY KEY (circuitid)\n);\n\nFirst 3 rows:\n  circuitid  circuitref    name                            location      country         lat        lng  alt    url\n-----------  ------------  ------------------------------  ------------  ---------  --------  ---------  -----  -----------------------------------------------------------\n          2  sepang        Sepang International Circuit    Kuala Lumpur  Malaysia    2.76083  101.738           http://en.wikipedia.org/wiki/Sepang_International_Circuit\n          3  bahrain       Bahrain International Circuit   Sakhir        Bahrain    26.0325    50.5106          http://en.wikipedia.org/wiki/Bahrain_International_Circuit\n          4  catalunya     Circuit de Barcelona-Catalunya  Montmeló      Spain      41.57       2.26111         http://en.wikipedia.org/wiki/Circuit_de_Barcelona-Catalunya\n...\n\n\nCREATE TABLE \"constructorresults\" (\nconstructorresultsid bigint NOT NULL DEFAULT nextval('constructorresults_constructorresultsid_seq'::regclass),\nraceid bigint NULL DEFAULT '0'::bigint,\nconstructorid bigint NULL DEFAULT '0'::bigint,\npoints real NULL,\nstatus text NULL,\n    PRIMARY KEY (constructorresultsid),\n    FOREIGN KEY (constructorid) REFERENCES constructors(constructorid)\n);\n\nFirst 3 rows:\n  constructorresultsid    raceid    constructorid    points  status\n----------------------  --------  ---------------  --------  --------\n                     1        18                1        14\n                     2        18                2         8\n                     3        18                3         9\n...\n\n\nCREATE TABLE \"constructors\" (\nconstructorid bigint NOT NULL DEFAULT nextval('constructors_constructorid_seq'::regclass),\nconstructorref text NULL DEFAULT ''::text,\nname text NULL DEFAULT ''::text,\nnationality text NULL,\nurl text NULL DEFAULT ''::text,\n    PRIMARY KEY (constructorid)\n);\n\nFirst 3 rows:\n  constructorid  constructorref    name        nationality    url\n---------------  ----------------  ----------  -------------  ------------------------------------------------------------\n              1  mclaren           McLaren     British        http://en.wikipedia.org/wiki/McLaren\n              2  bmw_sauber        BMW Sauber  German         http://en.wikipedia.org/wiki/BMW_Sauber\n              3  williams          Williams    British        http://en.wikipedia.org/wiki/Williams_Grand_Prix_Engineering\n...\n\n\nCREATE TABLE \"constructorstandings\" (\nconstructorstandingsid bigint NOT NULL DEFAULT nextval('constructorstandings_constructorstandingsid_seq'::regclass),\nraceid bigint NULL DEFAULT '0'::bigint,\nconstructorid bigint NULL DEFAULT '0'::bigint,\npoints real NULL DEFAULT '0'::real,\nposition bigint NULL,\npositiontext text NULL,\nwins bigint NULL DEFAULT '0'::bigint,\n    PRIMARY KEY (constructorstandingsid),\n    FOREIGN KEY (constructorid) REFERENCES constructors(constructorid)\n);\n\nFirst 3 rows:\n  constructorstandingsid    raceid    constructorid    points    position    positiontext    wins\n------------------------  --------  ---------------  --------  ----------  --------------  ------\n                       1        18                1        14           1               1       1\n                       2        18                2         8           3               3       0\n                       3        18                3         9           2               2       0\n...\n\n\nCREATE TABLE \"drivers\" (\ndriverid bigint NOT NULL DEFAULT nextval('drivers_driverid_seq'::regclass),\ndriverref text NULL DEFAULT ''::text,\nnumber bigint NULL,\ncode text NULL,\nforename text NULL DEFAULT ''::text,\nsurname text NULL DEFAULT ''::text,\ndob date NULL,\nnationality text NULL,\nurl text NULL DEFAULT ''::text,\n    PRIMARY KEY (driverid)\n);\n\nFirst 3 rows:\n  driverid  driverref      number  code    forename    surname    dob         nationality    url\n----------  -----------  --------  ------  ----------  ---------  ----------  -------------  -------------------------------------------\n         1  hamilton           44  HAM     Lewis       Hamilton   1985-01-07  British        http://en.wikipedia.org/wiki/Lewis_Hamilton\n         2  heidfeld          nan  HEI     Nick        Heidfeld   1977-05-10  German         http://en.wikipedia.org/wiki/Nick_Heidfeld\n         3  rosberg             6  ROS     Nico        Rosberg    1985-06-27  German         http://en.wikipedia.org/wiki/Nico_Rosberg\n...\n\n\nCREATE TABLE \"driverstandings\" (\ndriverstandingsid bigint NOT NULL DEFAULT nextval('driverstandings_driverstandingsid_seq'::regclass),\nraceid bigint NULL DEFAULT '0'::bigint,\ndriverid bigint NULL DEFAULT '0'::bigint,\npoints real NULL DEFAULT '0'::real,\nposition bigint NULL,\npositiontext text NULL,\nwins bigint NULL DEFAULT '0'::bigint,\n    PRIMARY KEY (driverstandingsid),\n    FOREIGN KEY (driverid) REFERENCES drivers(driverid)\n);\n\nFirst 3 rows:\n  driverstandingsid    raceid    driverid    points    position    positiontext    wins\n-------------------  --------  ----------  --------  ----------  --------------  ------\n                  1        18           1        10           1               1       1\n                  2        18           2         8           2               2       0\n                  3        18           3         6           3               3       0\n...\n\n\nCREATE TABLE \"laptimes\" (\nraceid bigint NOT NULL,\ndriverid bigint NOT NULL,\nlap bigint NOT NULL,\nposition bigint NULL,\ntime text NULL,\nmilliseconds bigint NULL,\n    PRIMARY KEY (raceid, driverid, lap),\n    FOREIGN KEY (driverid) REFERENCES drivers(driverid),\n    FOREIGN KEY (raceid) REFERENCES races(raceid)\n);\n\nFirst 3 rows:\n  raceid    driverid    lap    position  time        milliseconds\n--------  ----------  -----  ----------  --------  --------------\n       2           1      1          10  1:52.965          112965\n       2           1      2          10  1:41.865          101865\n       2           1      3          10  1:40.869          100869\n...\n\n\nCREATE TABLE \"pitstops\" (\nraceid bigint NOT NULL,\ndriverid bigint NOT NULL,\nstop bigint NOT NULL,\nlap bigint NULL,\ntime text NULL,\nduration text NULL,\nmilliseconds bigint NULL,\n    PRIMARY KEY (raceid, driverid, stop),\n    FOREIGN KEY (driverid) REFERENCES drivers(driverid),\n    FOREIGN KEY (raceid) REFERENCES races(raceid)\n);\n\nFirst 3 rows:\n  raceid    driverid    stop    lap  time        duration    milliseconds\n--------  ----------  ------  -----  --------  ----------  --------------\n     842           1       1     12  16:24:40      22.552           22552\n     842           1       2     24  16:45:48      22.611           22611\n     842           1       3     37  17:08:28      25.382           25382\n...\n\n\nCREATE TABLE \"qualifying\" (\nqualifyid bigint NOT NULL DEFAULT nextval('qualifying_qualifyid_seq'::regclass),\nraceid bigint NULL DEFAULT '0'::bigint,\ndriverid bigint NULL DEFAULT '0'::bigint,\nconstructorid bigint NULL DEFAULT '0'::bigint,\nnumber bigint NULL DEFAULT '0'::bigint,\nposition bigint NULL,\nq1 text NULL,\nq2 text NULL,\nq3 text NULL,\n    PRIMARY KEY (qualifyid),\n    FOREIGN KEY (constructorid) REFERENCES constructors(constructorid),\n    FOREIGN KEY (driverid) REFERENCES drivers(driverid),\n    FOREIGN KEY (raceid) REFERENCES races(raceid)\n);\n\nFirst 3 rows:\n  qualifyid    raceid    driverid    constructorid    number    position  q1        q2        q3\n-----------  --------  ----------  ---------------  --------  ----------  --------  --------  --------\n         23        19          13                6         2           1  1:35.347  1:34.412  1:35.748\n         24        19           8                6         1           2  1:35.645  1:34.188  1:36.230\n         25        19           5                1        23           3  1:35.227  1:34.759  1:36.613\n...\n\n\nCREATE TABLE \"races\" (\nraceid bigint NOT NULL DEFAULT nextval('races_raceid_seq'::regclass),\nyear bigint NULL DEFAULT '0'::bigint,\nround bigint NULL DEFAULT '0'::bigint,\ncircuitid bigint NULL DEFAULT '0'::bigint,\nname text NULL DEFAULT ''::text,\ndate date NULL,\ntime text NULL,\nurl text NULL,\n    PRIMARY KEY (raceid),\n    FOREIGN KEY (circuitid) REFERENCES circuits(circuitid),\n    FOREIGN KEY (year) REFERENCES seasons(year)\n);\n\nFirst 3 rows:\n  raceid    year    round    circuitid  name                  date        time      url\n--------  ------  -------  -----------  --------------------  ----------  --------  ------------------------------------------------------\n       2    2009        2            2  Malaysian Grand Prix  2009-04-05  09:00:00  http://en.wikipedia.org/wiki/2009_Malaysian_Grand_Prix\n       3    2009        3           17  Chinese Grand Prix    2009-04-19  07:00:00  http://en.wikipedia.org/wiki/2009_Chinese_Grand_Prix\n       4    2009        4            3  Bahrain Grand Prix    2009-04-26  12:00:00  http://en.wikipedia.org/wiki/2009_Bahrain_Grand_Prix\n...\n\n\nCREATE TABLE \"results\" (\nresultid bigint NOT NULL DEFAULT nextval('results_resultid_seq'::regclass),\nraceid bigint NULL DEFAULT '0'::bigint,\ndriverid bigint NULL DEFAULT '0'::bigint,\nconstructorid bigint NULL DEFAULT '0'::bigint,\nnumber bigint NULL,\ngrid bigint NULL DEFAULT '0'::bigint,\nposition bigint NULL,\npositiontext text NULL DEFAULT ''::text,\npositionorder bigint NULL DEFAULT '0'::bigint,\npoints real NULL DEFAULT '0'::real,\nlaps bigint NULL DEFAULT '0'::bigint,\ntime text NULL,\nmilliseconds bigint NULL,\nfastestlap bigint NULL,\nrank bigint NULL DEFAULT '0'::bigint,\nfastestlaptime text NULL,\nfastestlapspeed text NULL,\nstatusid bigint NULL DEFAULT '0'::bigint,\n    PRIMARY KEY (resultid),\n    FOREIGN KEY (constructorid) REFERENCES constructors(constructorid),\n    FOREIGN KEY (driverid) REFERENCES drivers(driverid),\n    FOREIGN KEY (raceid) REFERENCES races(raceid),\n    FOREIGN KEY (statusid) REFERENCES status(statusid)\n);\n\nFirst 3 rows:\n  resultid    raceid    driverid    constructorid    number    grid    position    positiontext    positionorder    points    laps  time           milliseconds    fastestlap    rank  fastestlaptime      fastestlapspeed    statusid\n----------  --------  ----------  ---------------  --------  ------  ----------  --------------  ---------------  --------  ------  -----------  --------------  ------------  ------  ----------------  -----------------  ----------\n        23        19           8                6         1       2           1               1                1        10      56  1:31:18.555         5478555            37       2  1:35.405                    209.158           1\n        24        19           9                2         4       4           2               2                2         8      56  +19.570             5498125            39       6  1:35.921                    208.033           1\n        25        19           5                1        23       8           3               3                3         6      56  +38.450             5517005            19       7  1:35.922                    208.031           1\n...\n\n\nCREATE TABLE \"seasons\" (\nyear bigint NOT NULL DEFAULT '0'::bigint,\nurl text NULL DEFAULT ''::text,\n    PRIMARY KEY (year)\n);\n\nFirst 3 rows:\n  year  url\n------  ----------------------------------------------------\n  1950  http://en.wikipedia.org/wiki/1950_Formula_One_season\n  1951  http://en.wikipedia.org/wiki/1951_Formula_One_season\n  1952  http://en.wikipedia.org/wiki/1952_Formula_One_season\n...\n\n\nCREATE TABLE \"status\" (\nstatusid bigint NOT NULL DEFAULT nextval('status_statusid_seq'::regclass),\nstatus text NULL DEFAULT ''::text,\n    PRIMARY KEY (statusid)\n);\n\nFirst 3 rows:\n  statusid  status\n----------  ------------\n         1  Finished\n         2  Disqualified\n         3  Accident\n...\n", "preprocess_schema": "CREATE TABLE \"circuits\" (\ncircuitid bigint NOT NULL DEFAULT nextval('circuits_circuitid_seq'::regclass),\ncircuitref text NULL DEFAULT ''::text,\nname text NULL DEFAULT ''::text,\nlocation text NULL,\ncountry text NULL,\nlat real NULL,\nlng real NULL,\nalt bigint NULL,\nurl text NULL DEFAULT ''::text,\n    PRIMARY KEY (circuitid)\n);\n\nFirst 3 rows:\n  circuitid  circuitref    name                            location      country         lat        lng  alt    url\n-----------  ------------  ------------------------------  ------------  ---------  --------  ---------  -----  -----------------------------------------------------------\n          2  sepang        Sepang International Circuit    Kuala Lumpur  Malaysia    2.76083  101.738           http://en.wikipedia.org/wiki/Sepang_International_Circuit\n          3  bahrain       Bahrain International Circuit   Sakhir        Bahrain    26.0325    50.5106          http://en.wikipedia.org/wiki/Bahrain_International_Circuit\n          4  catalunya     Circuit de Barcelona-Catalunya  Montmeló      Spain      41.57       2.26111         http://en.wikipedia.org/wiki/Circuit_de_Barcelona-Catalunya\n...\n\n\nCREATE TABLE \"constructorresults\" (\nconstructorresultsid bigint NOT NULL DEFAULT nextval('constructorresults_constructorresultsid_seq'::regclass),\nraceid bigint NULL DEFAULT '0'::bigint,\nconstructorid bigint NULL DEFAULT '0'::bigint,\npoints real NULL,\nstatus text NULL,\n    PRIMARY KEY (constructorresultsid),\n    FOREIGN KEY (constructorid) REFERENCES constructors(constructorid)\n);\n\nFirst 3 rows:\n  constructorresultsid    raceid    constructorid    points  status\n----------------------  --------  ---------------  --------  --------\n                     1        18                1        14\n                     2        18                2         8\n                     3        18                3         9\n...\n\n\nCREATE TABLE \"constructors\" (\nconstructorid bigint NOT NULL DEFAULT nextval('constructors_constructorid_seq'::regclass),\nconstructorref text NULL DEFAULT ''::text,\nname text NULL DEFAULT ''::text,\nnationality text NULL,\nurl text NULL DEFAULT ''::text,\n    PRIMARY KEY (constructorid)\n);\n\nFirst 3 rows:\n  constructorid  constructorref    name        nationality    url\n---------------  ----------------  ----------  -------------  ------------------------------------------------------------\n              1  mclaren           McLaren     British        http://en.wikipedia.org/wiki/McLaren\n              2  bmw_sauber        BMW Sauber  German         http://en.wikipedia.org/wiki/BMW_Sauber\n              3  williams          Williams    British        http://en.wikipedia.org/wiki/Williams_Grand_Prix_Engineering\n...\n\n\nCREATE TABLE \"constructorstandings\" (\nconstructorstandingsid bigint NOT NULL DEFAULT nextval('constructorstandings_constructorstandingsid_seq'::regclass),\nraceid bigint NULL DEFAULT '0'::bigint,\nconstructorid bigint NULL DEFAULT '0'::bigint,\npoints real NULL DEFAULT '0'::real,\nposition bigint NULL,\npositiontext text NULL,\nwins bigint NULL DEFAULT '0'::bigint,\n    PRIMARY KEY (constructorstandingsid),\n    FOREIGN KEY (constructorid) REFERENCES constructors(constructorid)\n);\n\nFirst 3 rows:\n  constructorstandingsid    raceid    constructorid    points    position    positiontext    wins\n------------------------  --------  ---------------  --------  ----------  --------------  ------\n                       1        18                1        14           1               1       1\n                       2        18                2         8           3               3       0\n                       3        18                3         9           2               2       0\n...\n\n\nCREATE TABLE \"drivers\" (\ndriverid bigint NOT NULL DEFAULT nextval('drivers_driverid_seq'::regclass),\ndriverref text NULL DEFAULT ''::text,\nnumber bigint NULL,\ncode text NULL,\nforename text NULL DEFAULT ''::text,\nsurname text NULL DEFAULT ''::text,\ndob date NULL,\nnationality text NULL,\nurl text NULL DEFAULT ''::text,\n    PRIMARY KEY (driverid)\n);\n\nFirst 3 rows:\n  driverid  driverref      number  code    forename    surname    dob         nationality    url\n----------  -----------  --------  ------  ----------  ---------  ----------  -------------  -------------------------------------------\n         1  hamilton           44  HAM     Lewis       Hamilton   1985-01-07  British        http://en.wikipedia.org/wiki/Lewis_Hamilton\n         2  heidfeld          nan  HEI     Nick        Heidfeld   1977-05-10  German         http://en.wikipedia.org/wiki/Nick_Heidfeld\n         3  rosberg             6  ROS     Nico        Rosberg    1985-06-27  German         http://en.wikipedia.org/wiki/Nico_Rosberg\n...\n\n\nCREATE TABLE \"driverstandings\" (\ndriverstandingsid bigint NOT NULL DEFAULT nextval('driverstandings_driverstandingsid_seq'::regclass),\nraceid bigint NULL DEFAULT '0'::bigint,\ndriverid bigint NULL DEFAULT '0'::bigint,\npoints real NULL DEFAULT '0'::real,\nposition bigint NULL,\npositiontext text NULL,\nwins bigint NULL DEFAULT '0'::bigint,\n    PRIMARY KEY (driverstandingsid),\n    FOREIGN KEY (driverid) REFERENCES drivers(driverid)\n);\n\nFirst 3 rows:\n  driverstandingsid    raceid    driverid    points    position    positiontext    wins\n-------------------  --------  ----------  --------  ----------  --------------  ------\n                  1        18           1        10           1               1       1\n                  2        18           2         8           2               2       0\n                  3        18           3         6           3               3       0\n...\n\n\nCREATE TABLE \"laptimes\" (\nraceid bigint NOT NULL,\ndriverid bigint NOT NULL,\nlap bigint NOT NULL,\nposition bigint NULL,\ntime text NULL,\nmilliseconds bigint NULL,\n    PRIMARY KEY (raceid, driverid, lap),\n    FOREIGN KEY (driverid) REFERENCES drivers(driverid),\n    FOREIGN KEY (raceid) REFERENCES races(raceid)\n);\n\nFirst 3 rows:\n  raceid    driverid    lap    position  time        milliseconds\n--------  ----------  -----  ----------  --------  --------------\n       2           1      1          10  1:52.965          112965\n       2           1      2          10  1:41.865          101865\n       2           1      3          10  1:40.869          100869\n...\n\n\nCREATE TABLE \"pitstops\" (\nraceid bigint NOT NULL,\ndriverid bigint NOT NULL,\nstop bigint NOT NULL,\nlap bigint NULL,\ntime text NULL,\nduration text NULL,\nmilliseconds bigint NULL,\n    PRIMARY KEY (raceid, driverid, stop),\n    FOREIGN KEY (driverid) REFERENCES drivers(driverid),\n    FOREIGN KEY (raceid) REFERENCES races(raceid)\n);\n\nFirst 3 rows:\n  raceid    driverid    stop    lap  time        duration    milliseconds\n--------  ----------  ------  -----  --------  ----------  --------------\n     842           1       1     12  16:24:40      22.552           22552\n     842           1       2     24  16:45:48      22.611           22611\n     842           1       3     37  17:08:28      25.382           25382\n...\n\n\nCREATE TABLE \"qualifying\" (\nqualifyid bigint NOT NULL DEFAULT nextval('qualifying_qualifyid_seq'::regclass),\nraceid bigint NULL DEFAULT '0'::bigint,\ndriverid bigint NULL DEFAULT '0'::bigint,\nconstructorid bigint NULL DEFAULT '0'::bigint,\nnumber bigint NULL DEFAULT '0'::bigint,\nposition bigint NULL,\nq1 text NULL,\nq2 text NULL,\nq3 text NULL,\n    PRIMARY KEY (qualifyid),\n    FOREIGN KEY (constructorid) REFERENCES constructors(constructorid),\n    FOREIGN KEY (driverid) REFERENCES drivers(driverid),\n    FOREIGN KEY (raceid) REFERENCES races(raceid)\n);\n\nFirst 3 rows:\n  qualifyid    raceid    driverid    constructorid    number    position  q1        q2        q3\n-----------  --------  ----------  ---------------  --------  ----------  --------  --------  --------\n         23        19          13                6         2           1  1:35.347  1:34.412  1:35.748\n         24        19           8                6         1           2  1:35.645  1:34.188  1:36.230\n         25        19           5                1        23           3  1:35.227  1:34.759  1:36.613\n...\n\n\nCREATE TABLE \"races\" (\nraceid bigint NOT NULL DEFAULT nextval('races_raceid_seq'::regclass),\nyear bigint NULL DEFAULT '0'::bigint,\nround bigint NULL DEFAULT '0'::bigint,\ncircuitid bigint NULL DEFAULT '0'::bigint,\nname text NULL DEFAULT ''::text,\ndate date NULL,\ntime text NULL,\nurl text NULL,\n    PRIMARY KEY (raceid),\n    FOREIGN KEY (circuitid) REFERENCES circuits(circuitid),\n    FOREIGN KEY (year) REFERENCES seasons(year)\n);\n\nFirst 3 rows:\n  raceid    year    round    circuitid  name                  date        time      url\n--------  ------  -------  -----------  --------------------  ----------  --------  ------------------------------------------------------\n       2    2009        2            2  Malaysian Grand Prix  2009-04-05  09:00:00  http://en.wikipedia.org/wiki/2009_Malaysian_Grand_Prix\n       3    2009        3           17  Chinese Grand Prix    2009-04-19  07:00:00  http://en.wikipedia.org/wiki/2009_Chinese_Grand_Prix\n       4    2009        4            3  Bahrain Grand Prix    2009-04-26  12:00:00  http://en.wikipedia.org/wiki/2009_Bahrain_Grand_Prix\n...\n\n\nCREATE TABLE \"results\" (\nresultid bigint NOT NULL DEFAULT nextval('results_resultid_seq'::regclass),\nraceid bigint NULL DEFAULT '0'::bigint,\ndriverid bigint NULL DEFAULT '0'::bigint,\nconstructorid bigint NULL DEFAULT '0'::bigint,\nnumber bigint NULL,\ngrid bigint NULL DEFAULT '0'::bigint,\nposition bigint NULL,\npositiontext text NULL DEFAULT ''::text,\npositionorder bigint NULL DEFAULT '0'::bigint,\npoints real NULL DEFAULT '0'::real,\nlaps bigint NULL DEFAULT '0'::bigint,\ntime text NULL,\nmilliseconds bigint NULL,\nfastestlap bigint NULL,\nrank bigint NULL DEFAULT '0'::bigint,\nfastestlaptime text NULL,\nfastestlapspeed text NULL,\nstatusid bigint NULL DEFAULT '0'::bigint,\n    PRIMARY KEY (resultid),\n    FOREIGN KEY (constructorid) REFERENCES constructors(constructorid),\n    FOREIGN KEY (driverid) REFERENCES drivers(driverid),\n    FOREIGN KEY (raceid) REFERENCES races(raceid),\n    FOREIGN KEY (statusid) REFERENCES status(statusid)\n);\n\nFirst 3 rows:\n  resultid    raceid    driverid    constructorid    number    grid    position    positiontext    positionorder    points    laps  time           milliseconds    fastestlap    rank  fastestlaptime      fastestlapspeed    statusid\n----------  --------  ----------  ---------------  --------  ------  ----------  --------------  ---------------  --------  ------  -----------  --------------  ------------  ------  ----------------  -----------------  ----------\n        23        19           8                6         1       2           1               1                1        10      56  1:31:18.555         5478555            37       2  1:35.405                    209.158           1\n        24        19           9                2         4       4           2               2                2         8      56  +19.570             5498125            39       6  1:35.921                    208.033           1\n        25        19           5                1        23       8           3               3                3         6      56  +38.450             5517005            19       7  1:35.922                    208.031           1\n...\n\n\nCREATE TABLE \"seasons\" (\nyear bigint NOT NULL DEFAULT '0'::bigint,\nurl text NULL DEFAULT ''::text,\n    PRIMARY KEY (year)\n);\n\nFirst 3 rows:\n  year  url\n------  ----------------------------------------------------\n  1950  http://en.wikipedia.org/wiki/1950_Formula_One_season\n  1951  http://en.wikipedia.org/wiki/1951_Formula_One_season\n  1952  http://en.wikipedia.org/wiki/1952_Formula_One_season\n...\n\n\nCREATE TABLE \"status\" (\nstatusid bigint NOT NULL DEFAULT nextval('status_statusid_seq'::regclass),\nstatus text NULL DEFAULT ''::text,\n    PRIMARY KEY (statusid)\n);\n\nFirst 3 rows:\n  statusid  status\n----------  ------------\n         1  Finished\n         2  Disqualified\n         3  Accident\n...\n", "sol_sql": ["SELECT d.forename, d.surname, r.race_results\nFROM (\n   SELECT driverid, \n          jsonb_agg(jsonb_build_object('laps', r.laps, 'position', r.position)) AS race_results\n   FROM results r\n   WHERE EXISTS (\n      SELECT 1 \n      FROM results r1\n      WHERE r1.driverid = r.driverid\n      AND   r1.laps = 56\n      AND   r1.position = 1\n   )\n   GROUP BY driverid\n) r\nJOIN drivers d ON d.driverid = r.driverid;"], "test_cases": ["\ndef test_case(pred_sqls, sol_sqls, db_name, conn):\n    pred_sqls_result = execute_queries(sol_sqls, db_name, conn)       \n    sol_sqls_result = execute_queries(sol_sqls, db_name, conn)\n    assert pred_sqls_result == sol_sqls_result, f\"Expected pred_result and sol_result are the same but pred_result is {pred_sqls_result} and sol_result is {sol_sqls_result}.\"\n\n    result = performance_compare_by_qep(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"performance_check returned {result} but expected 1.\"\n    return result\n"]}
{"instance_id": "PostgreSQL_120", "dialect": "PostgreSQL", "version": "14.12", "db_id": "superhero", "query": "\nIn the superhero database, we want to identify a list of superheroes who have only the superpowers of 'Flight' and 'Telepathy' and do not possess any other superpowers. The following query seems to work, but I suspect there might be a more efficient way to achieve this result.", "issue_sql": ["SELECT DISTINCT s.id\nFROM superhero s\nWHERE EXISTS (\n    SELECT 1\n    FROM hero_power hp\n    JOIN superpower sp ON hp.power_id = sp.id\n    WHERE s.id = hp.hero_id AND sp.power_name = 'Flight'\n)\nAND EXISTS (\n    SELECT 1\n    FROM hero_power hp\n    JOIN superpower sp ON hp.power_id = sp.id\n    WHERE s.id = hp.hero_id AND sp.power_name = 'Telepathy'\n)\nAND NOT EXISTS (\n    SELECT 1\n    FROM hero_power hp\n    JOIN superpower sp ON hp.power_id = sp.id\n    WHERE s.id = hp.hero_id AND sp.power_name NOT IN ('Flight', 'Telepathy')\n);"], "preprocess_sql": [], "clean_up_sql": [], "category": "Efficiency", "original_schema": "CREATE TABLE \"alignment\" (\nid bigint NOT NULL,\nalignment text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  alignment\n----  -----------\n   1  Good\n   2  Bad\n   3  Neutral\n...\n\n\nCREATE TABLE \"attribute\" (\nid bigint NOT NULL,\nattribute_name text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  attribute_name\n----  ----------------\n   1  Intelligence\n   2  Strength\n   3  Speed\n...\n\n\nCREATE TABLE \"colour\" (\nid bigint NOT NULL,\ncolour text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  colour\n----  ---------\n   1  No Colour\n   2  Amber\n   3  Auburn\n...\n\n\nCREATE TABLE \"gender\" (\nid bigint NOT NULL,\ngender text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  gender\n----  --------\n   1  Male\n   2  Female\n   3  N/A\n...\n\n\nCREATE TABLE \"hero_attribute\" (\nhero_id bigint NULL,\nattribute_id bigint NULL,\nattribute_value bigint NULL,\n    FOREIGN KEY (attribute_id) REFERENCES attribute(id),\n    FOREIGN KEY (hero_id) REFERENCES superhero(id)\n);\n\nFirst 3 rows:\n  hero_id    attribute_id    attribute_value\n---------  --------------  -----------------\n        1               1                 80\n        2               1                 75\n        3               1                 95\n...\n\n\nCREATE TABLE \"hero_power\" (\nhero_id bigint NULL,\npower_id bigint NULL,\n    FOREIGN KEY (hero_id) REFERENCES superhero(id),\n    FOREIGN KEY (power_id) REFERENCES superpower(id)\n);\n\nFirst 3 rows:\n  hero_id    power_id\n---------  ----------\n        1           1\n        1          18\n        1          26\n...\n\n\nCREATE TABLE \"publisher\" (\nid bigint NOT NULL,\npublisher_name text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  publisher_name\n----  -----------------\n   1\n   2  ABC Studios\n   3  Dark Horse Comics\n...\n\n\nCREATE TABLE \"race\" (\nid bigint NOT NULL,\nrace text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  race\n----  ------\n   1  -\n   2  Alien\n   3  Alpha\n...\n\n\nCREATE TABLE \"superhero\" (\nid bigint NOT NULL,\nsuperhero_name text NULL,\nfull_name text NULL,\ngender_id bigint NULL,\neye_colour_id bigint NULL,\nhair_colour_id bigint NULL,\nskin_colour_id bigint NULL,\nrace_id bigint NULL,\npublisher_id bigint NULL,\nalignment_id bigint NULL,\nheight_cm bigint NULL,\nweight_kg bigint NULL,\n    PRIMARY KEY (id),\n    FOREIGN KEY (alignment_id) REFERENCES alignment(id),\n    FOREIGN KEY (eye_colour_id) REFERENCES colour(id),\n    FOREIGN KEY (gender_id) REFERENCES gender(id),\n    FOREIGN KEY (hair_colour_id) REFERENCES colour(id),\n    FOREIGN KEY (publisher_id) REFERENCES publisher(id),\n    FOREIGN KEY (race_id) REFERENCES race(id),\n    FOREIGN KEY (skin_colour_id) REFERENCES colour(id)\n);\n\nFirst 3 rows:\n  id  superhero_name    full_name                 gender_id    eye_colour_id    hair_colour_id    skin_colour_id    race_id    publisher_id    alignment_id    height_cm    weight_kg\n----  ----------------  ----------------------  -----------  ---------------  ----------------  ----------------  ---------  --------------  --------------  -----------  -----------\n   1  3-D Man           Charles Chandler                  1                9                13                 1          1              13               1          188           90\n   2  A-Bomb            Richard Milhouse Jones            1               33                 1                 1         24              13               1          203          441\n   3  Abe Sapien        Abraham Sapien                    1                7                 1                 7         33               3               1          191           65\n...\n\n\nCREATE TABLE \"superpower\" (\nid bigint NOT NULL,\npower_name text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  power_name\n----  -------------------\n   1  Agility\n   2  Accelerated Healing\n   3  Lantern Power Ring\n...\n", "preprocess_schema": "CREATE TABLE \"alignment\" (\nid bigint NOT NULL,\nalignment text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  alignment\n----  -----------\n   1  Good\n   2  Bad\n   3  Neutral\n...\n\n\nCREATE TABLE \"attribute\" (\nid bigint NOT NULL,\nattribute_name text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  attribute_name\n----  ----------------\n   1  Intelligence\n   2  Strength\n   3  Speed\n...\n\n\nCREATE TABLE \"colour\" (\nid bigint NOT NULL,\ncolour text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  colour\n----  ---------\n   1  No Colour\n   2  Amber\n   3  Auburn\n...\n\n\nCREATE TABLE \"gender\" (\nid bigint NOT NULL,\ngender text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  gender\n----  --------\n   1  Male\n   2  Female\n   3  N/A\n...\n\n\nCREATE TABLE \"hero_attribute\" (\nhero_id bigint NULL,\nattribute_id bigint NULL,\nattribute_value bigint NULL,\n    FOREIGN KEY (attribute_id) REFERENCES attribute(id),\n    FOREIGN KEY (hero_id) REFERENCES superhero(id)\n);\n\nFirst 3 rows:\n  hero_id    attribute_id    attribute_value\n---------  --------------  -----------------\n        1               1                 80\n        2               1                 75\n        3               1                 95\n...\n\n\nCREATE TABLE \"hero_power\" (\nhero_id bigint NULL,\npower_id bigint NULL,\n    FOREIGN KEY (hero_id) REFERENCES superhero(id),\n    FOREIGN KEY (power_id) REFERENCES superpower(id)\n);\n\nFirst 3 rows:\n  hero_id    power_id\n---------  ----------\n        1           1\n        1          18\n        1          26\n...\n\n\nCREATE TABLE \"publisher\" (\nid bigint NOT NULL,\npublisher_name text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  publisher_name\n----  -----------------\n   1\n   2  ABC Studios\n   3  Dark Horse Comics\n...\n\n\nCREATE TABLE \"race\" (\nid bigint NOT NULL,\nrace text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  race\n----  ------\n   1  -\n   2  Alien\n   3  Alpha\n...\n\n\nCREATE TABLE \"superhero\" (\nid bigint NOT NULL,\nsuperhero_name text NULL,\nfull_name text NULL,\ngender_id bigint NULL,\neye_colour_id bigint NULL,\nhair_colour_id bigint NULL,\nskin_colour_id bigint NULL,\nrace_id bigint NULL,\npublisher_id bigint NULL,\nalignment_id bigint NULL,\nheight_cm bigint NULL,\nweight_kg bigint NULL,\n    PRIMARY KEY (id),\n    FOREIGN KEY (alignment_id) REFERENCES alignment(id),\n    FOREIGN KEY (eye_colour_id) REFERENCES colour(id),\n    FOREIGN KEY (gender_id) REFERENCES gender(id),\n    FOREIGN KEY (hair_colour_id) REFERENCES colour(id),\n    FOREIGN KEY (publisher_id) REFERENCES publisher(id),\n    FOREIGN KEY (race_id) REFERENCES race(id),\n    FOREIGN KEY (skin_colour_id) REFERENCES colour(id)\n);\n\nFirst 3 rows:\n  id  superhero_name    full_name                 gender_id    eye_colour_id    hair_colour_id    skin_colour_id    race_id    publisher_id    alignment_id    height_cm    weight_kg\n----  ----------------  ----------------------  -----------  ---------------  ----------------  ----------------  ---------  --------------  --------------  -----------  -----------\n   1  3-D Man           Charles Chandler                  1                9                13                 1          1              13               1          188           90\n   2  A-Bomb            Richard Milhouse Jones            1               33                 1                 1         24              13               1          203          441\n   3  Abe Sapien        Abraham Sapien                    1                7                 1                 7         33               3               1          191           65\n...\n\n\nCREATE TABLE \"superpower\" (\nid bigint NOT NULL,\npower_name text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  power_name\n----  -------------------\n   1  Agility\n   2  Accelerated Healing\n   3  Lantern Power Ring\n...\n", "sol_sql": ["SELECT DISTINCT s.id \nFROM superhero s \nWHERE s.id IN (\n    SELECT hero_id \n    FROM hero_power \n    WHERE power_id = (\n        SELECT id \n        FROM superpower \n        WHERE power_name = 'Flight'\n    )\n) \nAND s.id IN (\n    SELECT hero_id \n    FROM hero_power \n    WHERE power_id = (\n        SELECT id \n        FROM superpower \n        WHERE power_name = 'Telepathy'\n    )\n) \nAND s.id NOT IN (\n    SELECT hero_id \n    FROM hero_power \n    WHERE power_id NOT IN (\n        (SELECT id FROM superpower WHERE power_name = 'Flight'), \n        (SELECT id FROM superpower WHERE power_name = 'Telepathy')\n    )\n);"], "test_cases": ["\ndef test_case(pred_sqls, sol_sqls, db_name, conn):\n    result = ex_base(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"ex_base returned {result} but expected 1.\"\n    result = performance_compare_by_qep(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"performance_check returned {result} but expected 1.\"\n    return result\n"]}
{"instance_id": "PostgreSQL_134", "dialect": "PostgreSQL", "version": "14.12", "db_id": "superhero", "query": "I am given a task to optimize the following query (not originally written by me). The query calculates the success rate of superheroes requesting new powers, where each request can have up to 5 retries if it fails.\n\nThe query needs to return:\n1. The total number of requests,\n2. The success rate (ratio of successful to total requests),\n3. Grouped by the power requested and the superhero's ID.\n\nHowever, the current query is very slow on a large dataset (millions of rows). Below is the table-creation script, data-insertion script, and the problematic query. How can I optimize this further?\n", "issue_sql": ["SELECT\n    s.superhero_id AS \"superheroId\",\n    p.power_name   AS \"power\",\n    COUNT(*)       AS \"totalRequests\",\n    SUM(\n       CASE WHEN r.status = 'success' THEN 1 ELSE 0 END\n    ) * 100.0 / COUNT(*) AS \"successRate\"\nFROM public.superhero_requests s\nJOIN public.superpower p\n  ON s.superpower_id = p.id\nJOIN (\n    SELECT\n        id,\n        superhero_id,\n        superpower_id,\n        status,\n        retry_number,\n        main_request_uuid,\n        ROW_NUMBER() OVER (\n            PARTITION BY main_request_uuid\n            ORDER BY retry_number DESC, id DESC\n        ) AS row_number\n    FROM public.superhero_requests\n) r\n  ON s.id = r.id\nWHERE s.created_at >= CURRENT_DATE - INTERVAL '30 days'\n  AND s.created_at <= CURRENT_DATE\n  AND r.row_number = 1\nGROUP BY\n    s.superhero_id,\n    p.power_name\nLIMIT 10;"], "preprocess_sql": ["CREATE TABLE IF NOT EXISTS public.superhero_requests (\n    id BIGINT NOT NULL,\n    superhero_id BIGINT NOT NULL,\n    superpower_id BIGINT NOT NULL,\n    status TEXT NOT NULL,\n    created_at TIMESTAMPTZ NOT NULL,\n    retry_number SMALLINT NOT NULL,\n    main_request_uuid VARCHAR NOT NULL,\n    -- New columns\n    request_priority INTEGER DEFAULT 5,\n    processing_time_ms INTEGER DEFAULT 0,\n    approval_status TEXT DEFAULT 'pending',\n    approved_by VARCHAR(100) DEFAULT NULL,\n    approval_date TIMESTAMPTZ DEFAULT NULL,\n    request_source TEXT DEFAULT 'web',\n    request_notes TEXT DEFAULT '',\n    is_emergency BOOLEAN DEFAULT FALSE,\n    last_updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,\n    metadata JSONB DEFAULT '{}'::jsonb,\n    expiration_date DATE DEFAULT (CURRENT_DATE + INTERVAL '90 days'),\n    request_version INTEGER DEFAULT 1,\n    is_archived BOOLEAN DEFAULT FALSE,\n    archive_reason TEXT DEFAULT NULL,\n    client_ip VARCHAR(45) DEFAULT '127.0.0.1',\n    session_id UUID DEFAULT gen_random_uuid(),\n    request_hash VARCHAR(64) DEFAULT NULL,\n    retry_scheduled_at TIMESTAMPTZ DEFAULT NULL,\n    failure_reason TEXT DEFAULT NULL,\n    notification_sent BOOLEAN DEFAULT FALSE,\n    PRIMARY KEY (id)\n);", "INSERT INTO public.superhero_requests (\n    id,\n    superhero_id,\n    superpower_id,\n    status,\n    created_at,\n    retry_number,\n    main_request_uuid,\n    -- New columns\n    request_priority,\n    processing_time_ms,\n    approval_status,\n    approved_by,\n    approval_date,\n    request_source,\n    request_notes,\n    is_emergency,\n    last_updated_at,\n    metadata,\n    expiration_date,\n    request_version,\n    is_archived,\n    archive_reason,\n    client_ip,\n    session_id,\n    request_hash,\n    retry_scheduled_at,\n    failure_reason,\n    notification_sent\n)\nSELECT\n    generate_series(1, 1000000)               AS id,\n    (random() * 750)::int + 1                AS superhero_id,     -- IDs between 1..750\n    (random() * 5)::int + 1                  AS superpower_id,     -- referencing our 5 sample powers (1..5)\n    CASE WHEN random() < 0.8 THEN 'success'\n         ELSE 'failure'\n    END                                       AS status,          \n    NOW() - (random() * 30)::int * '1 day'::interval AS created_at,\n    (random() * 5)::int                      AS retry_number,      -- 0..5\n    md5(random()::text)                      AS main_request_uuid,  -- random UUID-like string\n    -- New column values\n    (random() * 10)::int                     AS request_priority,\n    (random() * 5000)::int                   AS processing_time_ms,\n    CASE \n        WHEN random() < 0.7 THEN 'approved'\n        WHEN random() < 0.9 THEN 'rejected'\n        ELSE 'pending'\n    END                                       AS approval_status,\n    CASE \n        WHEN random() < 0.8 THEN 'admin' || (random() * 10)::int\n        ELSE NULL\n    END                                       AS approved_by,\n    CASE \n        WHEN random() < 0.8 THEN NOW() - (random() * 25)::int * '1 day'::interval\n        ELSE NULL\n    END                                       AS approval_date,\n    CASE \n        WHEN random() < 0.6 THEN 'web'\n        WHEN random() < 0.8 THEN 'mobile'\n        WHEN random() < 0.9 THEN 'api'\n        ELSE 'internal'\n    END                                       AS request_source,\n    'Request notes for ' || md5(random()::text) AS request_notes,\n    random() < 0.1                           AS is_emergency,\n    NOW() - (random() * 20)::int * '1 hour'::interval AS last_updated_at,\n    jsonb_build_object(\n        'browser', CASE WHEN random() < 0.5 THEN 'Chrome' ELSE 'Firefox' END,\n        'device', CASE WHEN random() < 0.7 THEN 'Desktop' ELSE 'Mobile' END,\n        'tracking_id', md5(random()::text)\n    )                                         AS metadata,\n    CURRENT_DATE + ((random() * 180)::int - 30) * '1 day'::interval AS expiration_date,\n    (random() * 3)::int + 1                  AS request_version,\n    random() < 0.05                          AS is_archived,\n    CASE \n        WHEN random() < 0.05 THEN 'Outdated request'\n        ELSE NULL\n    END                                       AS archive_reason,\n    '192.168.' || (random() * 255)::int || '.' || (random() * 255)::int AS client_ip,\n    gen_random_uuid()                        AS session_id,\n    md5(random()::text)                      AS request_hash,\n    CASE \n        WHEN random() < 0.3 THEN NOW() + (random() * 5)::int * '1 day'::interval\n        ELSE NULL\n    END                                       AS retry_scheduled_at,\n    CASE \n        WHEN random() < 0.2 THEN 'Connection timeout'\n        WHEN random() < 0.4 THEN 'Invalid parameters'\n        WHEN random() < 0.6 THEN 'Server error'\n        ELSE NULL\n    END                                       AS failure_reason,\n    random() < 0.75                          AS notification_sent\n;"], "clean_up_sql": ["DROP TABLE public.superhero_requests;"], "category": "Efficiency", "original_schema": "CREATE TABLE \"alignment\" (\nid bigint NOT NULL,\nalignment text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  alignment\n----  -----------\n   1  Good\n   2  Bad\n   3  Neutral\n...\n\n\nCREATE TABLE \"attribute\" (\nid bigint NOT NULL,\nattribute_name text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  attribute_name\n----  ----------------\n   1  Intelligence\n   2  Strength\n   3  Speed\n...\n\n\nCREATE TABLE \"colour\" (\nid bigint NOT NULL,\ncolour text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  colour\n----  ---------\n   1  No Colour\n   2  Amber\n   3  Auburn\n...\n\n\nCREATE TABLE \"gender\" (\nid bigint NOT NULL,\ngender text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  gender\n----  --------\n   1  Male\n   2  Female\n   3  N/A\n...\n\n\nCREATE TABLE \"hero_attribute\" (\nhero_id bigint NULL,\nattribute_id bigint NULL,\nattribute_value bigint NULL,\n    FOREIGN KEY (attribute_id) REFERENCES attribute(id),\n    FOREIGN KEY (hero_id) REFERENCES superhero(id)\n);\n\nFirst 3 rows:\n  hero_id    attribute_id    attribute_value\n---------  --------------  -----------------\n        1               1                 80\n        2               1                 75\n        3               1                 95\n...\n\n\nCREATE TABLE \"hero_power\" (\nhero_id bigint NULL,\npower_id bigint NULL,\n    FOREIGN KEY (hero_id) REFERENCES superhero(id),\n    FOREIGN KEY (power_id) REFERENCES superpower(id)\n);\n\nFirst 3 rows:\n  hero_id    power_id\n---------  ----------\n        1           1\n        1          18\n        1          26\n...\n\n\nCREATE TABLE \"publisher\" (\nid bigint NOT NULL,\npublisher_name text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  publisher_name\n----  -----------------\n   1\n   2  ABC Studios\n   3  Dark Horse Comics\n...\n\n\nCREATE TABLE \"race\" (\nid bigint NOT NULL,\nrace text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  race\n----  ------\n   1  -\n   2  Alien\n   3  Alpha\n...\n\n\nCREATE TABLE \"superhero\" (\nid bigint NOT NULL,\nsuperhero_name text NULL,\nfull_name text NULL,\ngender_id bigint NULL,\neye_colour_id bigint NULL,\nhair_colour_id bigint NULL,\nskin_colour_id bigint NULL,\nrace_id bigint NULL,\npublisher_id bigint NULL,\nalignment_id bigint NULL,\nheight_cm bigint NULL,\nweight_kg bigint NULL,\n    PRIMARY KEY (id),\n    FOREIGN KEY (alignment_id) REFERENCES alignment(id),\n    FOREIGN KEY (eye_colour_id) REFERENCES colour(id),\n    FOREIGN KEY (gender_id) REFERENCES gender(id),\n    FOREIGN KEY (hair_colour_id) REFERENCES colour(id),\n    FOREIGN KEY (publisher_id) REFERENCES publisher(id),\n    FOREIGN KEY (race_id) REFERENCES race(id),\n    FOREIGN KEY (skin_colour_id) REFERENCES colour(id)\n);\n\nFirst 3 rows:\n  id  superhero_name    full_name                 gender_id    eye_colour_id    hair_colour_id    skin_colour_id    race_id    publisher_id    alignment_id    height_cm    weight_kg\n----  ----------------  ----------------------  -----------  ---------------  ----------------  ----------------  ---------  --------------  --------------  -----------  -----------\n   1  3-D Man           Charles Chandler                  1                9                13                 1          1              13               1          188           90\n   2  A-Bomb            Richard Milhouse Jones            1               33                 1                 1         24              13               1          203          441\n   3  Abe Sapien        Abraham Sapien                    1                7                 1                 7         33               3               1          191           65\n...\n\n\nCREATE TABLE \"superpower\" (\nid bigint NOT NULL,\npower_name text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  power_name\n----  -------------------\n   1  Agility\n   2  Accelerated Healing\n   3  Lantern Power Ring\n...\n", "preprocess_schema": "CREATE TABLE \"alignment\" (\nid bigint NOT NULL,\nalignment text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  alignment\n----  -----------\n   1  Good\n   2  Bad\n   3  Neutral\n...\n\n\nCREATE TABLE \"attribute\" (\nid bigint NOT NULL,\nattribute_name text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  attribute_name\n----  ----------------\n   1  Intelligence\n   2  Strength\n   3  Speed\n...\n\n\nCREATE TABLE \"colour\" (\nid bigint NOT NULL,\ncolour text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  colour\n----  ---------\n   1  No Colour\n   2  Amber\n   3  Auburn\n...\n\n\nCREATE TABLE \"gender\" (\nid bigint NOT NULL,\ngender text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  gender\n----  --------\n   1  Male\n   2  Female\n   3  N/A\n...\n\n\nCREATE TABLE \"hero_attribute\" (\nhero_id bigint NULL,\nattribute_id bigint NULL,\nattribute_value bigint NULL,\n    FOREIGN KEY (attribute_id) REFERENCES attribute(id),\n    FOREIGN KEY (hero_id) REFERENCES superhero(id)\n);\n\nFirst 3 rows:\n  hero_id    attribute_id    attribute_value\n---------  --------------  -----------------\n        1               1                 80\n        2               1                 75\n        3               1                 95\n...\n\n\nCREATE TABLE \"hero_power\" (\nhero_id bigint NULL,\npower_id bigint NULL,\n    FOREIGN KEY (hero_id) REFERENCES superhero(id),\n    FOREIGN KEY (power_id) REFERENCES superpower(id)\n);\n\nFirst 3 rows:\n  hero_id    power_id\n---------  ----------\n        1           1\n        1          18\n        1          26\n...\n\n\nCREATE TABLE \"publisher\" (\nid bigint NOT NULL,\npublisher_name text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  publisher_name\n----  -----------------\n   1\n   2  ABC Studios\n   3  Dark Horse Comics\n...\n\n\nCREATE TABLE \"race\" (\nid bigint NOT NULL,\nrace text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  race\n----  ------\n   1  -\n   2  Alien\n   3  Alpha\n...\n\n\nCREATE TABLE \"superhero\" (\nid bigint NOT NULL,\nsuperhero_name text NULL,\nfull_name text NULL,\ngender_id bigint NULL,\neye_colour_id bigint NULL,\nhair_colour_id bigint NULL,\nskin_colour_id bigint NULL,\nrace_id bigint NULL,\npublisher_id bigint NULL,\nalignment_id bigint NULL,\nheight_cm bigint NULL,\nweight_kg bigint NULL,\n    PRIMARY KEY (id),\n    FOREIGN KEY (alignment_id) REFERENCES alignment(id),\n    FOREIGN KEY (eye_colour_id) REFERENCES colour(id),\n    FOREIGN KEY (gender_id) REFERENCES gender(id),\n    FOREIGN KEY (hair_colour_id) REFERENCES colour(id),\n    FOREIGN KEY (publisher_id) REFERENCES publisher(id),\n    FOREIGN KEY (race_id) REFERENCES race(id),\n    FOREIGN KEY (skin_colour_id) REFERENCES colour(id)\n);\n\nFirst 3 rows:\n  id  superhero_name    full_name                 gender_id    eye_colour_id    hair_colour_id    skin_colour_id    race_id    publisher_id    alignment_id    height_cm    weight_kg\n----  ----------------  ----------------------  -----------  ---------------  ----------------  ----------------  ---------  --------------  --------------  -----------  -----------\n   1  3-D Man           Charles Chandler                  1                9                13                 1          1              13               1          188           90\n   2  A-Bomb            Richard Milhouse Jones            1               33                 1                 1         24              13               1          203          441\n   3  Abe Sapien        Abraham Sapien                    1                7                 1                 7         33               3               1          191           65\n...\n\n\nCREATE TABLE \"superhero_requests\" (\nid bigint NOT NULL,\nsuperhero_id bigint NOT NULL,\nsuperpower_id bigint NOT NULL,\nstatus text NOT NULL,\ncreated_at timestamp with time zone NOT NULL,\nretry_number smallint NOT NULL,\nmain_request_uuid character varying NOT NULL,\nrequest_priority integer NULL DEFAULT 5,\nprocessing_time_ms integer NULL DEFAULT 0,\napproval_status text NULL DEFAULT 'pending'::text,\napproved_by character varying NULL DEFAULT NULL::character varying,\napproval_date timestamp with time zone NULL,\nrequest_source text NULL DEFAULT 'web'::text,\nrequest_notes text NULL DEFAULT ''::text,\nis_emergency boolean NULL DEFAULT false,\nlast_updated_at timestamp with time zone NULL DEFAULT CURRENT_TIMESTAMP,\nmetadata jsonb NULL DEFAULT '{}'::jsonb,\nexpiration_date date NULL DEFAULT (CURRENT_DATE + '90 days'::interval),\nrequest_version integer NULL DEFAULT 1,\nis_archived boolean NULL DEFAULT false,\narchive_reason text NULL,\nclient_ip character varying NULL DEFAULT '127.0.0.1'::character varying,\nsession_id uuid NULL DEFAULT gen_random_uuid(),\nrequest_hash character varying NULL DEFAULT NULL::character varying,\nretry_scheduled_at timestamp with time zone NULL,\nfailure_reason text NULL,\nnotification_sent boolean NULL DEFAULT false,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id    superhero_id    superpower_id  status    created_at                          retry_number  main_request_uuid                   request_priority    processing_time_ms  approval_status    approved_by    approval_date                     request_source    request_notes                                       is_emergency    last_updated_at                   metadata                                                                                        expiration_date      request_version  is_archived    archive_reason    client_ip        session_id                            request_hash                      retry_scheduled_at                failure_reason      notification_sent\n----  --------------  ---------------  --------  --------------------------------  --------------  --------------------------------  ------------------  --------------------  -----------------  -------------  --------------------------------  ----------------  --------------------------------------------------  --------------  --------------------------------  ----------------------------------------------------------------------------------------------  -----------------  -----------------  -------------  ----------------  ---------------  ------------------------------------  --------------------------------  --------------------------------  ------------------  -------------------\n   1              78                4  success   2025-03-25 20:44:41.521181+08:00               1  19eef56a6bf7f1a5fea95051498e3eb0                   9                  3649  rejected           admin8         NaT                               web               Request notes for 422071e16b2114128c1a520ee5747e93  False           2025-04-14 13:44:41.521181+08:00  {'device': 'Desktop', 'browser': 'Chrome', 'tracking_id': '070a866d31b9f161aed05d9427bca20f'}   2025-07-25                         2  False                            192.168.83.81    44defdda-d29d-48aa-8d39-cc460fbd0733  45f2eb736265d989ec3a1091d22f7e5a  NaT                               Server error        True\n   2             368                6  success   2025-04-10 20:44:41.521181+08:00               4  6af6ef60cb6c99877c346746ffb8813f                   7                  1319  approved                          2025-03-27 20:44:41.521181+08:00  mobile            Request notes for a68cc432ea30fab6df0085414c450896  False           2025-04-14 12:44:41.521181+08:00  {'device': 'Desktop', 'browser': 'Firefox', 'tracking_id': '251951d7f5a4dae485aa5c887728ff73'}  2025-07-25                         2  False                            192.168.104.140  bc896ffe-33bb-41a5-bd89-f22118dfdaba  a64b9f2e3622dfe650bbfca199f41599  2025-04-16 20:44:41.521181+08:00  Invalid parameters  False\n   3             210                6  success   2025-04-04 20:44:41.521181+08:00               0  0a7afae6fc3826f25cdbbbf3e8b33b4c                   8                   469  rejected           admin2         2025-04-04 20:44:41.521181+08:00  web               Request notes for 2ea80a6e04ff7f24dc46aae7e3707327  False           2025-04-14 01:44:41.521181+08:00  {'device': 'Mobile', 'browser': 'Chrome', 'tracking_id': '6db7dc0712c1906fd15b5da82ba4f999'}    2025-08-31                         1  False                            192.168.148.141  f9192fd1-f140-4809-8491-213278aa9802  0d45d1a7b7b63747eabe17683fca665f  2025-04-16 20:44:41.521181+08:00  Invalid parameters  True\n...\n\n\nCREATE TABLE \"superpower\" (\nid bigint NOT NULL,\npower_name text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  power_name\n----  -------------------\n   1  Agility\n   2  Accelerated Healing\n   3  Lantern Power Ring\n...\n", "sol_sql": ["WITH main AS (\n    SELECT DISTINCT ON (main_request_uuid)\n           id,\n           superhero_id,\n           superpower_id,\n           status,\n           created_at\n    FROM public.superhero_requests\n    ORDER BY main_request_uuid, retry_number DESC, id DESC\n)\nSELECT\n    m.superhero_id AS \"superheroId\",\n    p.power_name   AS \"power\",\n    COUNT(*) AS \"totalRequests\",\n    SUM(CASE WHEN m.status = 'success' THEN 1 ELSE 0 END) * 100.0 / COUNT(*) AS \"successRate\"\nFROM main m\nJOIN public.superpower p\n    ON m.superpower_id = p.id\nWHERE m.created_at >= CURRENT_DATE - INTERVAL '30 days'\n  AND m.created_at <= CURRENT_DATE\nGROUP BY\n    m.superhero_id,\n    p.power_name\nLIMIT 10;"], "test_cases": ["def test_case(pred_sqls, sol_sqls, db_name, conn):\n    result = ex_base(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"ex_base returned {result} but expected 1.\"\n    result = performance_compare_by_qep(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"performance_check returned {result} but expected 1.\"\n    return result"]}
{"instance_id": "PostgreSQL_136", "dialect": "PostgreSQL", "version": "14.12", "db_id": "card_games", "query": "In the card_games database, we have a table named 'card_prices' that records the price changes of cards over time. Each entry includes the timestamp of the price change, the card's UUID, and the new price. When a new price is recorded, we need to take the first price older than 30 days, along with prices from the last 30 days, and return the minimum. When new price came, we should not include in range:  New Price Date: 2022/08/11; 30 days subtracted date: 2022/07/12. However, since price changes are not daily, we must also consider the price before the 30-day window to ensure we capture the correct minimum price. The current query is slow and sometimes returns incorrect results due to the way it handles the 30-day window and the price before it. We need to optimize the query to ensure it runs efficiently and accurately.", "issue_sql": ["SELECT min(price) FROM card_prices WHERE (timestamp >= (SELECT MAX(timestamp) FROM card_prices WHERE timestamp < '2022-07-12T15:30:00-00:00' AND uuid = '5f8287b1-5bb6-5f4c-ad17-316a40d5bb0c') OR timestamp >= '2022-07-12T15:30:00-00:00' AND timestamp < '2022-08-11T15:30:00-00:00') AND uuid = '5f8287b1-5bb6-5f4c-ad17-316a40d5bb0c' AND price > 0"], "preprocess_sql": ["CREATE TABLE card_prices (timestamp timestamp with time zone not null, uuid varchar(200) not null, price numeric(12, 2));", "INSERT INTO card_prices (timestamp, uuid, price) VALUES ('2022-07-09 18:18:39.000000 +00:00','5f8287b1-5bb6-5f4c-ad17-316a40d5bb0c', 120.00), ('2022-07-10 15:45:56.000000 +00:00', '5f8287b1-5bb6-5f4c-ad17-316a40d5bb0c', 125.00), ('2022-07-12 08:00:10.000000 +00:00', '5f8287b1-5bb6-5f4c-ad17-316a40d5bb0c', 130.00), ('2022-07-14 13:15:55.000000 +00:00', '5f8287b1-5bb6-5f4c-ad17-316a40d5bb0c', 135.00), ('2022-07-16 10:33:11.000000 +00:00', '5f8287b1-5bb6-5f4c-ad17-316a40d5bb0c', 140.00), ('2022-07-18 20:18:48.000000 +00:00', '5f8287b1-5bb6-5f4c-ad17-316a40d5bb0c', 145.00), ('2022-07-20 07:40:29.000000 +00:00', '5f8287b1-5bb6-5f4c-ad17-316a40d5bb0c', 150.00), ('2022-07-22 14:11:59.000000 +00:00', '5f8287b1-5bb6-5f4c-ad17-316a40d5bb0c', 155.00), ('2022-07-25 11:55:30.000000 +00:00', '5f8287b1-5bb6-5f4c-ad17-316a40d5bb0c', 160.00), ('2022-07-28 16:05:07.000000 +00:00', '5f8287b1-5bb6-5f4c-ad17-316a40d5bb0c', 165.00), ('2022-07-30 09:40:25.000000 +00:00', '5f8287b1-5bb6-5f4c-ad17-316a40d5bb0c', 170.00), ('2022-08-02 18:30:13.000000 +00:00', '5f8287b1-5bb6-5f4c-ad17-316a40d5bb0c', 175.00), ('2022-08-05 21:19:40.000000 +00:00','5f8287b1-5bb6-5f4c-ad17-316a40d5bb0c',130.00), ('2022-08-10 11:20:39.000000 +00:00','5f8287b1-5bb6-5f4c-ad17-316a40d5bb0c',140.00);"], "clean_up_sql": ["DROP TABLE card_prices;"], "category": "Efficiency", "original_schema": "CREATE TABLE \"cards\" (\nid bigint NOT NULL DEFAULT nextval('cards_id_seq'::regclass),\nartist text NULL,\nasciiname text NULL,\navailability text NULL,\nbordercolor text NULL,\ncardkingdomfoilid text NULL,\ncardkingdomid text NULL,\ncoloridentity text NULL,\ncolorindicator text NULL,\ncolors text NULL,\nconvertedmanacost real NULL,\ndueldeck text NULL,\nedhrecrank bigint NULL,\nfaceconvertedmanacost real NULL,\nfacename text NULL,\nflavorname text NULL,\nflavortext text NULL,\nframeeffects text NULL,\nframeversion text NULL,\nhand text NULL,\nhasalternativedecklimit bigint NULL DEFAULT '0'::bigint,\nhascontentwarning bigint NULL DEFAULT '0'::bigint,\nhasfoil bigint NULL DEFAULT '0'::bigint,\nhasnonfoil bigint NULL DEFAULT '0'::bigint,\nisalternative bigint NULL DEFAULT '0'::bigint,\nisfullart bigint NULL DEFAULT '0'::bigint,\nisonlineonly bigint NULL DEFAULT '0'::bigint,\nisoversized bigint NULL DEFAULT '0'::bigint,\nispromo bigint NULL DEFAULT '0'::bigint,\nisreprint bigint NULL DEFAULT '0'::bigint,\nisreserved bigint NULL DEFAULT '0'::bigint,\nisstarter bigint NULL DEFAULT '0'::bigint,\nisstoryspotlight bigint NULL DEFAULT '0'::bigint,\nistextless bigint NULL DEFAULT '0'::bigint,\nistimeshifted bigint NULL DEFAULT '0'::bigint,\nkeywords text NULL,\nlayout text NULL,\nleadershipskills text NULL,\nlife text NULL,\nloyalty text NULL,\nmanacost text NULL,\nmcmid text NULL,\nmcmmetaid text NULL,\nmtgarenaid text NULL,\nmtgjsonv4id text NULL,\nmtgofoilid text NULL,\nmtgoid text NULL,\nmultiverseid text NULL,\nname text NULL,\nnumber text NULL,\noriginalreleasedate text NULL,\noriginaltext text NULL,\noriginaltype text NULL,\notherfaceids text NULL,\npower text NULL,\nprintings text NULL,\npromotypes text NULL,\npurchaseurls text NULL,\nrarity text NULL,\nscryfallid text NULL,\nscryfallillustrationid text NULL,\nscryfalloracleid text NULL,\nsetcode text NULL,\nside text NULL,\nsubtypes text NULL,\nsupertypes text NULL,\ntcgplayerproductid text NULL,\ntext text NULL,\ntoughness text NULL,\ntype text NULL,\ntypes text NULL,\nuuid text NULL,\nvariations text NULL,\nwatermark text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  artist        asciiname    availability    bordercolor    cardkingdomfoilid      cardkingdomid  coloridentity    colorindicator    colors      convertedmanacost  dueldeck      edhrecrank  faceconvertedmanacost    facename    flavorname    flavortext                                 frameeffects      frameversion  hand      hasalternativedecklimit    hascontentwarning    hasfoil    hasnonfoil    isalternative    isfullart    isonlineonly    isoversized    ispromo    isreprint    isreserved    isstarter    isstoryspotlight    istextless    istimeshifted  keywords      layout    leadershipskills    life    loyalty    manacost      mcmid    mcmmetaid  mtgarenaid    mtgjsonv4id                             mtgofoilid    mtgoid    multiverseid  name                 number  originalreleasedate    originaltext                                                                              originaltype             otherfaceids      power  printings                                              promotypes    purchaseurls                                                                                                                                                                          rarity    scryfallid                            scryfallillustrationid                scryfalloracleid                      setcode    side    subtypes      supertypes      tcgplayerproductid    toughness  type                     types     uuid                                  variations                            watermark\n----  ------------  -----------  --------------  -------------  -------------------  ---------------  ---------------  ----------------  --------  -------------------  ----------  ------------  -----------------------  ----------  ------------  -----------------------------------------  --------------  --------------  ------  -------------------------  -------------------  ---------  ------------  ---------------  -----------  --------------  -------------  ---------  -----------  ------------  -----------  ------------------  ------------  ---------------  ------------  --------  ------------------  ------  ---------  ----------  -------  -----------  ------------  ------------------------------------  ------------  --------  --------------  -----------------  --------  ---------------------  ----------------------------------------------------------------------------------------  -----------------------  --------------  -------  -----------------------------------------------------  ------------  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  --------  ------------------------------------  ------------------------------------  ------------------------------------  ---------  ------  ------------  ------------  --------------------  -----------  -----------------------  --------  ------------------------------------  ------------------------------------  -----------\n   1  Pete Venters               mtgo,paper      black                                        122719  W                                  W                           7                     15650                                                                                                                          2003                                  0                    0          0             1                0            0               0              0          0            1             0            0                   0             0                0  First strike  normal                                           {5}{W}{W}     16165          156                ad41be73-582f-58ed-abd4-a88c1f616ac3         27501     27500          130550  Ancestor's Chosen         1                         First strike (This creature deals combat damage before creatures without first strike.)   Creature - Human Cleric                        4  10E,JUD,UMA                                                          {'cardKingdom': 'https://mtgjson.com/links/9fb51af0ad6f0736', 'cardmarket': 'https://mtgjson.com/links/ace8861194ee0b6a', 'tcgplayer': 'https://mtgjson.com/links/4843cea124a0d515'}  uncommon  7a5cd03c-4227-4551-aa4b-7d119f0468b5  be2f7173-c8b7-4172-a388-9b2c6b3c16e5  fc2ccab7-cab1-4463-b73d-898070136d74  10E                Human,Cleric                               15032            4  Creature — Human Cleric  Creature  5f8287b1-5bb6-5f4c-ad17-316a40d5bb0c  b7c19924-b4bf-56fc-aa73-f586e940bd42\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     When Ancestor's Chosen comes into play, you gain 1 life for each card in your graveyard.\n   2  Volkan Baǵa                mtgo,paper      black                                        122720  W                                  W                           5                     12702                                                     Every tear shed is a drop of immortality.                            2003                                  0                    0          0             1                0            0               0              0          0            1             0            0                   0             0                0  Flying        normal                                           {4}{W}        16166          176                9eb2e54c-a12b-5e88-a9c0-d8c84c52d59c         26993     26992          129465  Angel of Mercy            2                         Flying (This creature can't be blocked except by creatures with flying or reach.)         Creature - Angel                               3  10E,8ED,9ED,DDC,DVD,IMA,INV,JMP,MB1,P02,PS11,PSAL,S99                {'cardKingdom': 'https://mtgjson.com/links/027095d094e58f5b', 'cardmarket': 'https://mtgjson.com/links/f6fb5098e1cd1b1e', 'tcgplayer': 'https://mtgjson.com/links/56c4b57293f350ef'}  uncommon  8f7980d4-da43-4d6d-ad16-14b8a34ae91d  e4d6c53f-e936-4be8-8b70-47c2be863b20  a2daaf32-dbfe-4618-892e-0da24f63a44a  10E                Angel                                      15033            3  Creature — Angel         Creature  57aaebc1-850c-503d-9f6e-bb8d00d8bf7c  8fd4e2eb-3eb4-50ea-856b-ef638fa47f8a\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     When Angel of Mercy comes into play, you gain 3 life.\n   3  Justin Sweet               mtgo,paper      black                                        122725  W                                  W                           4                     11081                                                                                                                          2003                                  0                    0          0             1                0            0               0              0          0            1             0            0                   0             0                0  Flying        normal                                           {3}{W}        16171          368                c0de6fd8-367a-50fb-b2f4-2b8fa5aeb7d9         27473     27472          129470  Aven Cloudchaser          7                         Flying (This creature can't be blocked except by creatures with flying or reach.)         Creature - Bird Soldier                        2  10E,8ED,9ED,ODY                                                      {'cardKingdom': 'https://mtgjson.com/links/9246105d88032a9f', 'cardmarket': 'https://mtgjson.com/links/dcdfe48e6a8f9e1e', 'tcgplayer': 'https://mtgjson.com/links/3ce595aabe276f80'}  common    407110e9-19af-4ff5-97b2-c03225031a73  2eb663cd-020a-46d8-a6d9-bb63d4b5c848  48bda7dd-d023-41e8-8c28-e0cfda0d07ca  10E                Bird,Soldier                               15045            2  Creature — Bird Soldier  Creature  8ac972b5-9f6e-5cc8-91c3-b9a40a98232e  6adaf14d-43e3-521a-adf1-960c808e5b1a\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     When Aven Cloudchaser comes into play, destroy target enchantment.\n...\n\n\nCREATE TABLE \"foreign_data\" (\nid bigint NOT NULL DEFAULT nextval('foreign_data_id_seq'::regclass),\nflavortext text NULL,\nlanguage text NULL,\nmultiverseid bigint NULL,\nname text NULL,\ntext text NULL,\ntype text NULL,\nuuid text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  language      multiverseid  name                      uuid\n----  ----------  --------------  ------------------------  ------------------------------------\n   1  German              148411  Ausgewählter der Ahnfrau  5f8287b1-5bb6-5f4c-ad17-316a40d5bb0c\n   2  Spanish             150317  Elegido de la Antepasada  5f8287b1-5bb6-5f4c-ad17-316a40d5bb0c\n   3  French              149934  Élu de l'Ancêtre          5f8287b1-5bb6-5f4c-ad17-316a40d5bb0c\n...\n\n\nCREATE TABLE \"legalities\" (\nid bigint NOT NULL DEFAULT nextval('legalities_id_seq'::regclass),\nformat text NULL,\nstatus text NULL,\nuuid text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  format     status    uuid\n----  ---------  --------  ------------------------------------\n   1  commander  Legal     5f8287b1-5bb6-5f4c-ad17-316a40d5bb0c\n   2  duel       Legal     5f8287b1-5bb6-5f4c-ad17-316a40d5bb0c\n   3  legacy     Legal     5f8287b1-5bb6-5f4c-ad17-316a40d5bb0c\n...\n\n\nCREATE TABLE \"rulings\" (\nid bigint NOT NULL DEFAULT nextval('rulings_id_seq'::regclass),\ndate date NULL,\ntext text NULL,\nuuid text NULL,\n    PRIMARY KEY (id),\n    FOREIGN KEY (uuid) REFERENCES cards(uuid)\n);\n\nFirst 3 rows:\n  id  date        uuid\n----  ----------  ------------------------------------\n   1  2007-07-15  6d268c95-c176-5766-9a46-c14f739aba1c\n   2  2007-02-01  56f4935b-f6c5-59b9-88bf-9bcce20247ce\n   3  2007-07-15  56f4935b-f6c5-59b9-88bf-9bcce20247ce\n...\n\n\nCREATE TABLE \"set_translations\" (\nid bigint NOT NULL DEFAULT nextval('set_translations_id_seq'::regclass),\nlanguage text NULL,\nsetcode text NULL,\ntranslation text NULL,\n    PRIMARY KEY (id),\n    FOREIGN KEY (setcode) REFERENCES sets(code)\n);\n\nFirst 3 rows:\n  id  language             setcode    translation\n----  -------------------  ---------  ---------------\n   1  Chinese Simplified   10E        核心系列第十版\n   2  Chinese Traditional  10E        核心系列第十版\n   3  French               10E        Dixième édition\n...\n\n\nCREATE TABLE \"sets\" (\nid bigint NOT NULL DEFAULT nextval('sets_id_seq'::regclass),\nbasesetsize bigint NULL,\nblock text NULL,\nbooster text NULL,\ncode text NULL,\nisfoilonly bigint NULL DEFAULT '0'::bigint,\nisforeignonly bigint NULL DEFAULT '0'::bigint,\nisnonfoilonly bigint NULL DEFAULT '0'::bigint,\nisonlineonly bigint NULL DEFAULT '0'::bigint,\nispartialpreview bigint NULL DEFAULT '0'::bigint,\nkeyrunecode text NULL,\nmcmid bigint NULL,\nmcmidextras bigint NULL,\nmcmname text NULL,\nmtgocode text NULL,\nname text NULL,\nparentcode text NULL,\nreleasedate date NULL,\ntcgplayergroupid bigint NULL,\ntotalsetsize bigint NULL,\ntype text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id    basesetsize  block     code      isfoilonly    isforeignonly    isnonfoilonly    isonlineonly    ispartialpreview  keyrunecode      mcmid    mcmidextras  mcmname         mtgocode    name               parentcode    releasedate      tcgplayergroupid    totalsetsize  type\n----  -------------  --------  ------  ------------  ---------------  ---------------  --------------  ------------------  -------------  -------  -------------  --------------  ----------  -----------------  ------------  -------------  ------------------  --------------  -------\n   1            383  Core Set  10E                0                0                0               0                   0  10E                 74            nan  Tenth Edition   10E         Tenth Edition                    2007-07-13                      1             508  core\n   2            302  Core Set  2ED                0                0                1               0                   0  2ED                nan            nan                              Unlimited Edition                1993-12-01                    115             302  core\n   3            332            2XM                0                0                0               0                   0  2XM               3204           3209  Double Masters  2XM         Double Masters                   2020-08-07                   2655             384  masters\n...\n", "preprocess_schema": "CREATE TABLE \"card_prices\" (\ntimestamp timestamp with time zone NOT NULL,\nuuid character varying NOT NULL,\nprice numeric NULL\n);\n\nFirst 3 rows:\ntimestamp                  uuid                                    price\n-------------------------  ------------------------------------  -------\n2022-07-10 02:18:39+08:00  5f8287b1-5bb6-5f4c-ad17-316a40d5bb0c      120\n2022-07-10 23:45:56+08:00  5f8287b1-5bb6-5f4c-ad17-316a40d5bb0c      125\n2022-07-12 16:00:10+08:00  5f8287b1-5bb6-5f4c-ad17-316a40d5bb0c      130\n...\n\n\nCREATE TABLE \"cards\" (\nid bigint NOT NULL DEFAULT nextval('cards_id_seq'::regclass),\nartist text NULL,\nasciiname text NULL,\navailability text NULL,\nbordercolor text NULL,\ncardkingdomfoilid text NULL,\ncardkingdomid text NULL,\ncoloridentity text NULL,\ncolorindicator text NULL,\ncolors text NULL,\nconvertedmanacost real NULL,\ndueldeck text NULL,\nedhrecrank bigint NULL,\nfaceconvertedmanacost real NULL,\nfacename text NULL,\nflavorname text NULL,\nflavortext text NULL,\nframeeffects text NULL,\nframeversion text NULL,\nhand text NULL,\nhasalternativedecklimit bigint NULL DEFAULT '0'::bigint,\nhascontentwarning bigint NULL DEFAULT '0'::bigint,\nhasfoil bigint NULL DEFAULT '0'::bigint,\nhasnonfoil bigint NULL DEFAULT '0'::bigint,\nisalternative bigint NULL DEFAULT '0'::bigint,\nisfullart bigint NULL DEFAULT '0'::bigint,\nisonlineonly bigint NULL DEFAULT '0'::bigint,\nisoversized bigint NULL DEFAULT '0'::bigint,\nispromo bigint NULL DEFAULT '0'::bigint,\nisreprint bigint NULL DEFAULT '0'::bigint,\nisreserved bigint NULL DEFAULT '0'::bigint,\nisstarter bigint NULL DEFAULT '0'::bigint,\nisstoryspotlight bigint NULL DEFAULT '0'::bigint,\nistextless bigint NULL DEFAULT '0'::bigint,\nistimeshifted bigint NULL DEFAULT '0'::bigint,\nkeywords text NULL,\nlayout text NULL,\nleadershipskills text NULL,\nlife text NULL,\nloyalty text NULL,\nmanacost text NULL,\nmcmid text NULL,\nmcmmetaid text NULL,\nmtgarenaid text NULL,\nmtgjsonv4id text NULL,\nmtgofoilid text NULL,\nmtgoid text NULL,\nmultiverseid text NULL,\nname text NULL,\nnumber text NULL,\noriginalreleasedate text NULL,\noriginaltext text NULL,\noriginaltype text NULL,\notherfaceids text NULL,\npower text NULL,\nprintings text NULL,\npromotypes text NULL,\npurchaseurls text NULL,\nrarity text NULL,\nscryfallid text NULL,\nscryfallillustrationid text NULL,\nscryfalloracleid text NULL,\nsetcode text NULL,\nside text NULL,\nsubtypes text NULL,\nsupertypes text NULL,\ntcgplayerproductid text NULL,\ntext text NULL,\ntoughness text NULL,\ntype text NULL,\ntypes text NULL,\nuuid text NULL,\nvariations text NULL,\nwatermark text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  artist        asciiname    availability    bordercolor    cardkingdomfoilid      cardkingdomid  coloridentity    colorindicator    colors      convertedmanacost  dueldeck      edhrecrank  faceconvertedmanacost    facename    flavorname    flavortext                                 frameeffects      frameversion  hand      hasalternativedecklimit    hascontentwarning    hasfoil    hasnonfoil    isalternative    isfullart    isonlineonly    isoversized    ispromo    isreprint    isreserved    isstarter    isstoryspotlight    istextless    istimeshifted  keywords      layout    leadershipskills    life    loyalty    manacost      mcmid    mcmmetaid  mtgarenaid    mtgjsonv4id                             mtgofoilid    mtgoid    multiverseid  name                 number  originalreleasedate    originaltext                                                                              originaltype             otherfaceids      power  printings                                              promotypes    purchaseurls                                                                                                                                                                          rarity    scryfallid                            scryfallillustrationid                scryfalloracleid                      setcode    side    subtypes      supertypes      tcgplayerproductid    toughness  type                     types     uuid                                  variations                            watermark\n----  ------------  -----------  --------------  -------------  -------------------  ---------------  ---------------  ----------------  --------  -------------------  ----------  ------------  -----------------------  ----------  ------------  -----------------------------------------  --------------  --------------  ------  -------------------------  -------------------  ---------  ------------  ---------------  -----------  --------------  -------------  ---------  -----------  ------------  -----------  ------------------  ------------  ---------------  ------------  --------  ------------------  ------  ---------  ----------  -------  -----------  ------------  ------------------------------------  ------------  --------  --------------  -----------------  --------  ---------------------  ----------------------------------------------------------------------------------------  -----------------------  --------------  -------  -----------------------------------------------------  ------------  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  --------  ------------------------------------  ------------------------------------  ------------------------------------  ---------  ------  ------------  ------------  --------------------  -----------  -----------------------  --------  ------------------------------------  ------------------------------------  -----------\n   1  Pete Venters               mtgo,paper      black                                        122719  W                                  W                           7                     15650                                                                                                                          2003                                  0                    0          0             1                0            0               0              0          0            1             0            0                   0             0                0  First strike  normal                                           {5}{W}{W}     16165          156                ad41be73-582f-58ed-abd4-a88c1f616ac3         27501     27500          130550  Ancestor's Chosen         1                         First strike (This creature deals combat damage before creatures without first strike.)   Creature - Human Cleric                        4  10E,JUD,UMA                                                          {'cardKingdom': 'https://mtgjson.com/links/9fb51af0ad6f0736', 'cardmarket': 'https://mtgjson.com/links/ace8861194ee0b6a', 'tcgplayer': 'https://mtgjson.com/links/4843cea124a0d515'}  uncommon  7a5cd03c-4227-4551-aa4b-7d119f0468b5  be2f7173-c8b7-4172-a388-9b2c6b3c16e5  fc2ccab7-cab1-4463-b73d-898070136d74  10E                Human,Cleric                               15032            4  Creature — Human Cleric  Creature  5f8287b1-5bb6-5f4c-ad17-316a40d5bb0c  b7c19924-b4bf-56fc-aa73-f586e940bd42\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     When Ancestor's Chosen comes into play, you gain 1 life for each card in your graveyard.\n   2  Volkan Baǵa                mtgo,paper      black                                        122720  W                                  W                           5                     12702                                                     Every tear shed is a drop of immortality.                            2003                                  0                    0          0             1                0            0               0              0          0            1             0            0                   0             0                0  Flying        normal                                           {4}{W}        16166          176                9eb2e54c-a12b-5e88-a9c0-d8c84c52d59c         26993     26992          129465  Angel of Mercy            2                         Flying (This creature can't be blocked except by creatures with flying or reach.)         Creature - Angel                               3  10E,8ED,9ED,DDC,DVD,IMA,INV,JMP,MB1,P02,PS11,PSAL,S99                {'cardKingdom': 'https://mtgjson.com/links/027095d094e58f5b', 'cardmarket': 'https://mtgjson.com/links/f6fb5098e1cd1b1e', 'tcgplayer': 'https://mtgjson.com/links/56c4b57293f350ef'}  uncommon  8f7980d4-da43-4d6d-ad16-14b8a34ae91d  e4d6c53f-e936-4be8-8b70-47c2be863b20  a2daaf32-dbfe-4618-892e-0da24f63a44a  10E                Angel                                      15033            3  Creature — Angel         Creature  57aaebc1-850c-503d-9f6e-bb8d00d8bf7c  8fd4e2eb-3eb4-50ea-856b-ef638fa47f8a\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     When Angel of Mercy comes into play, you gain 3 life.\n   3  Justin Sweet               mtgo,paper      black                                        122725  W                                  W                           4                     11081                                                                                                                          2003                                  0                    0          0             1                0            0               0              0          0            1             0            0                   0             0                0  Flying        normal                                           {3}{W}        16171          368                c0de6fd8-367a-50fb-b2f4-2b8fa5aeb7d9         27473     27472          129470  Aven Cloudchaser          7                         Flying (This creature can't be blocked except by creatures with flying or reach.)         Creature - Bird Soldier                        2  10E,8ED,9ED,ODY                                                      {'cardKingdom': 'https://mtgjson.com/links/9246105d88032a9f', 'cardmarket': 'https://mtgjson.com/links/dcdfe48e6a8f9e1e', 'tcgplayer': 'https://mtgjson.com/links/3ce595aabe276f80'}  common    407110e9-19af-4ff5-97b2-c03225031a73  2eb663cd-020a-46d8-a6d9-bb63d4b5c848  48bda7dd-d023-41e8-8c28-e0cfda0d07ca  10E                Bird,Soldier                               15045            2  Creature — Bird Soldier  Creature  8ac972b5-9f6e-5cc8-91c3-b9a40a98232e  6adaf14d-43e3-521a-adf1-960c808e5b1a\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     When Aven Cloudchaser comes into play, destroy target enchantment.\n...\n\n\nCREATE TABLE \"foreign_data\" (\nid bigint NOT NULL DEFAULT nextval('foreign_data_id_seq'::regclass),\nflavortext text NULL,\nlanguage text NULL,\nmultiverseid bigint NULL,\nname text NULL,\ntext text NULL,\ntype text NULL,\nuuid text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  language      multiverseid  name                      uuid\n----  ----------  --------------  ------------------------  ------------------------------------\n   1  German              148411  Ausgewählter der Ahnfrau  5f8287b1-5bb6-5f4c-ad17-316a40d5bb0c\n   2  Spanish             150317  Elegido de la Antepasada  5f8287b1-5bb6-5f4c-ad17-316a40d5bb0c\n   3  French              149934  Élu de l'Ancêtre          5f8287b1-5bb6-5f4c-ad17-316a40d5bb0c\n...\n\n\nCREATE TABLE \"legalities\" (\nid bigint NOT NULL DEFAULT nextval('legalities_id_seq'::regclass),\nformat text NULL,\nstatus text NULL,\nuuid text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  format     status    uuid\n----  ---------  --------  ------------------------------------\n   1  commander  Legal     5f8287b1-5bb6-5f4c-ad17-316a40d5bb0c\n   2  duel       Legal     5f8287b1-5bb6-5f4c-ad17-316a40d5bb0c\n   3  legacy     Legal     5f8287b1-5bb6-5f4c-ad17-316a40d5bb0c\n...\n\n\nCREATE TABLE \"rulings\" (\nid bigint NOT NULL DEFAULT nextval('rulings_id_seq'::regclass),\ndate date NULL,\ntext text NULL,\nuuid text NULL,\n    PRIMARY KEY (id),\n    FOREIGN KEY (uuid) REFERENCES cards(uuid)\n);\n\nFirst 3 rows:\n  id  date        uuid\n----  ----------  ------------------------------------\n   1  2007-07-15  6d268c95-c176-5766-9a46-c14f739aba1c\n   2  2007-02-01  56f4935b-f6c5-59b9-88bf-9bcce20247ce\n   3  2007-07-15  56f4935b-f6c5-59b9-88bf-9bcce20247ce\n...\n\n\nCREATE TABLE \"set_translations\" (\nid bigint NOT NULL DEFAULT nextval('set_translations_id_seq'::regclass),\nlanguage text NULL,\nsetcode text NULL,\ntranslation text NULL,\n    PRIMARY KEY (id),\n    FOREIGN KEY (setcode) REFERENCES sets(code)\n);\n\nFirst 3 rows:\n  id  language             setcode    translation\n----  -------------------  ---------  ---------------\n   1  Chinese Simplified   10E        核心系列第十版\n   2  Chinese Traditional  10E        核心系列第十版\n   3  French               10E        Dixième édition\n...\n\n\nCREATE TABLE \"sets\" (\nid bigint NOT NULL DEFAULT nextval('sets_id_seq'::regclass),\nbasesetsize bigint NULL,\nblock text NULL,\nbooster text NULL,\ncode text NULL,\nisfoilonly bigint NULL DEFAULT '0'::bigint,\nisforeignonly bigint NULL DEFAULT '0'::bigint,\nisnonfoilonly bigint NULL DEFAULT '0'::bigint,\nisonlineonly bigint NULL DEFAULT '0'::bigint,\nispartialpreview bigint NULL DEFAULT '0'::bigint,\nkeyrunecode text NULL,\nmcmid bigint NULL,\nmcmidextras bigint NULL,\nmcmname text NULL,\nmtgocode text NULL,\nname text NULL,\nparentcode text NULL,\nreleasedate date NULL,\ntcgplayergroupid bigint NULL,\ntotalsetsize bigint NULL,\ntype text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id    basesetsize  block     code      isfoilonly    isforeignonly    isnonfoilonly    isonlineonly    ispartialpreview  keyrunecode      mcmid    mcmidextras  mcmname         mtgocode    name               parentcode    releasedate      tcgplayergroupid    totalsetsize  type\n----  -------------  --------  ------  ------------  ---------------  ---------------  --------------  ------------------  -------------  -------  -------------  --------------  ----------  -----------------  ------------  -------------  ------------------  --------------  -------\n   1            383  Core Set  10E                0                0                0               0                   0  10E                 74            nan  Tenth Edition   10E         Tenth Edition                    2007-07-13                      1             508  core\n   2            302  Core Set  2ED                0                0                1               0                   0  2ED                nan            nan                              Unlimited Edition                1993-12-01                    115             302  core\n   3            332            2XM                0                0                0               0                   0  2XM               3204           3209  Double Masters  2XM         Double Masters                   2020-08-07                   2655             384  masters\n...\n", "sol_sql": ["CREATE INDEX IF NOT EXISTS price_uuid_time_desc ON card_prices (uuid ASC, timestamp DESC) INCLUDE (price) WHERE price > 0;;", "SELECT LEAST ((SELECT min(price) FROM card_prices WHERE timestamp >= '2022-07-12T15:30:00-00:00' AND uuid = '5f8287b1-5bb6-5f4c-ad17-316a40d5bb0c' AND price > 0), (SELECT price FROM card_prices WHERE timestamp < '2022-07-12T15:30:00-00:00' AND uuid = '5f8287b1-5bb6-5f4c-ad17-316a40d5bb0c' AND price > 0 ORDER BY timestamp DESC LIMIT 1));"], "test_cases": ["\ndef test_case(pred_sqls, sol_sqls, db_name, conn):\n    pred_sqls_result = execute_queries(pred_sqls, db_name, conn)[0]\n    sol_sqls_result = execute_queries(sol_sqls, db_name, conn)[0]\n    assert pred_sqls_result == sol_sqls_result, f\"Expected pred_result and sol_result are the same but pred_result is {pred_sqls_result} and sol_result is {sol_sqls_result}.\"\n    result = performance_compare_by_qep(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"performance_check returned {result} but expected 1.\"\n    return result\n    "]}
{"instance_id": "PostgreSQL_140", "dialect": "PostgreSQL", "version": "14.12", "db_id": "european_football_2", "query": "The football league management system requires a report that shows the performance of each team in terms of the number of matches played, victories, defeats, draws, and the total score. The score is calculated by awarding 3 points for a victory, 1 point for a draw, and 0 points for a defeat. The data is stored in the 'team' and 'match' tables. The 'team' table contains the team details, and the 'match' table contains the match details including the goals scored by the home and away teams. The task is to generate a report that includes the team name, number of matches, victories, defeats, draws, and the total score for each team. The user has attempted to write a query but is seeking a more efficient and cleaner solution.", "issue_sql": ["SELECT t.team_long_name, count(m.home_team_api_id) filter(WHERE t.team_api_id = m.home_team_api_id) + count(m.away_team_api_id) filter(WHERE t.team_api_id = m.away_team_api_id) as matches, count(m.home_team_api_id) filter(WHERE t.team_api_id = m.home_team_api_id AND m.home_team_goal > m.away_team_goal) + count(m.away_team_api_id) filter(WHERE t.team_api_id = m.away_team_api_id AND m.away_team_goal > m.home_team_goal) as victories, count(m.home_team_api_id) filter(WHERE t.team_api_id = m.home_team_api_id AND m.home_team_goal < m.away_team_goal) + count(m.away_team_api_id) filter(WHERE t.team_api_id = m.away_team_api_id AND m.away_team_goal < m.home_team_goal) as defeats, count(m.home_team_api_id) filter(WHERE t.team_api_id = m.home_team_api_id AND m.home_team_goal = m.away_team_goal) + count(m.away_team_api_id) filter(WHERE t.team_api_id = m.away_team_api_id AND m.away_team_goal = m.home_team_goal) as draws, ((count(m.home_team_api_id) filter(WHERE t.team_api_id = m.home_team_api_id AND m.home_team_goal > m.away_team_goal) + count(m.away_team_api_id) filter(WHERE t.team_api_id = m.away_team_api_id AND m.away_team_goal > m.home_team_goal)) * 3) + count(m.home_team_api_id) filter(WHERE t.team_api_id = m.home_team_api_id AND m.home_team_goal = m.away_team_goal) + count(m.away_team_api_id) filter(WHERE t.team_api_id = m.away_team_api_id AND m.away_team_goal = m.home_team_goal) as score FROM team t JOIN match m ON t.team_api_id IN (m.home_team_api_id, m.away_team_api_id) GROUP BY t.team_long_name ORDER BY victories DESC"], "preprocess_sql": [], "clean_up_sql": [], "category": "Efficiency", "original_schema": "CREATE TABLE \"country\" (\nid bigint NOT NULL DEFAULT nextval('country_id_seq'::regclass),\nname text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  name\n----  -------\n   1  Belgium\n1729  England\n4769  France\n...\n\n\nCREATE TABLE \"league\" (\nid bigint NOT NULL DEFAULT nextval('league_id_seq'::regclass),\ncountry_id bigint NULL,\nname text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id    country_id  name\n----  ------------  ----------------------\n   1             1  Belgium Jupiler League\n1729          1729  England Premier League\n4769          4769  France Ligue 1\n...\n\n\nCREATE TABLE \"match\" (\nid bigint NOT NULL DEFAULT nextval('match_id_seq'::regclass),\ncountry_id bigint NULL,\nleague_id bigint NULL,\nseason text NULL,\nstage bigint NULL,\ndate text NULL,\nmatch_api_id bigint NULL,\nhome_team_api_id bigint NULL,\naway_team_api_id bigint NULL,\nhome_team_goal bigint NULL,\naway_team_goal bigint NULL,\nhome_player_x1 bigint NULL,\nhome_player_x2 bigint NULL,\nhome_player_x3 bigint NULL,\nhome_player_x4 bigint NULL,\nhome_player_x5 bigint NULL,\nhome_player_x6 bigint NULL,\nhome_player_x7 bigint NULL,\nhome_player_x8 bigint NULL,\nhome_player_x9 bigint NULL,\nhome_player_x10 bigint NULL,\nhome_player_x11 bigint NULL,\naway_player_x1 bigint NULL,\naway_player_x2 bigint NULL,\naway_player_x3 bigint NULL,\naway_player_x4 bigint NULL,\naway_player_x5 bigint NULL,\naway_player_x6 bigint NULL,\naway_player_x7 bigint NULL,\naway_player_x8 bigint NULL,\naway_player_x9 bigint NULL,\naway_player_x10 bigint NULL,\naway_player_x11 bigint NULL,\nhome_player_y1 bigint NULL,\nhome_player_y2 bigint NULL,\nhome_player_y3 bigint NULL,\nhome_player_y4 bigint NULL,\nhome_player_y5 bigint NULL,\nhome_player_y6 bigint NULL,\nhome_player_y7 bigint NULL,\nhome_player_y8 bigint NULL,\nhome_player_y9 bigint NULL,\nhome_player_y10 bigint NULL,\nhome_player_y11 bigint NULL,\naway_player_y1 bigint NULL,\naway_player_y2 bigint NULL,\naway_player_y3 bigint NULL,\naway_player_y4 bigint NULL,\naway_player_y5 bigint NULL,\naway_player_y6 bigint NULL,\naway_player_y7 bigint NULL,\naway_player_y8 bigint NULL,\naway_player_y9 bigint NULL,\naway_player_y10 bigint NULL,\naway_player_y11 bigint NULL,\nhome_player_1 bigint NULL,\nhome_player_2 bigint NULL,\nhome_player_3 bigint NULL,\nhome_player_4 bigint NULL,\nhome_player_5 bigint NULL,\nhome_player_6 bigint NULL,\nhome_player_7 bigint NULL,\nhome_player_8 bigint NULL,\nhome_player_9 bigint NULL,\nhome_player_10 bigint NULL,\nhome_player_11 bigint NULL,\naway_player_1 bigint NULL,\naway_player_2 bigint NULL,\naway_player_3 bigint NULL,\naway_player_4 bigint NULL,\naway_player_5 bigint NULL,\naway_player_6 bigint NULL,\naway_player_7 bigint NULL,\naway_player_8 bigint NULL,\naway_player_9 bigint NULL,\naway_player_10 bigint NULL,\naway_player_11 bigint NULL,\ngoal text NULL,\nshoton text NULL,\nshotoff text NULL,\nfoulcommit text NULL,\ncard text NULL,\ncross text NULL,\ncorner text NULL,\npossession text NULL,\nb365h real NULL,\nb365d real NULL,\nb365a real NULL,\nbwh real NULL,\nbwd real NULL,\nbwa real NULL,\niwh real NULL,\niwd real NULL,\niwa real NULL,\nlbh real NULL,\nlbd real NULL,\nlba real NULL,\npsh real NULL,\npsd real NULL,\npsa real NULL,\nwhh real NULL,\nwhd real NULL,\nwha real NULL,\nsjh real NULL,\nsjd real NULL,\nsja real NULL,\nvch real NULL,\nvcd real NULL,\nvca real NULL,\ngbh real NULL,\ngbd real NULL,\ngba real NULL,\nbsh real NULL,\nbsd real NULL,\nbsa real NULL,\n    PRIMARY KEY (id),\n    FOREIGN KEY (away_player_10) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_11) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_1) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_2) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_3) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_4) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_5) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_6) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_7) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_8) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_9) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_team_api_id) REFERENCES team(team_api_id),\n    FOREIGN KEY (home_player_10) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_11) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_1) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_2) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_3) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_4) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_5) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_6) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_7) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_8) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_9) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_team_api_id) REFERENCES team(team_api_id)\n);\n\nFirst 3 rows:\n  id    country_id    league_id  season       stage  date                   match_api_id    home_team_api_id    away_team_api_id    home_team_goal    away_team_goal  home_player_x1    home_player_x2    home_player_x3    home_player_x4    home_player_x5    home_player_x6    home_player_x7    home_player_x8    home_player_x9    home_player_x10    home_player_x11    away_player_x1    away_player_x2    away_player_x3    away_player_x4    away_player_x5    away_player_x6    away_player_x7    away_player_x8    away_player_x9    away_player_x10    away_player_x11    home_player_y1    home_player_y2    home_player_y3    home_player_y4    home_player_y5    home_player_y6    home_player_y7    home_player_y8    home_player_y9    home_player_y10    home_player_y11    away_player_y1    away_player_y2    away_player_y3    away_player_y4    away_player_y5    away_player_y6    away_player_y7    away_player_y8    away_player_y9    away_player_y10    away_player_y11    home_player_1    home_player_2    home_player_3    home_player_4    home_player_5    home_player_6    home_player_7    home_player_8    home_player_9    home_player_10    home_player_11    away_player_1    away_player_2    away_player_3    away_player_4    away_player_5    away_player_6    away_player_7    away_player_8    away_player_9    away_player_10    away_player_11      b365h    b365d    b365a    bwh    bwd    bwa    iwh    iwd    iwa    lbh    lbd    lba  psh    psd    psa      whh    whd    wha    sjh    sjd    sja    vch    vcd    vca    gbh    gbd    gba    bsh    bsd    bsa\n----  ------------  -----------  ---------  -------  -------------------  --------------  ------------------  ------------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  -----------------  -----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  -----------------  -----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  -----------------  -----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  -----------------  -----------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ----------------  ----------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ----------------  ----------------  -------  -------  -------  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----\n   1             1            1  2008/2009        1  2008-08-17 00:00:00          492473                9987                9993                 1                 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               1.73      3.4     5      1.75   3.35   4.2    1.85    3.2    3.5    1.8    3.3   3.75                        1.7    3.3    4.33   1.9     3.3    4     1.65   3.4    4.5    1.78   3.25   4      1.73   3.4    4.2\n   2             1            1  2008/2009        1  2008-08-16 00:00:00          492474               10000                9994                 0                 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               1.95      3.2     3.6    1.8    3.3    3.95   1.9     3.2    3.5    1.9    3.2   3.5                         1.83   3.3    3.6    1.95    3.3    3.8   2      3.25   3.25   1.85   3.25   3.75   1.91   3.25   3.6\n   3             1            1  2008/2009        1  2008-08-16 00:00:00          492475                9984                8635                 0                 3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               2.38      3.3     2.75   2.4    3.3    2.55   2.6     3.1    2.3    2.5    3.2   2.5                         2.5    3.25   2.4    2.63    3.3    2.5   2.35   3.25   2.65   2.5    3.2    2.5    2.3    3.2    2.75\n...\n\n\nCREATE TABLE \"player\" (\nid bigint NOT NULL DEFAULT nextval('player_id_seq'::regclass),\nplayer_api_id bigint NULL,\nplayer_name text NULL,\nplayer_fifa_api_id bigint NULL,\nbirthday text NULL,\nheight bigint NULL,\nweight bigint NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id    player_api_id  player_name           player_fifa_api_id  birthday               height    weight\n----  ---------------  ------------------  --------------------  -------------------  --------  --------\n   1           505942  Aaron Appindangoye                218353  1992-02-29 00:00:00       182       187\n   2           155782  Aaron Cresswell                   189615  1989-12-15 00:00:00       170       146\n   3           162549  Aaron Doran                       186170  1991-05-13 00:00:00       170       163\n...\n\n\nCREATE TABLE \"player_attributes\" (\nid bigint NOT NULL DEFAULT nextval('player_attributes_id_seq'::regclass),\nplayer_fifa_api_id bigint NULL,\nplayer_api_id bigint NULL,\ndate text NULL,\noverall_rating bigint NULL,\npotential bigint NULL,\npreferred_foot text NULL,\nattacking_work_rate text NULL,\ndefensive_work_rate text NULL,\ncrossing bigint NULL,\nfinishing bigint NULL,\nheading_accuracy bigint NULL,\nshort_passing bigint NULL,\nvolleys bigint NULL,\ndribbling bigint NULL,\ncurve bigint NULL,\nfree_kick_accuracy bigint NULL,\nlong_passing bigint NULL,\nball_control bigint NULL,\nacceleration bigint NULL,\nsprint_speed bigint NULL,\nagility bigint NULL,\nreactions bigint NULL,\nbalance bigint NULL,\nshot_power bigint NULL,\njumping bigint NULL,\nstamina bigint NULL,\nstrength bigint NULL,\nlong_shots bigint NULL,\naggression bigint NULL,\ninterceptions bigint NULL,\npositioning bigint NULL,\nvision bigint NULL,\npenalties bigint NULL,\nmarking bigint NULL,\nstanding_tackle bigint NULL,\nsliding_tackle bigint NULL,\ngk_diving bigint NULL,\ngk_handling bigint NULL,\ngk_kicking bigint NULL,\ngk_positioning bigint NULL,\ngk_reflexes bigint NULL,\n    PRIMARY KEY (id),\n    FOREIGN KEY (player_api_id) REFERENCES player(player_api_id)\n);\n\nFirst 3 rows:\n  id    player_fifa_api_id    player_api_id  date                   overall_rating    potential  preferred_foot    attacking_work_rate    defensive_work_rate      crossing    finishing    heading_accuracy    short_passing    volleys    dribbling    curve    free_kick_accuracy    long_passing    ball_control    acceleration    sprint_speed    agility    reactions    balance    shot_power    jumping    stamina    strength    long_shots    aggression    interceptions    positioning    vision    penalties    marking    standing_tackle    sliding_tackle    gk_diving    gk_handling    gk_kicking    gk_positioning    gk_reflexes\n----  --------------------  ---------------  -------------------  ----------------  -----------  ----------------  ---------------------  ---------------------  ----------  -----------  ------------------  ---------------  ---------  -----------  -------  --------------------  --------------  --------------  --------------  --------------  ---------  -----------  ---------  ------------  ---------  ---------  ----------  ------------  ------------  ---------------  -------------  --------  -----------  ---------  -----------------  ----------------  -----------  -------------  ------------  ----------------  -------------\n   1                218353           505942  2016-02-18 00:00:00                67           71  right             medium                 medium                         49           44                  71               61         44           51       45                    39              64              49              60              64         59           47         65            55         58         54          76            35            71               70             45        54           48         65                 69                69            6             11            10                 8              8\n   2                218353           505942  2015-11-19 00:00:00                67           71  right             medium                 medium                         49           44                  71               61         44           51       45                    39              64              49              60              64         59           47         65            55         58         54          76            35            71               70             45        54           48         65                 69                69            6             11            10                 8              8\n   3                218353           505942  2015-09-21 00:00:00                62           66  right             medium                 medium                         49           44                  71               61         44           51       45                    39              64              49              60              64         59           47         65            55         58         54          76            35            63               41             45        54           48         65                 66                69            6             11            10                 8              8\n...\n\n\nCREATE TABLE \"team\" (\nid bigint NOT NULL DEFAULT nextval('team_id_seq'::regclass),\nteam_api_id bigint NULL,\nteam_fifa_api_id bigint NULL,\nteam_long_name text NULL,\nteam_short_name text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id    team_api_id    team_fifa_api_id  team_long_name    team_short_name\n----  -------------  ------------------  ----------------  -----------------\n   1           9987                 673  KRC Genk          GEN\n   2           9993                 675  Beerschot AC      BAC\n   3          10000               15005  SV Zulte-Waregem  ZUL\n...\n\n\nCREATE TABLE \"team_attributes\" (\nid bigint NOT NULL DEFAULT nextval('team_attributes_id_seq'::regclass),\nteam_fifa_api_id bigint NULL,\nteam_api_id bigint NULL,\ndate text NULL,\nbuildupplayspeed bigint NULL,\nbuildupplayspeedclass text NULL,\nbuildupplaydribbling bigint NULL,\nbuildupplaydribblingclass text NULL,\nbuildupplaypassing bigint NULL,\nbuildupplaypassingclass text NULL,\nbuildupplaypositioningclass text NULL,\nchancecreationpassing bigint NULL,\nchancecreationpassingclass text NULL,\nchancecreationcrossing bigint NULL,\nchancecreationcrossingclass text NULL,\nchancecreationshooting bigint NULL,\nchancecreationshootingclass text NULL,\nchancecreationpositioningclass text NULL,\ndefencepressure bigint NULL,\ndefencepressureclass text NULL,\ndefenceaggression bigint NULL,\ndefenceaggressionclass text NULL,\ndefenceteamwidth bigint NULL,\ndefenceteamwidthclass text NULL,\ndefencedefenderlineclass text NULL,\n    PRIMARY KEY (id),\n    FOREIGN KEY (team_api_id) REFERENCES team(team_api_id)\n);\n\nFirst 3 rows:\n  id    team_fifa_api_id    team_api_id  date                   buildupplayspeed  buildupplayspeedclass      buildupplaydribbling  buildupplaydribblingclass      buildupplaypassing  buildupplaypassingclass    buildupplaypositioningclass      chancecreationpassing  chancecreationpassingclass      chancecreationcrossing  chancecreationcrossingclass      chancecreationshooting  chancecreationshootingclass    chancecreationpositioningclass      defencepressure  defencepressureclass      defenceaggression  defenceaggressionclass      defenceteamwidth  defenceteamwidthclass    defencedefenderlineclass\n----  ------------------  -------------  -------------------  ------------------  -----------------------  ----------------------  ---------------------------  --------------------  -------------------------  -----------------------------  -----------------------  ----------------------------  ------------------------  -----------------------------  ------------------------  -----------------------------  --------------------------------  -----------------  ----------------------  -------------------  ------------------------  ------------------  -----------------------  --------------------------\n   1                 434           9930  2010-02-22 00:00:00                  60  Balanced                                    nan  Little                                         50  Mixed                      Organised                                           60  Normal                                              65  Normal                                               55  Normal                         Organised                                        50  Medium                                   55  Press                                     45  Normal                   Cover\n   2                 434           9930  2014-09-19 00:00:00                  52  Balanced                                     48  Normal                                         56  Mixed                      Organised                                           54  Normal                                              63  Normal                                               64  Normal                         Organised                                        47  Medium                                   44  Press                                     54  Normal                   Cover\n   3                 434           9930  2015-09-10 00:00:00                  47  Balanced                                     41  Normal                                         54  Mixed                      Organised                                           54  Normal                                              63  Normal                                               64  Normal                         Organised                                        47  Medium                                   44  Press                                     54  Normal                   Cover\n...\n", "preprocess_schema": "CREATE TABLE \"country\" (\nid bigint NOT NULL DEFAULT nextval('country_id_seq'::regclass),\nname text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  name\n----  -------\n   1  Belgium\n1729  England\n4769  France\n...\n\n\nCREATE TABLE \"league\" (\nid bigint NOT NULL DEFAULT nextval('league_id_seq'::regclass),\ncountry_id bigint NULL,\nname text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id    country_id  name\n----  ------------  ----------------------\n   1             1  Belgium Jupiler League\n1729          1729  England Premier League\n4769          4769  France Ligue 1\n...\n\n\nCREATE TABLE \"match\" (\nid bigint NOT NULL DEFAULT nextval('match_id_seq'::regclass),\ncountry_id bigint NULL,\nleague_id bigint NULL,\nseason text NULL,\nstage bigint NULL,\ndate text NULL,\nmatch_api_id bigint NULL,\nhome_team_api_id bigint NULL,\naway_team_api_id bigint NULL,\nhome_team_goal bigint NULL,\naway_team_goal bigint NULL,\nhome_player_x1 bigint NULL,\nhome_player_x2 bigint NULL,\nhome_player_x3 bigint NULL,\nhome_player_x4 bigint NULL,\nhome_player_x5 bigint NULL,\nhome_player_x6 bigint NULL,\nhome_player_x7 bigint NULL,\nhome_player_x8 bigint NULL,\nhome_player_x9 bigint NULL,\nhome_player_x10 bigint NULL,\nhome_player_x11 bigint NULL,\naway_player_x1 bigint NULL,\naway_player_x2 bigint NULL,\naway_player_x3 bigint NULL,\naway_player_x4 bigint NULL,\naway_player_x5 bigint NULL,\naway_player_x6 bigint NULL,\naway_player_x7 bigint NULL,\naway_player_x8 bigint NULL,\naway_player_x9 bigint NULL,\naway_player_x10 bigint NULL,\naway_player_x11 bigint NULL,\nhome_player_y1 bigint NULL,\nhome_player_y2 bigint NULL,\nhome_player_y3 bigint NULL,\nhome_player_y4 bigint NULL,\nhome_player_y5 bigint NULL,\nhome_player_y6 bigint NULL,\nhome_player_y7 bigint NULL,\nhome_player_y8 bigint NULL,\nhome_player_y9 bigint NULL,\nhome_player_y10 bigint NULL,\nhome_player_y11 bigint NULL,\naway_player_y1 bigint NULL,\naway_player_y2 bigint NULL,\naway_player_y3 bigint NULL,\naway_player_y4 bigint NULL,\naway_player_y5 bigint NULL,\naway_player_y6 bigint NULL,\naway_player_y7 bigint NULL,\naway_player_y8 bigint NULL,\naway_player_y9 bigint NULL,\naway_player_y10 bigint NULL,\naway_player_y11 bigint NULL,\nhome_player_1 bigint NULL,\nhome_player_2 bigint NULL,\nhome_player_3 bigint NULL,\nhome_player_4 bigint NULL,\nhome_player_5 bigint NULL,\nhome_player_6 bigint NULL,\nhome_player_7 bigint NULL,\nhome_player_8 bigint NULL,\nhome_player_9 bigint NULL,\nhome_player_10 bigint NULL,\nhome_player_11 bigint NULL,\naway_player_1 bigint NULL,\naway_player_2 bigint NULL,\naway_player_3 bigint NULL,\naway_player_4 bigint NULL,\naway_player_5 bigint NULL,\naway_player_6 bigint NULL,\naway_player_7 bigint NULL,\naway_player_8 bigint NULL,\naway_player_9 bigint NULL,\naway_player_10 bigint NULL,\naway_player_11 bigint NULL,\ngoal text NULL,\nshoton text NULL,\nshotoff text NULL,\nfoulcommit text NULL,\ncard text NULL,\ncross text NULL,\ncorner text NULL,\npossession text NULL,\nb365h real NULL,\nb365d real NULL,\nb365a real NULL,\nbwh real NULL,\nbwd real NULL,\nbwa real NULL,\niwh real NULL,\niwd real NULL,\niwa real NULL,\nlbh real NULL,\nlbd real NULL,\nlba real NULL,\npsh real NULL,\npsd real NULL,\npsa real NULL,\nwhh real NULL,\nwhd real NULL,\nwha real NULL,\nsjh real NULL,\nsjd real NULL,\nsja real NULL,\nvch real NULL,\nvcd real NULL,\nvca real NULL,\ngbh real NULL,\ngbd real NULL,\ngba real NULL,\nbsh real NULL,\nbsd real NULL,\nbsa real NULL,\n    PRIMARY KEY (id),\n    FOREIGN KEY (away_player_10) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_11) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_1) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_2) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_3) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_4) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_5) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_6) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_7) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_8) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_9) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_team_api_id) REFERENCES team(team_api_id),\n    FOREIGN KEY (home_player_10) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_11) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_1) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_2) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_3) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_4) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_5) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_6) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_7) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_8) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_9) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_team_api_id) REFERENCES team(team_api_id)\n);\n\nFirst 3 rows:\n  id    country_id    league_id  season       stage  date                   match_api_id    home_team_api_id    away_team_api_id    home_team_goal    away_team_goal  home_player_x1    home_player_x2    home_player_x3    home_player_x4    home_player_x5    home_player_x6    home_player_x7    home_player_x8    home_player_x9    home_player_x10    home_player_x11    away_player_x1    away_player_x2    away_player_x3    away_player_x4    away_player_x5    away_player_x6    away_player_x7    away_player_x8    away_player_x9    away_player_x10    away_player_x11    home_player_y1    home_player_y2    home_player_y3    home_player_y4    home_player_y5    home_player_y6    home_player_y7    home_player_y8    home_player_y9    home_player_y10    home_player_y11    away_player_y1    away_player_y2    away_player_y3    away_player_y4    away_player_y5    away_player_y6    away_player_y7    away_player_y8    away_player_y9    away_player_y10    away_player_y11    home_player_1    home_player_2    home_player_3    home_player_4    home_player_5    home_player_6    home_player_7    home_player_8    home_player_9    home_player_10    home_player_11    away_player_1    away_player_2    away_player_3    away_player_4    away_player_5    away_player_6    away_player_7    away_player_8    away_player_9    away_player_10    away_player_11      b365h    b365d    b365a    bwh    bwd    bwa    iwh    iwd    iwa    lbh    lbd    lba  psh    psd    psa      whh    whd    wha    sjh    sjd    sja    vch    vcd    vca    gbh    gbd    gba    bsh    bsd    bsa\n----  ------------  -----------  ---------  -------  -------------------  --------------  ------------------  ------------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  -----------------  -----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  -----------------  -----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  -----------------  -----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  -----------------  -----------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ----------------  ----------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ----------------  ----------------  -------  -------  -------  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----\n   1             1            1  2008/2009        1  2008-08-17 00:00:00          492473                9987                9993                 1                 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               1.73      3.4     5      1.75   3.35   4.2    1.85    3.2    3.5    1.8    3.3   3.75                        1.7    3.3    4.33   1.9     3.3    4     1.65   3.4    4.5    1.78   3.25   4      1.73   3.4    4.2\n   2             1            1  2008/2009        1  2008-08-16 00:00:00          492474               10000                9994                 0                 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               1.95      3.2     3.6    1.8    3.3    3.95   1.9     3.2    3.5    1.9    3.2   3.5                         1.83   3.3    3.6    1.95    3.3    3.8   2      3.25   3.25   1.85   3.25   3.75   1.91   3.25   3.6\n   3             1            1  2008/2009        1  2008-08-16 00:00:00          492475                9984                8635                 0                 3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               2.38      3.3     2.75   2.4    3.3    2.55   2.6     3.1    2.3    2.5    3.2   2.5                         2.5    3.25   2.4    2.63    3.3    2.5   2.35   3.25   2.65   2.5    3.2    2.5    2.3    3.2    2.75\n...\n\n\nCREATE TABLE \"player\" (\nid bigint NOT NULL DEFAULT nextval('player_id_seq'::regclass),\nplayer_api_id bigint NULL,\nplayer_name text NULL,\nplayer_fifa_api_id bigint NULL,\nbirthday text NULL,\nheight bigint NULL,\nweight bigint NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id    player_api_id  player_name           player_fifa_api_id  birthday               height    weight\n----  ---------------  ------------------  --------------------  -------------------  --------  --------\n   1           505942  Aaron Appindangoye                218353  1992-02-29 00:00:00       182       187\n   2           155782  Aaron Cresswell                   189615  1989-12-15 00:00:00       170       146\n   3           162549  Aaron Doran                       186170  1991-05-13 00:00:00       170       163\n...\n\n\nCREATE TABLE \"player_attributes\" (\nid bigint NOT NULL DEFAULT nextval('player_attributes_id_seq'::regclass),\nplayer_fifa_api_id bigint NULL,\nplayer_api_id bigint NULL,\ndate text NULL,\noverall_rating bigint NULL,\npotential bigint NULL,\npreferred_foot text NULL,\nattacking_work_rate text NULL,\ndefensive_work_rate text NULL,\ncrossing bigint NULL,\nfinishing bigint NULL,\nheading_accuracy bigint NULL,\nshort_passing bigint NULL,\nvolleys bigint NULL,\ndribbling bigint NULL,\ncurve bigint NULL,\nfree_kick_accuracy bigint NULL,\nlong_passing bigint NULL,\nball_control bigint NULL,\nacceleration bigint NULL,\nsprint_speed bigint NULL,\nagility bigint NULL,\nreactions bigint NULL,\nbalance bigint NULL,\nshot_power bigint NULL,\njumping bigint NULL,\nstamina bigint NULL,\nstrength bigint NULL,\nlong_shots bigint NULL,\naggression bigint NULL,\ninterceptions bigint NULL,\npositioning bigint NULL,\nvision bigint NULL,\npenalties bigint NULL,\nmarking bigint NULL,\nstanding_tackle bigint NULL,\nsliding_tackle bigint NULL,\ngk_diving bigint NULL,\ngk_handling bigint NULL,\ngk_kicking bigint NULL,\ngk_positioning bigint NULL,\ngk_reflexes bigint NULL,\n    PRIMARY KEY (id),\n    FOREIGN KEY (player_api_id) REFERENCES player(player_api_id)\n);\n\nFirst 3 rows:\n  id    player_fifa_api_id    player_api_id  date                   overall_rating    potential  preferred_foot    attacking_work_rate    defensive_work_rate      crossing    finishing    heading_accuracy    short_passing    volleys    dribbling    curve    free_kick_accuracy    long_passing    ball_control    acceleration    sprint_speed    agility    reactions    balance    shot_power    jumping    stamina    strength    long_shots    aggression    interceptions    positioning    vision    penalties    marking    standing_tackle    sliding_tackle    gk_diving    gk_handling    gk_kicking    gk_positioning    gk_reflexes\n----  --------------------  ---------------  -------------------  ----------------  -----------  ----------------  ---------------------  ---------------------  ----------  -----------  ------------------  ---------------  ---------  -----------  -------  --------------------  --------------  --------------  --------------  --------------  ---------  -----------  ---------  ------------  ---------  ---------  ----------  ------------  ------------  ---------------  -------------  --------  -----------  ---------  -----------------  ----------------  -----------  -------------  ------------  ----------------  -------------\n   1                218353           505942  2016-02-18 00:00:00                67           71  right             medium                 medium                         49           44                  71               61         44           51       45                    39              64              49              60              64         59           47         65            55         58         54          76            35            71               70             45        54           48         65                 69                69            6             11            10                 8              8\n   2                218353           505942  2015-11-19 00:00:00                67           71  right             medium                 medium                         49           44                  71               61         44           51       45                    39              64              49              60              64         59           47         65            55         58         54          76            35            71               70             45        54           48         65                 69                69            6             11            10                 8              8\n   3                218353           505942  2015-09-21 00:00:00                62           66  right             medium                 medium                         49           44                  71               61         44           51       45                    39              64              49              60              64         59           47         65            55         58         54          76            35            63               41             45        54           48         65                 66                69            6             11            10                 8              8\n...\n\n\nCREATE TABLE \"team\" (\nid bigint NOT NULL DEFAULT nextval('team_id_seq'::regclass),\nteam_api_id bigint NULL,\nteam_fifa_api_id bigint NULL,\nteam_long_name text NULL,\nteam_short_name text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id    team_api_id    team_fifa_api_id  team_long_name    team_short_name\n----  -------------  ------------------  ----------------  -----------------\n   1           9987                 673  KRC Genk          GEN\n   2           9993                 675  Beerschot AC      BAC\n   3          10000               15005  SV Zulte-Waregem  ZUL\n...\n\n\nCREATE TABLE \"team_attributes\" (\nid bigint NOT NULL DEFAULT nextval('team_attributes_id_seq'::regclass),\nteam_fifa_api_id bigint NULL,\nteam_api_id bigint NULL,\ndate text NULL,\nbuildupplayspeed bigint NULL,\nbuildupplayspeedclass text NULL,\nbuildupplaydribbling bigint NULL,\nbuildupplaydribblingclass text NULL,\nbuildupplaypassing bigint NULL,\nbuildupplaypassingclass text NULL,\nbuildupplaypositioningclass text NULL,\nchancecreationpassing bigint NULL,\nchancecreationpassingclass text NULL,\nchancecreationcrossing bigint NULL,\nchancecreationcrossingclass text NULL,\nchancecreationshooting bigint NULL,\nchancecreationshootingclass text NULL,\nchancecreationpositioningclass text NULL,\ndefencepressure bigint NULL,\ndefencepressureclass text NULL,\ndefenceaggression bigint NULL,\ndefenceaggressionclass text NULL,\ndefenceteamwidth bigint NULL,\ndefenceteamwidthclass text NULL,\ndefencedefenderlineclass text NULL,\n    PRIMARY KEY (id),\n    FOREIGN KEY (team_api_id) REFERENCES team(team_api_id)\n);\n\nFirst 3 rows:\n  id    team_fifa_api_id    team_api_id  date                   buildupplayspeed  buildupplayspeedclass      buildupplaydribbling  buildupplaydribblingclass      buildupplaypassing  buildupplaypassingclass    buildupplaypositioningclass      chancecreationpassing  chancecreationpassingclass      chancecreationcrossing  chancecreationcrossingclass      chancecreationshooting  chancecreationshootingclass    chancecreationpositioningclass      defencepressure  defencepressureclass      defenceaggression  defenceaggressionclass      defenceteamwidth  defenceteamwidthclass    defencedefenderlineclass\n----  ------------------  -------------  -------------------  ------------------  -----------------------  ----------------------  ---------------------------  --------------------  -------------------------  -----------------------------  -----------------------  ----------------------------  ------------------------  -----------------------------  ------------------------  -----------------------------  --------------------------------  -----------------  ----------------------  -------------------  ------------------------  ------------------  -----------------------  --------------------------\n   1                 434           9930  2010-02-22 00:00:00                  60  Balanced                                    nan  Little                                         50  Mixed                      Organised                                           60  Normal                                              65  Normal                                               55  Normal                         Organised                                        50  Medium                                   55  Press                                     45  Normal                   Cover\n   2                 434           9930  2014-09-19 00:00:00                  52  Balanced                                     48  Normal                                         56  Mixed                      Organised                                           54  Normal                                              63  Normal                                               64  Normal                         Organised                                        47  Medium                                   44  Press                                     54  Normal                   Cover\n   3                 434           9930  2015-09-10 00:00:00                  47  Balanced                                     41  Normal                                         54  Mixed                      Organised                                           54  Normal                                              63  Normal                                               64  Normal                         Organised                                        47  Medium                                   44  Press                                     54  Normal                   Cover\n...\n", "sol_sql": ["WITH norm_matches AS ( SELECT id AS match_id, home_team_api_id AS team_id, home_team_goal AS goals, CASE WHEN home_team_goal > away_team_goal THEN 'W' WHEN home_team_goal = away_team_goal THEN 'D' WHEN home_team_goal < away_team_goal THEN 'L' END AS outcome FROM match UNION ALL SELECT id AS match_id, away_team_api_id AS team_id, away_team_goal AS goals, CASE WHEN home_team_goal > away_team_goal THEN 'L' WHEN home_team_goal = away_team_goal THEN 'D' WHEN home_team_goal < away_team_goal THEN 'W' END AS outcome FROM match ), points (outcome, value) AS ( VALUES ('W', 3), ('D', 1), ('L', 0) ) SELECT t.team_long_name, count(1) AS matches, count(1) filter (WHERE m.outcome = 'W') AS victories, count(1) filter (WHERE m.outcome = 'L') AS defeats, count(1) filter (WHERE m.outcome = 'D') AS draws, sum(p.value) AS score FROM team t JOIN norm_matches m ON m.team_id = t.team_api_id JOIN points p ON p.outcome = m.outcome GROUP BY t.team_long_name ORDER BY t.team_long_name"], "test_cases": ["\ndef test_case(pred_sqls, sol_sqls, db_name, conn):\n    pred_sqls = remove_distinct(pred_sqls)\n    sol_sqls = remove_distinct(sol_sqls)\n    result = ex_base(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"ex_base returned {result} but expected 1.\"\n    result = performance_compare_by_qep(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"performance_check returned {result} but expected 1.\"\n    return result\n    "]}
{"instance_id": "PostgreSQL_164", "dialect": "PostgreSQL", "version": "14.12", "db_id": "superhero", "query": "Suppose we have a superhero event schedule where each superhero is scheduled to perform at different events. We have a table `superhero_events` that records the start and end times of these events. We want to retrieve a list of events that: Started within the last 3 days (inclusive) and end before 5 hours into the future (exclusive). The results should be ordered so that events that started in the past appear first, followed by events that start in the future. We can do something like the following query, but it is slow and needs optimization. Is there a way to use indexes to make this faster?", "issue_sql": ["DROP INDEX IF EXISTS idx_a;", "SELECT * from superhero_events WHERE start_time >= Now()::timestamp - INTERVAL '3 days' AND end_time < now()+'5 hours'::interval ORDER BY CASE WHEN now()+'5 hours'::interval > Now()::timestamp AND start_time < Now()::timestamp THEN 1 WHEN start_time < Now()::timestamp THEN 2 ELSE 3 END;"], "preprocess_sql": ["CREATE TABLE superhero_events (hero_id bigint NOT NULL, start_time timestamp without time zone NOT NULL, end_time timestamp without time zone NOT NULL);", "ALTER TABLE superhero_events ADD COLUMN event_id SERIAL PRIMARY KEY;", "ALTER TABLE superhero_events ADD CONSTRAINT chk_time_order CHECK (start_time < end_time);", "INSERT INTO superhero_events (hero_id, start_time, end_time) SELECT s.id, NOW() - INTERVAL '1 hour' * (random()+0.5), NOW() + INTERVAL '1 hour' * (random()+0.5) FROM superhero s ORDER BY random() LIMIT 250;", "INSERT INTO superhero_events (hero_id, start_time, end_time) SELECT s.id, NOW() + INTERVAL '5 hour' * (random()+0.5), NOW() + INTERVAL '5 hour' * (random()+0.5) + INTERVAL '2 hour' * (random()+0.5) FROM superhero s ORDER BY random() LIMIT 500;", "INSERT INTO superhero_events (hero_id, start_time, end_time) SELECT s.id, NOW() - INTERVAL '3 day' * (random()+0.5), (NOW() - INTERVAL '3 day' * (random()+0.5)) + INTERVAL '3 hour' * (random()+0.5) FROM superhero s ORDER BY random() LIMIT 1500;", "INSERT INTO superhero_events (hero_id, start_time, end_time) SELECT s.id, NOW() - INTERVAL '15 day' * (random()+0.5) - INTERVAL '3 day', (NOW() - INTERVAL '15 day' * (random()+0.5) - INTERVAL '3 day') + INTERVAL '4 hour' * (random()+0.5) FROM superhero s ORDER BY random() LIMIT 2750;"], "clean_up_sql": ["DROP TABLE IF EXISTS superhero_events;"], "category": "Efficiency", "original_schema": "CREATE TABLE \"alignment\" (\nid bigint NOT NULL,\nalignment text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  alignment\n----  -----------\n   1  Good\n   2  Bad\n   3  Neutral\n...\n\n\nCREATE TABLE \"attribute\" (\nid bigint NOT NULL,\nattribute_name text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  attribute_name\n----  ----------------\n   1  Intelligence\n   2  Strength\n   3  Speed\n...\n\n\nCREATE TABLE \"colour\" (\nid bigint NOT NULL,\ncolour text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  colour\n----  ---------\n   1  No Colour\n   2  Amber\n   3  Auburn\n...\n\n\nCREATE TABLE \"gender\" (\nid bigint NOT NULL,\ngender text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  gender\n----  --------\n   1  Male\n   2  Female\n   3  N/A\n...\n\n\nCREATE TABLE \"hero_attribute\" (\nhero_id bigint NULL,\nattribute_id bigint NULL,\nattribute_value bigint NULL,\n    FOREIGN KEY (attribute_id) REFERENCES attribute(id),\n    FOREIGN KEY (hero_id) REFERENCES superhero(id)\n);\n\nFirst 3 rows:\n  hero_id    attribute_id    attribute_value\n---------  --------------  -----------------\n        1               1                 80\n        2               1                 75\n        3               1                 95\n...\n\n\nCREATE TABLE \"hero_power\" (\nhero_id bigint NULL,\npower_id bigint NULL,\n    FOREIGN KEY (hero_id) REFERENCES superhero(id),\n    FOREIGN KEY (power_id) REFERENCES superpower(id)\n);\n\nFirst 3 rows:\n  hero_id    power_id\n---------  ----------\n        1           1\n        1          18\n        1          26\n...\n\n\nCREATE TABLE \"publisher\" (\nid bigint NOT NULL,\npublisher_name text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  publisher_name\n----  -----------------\n   1\n   2  ABC Studios\n   3  Dark Horse Comics\n...\n\n\nCREATE TABLE \"race\" (\nid bigint NOT NULL,\nrace text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  race\n----  ------\n   1  -\n   2  Alien\n   3  Alpha\n...\n\n\nCREATE TABLE \"superhero\" (\nid bigint NOT NULL,\nsuperhero_name text NULL,\nfull_name text NULL,\ngender_id bigint NULL,\neye_colour_id bigint NULL,\nhair_colour_id bigint NULL,\nskin_colour_id bigint NULL,\nrace_id bigint NULL,\npublisher_id bigint NULL,\nalignment_id bigint NULL,\nheight_cm bigint NULL,\nweight_kg bigint NULL,\n    PRIMARY KEY (id),\n    FOREIGN KEY (alignment_id) REFERENCES alignment(id),\n    FOREIGN KEY (eye_colour_id) REFERENCES colour(id),\n    FOREIGN KEY (gender_id) REFERENCES gender(id),\n    FOREIGN KEY (hair_colour_id) REFERENCES colour(id),\n    FOREIGN KEY (publisher_id) REFERENCES publisher(id),\n    FOREIGN KEY (race_id) REFERENCES race(id),\n    FOREIGN KEY (skin_colour_id) REFERENCES colour(id)\n);\n\nFirst 3 rows:\n  id  superhero_name    full_name                 gender_id    eye_colour_id    hair_colour_id    skin_colour_id    race_id    publisher_id    alignment_id    height_cm    weight_kg\n----  ----------------  ----------------------  -----------  ---------------  ----------------  ----------------  ---------  --------------  --------------  -----------  -----------\n   1  3-D Man           Charles Chandler                  1                9                13                 1          1              13               1          188           90\n   2  A-Bomb            Richard Milhouse Jones            1               33                 1                 1         24              13               1          203          441\n   3  Abe Sapien        Abraham Sapien                    1                7                 1                 7         33               3               1          191           65\n...\n\n\nCREATE TABLE \"superpower\" (\nid bigint NOT NULL,\npower_name text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  power_name\n----  -------------------\n   1  Agility\n   2  Accelerated Healing\n   3  Lantern Power Ring\n...\n", "preprocess_schema": "CREATE TABLE \"alignment\" (\nid bigint NOT NULL,\nalignment text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  alignment\n----  -----------\n   1  Good\n   2  Bad\n   3  Neutral\n...\n\n\nCREATE TABLE \"attribute\" (\nid bigint NOT NULL,\nattribute_name text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  attribute_name\n----  ----------------\n   1  Intelligence\n   2  Strength\n   3  Speed\n...\n\n\nCREATE TABLE \"colour\" (\nid bigint NOT NULL,\ncolour text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  colour\n----  ---------\n   1  No Colour\n   2  Amber\n   3  Auburn\n...\n\n\nCREATE TABLE \"gender\" (\nid bigint NOT NULL,\ngender text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  gender\n----  --------\n   1  Male\n   2  Female\n   3  N/A\n...\n\n\nCREATE TABLE \"hero_attribute\" (\nhero_id bigint NULL,\nattribute_id bigint NULL,\nattribute_value bigint NULL,\n    FOREIGN KEY (attribute_id) REFERENCES attribute(id),\n    FOREIGN KEY (hero_id) REFERENCES superhero(id)\n);\n\nFirst 3 rows:\n  hero_id    attribute_id    attribute_value\n---------  --------------  -----------------\n        1               1                 80\n        2               1                 75\n        3               1                 95\n...\n\n\nCREATE TABLE \"hero_power\" (\nhero_id bigint NULL,\npower_id bigint NULL,\n    FOREIGN KEY (hero_id) REFERENCES superhero(id),\n    FOREIGN KEY (power_id) REFERENCES superpower(id)\n);\n\nFirst 3 rows:\n  hero_id    power_id\n---------  ----------\n        1           1\n        1          18\n        1          26\n...\n\n\nCREATE TABLE \"publisher\" (\nid bigint NOT NULL,\npublisher_name text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  publisher_name\n----  -----------------\n   1\n   2  ABC Studios\n   3  Dark Horse Comics\n...\n\n\nCREATE TABLE \"race\" (\nid bigint NOT NULL,\nrace text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  race\n----  ------\n   1  -\n   2  Alien\n   3  Alpha\n...\n\n\nCREATE TABLE \"superhero\" (\nid bigint NOT NULL,\nsuperhero_name text NULL,\nfull_name text NULL,\ngender_id bigint NULL,\neye_colour_id bigint NULL,\nhair_colour_id bigint NULL,\nskin_colour_id bigint NULL,\nrace_id bigint NULL,\npublisher_id bigint NULL,\nalignment_id bigint NULL,\nheight_cm bigint NULL,\nweight_kg bigint NULL,\n    PRIMARY KEY (id),\n    FOREIGN KEY (alignment_id) REFERENCES alignment(id),\n    FOREIGN KEY (eye_colour_id) REFERENCES colour(id),\n    FOREIGN KEY (gender_id) REFERENCES gender(id),\n    FOREIGN KEY (hair_colour_id) REFERENCES colour(id),\n    FOREIGN KEY (publisher_id) REFERENCES publisher(id),\n    FOREIGN KEY (race_id) REFERENCES race(id),\n    FOREIGN KEY (skin_colour_id) REFERENCES colour(id)\n);\n\nFirst 3 rows:\n  id  superhero_name    full_name                 gender_id    eye_colour_id    hair_colour_id    skin_colour_id    race_id    publisher_id    alignment_id    height_cm    weight_kg\n----  ----------------  ----------------------  -----------  ---------------  ----------------  ----------------  ---------  --------------  --------------  -----------  -----------\n   1  3-D Man           Charles Chandler                  1                9                13                 1          1              13               1          188           90\n   2  A-Bomb            Richard Milhouse Jones            1               33                 1                 1         24              13               1          203          441\n   3  Abe Sapien        Abraham Sapien                    1                7                 1                 7         33               3               1          191           65\n...\n\n\nCREATE TABLE \"superhero_events\" (\nhero_id bigint NOT NULL,\nstart_time timestamp without time zone NOT NULL,\nend_time timestamp without time zone NOT NULL,\nevent_id integer NOT NULL DEFAULT nextval('superhero_events_event_id_seq'::regclass),\n    PRIMARY KEY (event_id)\n);\n\nFirst 3 rows:\n  hero_id  start_time                  end_time                      event_id\n---------  --------------------------  --------------------------  ----------\n       65  2025-04-14 20:15:45.283425  2025-04-14 21:16:10.765637           1\n      745  2025-04-14 20:15:43.739481  2025-04-14 21:16:12.309581           2\n      704  2025-04-14 20:15:41.118460  2025-04-14 21:16:14.930602           3\n...\n\n\nCREATE TABLE \"superpower\" (\nid bigint NOT NULL,\npower_name text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  power_name\n----  -------------------\n   1  Agility\n   2  Accelerated Healing\n   3  Lantern Power Ring\n...\n", "sol_sql": ["create index idx_a on superhero_events (start_time, end_time) include (event_id, hero_id);", "SELECT * from superhero_events WHERE start_time >= Now()::timestamp - INTERVAL '3 days' AND end_time < now()+'5 hours'::interval ORDER BY CASE WHEN now()+'5 hours'::interval > Now()::timestamp AND start_time < Now()::timestamp THEN 1 WHEN start_time < Now()::timestamp THEN 2 ELSE 3 END;"], "test_cases": ["\ndef test_case(pred_sqls, sol_sqls, db_name, conn):\n    result = ex_base(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"ex_base returned {result} but expected 1.\"\n    result = performance_compare_by_qep(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"performance_check returned {result} but expected 1.\"\n    return result\n    "]}
{"instance_id": "PostgreSQL_175", "dialect": "PostgreSQL", "version": "14.12", "db_id": "superhero", "query": "We need to count the occurrences of specific superheroes in two different datasets: one dataset includes superheroes with a specific gender, and the other includes superheroes with a specific alignment. We want to return a single result set that includes the counts of these superheroes from both datasets. The challenge is to ensure that the query is optimized and that the database planner can effectively use indexes to speed up the query. The user encountered an issue where applying the filter condition after the join operation prevented the planner from using indexes, leading to a suboptimal execution plan. The user wants to avoid manually applying the filter condition to each joined table to maintain query simplicity and performance.", "issue_sql": ["SELECT *\nFROM (\n  SELECT gender_id, COUNT(*) as cnt1\n  FROM superhero\n  WHERE gender_id IN (1, 2)\n  GROUP BY gender_id\n) AS c1\nFULL OUTER JOIN (\n  SELECT alignment_id, COUNT(*) as cnt2\n  FROM superhero\n  WHERE alignment_id IN (1, 2)\n  GROUP BY alignment_id\n) AS c2\nON c1.gender_id = c2.alignment_id\nWHERE c1.gender_id IN (1,2) AND c2.alignment_id IN (1,2);"], "preprocess_sql": [], "clean_up_sql": [], "category": "Efficiency", "original_schema": "CREATE TABLE \"alignment\" (\nid bigint NOT NULL,\nalignment text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  alignment\n----  -----------\n   1  Good\n   2  Bad\n   3  Neutral\n...\n\n\nCREATE TABLE \"attribute\" (\nid bigint NOT NULL,\nattribute_name text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  attribute_name\n----  ----------------\n   1  Intelligence\n   2  Strength\n   3  Speed\n...\n\n\nCREATE TABLE \"colour\" (\nid bigint NOT NULL,\ncolour text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  colour\n----  ---------\n   1  No Colour\n   2  Amber\n   3  Auburn\n...\n\n\nCREATE TABLE \"gender\" (\nid bigint NOT NULL,\ngender text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  gender\n----  --------\n   1  Male\n   2  Female\n   3  N/A\n...\n\n\nCREATE TABLE \"hero_attribute\" (\nhero_id bigint NULL,\nattribute_id bigint NULL,\nattribute_value bigint NULL,\n    FOREIGN KEY (attribute_id) REFERENCES attribute(id),\n    FOREIGN KEY (hero_id) REFERENCES superhero(id)\n);\n\nFirst 3 rows:\n  hero_id    attribute_id    attribute_value\n---------  --------------  -----------------\n        1               1                 80\n        2               1                 75\n        3               1                 95\n...\n\n\nCREATE TABLE \"hero_power\" (\nhero_id bigint NULL,\npower_id bigint NULL,\n    FOREIGN KEY (hero_id) REFERENCES superhero(id),\n    FOREIGN KEY (power_id) REFERENCES superpower(id)\n);\n\nFirst 3 rows:\n  hero_id    power_id\n---------  ----------\n        1           1\n        1          18\n        1          26\n...\n\n\nCREATE TABLE \"publisher\" (\nid bigint NOT NULL,\npublisher_name text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  publisher_name\n----  -----------------\n   1\n   2  ABC Studios\n   3  Dark Horse Comics\n...\n\n\nCREATE TABLE \"race\" (\nid bigint NOT NULL,\nrace text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  race\n----  ------\n   1  -\n   2  Alien\n   3  Alpha\n...\n\n\nCREATE TABLE \"superhero\" (\nid bigint NOT NULL,\nsuperhero_name text NULL,\nfull_name text NULL,\ngender_id bigint NULL,\neye_colour_id bigint NULL,\nhair_colour_id bigint NULL,\nskin_colour_id bigint NULL,\nrace_id bigint NULL,\npublisher_id bigint NULL,\nalignment_id bigint NULL,\nheight_cm bigint NULL,\nweight_kg bigint NULL,\n    PRIMARY KEY (id),\n    FOREIGN KEY (alignment_id) REFERENCES alignment(id),\n    FOREIGN KEY (eye_colour_id) REFERENCES colour(id),\n    FOREIGN KEY (gender_id) REFERENCES gender(id),\n    FOREIGN KEY (hair_colour_id) REFERENCES colour(id),\n    FOREIGN KEY (publisher_id) REFERENCES publisher(id),\n    FOREIGN KEY (race_id) REFERENCES race(id),\n    FOREIGN KEY (skin_colour_id) REFERENCES colour(id)\n);\n\nFirst 3 rows:\n  id  superhero_name    full_name                 gender_id    eye_colour_id    hair_colour_id    skin_colour_id    race_id    publisher_id    alignment_id    height_cm    weight_kg\n----  ----------------  ----------------------  -----------  ---------------  ----------------  ----------------  ---------  --------------  --------------  -----------  -----------\n   1  3-D Man           Charles Chandler                  1                9                13                 1          1              13               1          188           90\n   2  A-Bomb            Richard Milhouse Jones            1               33                 1                 1         24              13               1          203          441\n   3  Abe Sapien        Abraham Sapien                    1                7                 1                 7         33               3               1          191           65\n...\n\n\nCREATE TABLE \"superpower\" (\nid bigint NOT NULL,\npower_name text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  power_name\n----  -------------------\n   1  Agility\n   2  Accelerated Healing\n   3  Lantern Power Ring\n...\n", "preprocess_schema": "CREATE TABLE \"alignment\" (\nid bigint NOT NULL,\nalignment text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  alignment\n----  -----------\n   1  Good\n   2  Bad\n   3  Neutral\n...\n\n\nCREATE TABLE \"attribute\" (\nid bigint NOT NULL,\nattribute_name text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  attribute_name\n----  ----------------\n   1  Intelligence\n   2  Strength\n   3  Speed\n...\n\n\nCREATE TABLE \"colour\" (\nid bigint NOT NULL,\ncolour text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  colour\n----  ---------\n   1  No Colour\n   2  Amber\n   3  Auburn\n...\n\n\nCREATE TABLE \"gender\" (\nid bigint NOT NULL,\ngender text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  gender\n----  --------\n   1  Male\n   2  Female\n   3  N/A\n...\n\n\nCREATE TABLE \"hero_attribute\" (\nhero_id bigint NULL,\nattribute_id bigint NULL,\nattribute_value bigint NULL,\n    FOREIGN KEY (attribute_id) REFERENCES attribute(id),\n    FOREIGN KEY (hero_id) REFERENCES superhero(id)\n);\n\nFirst 3 rows:\n  hero_id    attribute_id    attribute_value\n---------  --------------  -----------------\n        1               1                 80\n        2               1                 75\n        3               1                 95\n...\n\n\nCREATE TABLE \"hero_power\" (\nhero_id bigint NULL,\npower_id bigint NULL,\n    FOREIGN KEY (hero_id) REFERENCES superhero(id),\n    FOREIGN KEY (power_id) REFERENCES superpower(id)\n);\n\nFirst 3 rows:\n  hero_id    power_id\n---------  ----------\n        1           1\n        1          18\n        1          26\n...\n\n\nCREATE TABLE \"publisher\" (\nid bigint NOT NULL,\npublisher_name text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  publisher_name\n----  -----------------\n   1\n   2  ABC Studios\n   3  Dark Horse Comics\n...\n\n\nCREATE TABLE \"race\" (\nid bigint NOT NULL,\nrace text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  race\n----  ------\n   1  -\n   2  Alien\n   3  Alpha\n...\n\n\nCREATE TABLE \"superhero\" (\nid bigint NOT NULL,\nsuperhero_name text NULL,\nfull_name text NULL,\ngender_id bigint NULL,\neye_colour_id bigint NULL,\nhair_colour_id bigint NULL,\nskin_colour_id bigint NULL,\nrace_id bigint NULL,\npublisher_id bigint NULL,\nalignment_id bigint NULL,\nheight_cm bigint NULL,\nweight_kg bigint NULL,\n    PRIMARY KEY (id),\n    FOREIGN KEY (alignment_id) REFERENCES alignment(id),\n    FOREIGN KEY (eye_colour_id) REFERENCES colour(id),\n    FOREIGN KEY (gender_id) REFERENCES gender(id),\n    FOREIGN KEY (hair_colour_id) REFERENCES colour(id),\n    FOREIGN KEY (publisher_id) REFERENCES publisher(id),\n    FOREIGN KEY (race_id) REFERENCES race(id),\n    FOREIGN KEY (skin_colour_id) REFERENCES colour(id)\n);\n\nFirst 3 rows:\n  id  superhero_name    full_name                 gender_id    eye_colour_id    hair_colour_id    skin_colour_id    race_id    publisher_id    alignment_id    height_cm    weight_kg\n----  ----------------  ----------------------  -----------  ---------------  ----------------  ----------------  ---------  --------------  --------------  -----------  -----------\n   1  3-D Man           Charles Chandler                  1                9                13                 1          1              13               1          188           90\n   2  A-Bomb            Richard Milhouse Jones            1               33                 1                 1         24              13               1          203          441\n   3  Abe Sapien        Abraham Sapien                    1                7                 1                 7         33               3               1          191           65\n...\n\n\nCREATE TABLE \"superpower\" (\nid bigint NOT NULL,\npower_name text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  power_name\n----  -------------------\n   1  Agility\n   2  Accelerated Healing\n   3  Lantern Power Ring\n...\n", "sol_sql": ["SELECT * \nFROM (\n  SELECT gender_id, COUNT(*) as cnt1 \n  FROM superhero \n  WHERE gender_id IN (1, 2) \n  GROUP BY gender_id\n) AS g1\nFULL OUTER JOIN (\n  SELECT alignment_id, COUNT(*) as cnt2 \n  FROM superhero \n  WHERE alignment_id IN (1, 2) \n  GROUP BY alignment_id\n) AS a1\nON g1.gender_id = a1.alignment_id\nWHERE COALESCE(g1.gender_id, a1.alignment_id) IN (1, 2);"], "test_cases": ["\ndef test_case(pred_sqls, sol_sqls, db_name, conn):\n    result = ex_base(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"ex_base returned {result} but expected 1.\"\n    result = performance_compare_by_qep(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"performance_check returned {result} but expected 1.\"\n    return result\n"]}
{"instance_id": "PostgreSQL_190", "dialect": "PostgreSQL", "version": "14.12", "db_id": "formula_1", "query": "In the Formula 1 database, I have a results table currently containing around 400 million entries and the following query on it:\n\nThe query retrieves the top 10 result IDs for a specific driver or another driver, ordered by the result ID in descending order. The query works fine when filtering by a single driver ID, but it takes several minutes when filtering by two driver IDs, even if both drivers have a small number of results (e.g., 2 for the first driver and 57 for the second driver). The issue seems to be related to the combination of ORDER BY and LIMIT clauses.", "issue_sql": ["SELECT resultid FROM results WHERE driverid = 3 OR driverid = 4 ORDER BY resultid DESC LIMIT 10"], "preprocess_sql": [], "clean_up_sql": [], "category": "Efficiency", "original_schema": "CREATE TABLE \"circuits\" (\ncircuitid bigint NOT NULL DEFAULT nextval('circuits_circuitid_seq'::regclass),\ncircuitref text NULL DEFAULT ''::text,\nname text NULL DEFAULT ''::text,\nlocation text NULL,\ncountry text NULL,\nlat real NULL,\nlng real NULL,\nalt bigint NULL,\nurl text NULL DEFAULT ''::text,\n    PRIMARY KEY (circuitid)\n);\n\nFirst 3 rows:\n  circuitid  circuitref    name                            location      country         lat        lng  alt    url\n-----------  ------------  ------------------------------  ------------  ---------  --------  ---------  -----  -----------------------------------------------------------\n          2  sepang        Sepang International Circuit    Kuala Lumpur  Malaysia    2.76083  101.738           http://en.wikipedia.org/wiki/Sepang_International_Circuit\n          3  bahrain       Bahrain International Circuit   Sakhir        Bahrain    26.0325    50.5106          http://en.wikipedia.org/wiki/Bahrain_International_Circuit\n          4  catalunya     Circuit de Barcelona-Catalunya  Montmeló      Spain      41.57       2.26111         http://en.wikipedia.org/wiki/Circuit_de_Barcelona-Catalunya\n...\n\n\nCREATE TABLE \"constructorresults\" (\nconstructorresultsid bigint NOT NULL DEFAULT nextval('constructorresults_constructorresultsid_seq'::regclass),\nraceid bigint NULL DEFAULT '0'::bigint,\nconstructorid bigint NULL DEFAULT '0'::bigint,\npoints real NULL,\nstatus text NULL,\n    PRIMARY KEY (constructorresultsid),\n    FOREIGN KEY (constructorid) REFERENCES constructors(constructorid)\n);\n\nFirst 3 rows:\n  constructorresultsid    raceid    constructorid    points  status\n----------------------  --------  ---------------  --------  --------\n                     1        18                1        14\n                     2        18                2         8\n                     3        18                3         9\n...\n\n\nCREATE TABLE \"constructors\" (\nconstructorid bigint NOT NULL DEFAULT nextval('constructors_constructorid_seq'::regclass),\nconstructorref text NULL DEFAULT ''::text,\nname text NULL DEFAULT ''::text,\nnationality text NULL,\nurl text NULL DEFAULT ''::text,\n    PRIMARY KEY (constructorid)\n);\n\nFirst 3 rows:\n  constructorid  constructorref    name        nationality    url\n---------------  ----------------  ----------  -------------  ------------------------------------------------------------\n              1  mclaren           McLaren     British        http://en.wikipedia.org/wiki/McLaren\n              2  bmw_sauber        BMW Sauber  German         http://en.wikipedia.org/wiki/BMW_Sauber\n              3  williams          Williams    British        http://en.wikipedia.org/wiki/Williams_Grand_Prix_Engineering\n...\n\n\nCREATE TABLE \"constructorstandings\" (\nconstructorstandingsid bigint NOT NULL DEFAULT nextval('constructorstandings_constructorstandingsid_seq'::regclass),\nraceid bigint NULL DEFAULT '0'::bigint,\nconstructorid bigint NULL DEFAULT '0'::bigint,\npoints real NULL DEFAULT '0'::real,\nposition bigint NULL,\npositiontext text NULL,\nwins bigint NULL DEFAULT '0'::bigint,\n    PRIMARY KEY (constructorstandingsid),\n    FOREIGN KEY (constructorid) REFERENCES constructors(constructorid)\n);\n\nFirst 3 rows:\n  constructorstandingsid    raceid    constructorid    points    position    positiontext    wins\n------------------------  --------  ---------------  --------  ----------  --------------  ------\n                       1        18                1        14           1               1       1\n                       2        18                2         8           3               3       0\n                       3        18                3         9           2               2       0\n...\n\n\nCREATE TABLE \"drivers\" (\ndriverid bigint NOT NULL DEFAULT nextval('drivers_driverid_seq'::regclass),\ndriverref text NULL DEFAULT ''::text,\nnumber bigint NULL,\ncode text NULL,\nforename text NULL DEFAULT ''::text,\nsurname text NULL DEFAULT ''::text,\ndob date NULL,\nnationality text NULL,\nurl text NULL DEFAULT ''::text,\n    PRIMARY KEY (driverid)\n);\n\nFirst 3 rows:\n  driverid  driverref      number  code    forename    surname    dob         nationality    url\n----------  -----------  --------  ------  ----------  ---------  ----------  -------------  -------------------------------------------\n         1  hamilton           44  HAM     Lewis       Hamilton   1985-01-07  British        http://en.wikipedia.org/wiki/Lewis_Hamilton\n         2  heidfeld          nan  HEI     Nick        Heidfeld   1977-05-10  German         http://en.wikipedia.org/wiki/Nick_Heidfeld\n         3  rosberg             6  ROS     Nico        Rosberg    1985-06-27  German         http://en.wikipedia.org/wiki/Nico_Rosberg\n...\n\n\nCREATE TABLE \"driverstandings\" (\ndriverstandingsid bigint NOT NULL DEFAULT nextval('driverstandings_driverstandingsid_seq'::regclass),\nraceid bigint NULL DEFAULT '0'::bigint,\ndriverid bigint NULL DEFAULT '0'::bigint,\npoints real NULL DEFAULT '0'::real,\nposition bigint NULL,\npositiontext text NULL,\nwins bigint NULL DEFAULT '0'::bigint,\n    PRIMARY KEY (driverstandingsid),\n    FOREIGN KEY (driverid) REFERENCES drivers(driverid)\n);\n\nFirst 3 rows:\n  driverstandingsid    raceid    driverid    points    position    positiontext    wins\n-------------------  --------  ----------  --------  ----------  --------------  ------\n                  1        18           1        10           1               1       1\n                  2        18           2         8           2               2       0\n                  3        18           3         6           3               3       0\n...\n\n\nCREATE TABLE \"laptimes\" (\nraceid bigint NOT NULL,\ndriverid bigint NOT NULL,\nlap bigint NOT NULL,\nposition bigint NULL,\ntime text NULL,\nmilliseconds bigint NULL,\n    PRIMARY KEY (raceid, driverid, lap),\n    FOREIGN KEY (driverid) REFERENCES drivers(driverid),\n    FOREIGN KEY (raceid) REFERENCES races(raceid)\n);\n\nFirst 3 rows:\n  raceid    driverid    lap    position  time        milliseconds\n--------  ----------  -----  ----------  --------  --------------\n       2           1      1          10  1:52.965          112965\n       2           1      2          10  1:41.865          101865\n       2           1      3          10  1:40.869          100869\n...\n\n\nCREATE TABLE \"pitstops\" (\nraceid bigint NOT NULL,\ndriverid bigint NOT NULL,\nstop bigint NOT NULL,\nlap bigint NULL,\ntime text NULL,\nduration text NULL,\nmilliseconds bigint NULL,\n    PRIMARY KEY (raceid, driverid, stop),\n    FOREIGN KEY (driverid) REFERENCES drivers(driverid),\n    FOREIGN KEY (raceid) REFERENCES races(raceid)\n);\n\nFirst 3 rows:\n  raceid    driverid    stop    lap  time        duration    milliseconds\n--------  ----------  ------  -----  --------  ----------  --------------\n     842           1       1     12  16:24:40      22.552           22552\n     842           1       2     24  16:45:48      22.611           22611\n     842           1       3     37  17:08:28      25.382           25382\n...\n\n\nCREATE TABLE \"qualifying\" (\nqualifyid bigint NOT NULL DEFAULT nextval('qualifying_qualifyid_seq'::regclass),\nraceid bigint NULL DEFAULT '0'::bigint,\ndriverid bigint NULL DEFAULT '0'::bigint,\nconstructorid bigint NULL DEFAULT '0'::bigint,\nnumber bigint NULL DEFAULT '0'::bigint,\nposition bigint NULL,\nq1 text NULL,\nq2 text NULL,\nq3 text NULL,\n    PRIMARY KEY (qualifyid),\n    FOREIGN KEY (constructorid) REFERENCES constructors(constructorid),\n    FOREIGN KEY (driverid) REFERENCES drivers(driverid),\n    FOREIGN KEY (raceid) REFERENCES races(raceid)\n);\n\nFirst 3 rows:\n  qualifyid    raceid    driverid    constructorid    number    position  q1        q2        q3\n-----------  --------  ----------  ---------------  --------  ----------  --------  --------  --------\n         23        19          13                6         2           1  1:35.347  1:34.412  1:35.748\n         24        19           8                6         1           2  1:35.645  1:34.188  1:36.230\n         25        19           5                1        23           3  1:35.227  1:34.759  1:36.613\n...\n\n\nCREATE TABLE \"races\" (\nraceid bigint NOT NULL DEFAULT nextval('races_raceid_seq'::regclass),\nyear bigint NULL DEFAULT '0'::bigint,\nround bigint NULL DEFAULT '0'::bigint,\ncircuitid bigint NULL DEFAULT '0'::bigint,\nname text NULL DEFAULT ''::text,\ndate date NULL,\ntime text NULL,\nurl text NULL,\n    PRIMARY KEY (raceid),\n    FOREIGN KEY (circuitid) REFERENCES circuits(circuitid),\n    FOREIGN KEY (year) REFERENCES seasons(year)\n);\n\nFirst 3 rows:\n  raceid    year    round    circuitid  name                  date        time      url\n--------  ------  -------  -----------  --------------------  ----------  --------  ------------------------------------------------------\n       2    2009        2            2  Malaysian Grand Prix  2009-04-05  09:00:00  http://en.wikipedia.org/wiki/2009_Malaysian_Grand_Prix\n       3    2009        3           17  Chinese Grand Prix    2009-04-19  07:00:00  http://en.wikipedia.org/wiki/2009_Chinese_Grand_Prix\n       4    2009        4            3  Bahrain Grand Prix    2009-04-26  12:00:00  http://en.wikipedia.org/wiki/2009_Bahrain_Grand_Prix\n...\n\n\nCREATE TABLE \"results\" (\nresultid bigint NOT NULL DEFAULT nextval('results_resultid_seq'::regclass),\nraceid bigint NULL DEFAULT '0'::bigint,\ndriverid bigint NULL DEFAULT '0'::bigint,\nconstructorid bigint NULL DEFAULT '0'::bigint,\nnumber bigint NULL,\ngrid bigint NULL DEFAULT '0'::bigint,\nposition bigint NULL,\npositiontext text NULL DEFAULT ''::text,\npositionorder bigint NULL DEFAULT '0'::bigint,\npoints real NULL DEFAULT '0'::real,\nlaps bigint NULL DEFAULT '0'::bigint,\ntime text NULL,\nmilliseconds bigint NULL,\nfastestlap bigint NULL,\nrank bigint NULL DEFAULT '0'::bigint,\nfastestlaptime text NULL,\nfastestlapspeed text NULL,\nstatusid bigint NULL DEFAULT '0'::bigint,\n    PRIMARY KEY (resultid),\n    FOREIGN KEY (constructorid) REFERENCES constructors(constructorid),\n    FOREIGN KEY (driverid) REFERENCES drivers(driverid),\n    FOREIGN KEY (raceid) REFERENCES races(raceid),\n    FOREIGN KEY (statusid) REFERENCES status(statusid)\n);\n\nFirst 3 rows:\n  resultid    raceid    driverid    constructorid    number    grid    position    positiontext    positionorder    points    laps  time           milliseconds    fastestlap    rank  fastestlaptime      fastestlapspeed    statusid\n----------  --------  ----------  ---------------  --------  ------  ----------  --------------  ---------------  --------  ------  -----------  --------------  ------------  ------  ----------------  -----------------  ----------\n        23        19           8                6         1       2           1               1                1        10      56  1:31:18.555         5478555            37       2  1:35.405                    209.158           1\n        24        19           9                2         4       4           2               2                2         8      56  +19.570             5498125            39       6  1:35.921                    208.033           1\n        25        19           5                1        23       8           3               3                3         6      56  +38.450             5517005            19       7  1:35.922                    208.031           1\n...\n\n\nCREATE TABLE \"seasons\" (\nyear bigint NOT NULL DEFAULT '0'::bigint,\nurl text NULL DEFAULT ''::text,\n    PRIMARY KEY (year)\n);\n\nFirst 3 rows:\n  year  url\n------  ----------------------------------------------------\n  1950  http://en.wikipedia.org/wiki/1950_Formula_One_season\n  1951  http://en.wikipedia.org/wiki/1951_Formula_One_season\n  1952  http://en.wikipedia.org/wiki/1952_Formula_One_season\n...\n\n\nCREATE TABLE \"status\" (\nstatusid bigint NOT NULL DEFAULT nextval('status_statusid_seq'::regclass),\nstatus text NULL DEFAULT ''::text,\n    PRIMARY KEY (statusid)\n);\n\nFirst 3 rows:\n  statusid  status\n----------  ------------\n         1  Finished\n         2  Disqualified\n         3  Accident\n...\n", "preprocess_schema": "CREATE TABLE \"circuits\" (\ncircuitid bigint NOT NULL DEFAULT nextval('circuits_circuitid_seq'::regclass),\ncircuitref text NULL DEFAULT ''::text,\nname text NULL DEFAULT ''::text,\nlocation text NULL,\ncountry text NULL,\nlat real NULL,\nlng real NULL,\nalt bigint NULL,\nurl text NULL DEFAULT ''::text,\n    PRIMARY KEY (circuitid)\n);\n\nFirst 3 rows:\n  circuitid  circuitref    name                            location      country         lat        lng  alt    url\n-----------  ------------  ------------------------------  ------------  ---------  --------  ---------  -----  -----------------------------------------------------------\n          2  sepang        Sepang International Circuit    Kuala Lumpur  Malaysia    2.76083  101.738           http://en.wikipedia.org/wiki/Sepang_International_Circuit\n          3  bahrain       Bahrain International Circuit   Sakhir        Bahrain    26.0325    50.5106          http://en.wikipedia.org/wiki/Bahrain_International_Circuit\n          4  catalunya     Circuit de Barcelona-Catalunya  Montmeló      Spain      41.57       2.26111         http://en.wikipedia.org/wiki/Circuit_de_Barcelona-Catalunya\n...\n\n\nCREATE TABLE \"constructorresults\" (\nconstructorresultsid bigint NOT NULL DEFAULT nextval('constructorresults_constructorresultsid_seq'::regclass),\nraceid bigint NULL DEFAULT '0'::bigint,\nconstructorid bigint NULL DEFAULT '0'::bigint,\npoints real NULL,\nstatus text NULL,\n    PRIMARY KEY (constructorresultsid),\n    FOREIGN KEY (constructorid) REFERENCES constructors(constructorid)\n);\n\nFirst 3 rows:\n  constructorresultsid    raceid    constructorid    points  status\n----------------------  --------  ---------------  --------  --------\n                     1        18                1        14\n                     2        18                2         8\n                     3        18                3         9\n...\n\n\nCREATE TABLE \"constructors\" (\nconstructorid bigint NOT NULL DEFAULT nextval('constructors_constructorid_seq'::regclass),\nconstructorref text NULL DEFAULT ''::text,\nname text NULL DEFAULT ''::text,\nnationality text NULL,\nurl text NULL DEFAULT ''::text,\n    PRIMARY KEY (constructorid)\n);\n\nFirst 3 rows:\n  constructorid  constructorref    name        nationality    url\n---------------  ----------------  ----------  -------------  ------------------------------------------------------------\n              1  mclaren           McLaren     British        http://en.wikipedia.org/wiki/McLaren\n              2  bmw_sauber        BMW Sauber  German         http://en.wikipedia.org/wiki/BMW_Sauber\n              3  williams          Williams    British        http://en.wikipedia.org/wiki/Williams_Grand_Prix_Engineering\n...\n\n\nCREATE TABLE \"constructorstandings\" (\nconstructorstandingsid bigint NOT NULL DEFAULT nextval('constructorstandings_constructorstandingsid_seq'::regclass),\nraceid bigint NULL DEFAULT '0'::bigint,\nconstructorid bigint NULL DEFAULT '0'::bigint,\npoints real NULL DEFAULT '0'::real,\nposition bigint NULL,\npositiontext text NULL,\nwins bigint NULL DEFAULT '0'::bigint,\n    PRIMARY KEY (constructorstandingsid),\n    FOREIGN KEY (constructorid) REFERENCES constructors(constructorid)\n);\n\nFirst 3 rows:\n  constructorstandingsid    raceid    constructorid    points    position    positiontext    wins\n------------------------  --------  ---------------  --------  ----------  --------------  ------\n                       1        18                1        14           1               1       1\n                       2        18                2         8           3               3       0\n                       3        18                3         9           2               2       0\n...\n\n\nCREATE TABLE \"drivers\" (\ndriverid bigint NOT NULL DEFAULT nextval('drivers_driverid_seq'::regclass),\ndriverref text NULL DEFAULT ''::text,\nnumber bigint NULL,\ncode text NULL,\nforename text NULL DEFAULT ''::text,\nsurname text NULL DEFAULT ''::text,\ndob date NULL,\nnationality text NULL,\nurl text NULL DEFAULT ''::text,\n    PRIMARY KEY (driverid)\n);\n\nFirst 3 rows:\n  driverid  driverref      number  code    forename    surname    dob         nationality    url\n----------  -----------  --------  ------  ----------  ---------  ----------  -------------  -------------------------------------------\n         1  hamilton           44  HAM     Lewis       Hamilton   1985-01-07  British        http://en.wikipedia.org/wiki/Lewis_Hamilton\n         2  heidfeld          nan  HEI     Nick        Heidfeld   1977-05-10  German         http://en.wikipedia.org/wiki/Nick_Heidfeld\n         3  rosberg             6  ROS     Nico        Rosberg    1985-06-27  German         http://en.wikipedia.org/wiki/Nico_Rosberg\n...\n\n\nCREATE TABLE \"driverstandings\" (\ndriverstandingsid bigint NOT NULL DEFAULT nextval('driverstandings_driverstandingsid_seq'::regclass),\nraceid bigint NULL DEFAULT '0'::bigint,\ndriverid bigint NULL DEFAULT '0'::bigint,\npoints real NULL DEFAULT '0'::real,\nposition bigint NULL,\npositiontext text NULL,\nwins bigint NULL DEFAULT '0'::bigint,\n    PRIMARY KEY (driverstandingsid),\n    FOREIGN KEY (driverid) REFERENCES drivers(driverid)\n);\n\nFirst 3 rows:\n  driverstandingsid    raceid    driverid    points    position    positiontext    wins\n-------------------  --------  ----------  --------  ----------  --------------  ------\n                  1        18           1        10           1               1       1\n                  2        18           2         8           2               2       0\n                  3        18           3         6           3               3       0\n...\n\n\nCREATE TABLE \"laptimes\" (\nraceid bigint NOT NULL,\ndriverid bigint NOT NULL,\nlap bigint NOT NULL,\nposition bigint NULL,\ntime text NULL,\nmilliseconds bigint NULL,\n    PRIMARY KEY (raceid, driverid, lap),\n    FOREIGN KEY (driverid) REFERENCES drivers(driverid),\n    FOREIGN KEY (raceid) REFERENCES races(raceid)\n);\n\nFirst 3 rows:\n  raceid    driverid    lap    position  time        milliseconds\n--------  ----------  -----  ----------  --------  --------------\n       2           1      1          10  1:52.965          112965\n       2           1      2          10  1:41.865          101865\n       2           1      3          10  1:40.869          100869\n...\n\n\nCREATE TABLE \"pitstops\" (\nraceid bigint NOT NULL,\ndriverid bigint NOT NULL,\nstop bigint NOT NULL,\nlap bigint NULL,\ntime text NULL,\nduration text NULL,\nmilliseconds bigint NULL,\n    PRIMARY KEY (raceid, driverid, stop),\n    FOREIGN KEY (driverid) REFERENCES drivers(driverid),\n    FOREIGN KEY (raceid) REFERENCES races(raceid)\n);\n\nFirst 3 rows:\n  raceid    driverid    stop    lap  time        duration    milliseconds\n--------  ----------  ------  -----  --------  ----------  --------------\n     842           1       1     12  16:24:40      22.552           22552\n     842           1       2     24  16:45:48      22.611           22611\n     842           1       3     37  17:08:28      25.382           25382\n...\n\n\nCREATE TABLE \"qualifying\" (\nqualifyid bigint NOT NULL DEFAULT nextval('qualifying_qualifyid_seq'::regclass),\nraceid bigint NULL DEFAULT '0'::bigint,\ndriverid bigint NULL DEFAULT '0'::bigint,\nconstructorid bigint NULL DEFAULT '0'::bigint,\nnumber bigint NULL DEFAULT '0'::bigint,\nposition bigint NULL,\nq1 text NULL,\nq2 text NULL,\nq3 text NULL,\n    PRIMARY KEY (qualifyid),\n    FOREIGN KEY (constructorid) REFERENCES constructors(constructorid),\n    FOREIGN KEY (driverid) REFERENCES drivers(driverid),\n    FOREIGN KEY (raceid) REFERENCES races(raceid)\n);\n\nFirst 3 rows:\n  qualifyid    raceid    driverid    constructorid    number    position  q1        q2        q3\n-----------  --------  ----------  ---------------  --------  ----------  --------  --------  --------\n         23        19          13                6         2           1  1:35.347  1:34.412  1:35.748\n         24        19           8                6         1           2  1:35.645  1:34.188  1:36.230\n         25        19           5                1        23           3  1:35.227  1:34.759  1:36.613\n...\n\n\nCREATE TABLE \"races\" (\nraceid bigint NOT NULL DEFAULT nextval('races_raceid_seq'::regclass),\nyear bigint NULL DEFAULT '0'::bigint,\nround bigint NULL DEFAULT '0'::bigint,\ncircuitid bigint NULL DEFAULT '0'::bigint,\nname text NULL DEFAULT ''::text,\ndate date NULL,\ntime text NULL,\nurl text NULL,\n    PRIMARY KEY (raceid),\n    FOREIGN KEY (circuitid) REFERENCES circuits(circuitid),\n    FOREIGN KEY (year) REFERENCES seasons(year)\n);\n\nFirst 3 rows:\n  raceid    year    round    circuitid  name                  date        time      url\n--------  ------  -------  -----------  --------------------  ----------  --------  ------------------------------------------------------\n       2    2009        2            2  Malaysian Grand Prix  2009-04-05  09:00:00  http://en.wikipedia.org/wiki/2009_Malaysian_Grand_Prix\n       3    2009        3           17  Chinese Grand Prix    2009-04-19  07:00:00  http://en.wikipedia.org/wiki/2009_Chinese_Grand_Prix\n       4    2009        4            3  Bahrain Grand Prix    2009-04-26  12:00:00  http://en.wikipedia.org/wiki/2009_Bahrain_Grand_Prix\n...\n\n\nCREATE TABLE \"results\" (\nresultid bigint NOT NULL DEFAULT nextval('results_resultid_seq'::regclass),\nraceid bigint NULL DEFAULT '0'::bigint,\ndriverid bigint NULL DEFAULT '0'::bigint,\nconstructorid bigint NULL DEFAULT '0'::bigint,\nnumber bigint NULL,\ngrid bigint NULL DEFAULT '0'::bigint,\nposition bigint NULL,\npositiontext text NULL DEFAULT ''::text,\npositionorder bigint NULL DEFAULT '0'::bigint,\npoints real NULL DEFAULT '0'::real,\nlaps bigint NULL DEFAULT '0'::bigint,\ntime text NULL,\nmilliseconds bigint NULL,\nfastestlap bigint NULL,\nrank bigint NULL DEFAULT '0'::bigint,\nfastestlaptime text NULL,\nfastestlapspeed text NULL,\nstatusid bigint NULL DEFAULT '0'::bigint,\n    PRIMARY KEY (resultid),\n    FOREIGN KEY (constructorid) REFERENCES constructors(constructorid),\n    FOREIGN KEY (driverid) REFERENCES drivers(driverid),\n    FOREIGN KEY (raceid) REFERENCES races(raceid),\n    FOREIGN KEY (statusid) REFERENCES status(statusid)\n);\n\nFirst 3 rows:\n  resultid    raceid    driverid    constructorid    number    grid    position    positiontext    positionorder    points    laps  time           milliseconds    fastestlap    rank  fastestlaptime      fastestlapspeed    statusid\n----------  --------  ----------  ---------------  --------  ------  ----------  --------------  ---------------  --------  ------  -----------  --------------  ------------  ------  ----------------  -----------------  ----------\n        23        19           8                6         1       2           1               1                1        10      56  1:31:18.555         5478555            37       2  1:35.405                    209.158           1\n        24        19           9                2         4       4           2               2                2         8      56  +19.570             5498125            39       6  1:35.921                    208.033           1\n        25        19           5                1        23       8           3               3                3         6      56  +38.450             5517005            19       7  1:35.922                    208.031           1\n...\n\n\nCREATE TABLE \"seasons\" (\nyear bigint NOT NULL DEFAULT '0'::bigint,\nurl text NULL DEFAULT ''::text,\n    PRIMARY KEY (year)\n);\n\nFirst 3 rows:\n  year  url\n------  ----------------------------------------------------\n  1950  http://en.wikipedia.org/wiki/1950_Formula_One_season\n  1951  http://en.wikipedia.org/wiki/1951_Formula_One_season\n  1952  http://en.wikipedia.org/wiki/1952_Formula_One_season\n...\n\n\nCREATE TABLE \"status\" (\nstatusid bigint NOT NULL DEFAULT nextval('status_statusid_seq'::regclass),\nstatus text NULL DEFAULT ''::text,\n    PRIMARY KEY (statusid)\n);\n\nFirst 3 rows:\n  statusid  status\n----------  ------------\n         1  Finished\n         2  Disqualified\n         3  Accident\n...\n", "sol_sql": ["SELECT resultid FROM results where driverid in (3, 4) order by resultid DESC LIMIT 10"], "test_cases": ["\ndef test_case(pred_sqls, sol_sqls, db_name, conn):\n    result = ex_base(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"ex_base returned {result} but expected 1.\"\n    result = performance_compare_by_qep(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"performance_check returned {result} but expected 1.\"\n    return result\n    "]}
{"instance_id": "PostgreSQL_216", "dialect": "PostgreSQL", "version": "14.12", "db_id": "european_football_2", "query": "In the 'european_football_2' database, I need to find the the top 3 largest tables in terms of storage. The goal is to list the table name and table size for all tables. Initially, I attempted to use a simple count(*) query for each table to compare the siza, but I need a more efficient method to achieve this in a single SQL command, which selects all table names with their sizes.", "issue_sql": ["WITH ranges_with_whole_days AS (SELECT booking_id, stadium_id, start_at, date_trunc('day', start_at) + interval '1 d' as start_at_next_whole_day, date_trunc('day', end_at) as end_at_whole_day, end_at FROM stadium_bookings), ranges AS (SELECT booking_id, stadium_id, start_at, CASE WHEN start_at_next_whole_day <= end_at_whole_day THEN start_at_next_whole_day ELSE NULL END as start_at_next_day, CASE WHEN end_at_whole_day >= start_at_next_whole_day THEN end_at_whole_day ELSE NULL END as end_at_prev_day, end_at FROM ranges_with_whole_days), ranges_bucketed AS (SELECT booking_id, stadium_id, start_at, start_at_next_day as end_at FROM ranges WHERE start_at_next_day IS NOT NULL UNION SELECT booking_id, stadium_id, start_at_next_day as start_at, end_at_prev_day as end_at FROM ranges WHERE start_at_next_day IS NOT NULL AND end_at_prev_day IS NOT NULL AND start_at_next_day != end_at_prev_day UNION SELECT booking_id, stadium_id, end_at_prev_day as start_at, end_at FROM ranges WHERE end_at_prev_day IS NOT NULL UNION SELECT booking_id, stadium_id, start_at, end_at FROM ranges WHERE start_at_next_day IS NULL AND end_at_prev_day IS NULL) SELECT * FROM ranges_bucketed ORDER BY booking_id, stadium_id, start_at;"], "preprocess_sql": ["CREATE TABLE IF NOT EXISTS stadium_bookings (\n  booking_id text NOT NULL,\n  stadium_id text NOT NULL,\n  start_at timestamp with time zone NOT NULL,\n  end_at timestamp with time zone NOT NULL,\n  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,\n  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,\n  booking_status varchar(50) DEFAULT 'confirmed',\n  booking_type varchar(100) DEFAULT 'standard',\n  customer_id uuid DEFAULT gen_random_uuid(),\n  event_name text DEFAULT 'Unnamed Event',\n  attendees_count integer DEFAULT 0,\n  total_price numeric(12, 2) DEFAULT 0.00,\n  payment_status varchar(50) DEFAULT 'pending',\n  notes text DEFAULT NULL,\n  is_recurring boolean DEFAULT false,\n  recurrence_pattern jsonb DEFAULT '{}'::jsonb,\n  cancellation_policy text DEFAULT 'Standard 48-hour cancellation policy applies',\n  special_requirements text DEFAULT NULL,\n  contact_person varchar(255) DEFAULT NULL,\n  contact_email varchar(255) DEFAULT NULL,\n  contact_phone varchar(50) DEFAULT NULL,\n  internal_reference_code varchar(100) DEFAULT NULL,\n  last_modified_by varchar(100) DEFAULT 'system',\n  version_number integer DEFAULT 1\n);", "INSERT INTO stadium_bookings(booking_id, stadium_id, start_at, end_at, created_at, updated_at, booking_status, booking_type, customer_id, event_name, attendees_count, total_price, payment_status, notes, is_recurring, recurrence_pattern, cancellation_policy, special_requirements, contact_person, contact_email, contact_phone, internal_reference_code, last_modified_by, version_number) VALUES \n('booking1', 'stadium1', '2023-06-01 14:00:00', '2023-06-03 18:00:00', '2023-05-15 09:23:45+08:00', '2023-05-15 09:23:45+08:00', 'confirmed', 'tournament', 'a1b2c3d4-e5f6-7890-abcd-ef1234567890', 'Summer Football Championship', 1500, 5000.00, 'paid', 'Annual football tournament with 16 teams', false, '{\"frequency\": \"annual\", \"day\": \"first Saturday of June\"}'::jsonb, 'No refunds within 14 days of event', 'Extra seating required in north stand', 'John Smith', 'john.smith@example.com', '+1-555-123-4567', 'SFC-2023-06', 'admin', 1),\n('booking2', 'stadium1', '2023-06-04 14:00:00', '2023-06-04 18:00:00', '2023-05-20 14:30:12+08:00', '2023-05-25 11:15:30+08:00', 'confirmed', 'friendly match', 'b2c3d4e5-f6a7-8901-bcde-f23456789012', 'Charity Exhibition Match', 800, 1200.50, 'paid', 'Charity match between local celebrities and retired professionals', false, '{}'::jsonb, 'Standard 48-hour cancellation policy applies', 'VIP area setup required', 'Mary Johnson', 'mary.j@charity.org', '+1-555-987-6543', 'CEM-2023-06', 'booking_manager', 2),\n('booking3', 'stadium1', '2023-06-06 10:30:00', '2023-07-02 16:30:00', '2023-04-10 08:45:22+08:00', '2023-05-30 16:20:18+08:00', 'confirmed', 'training camp', 'c3d4e5f6-a7b8-9012-cdef-345678901234', 'National Team Training Camp', 120, 15000.00, 'partially_paid', 'Extended booking for national team preparation before international tournament', true, '{\"frequency\": \"weekly\", \"days\": [\"Monday\", \"Wednesday\", \"Friday\"]}'::jsonb, 'Cancellation fee of 50% applies to all cancellations', 'Private access only, media area required, enhanced security measures', 'Coach Thompson', 'coach.thompson@nationalteam.org', '+1-555-789-0123', 'NTC-2023-06', 'director', 3);"], "clean_up_sql": ["DROP TABLE IF EXISTS stadium_bookings;"], "category": "Efficiency", "original_schema": "CREATE TABLE \"country\" (\nid bigint NOT NULL DEFAULT nextval('country_id_seq'::regclass),\nname text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  name\n----  -------\n   1  Belgium\n1729  England\n4769  France\n...\n\n\nCREATE TABLE \"league\" (\nid bigint NOT NULL DEFAULT nextval('league_id_seq'::regclass),\ncountry_id bigint NULL,\nname text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id    country_id  name\n----  ------------  ----------------------\n   1             1  Belgium Jupiler League\n1729          1729  England Premier League\n4769          4769  France Ligue 1\n...\n\n\nCREATE TABLE \"match\" (\nid bigint NOT NULL DEFAULT nextval('match_id_seq'::regclass),\ncountry_id bigint NULL,\nleague_id bigint NULL,\nseason text NULL,\nstage bigint NULL,\ndate text NULL,\nmatch_api_id bigint NULL,\nhome_team_api_id bigint NULL,\naway_team_api_id bigint NULL,\nhome_team_goal bigint NULL,\naway_team_goal bigint NULL,\nhome_player_x1 bigint NULL,\nhome_player_x2 bigint NULL,\nhome_player_x3 bigint NULL,\nhome_player_x4 bigint NULL,\nhome_player_x5 bigint NULL,\nhome_player_x6 bigint NULL,\nhome_player_x7 bigint NULL,\nhome_player_x8 bigint NULL,\nhome_player_x9 bigint NULL,\nhome_player_x10 bigint NULL,\nhome_player_x11 bigint NULL,\naway_player_x1 bigint NULL,\naway_player_x2 bigint NULL,\naway_player_x3 bigint NULL,\naway_player_x4 bigint NULL,\naway_player_x5 bigint NULL,\naway_player_x6 bigint NULL,\naway_player_x7 bigint NULL,\naway_player_x8 bigint NULL,\naway_player_x9 bigint NULL,\naway_player_x10 bigint NULL,\naway_player_x11 bigint NULL,\nhome_player_y1 bigint NULL,\nhome_player_y2 bigint NULL,\nhome_player_y3 bigint NULL,\nhome_player_y4 bigint NULL,\nhome_player_y5 bigint NULL,\nhome_player_y6 bigint NULL,\nhome_player_y7 bigint NULL,\nhome_player_y8 bigint NULL,\nhome_player_y9 bigint NULL,\nhome_player_y10 bigint NULL,\nhome_player_y11 bigint NULL,\naway_player_y1 bigint NULL,\naway_player_y2 bigint NULL,\naway_player_y3 bigint NULL,\naway_player_y4 bigint NULL,\naway_player_y5 bigint NULL,\naway_player_y6 bigint NULL,\naway_player_y7 bigint NULL,\naway_player_y8 bigint NULL,\naway_player_y9 bigint NULL,\naway_player_y10 bigint NULL,\naway_player_y11 bigint NULL,\nhome_player_1 bigint NULL,\nhome_player_2 bigint NULL,\nhome_player_3 bigint NULL,\nhome_player_4 bigint NULL,\nhome_player_5 bigint NULL,\nhome_player_6 bigint NULL,\nhome_player_7 bigint NULL,\nhome_player_8 bigint NULL,\nhome_player_9 bigint NULL,\nhome_player_10 bigint NULL,\nhome_player_11 bigint NULL,\naway_player_1 bigint NULL,\naway_player_2 bigint NULL,\naway_player_3 bigint NULL,\naway_player_4 bigint NULL,\naway_player_5 bigint NULL,\naway_player_6 bigint NULL,\naway_player_7 bigint NULL,\naway_player_8 bigint NULL,\naway_player_9 bigint NULL,\naway_player_10 bigint NULL,\naway_player_11 bigint NULL,\ngoal text NULL,\nshoton text NULL,\nshotoff text NULL,\nfoulcommit text NULL,\ncard text NULL,\ncross text NULL,\ncorner text NULL,\npossession text NULL,\nb365h real NULL,\nb365d real NULL,\nb365a real NULL,\nbwh real NULL,\nbwd real NULL,\nbwa real NULL,\niwh real NULL,\niwd real NULL,\niwa real NULL,\nlbh real NULL,\nlbd real NULL,\nlba real NULL,\npsh real NULL,\npsd real NULL,\npsa real NULL,\nwhh real NULL,\nwhd real NULL,\nwha real NULL,\nsjh real NULL,\nsjd real NULL,\nsja real NULL,\nvch real NULL,\nvcd real NULL,\nvca real NULL,\ngbh real NULL,\ngbd real NULL,\ngba real NULL,\nbsh real NULL,\nbsd real NULL,\nbsa real NULL,\n    PRIMARY KEY (id),\n    FOREIGN KEY (away_player_10) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_11) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_1) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_2) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_3) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_4) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_5) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_6) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_7) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_8) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_9) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_team_api_id) REFERENCES team(team_api_id),\n    FOREIGN KEY (home_player_10) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_11) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_1) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_2) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_3) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_4) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_5) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_6) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_7) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_8) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_9) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_team_api_id) REFERENCES team(team_api_id)\n);\n\nFirst 3 rows:\n  id    country_id    league_id  season       stage  date                   match_api_id    home_team_api_id    away_team_api_id    home_team_goal    away_team_goal  home_player_x1    home_player_x2    home_player_x3    home_player_x4    home_player_x5    home_player_x6    home_player_x7    home_player_x8    home_player_x9    home_player_x10    home_player_x11    away_player_x1    away_player_x2    away_player_x3    away_player_x4    away_player_x5    away_player_x6    away_player_x7    away_player_x8    away_player_x9    away_player_x10    away_player_x11    home_player_y1    home_player_y2    home_player_y3    home_player_y4    home_player_y5    home_player_y6    home_player_y7    home_player_y8    home_player_y9    home_player_y10    home_player_y11    away_player_y1    away_player_y2    away_player_y3    away_player_y4    away_player_y5    away_player_y6    away_player_y7    away_player_y8    away_player_y9    away_player_y10    away_player_y11    home_player_1    home_player_2    home_player_3    home_player_4    home_player_5    home_player_6    home_player_7    home_player_8    home_player_9    home_player_10    home_player_11    away_player_1    away_player_2    away_player_3    away_player_4    away_player_5    away_player_6    away_player_7    away_player_8    away_player_9    away_player_10    away_player_11      b365h    b365d    b365a    bwh    bwd    bwa    iwh    iwd    iwa    lbh    lbd    lba  psh    psd    psa      whh    whd    wha    sjh    sjd    sja    vch    vcd    vca    gbh    gbd    gba    bsh    bsd    bsa\n----  ------------  -----------  ---------  -------  -------------------  --------------  ------------------  ------------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  -----------------  -----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  -----------------  -----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  -----------------  -----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  -----------------  -----------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ----------------  ----------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ----------------  ----------------  -------  -------  -------  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----\n   1             1            1  2008/2009        1  2008-08-17 00:00:00          492473                9987                9993                 1                 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               1.73      3.4     5      1.75   3.35   4.2    1.85    3.2    3.5    1.8    3.3   3.75                        1.7    3.3    4.33   1.9     3.3    4     1.65   3.4    4.5    1.78   3.25   4      1.73   3.4    4.2\n   2             1            1  2008/2009        1  2008-08-16 00:00:00          492474               10000                9994                 0                 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               1.95      3.2     3.6    1.8    3.3    3.95   1.9     3.2    3.5    1.9    3.2   3.5                         1.83   3.3    3.6    1.95    3.3    3.8   2      3.25   3.25   1.85   3.25   3.75   1.91   3.25   3.6\n   3             1            1  2008/2009        1  2008-08-16 00:00:00          492475                9984                8635                 0                 3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               2.38      3.3     2.75   2.4    3.3    2.55   2.6     3.1    2.3    2.5    3.2   2.5                         2.5    3.25   2.4    2.63    3.3    2.5   2.35   3.25   2.65   2.5    3.2    2.5    2.3    3.2    2.75\n...\n\n\nCREATE TABLE \"player\" (\nid bigint NOT NULL DEFAULT nextval('player_id_seq'::regclass),\nplayer_api_id bigint NULL,\nplayer_name text NULL,\nplayer_fifa_api_id bigint NULL,\nbirthday text NULL,\nheight bigint NULL,\nweight bigint NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id    player_api_id  player_name           player_fifa_api_id  birthday               height    weight\n----  ---------------  ------------------  --------------------  -------------------  --------  --------\n   1           505942  Aaron Appindangoye                218353  1992-02-29 00:00:00       182       187\n   2           155782  Aaron Cresswell                   189615  1989-12-15 00:00:00       170       146\n   3           162549  Aaron Doran                       186170  1991-05-13 00:00:00       170       163\n...\n\n\nCREATE TABLE \"player_attributes\" (\nid bigint NOT NULL DEFAULT nextval('player_attributes_id_seq'::regclass),\nplayer_fifa_api_id bigint NULL,\nplayer_api_id bigint NULL,\ndate text NULL,\noverall_rating bigint NULL,\npotential bigint NULL,\npreferred_foot text NULL,\nattacking_work_rate text NULL,\ndefensive_work_rate text NULL,\ncrossing bigint NULL,\nfinishing bigint NULL,\nheading_accuracy bigint NULL,\nshort_passing bigint NULL,\nvolleys bigint NULL,\ndribbling bigint NULL,\ncurve bigint NULL,\nfree_kick_accuracy bigint NULL,\nlong_passing bigint NULL,\nball_control bigint NULL,\nacceleration bigint NULL,\nsprint_speed bigint NULL,\nagility bigint NULL,\nreactions bigint NULL,\nbalance bigint NULL,\nshot_power bigint NULL,\njumping bigint NULL,\nstamina bigint NULL,\nstrength bigint NULL,\nlong_shots bigint NULL,\naggression bigint NULL,\ninterceptions bigint NULL,\npositioning bigint NULL,\nvision bigint NULL,\npenalties bigint NULL,\nmarking bigint NULL,\nstanding_tackle bigint NULL,\nsliding_tackle bigint NULL,\ngk_diving bigint NULL,\ngk_handling bigint NULL,\ngk_kicking bigint NULL,\ngk_positioning bigint NULL,\ngk_reflexes bigint NULL,\n    PRIMARY KEY (id),\n    FOREIGN KEY (player_api_id) REFERENCES player(player_api_id)\n);\n\nFirst 3 rows:\n  id    player_fifa_api_id    player_api_id  date                   overall_rating    potential  preferred_foot    attacking_work_rate    defensive_work_rate      crossing    finishing    heading_accuracy    short_passing    volleys    dribbling    curve    free_kick_accuracy    long_passing    ball_control    acceleration    sprint_speed    agility    reactions    balance    shot_power    jumping    stamina    strength    long_shots    aggression    interceptions    positioning    vision    penalties    marking    standing_tackle    sliding_tackle    gk_diving    gk_handling    gk_kicking    gk_positioning    gk_reflexes\n----  --------------------  ---------------  -------------------  ----------------  -----------  ----------------  ---------------------  ---------------------  ----------  -----------  ------------------  ---------------  ---------  -----------  -------  --------------------  --------------  --------------  --------------  --------------  ---------  -----------  ---------  ------------  ---------  ---------  ----------  ------------  ------------  ---------------  -------------  --------  -----------  ---------  -----------------  ----------------  -----------  -------------  ------------  ----------------  -------------\n   1                218353           505942  2016-02-18 00:00:00                67           71  right             medium                 medium                         49           44                  71               61         44           51       45                    39              64              49              60              64         59           47         65            55         58         54          76            35            71               70             45        54           48         65                 69                69            6             11            10                 8              8\n   2                218353           505942  2015-11-19 00:00:00                67           71  right             medium                 medium                         49           44                  71               61         44           51       45                    39              64              49              60              64         59           47         65            55         58         54          76            35            71               70             45        54           48         65                 69                69            6             11            10                 8              8\n   3                218353           505942  2015-09-21 00:00:00                62           66  right             medium                 medium                         49           44                  71               61         44           51       45                    39              64              49              60              64         59           47         65            55         58         54          76            35            63               41             45        54           48         65                 66                69            6             11            10                 8              8\n...\n\n\nCREATE TABLE \"team\" (\nid bigint NOT NULL DEFAULT nextval('team_id_seq'::regclass),\nteam_api_id bigint NULL,\nteam_fifa_api_id bigint NULL,\nteam_long_name text NULL,\nteam_short_name text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id    team_api_id    team_fifa_api_id  team_long_name    team_short_name\n----  -------------  ------------------  ----------------  -----------------\n   1           9987                 673  KRC Genk          GEN\n   2           9993                 675  Beerschot AC      BAC\n   3          10000               15005  SV Zulte-Waregem  ZUL\n...\n\n\nCREATE TABLE \"team_attributes\" (\nid bigint NOT NULL DEFAULT nextval('team_attributes_id_seq'::regclass),\nteam_fifa_api_id bigint NULL,\nteam_api_id bigint NULL,\ndate text NULL,\nbuildupplayspeed bigint NULL,\nbuildupplayspeedclass text NULL,\nbuildupplaydribbling bigint NULL,\nbuildupplaydribblingclass text NULL,\nbuildupplaypassing bigint NULL,\nbuildupplaypassingclass text NULL,\nbuildupplaypositioningclass text NULL,\nchancecreationpassing bigint NULL,\nchancecreationpassingclass text NULL,\nchancecreationcrossing bigint NULL,\nchancecreationcrossingclass text NULL,\nchancecreationshooting bigint NULL,\nchancecreationshootingclass text NULL,\nchancecreationpositioningclass text NULL,\ndefencepressure bigint NULL,\ndefencepressureclass text NULL,\ndefenceaggression bigint NULL,\ndefenceaggressionclass text NULL,\ndefenceteamwidth bigint NULL,\ndefenceteamwidthclass text NULL,\ndefencedefenderlineclass text NULL,\n    PRIMARY KEY (id),\n    FOREIGN KEY (team_api_id) REFERENCES team(team_api_id)\n);\n\nFirst 3 rows:\n  id    team_fifa_api_id    team_api_id  date                   buildupplayspeed  buildupplayspeedclass      buildupplaydribbling  buildupplaydribblingclass      buildupplaypassing  buildupplaypassingclass    buildupplaypositioningclass      chancecreationpassing  chancecreationpassingclass      chancecreationcrossing  chancecreationcrossingclass      chancecreationshooting  chancecreationshootingclass    chancecreationpositioningclass      defencepressure  defencepressureclass      defenceaggression  defenceaggressionclass      defenceteamwidth  defenceteamwidthclass    defencedefenderlineclass\n----  ------------------  -------------  -------------------  ------------------  -----------------------  ----------------------  ---------------------------  --------------------  -------------------------  -----------------------------  -----------------------  ----------------------------  ------------------------  -----------------------------  ------------------------  -----------------------------  --------------------------------  -----------------  ----------------------  -------------------  ------------------------  ------------------  -----------------------  --------------------------\n   1                 434           9930  2010-02-22 00:00:00                  60  Balanced                                    nan  Little                                         50  Mixed                      Organised                                           60  Normal                                              65  Normal                                               55  Normal                         Organised                                        50  Medium                                   55  Press                                     45  Normal                   Cover\n   2                 434           9930  2014-09-19 00:00:00                  52  Balanced                                     48  Normal                                         56  Mixed                      Organised                                           54  Normal                                              63  Normal                                               64  Normal                         Organised                                        47  Medium                                   44  Press                                     54  Normal                   Cover\n   3                 434           9930  2015-09-10 00:00:00                  47  Balanced                                     41  Normal                                         54  Mixed                      Organised                                           54  Normal                                              63  Normal                                               64  Normal                         Organised                                        47  Medium                                   44  Press                                     54  Normal                   Cover\n...\n", "preprocess_schema": "CREATE TABLE \"country\" (\nid bigint NOT NULL DEFAULT nextval('country_id_seq'::regclass),\nname text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id  name\n----  -------\n   1  Belgium\n1729  England\n4769  France\n...\n\n\nCREATE TABLE \"league\" (\nid bigint NOT NULL DEFAULT nextval('league_id_seq'::regclass),\ncountry_id bigint NULL,\nname text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id    country_id  name\n----  ------------  ----------------------\n   1             1  Belgium Jupiler League\n1729          1729  England Premier League\n4769          4769  France Ligue 1\n...\n\n\nCREATE TABLE \"match\" (\nid bigint NOT NULL DEFAULT nextval('match_id_seq'::regclass),\ncountry_id bigint NULL,\nleague_id bigint NULL,\nseason text NULL,\nstage bigint NULL,\ndate text NULL,\nmatch_api_id bigint NULL,\nhome_team_api_id bigint NULL,\naway_team_api_id bigint NULL,\nhome_team_goal bigint NULL,\naway_team_goal bigint NULL,\nhome_player_x1 bigint NULL,\nhome_player_x2 bigint NULL,\nhome_player_x3 bigint NULL,\nhome_player_x4 bigint NULL,\nhome_player_x5 bigint NULL,\nhome_player_x6 bigint NULL,\nhome_player_x7 bigint NULL,\nhome_player_x8 bigint NULL,\nhome_player_x9 bigint NULL,\nhome_player_x10 bigint NULL,\nhome_player_x11 bigint NULL,\naway_player_x1 bigint NULL,\naway_player_x2 bigint NULL,\naway_player_x3 bigint NULL,\naway_player_x4 bigint NULL,\naway_player_x5 bigint NULL,\naway_player_x6 bigint NULL,\naway_player_x7 bigint NULL,\naway_player_x8 bigint NULL,\naway_player_x9 bigint NULL,\naway_player_x10 bigint NULL,\naway_player_x11 bigint NULL,\nhome_player_y1 bigint NULL,\nhome_player_y2 bigint NULL,\nhome_player_y3 bigint NULL,\nhome_player_y4 bigint NULL,\nhome_player_y5 bigint NULL,\nhome_player_y6 bigint NULL,\nhome_player_y7 bigint NULL,\nhome_player_y8 bigint NULL,\nhome_player_y9 bigint NULL,\nhome_player_y10 bigint NULL,\nhome_player_y11 bigint NULL,\naway_player_y1 bigint NULL,\naway_player_y2 bigint NULL,\naway_player_y3 bigint NULL,\naway_player_y4 bigint NULL,\naway_player_y5 bigint NULL,\naway_player_y6 bigint NULL,\naway_player_y7 bigint NULL,\naway_player_y8 bigint NULL,\naway_player_y9 bigint NULL,\naway_player_y10 bigint NULL,\naway_player_y11 bigint NULL,\nhome_player_1 bigint NULL,\nhome_player_2 bigint NULL,\nhome_player_3 bigint NULL,\nhome_player_4 bigint NULL,\nhome_player_5 bigint NULL,\nhome_player_6 bigint NULL,\nhome_player_7 bigint NULL,\nhome_player_8 bigint NULL,\nhome_player_9 bigint NULL,\nhome_player_10 bigint NULL,\nhome_player_11 bigint NULL,\naway_player_1 bigint NULL,\naway_player_2 bigint NULL,\naway_player_3 bigint NULL,\naway_player_4 bigint NULL,\naway_player_5 bigint NULL,\naway_player_6 bigint NULL,\naway_player_7 bigint NULL,\naway_player_8 bigint NULL,\naway_player_9 bigint NULL,\naway_player_10 bigint NULL,\naway_player_11 bigint NULL,\ngoal text NULL,\nshoton text NULL,\nshotoff text NULL,\nfoulcommit text NULL,\ncard text NULL,\ncross text NULL,\ncorner text NULL,\npossession text NULL,\nb365h real NULL,\nb365d real NULL,\nb365a real NULL,\nbwh real NULL,\nbwd real NULL,\nbwa real NULL,\niwh real NULL,\niwd real NULL,\niwa real NULL,\nlbh real NULL,\nlbd real NULL,\nlba real NULL,\npsh real NULL,\npsd real NULL,\npsa real NULL,\nwhh real NULL,\nwhd real NULL,\nwha real NULL,\nsjh real NULL,\nsjd real NULL,\nsja real NULL,\nvch real NULL,\nvcd real NULL,\nvca real NULL,\ngbh real NULL,\ngbd real NULL,\ngba real NULL,\nbsh real NULL,\nbsd real NULL,\nbsa real NULL,\n    PRIMARY KEY (id),\n    FOREIGN KEY (away_player_10) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_11) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_1) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_2) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_3) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_4) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_5) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_6) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_7) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_8) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_player_9) REFERENCES player(player_api_id),\n    FOREIGN KEY (away_team_api_id) REFERENCES team(team_api_id),\n    FOREIGN KEY (home_player_10) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_11) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_1) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_2) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_3) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_4) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_5) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_6) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_7) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_8) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_player_9) REFERENCES player(player_api_id),\n    FOREIGN KEY (home_team_api_id) REFERENCES team(team_api_id)\n);\n\nFirst 3 rows:\n  id    country_id    league_id  season       stage  date                   match_api_id    home_team_api_id    away_team_api_id    home_team_goal    away_team_goal  home_player_x1    home_player_x2    home_player_x3    home_player_x4    home_player_x5    home_player_x6    home_player_x7    home_player_x8    home_player_x9    home_player_x10    home_player_x11    away_player_x1    away_player_x2    away_player_x3    away_player_x4    away_player_x5    away_player_x6    away_player_x7    away_player_x8    away_player_x9    away_player_x10    away_player_x11    home_player_y1    home_player_y2    home_player_y3    home_player_y4    home_player_y5    home_player_y6    home_player_y7    home_player_y8    home_player_y9    home_player_y10    home_player_y11    away_player_y1    away_player_y2    away_player_y3    away_player_y4    away_player_y5    away_player_y6    away_player_y7    away_player_y8    away_player_y9    away_player_y10    away_player_y11    home_player_1    home_player_2    home_player_3    home_player_4    home_player_5    home_player_6    home_player_7    home_player_8    home_player_9    home_player_10    home_player_11    away_player_1    away_player_2    away_player_3    away_player_4    away_player_5    away_player_6    away_player_7    away_player_8    away_player_9    away_player_10    away_player_11      b365h    b365d    b365a    bwh    bwd    bwa    iwh    iwd    iwa    lbh    lbd    lba  psh    psd    psa      whh    whd    wha    sjh    sjd    sja    vch    vcd    vca    gbh    gbd    gba    bsh    bsd    bsa\n----  ------------  -----------  ---------  -------  -------------------  --------------  ------------------  ------------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  -----------------  -----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  -----------------  -----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  -----------------  -----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  -----------------  -----------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ----------------  ----------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ----------------  ----------------  -------  -------  -------  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----\n   1             1            1  2008/2009        1  2008-08-17 00:00:00          492473                9987                9993                 1                 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               1.73      3.4     5      1.75   3.35   4.2    1.85    3.2    3.5    1.8    3.3   3.75                        1.7    3.3    4.33   1.9     3.3    4     1.65   3.4    4.5    1.78   3.25   4      1.73   3.4    4.2\n   2             1            1  2008/2009        1  2008-08-16 00:00:00          492474               10000                9994                 0                 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               1.95      3.2     3.6    1.8    3.3    3.95   1.9     3.2    3.5    1.9    3.2   3.5                         1.83   3.3    3.6    1.95    3.3    3.8   2      3.25   3.25   1.85   3.25   3.75   1.91   3.25   3.6\n   3             1            1  2008/2009        1  2008-08-16 00:00:00          492475                9984                8635                 0                 3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               2.38      3.3     2.75   2.4    3.3    2.55   2.6     3.1    2.3    2.5    3.2   2.5                         2.5    3.25   2.4    2.63    3.3    2.5   2.35   3.25   2.65   2.5    3.2    2.5    2.3    3.2    2.75\n...\n\n\nCREATE TABLE \"player\" (\nid bigint NOT NULL DEFAULT nextval('player_id_seq'::regclass),\nplayer_api_id bigint NULL,\nplayer_name text NULL,\nplayer_fifa_api_id bigint NULL,\nbirthday text NULL,\nheight bigint NULL,\nweight bigint NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id    player_api_id  player_name           player_fifa_api_id  birthday               height    weight\n----  ---------------  ------------------  --------------------  -------------------  --------  --------\n   1           505942  Aaron Appindangoye                218353  1992-02-29 00:00:00       182       187\n   2           155782  Aaron Cresswell                   189615  1989-12-15 00:00:00       170       146\n   3           162549  Aaron Doran                       186170  1991-05-13 00:00:00       170       163\n...\n\n\nCREATE TABLE \"player_attributes\" (\nid bigint NOT NULL DEFAULT nextval('player_attributes_id_seq'::regclass),\nplayer_fifa_api_id bigint NULL,\nplayer_api_id bigint NULL,\ndate text NULL,\noverall_rating bigint NULL,\npotential bigint NULL,\npreferred_foot text NULL,\nattacking_work_rate text NULL,\ndefensive_work_rate text NULL,\ncrossing bigint NULL,\nfinishing bigint NULL,\nheading_accuracy bigint NULL,\nshort_passing bigint NULL,\nvolleys bigint NULL,\ndribbling bigint NULL,\ncurve bigint NULL,\nfree_kick_accuracy bigint NULL,\nlong_passing bigint NULL,\nball_control bigint NULL,\nacceleration bigint NULL,\nsprint_speed bigint NULL,\nagility bigint NULL,\nreactions bigint NULL,\nbalance bigint NULL,\nshot_power bigint NULL,\njumping bigint NULL,\nstamina bigint NULL,\nstrength bigint NULL,\nlong_shots bigint NULL,\naggression bigint NULL,\ninterceptions bigint NULL,\npositioning bigint NULL,\nvision bigint NULL,\npenalties bigint NULL,\nmarking bigint NULL,\nstanding_tackle bigint NULL,\nsliding_tackle bigint NULL,\ngk_diving bigint NULL,\ngk_handling bigint NULL,\ngk_kicking bigint NULL,\ngk_positioning bigint NULL,\ngk_reflexes bigint NULL,\n    PRIMARY KEY (id),\n    FOREIGN KEY (player_api_id) REFERENCES player(player_api_id)\n);\n\nFirst 3 rows:\n  id    player_fifa_api_id    player_api_id  date                   overall_rating    potential  preferred_foot    attacking_work_rate    defensive_work_rate      crossing    finishing    heading_accuracy    short_passing    volleys    dribbling    curve    free_kick_accuracy    long_passing    ball_control    acceleration    sprint_speed    agility    reactions    balance    shot_power    jumping    stamina    strength    long_shots    aggression    interceptions    positioning    vision    penalties    marking    standing_tackle    sliding_tackle    gk_diving    gk_handling    gk_kicking    gk_positioning    gk_reflexes\n----  --------------------  ---------------  -------------------  ----------------  -----------  ----------------  ---------------------  ---------------------  ----------  -----------  ------------------  ---------------  ---------  -----------  -------  --------------------  --------------  --------------  --------------  --------------  ---------  -----------  ---------  ------------  ---------  ---------  ----------  ------------  ------------  ---------------  -------------  --------  -----------  ---------  -----------------  ----------------  -----------  -------------  ------------  ----------------  -------------\n   1                218353           505942  2016-02-18 00:00:00                67           71  right             medium                 medium                         49           44                  71               61         44           51       45                    39              64              49              60              64         59           47         65            55         58         54          76            35            71               70             45        54           48         65                 69                69            6             11            10                 8              8\n   2                218353           505942  2015-11-19 00:00:00                67           71  right             medium                 medium                         49           44                  71               61         44           51       45                    39              64              49              60              64         59           47         65            55         58         54          76            35            71               70             45        54           48         65                 69                69            6             11            10                 8              8\n   3                218353           505942  2015-09-21 00:00:00                62           66  right             medium                 medium                         49           44                  71               61         44           51       45                    39              64              49              60              64         59           47         65            55         58         54          76            35            63               41             45        54           48         65                 66                69            6             11            10                 8              8\n...\n\n\nCREATE TABLE \"stadium_bookings\" (\nbooking_id text NOT NULL,\nstadium_id text NOT NULL,\nstart_at timestamp with time zone NOT NULL,\nend_at timestamp with time zone NOT NULL,\ncreated_at timestamp with time zone NULL DEFAULT CURRENT_TIMESTAMP,\nupdated_at timestamp with time zone NULL DEFAULT CURRENT_TIMESTAMP,\nbooking_status character varying NULL DEFAULT 'confirmed'::character varying,\nbooking_type character varying NULL DEFAULT 'standard'::character varying,\ncustomer_id uuid NULL DEFAULT gen_random_uuid(),\nevent_name text NULL DEFAULT 'Unnamed Event'::text,\nattendees_count integer NULL DEFAULT 0,\ntotal_price numeric NULL DEFAULT 0.00,\npayment_status character varying NULL DEFAULT 'pending'::character varying,\nnotes text NULL,\nis_recurring boolean NULL DEFAULT false,\nrecurrence_pattern jsonb NULL DEFAULT '{}'::jsonb,\ncancellation_policy text NULL DEFAULT 'Standard 48-hour cancellation policy applies'::text,\nspecial_requirements text NULL,\ncontact_person character varying NULL DEFAULT NULL::character varying,\ncontact_email character varying NULL DEFAULT NULL::character varying,\ncontact_phone character varying NULL DEFAULT NULL::character varying,\ninternal_reference_code character varying NULL DEFAULT NULL::character varying,\nlast_modified_by character varying NULL DEFAULT 'system'::character varying,\nversion_number integer NULL DEFAULT 1\n);\n\nFirst 3 rows:\nbooking_id    stadium_id    start_at                   end_at                     created_at                 updated_at                 booking_status    booking_type    customer_id                           event_name                      attendees_count    total_price  payment_status    notes                                                                           is_recurring    recurrence_pattern                                                  cancellation_policy                                   special_requirements                                                  contact_person    contact_email                    contact_phone    internal_reference_code    last_modified_by      version_number\n------------  ------------  -------------------------  -------------------------  -------------------------  -------------------------  ----------------  --------------  ------------------------------------  ----------------------------  -----------------  -------------  ----------------  ------------------------------------------------------------------------------  --------------  ------------------------------------------------------------------  ----------------------------------------------------  --------------------------------------------------------------------  ----------------  -------------------------------  ---------------  -------------------------  ------------------  ----------------\nbooking1      stadium1      2023-06-01 14:00:00+08:00  2023-06-03 18:00:00+08:00  2023-05-15 09:23:45+08:00  2023-05-15 09:23:45+08:00  confirmed         tournament      a1b2c3d4-e5f6-7890-abcd-ef1234567890  Summer Football Championship               1500         5000    paid              Annual football tournament with 16 teams                                        False           {'day': 'first Saturday of June', 'frequency': 'annual'}            No refunds within 14 days of event                    Extra seating required in north stand                                 John Smith        john.smith@example.com           +1-555-123-4567  SFC-2023-06                admin                              1\nbooking2      stadium1      2023-06-04 14:00:00+08:00  2023-06-04 18:00:00+08:00  2023-05-20 14:30:12+08:00  2023-05-25 11:15:30+08:00  confirmed         friendly match  b2c3d4e5-f6a7-8901-bcde-f23456789012  Charity Exhibition Match                    800         1200.5  paid              Charity match between local celebrities and retired professionals               False           {}                                                                  Standard 48-hour cancellation policy applies          VIP area setup required                                               Mary Johnson      mary.j@charity.org               +1-555-987-6543  CEM-2023-06                booking_manager                    2\nbooking3      stadium1      2023-06-06 10:30:00+08:00  2023-07-02 16:30:00+08:00  2023-04-10 08:45:22+08:00  2023-05-30 16:20:18+08:00  confirmed         training camp   c3d4e5f6-a7b8-9012-cdef-345678901234  National Team Training Camp                 120        15000    partially_paid    Extended booking for national team preparation before international tournament  True            {'days': ['Monday', 'Wednesday', 'Friday'], 'frequency': 'weekly'}  Cancellation fee of 50% applies to all cancellations  Private access only, media area required, enhanced security measures  Coach Thompson    coach.thompson@nationalteam.org  +1-555-789-0123  NTC-2023-06                director                           3\n...\n\n\nCREATE TABLE \"team\" (\nid bigint NOT NULL DEFAULT nextval('team_id_seq'::regclass),\nteam_api_id bigint NULL,\nteam_fifa_api_id bigint NULL,\nteam_long_name text NULL,\nteam_short_name text NULL,\n    PRIMARY KEY (id)\n);\n\nFirst 3 rows:\n  id    team_api_id    team_fifa_api_id  team_long_name    team_short_name\n----  -------------  ------------------  ----------------  -----------------\n   1           9987                 673  KRC Genk          GEN\n   2           9993                 675  Beerschot AC      BAC\n   3          10000               15005  SV Zulte-Waregem  ZUL\n...\n\n\nCREATE TABLE \"team_attributes\" (\nid bigint NOT NULL DEFAULT nextval('team_attributes_id_seq'::regclass),\nteam_fifa_api_id bigint NULL,\nteam_api_id bigint NULL,\ndate text NULL,\nbuildupplayspeed bigint NULL,\nbuildupplayspeedclass text NULL,\nbuildupplaydribbling bigint NULL,\nbuildupplaydribblingclass text NULL,\nbuildupplaypassing bigint NULL,\nbuildupplaypassingclass text NULL,\nbuildupplaypositioningclass text NULL,\nchancecreationpassing bigint NULL,\nchancecreationpassingclass text NULL,\nchancecreationcrossing bigint NULL,\nchancecreationcrossingclass text NULL,\nchancecreationshooting bigint NULL,\nchancecreationshootingclass text NULL,\nchancecreationpositioningclass text NULL,\ndefencepressure bigint NULL,\ndefencepressureclass text NULL,\ndefenceaggression bigint NULL,\ndefenceaggressionclass text NULL,\ndefenceteamwidth bigint NULL,\ndefenceteamwidthclass text NULL,\ndefencedefenderlineclass text NULL,\n    PRIMARY KEY (id),\n    FOREIGN KEY (team_api_id) REFERENCES team(team_api_id)\n);\n\nFirst 3 rows:\n  id    team_fifa_api_id    team_api_id  date                   buildupplayspeed  buildupplayspeedclass      buildupplaydribbling  buildupplaydribblingclass      buildupplaypassing  buildupplaypassingclass    buildupplaypositioningclass      chancecreationpassing  chancecreationpassingclass      chancecreationcrossing  chancecreationcrossingclass      chancecreationshooting  chancecreationshootingclass    chancecreationpositioningclass      defencepressure  defencepressureclass      defenceaggression  defenceaggressionclass      defenceteamwidth  defenceteamwidthclass    defencedefenderlineclass\n----  ------------------  -------------  -------------------  ------------------  -----------------------  ----------------------  ---------------------------  --------------------  -------------------------  -----------------------------  -----------------------  ----------------------------  ------------------------  -----------------------------  ------------------------  -----------------------------  --------------------------------  -----------------  ----------------------  -------------------  ------------------------  ------------------  -----------------------  --------------------------\n   1                 434           9930  2010-02-22 00:00:00                  60  Balanced                                    nan  Little                                         50  Mixed                      Organised                                           60  Normal                                              65  Normal                                               55  Normal                         Organised                                        50  Medium                                   55  Press                                     45  Normal                   Cover\n   2                 434           9930  2014-09-19 00:00:00                  52  Balanced                                     48  Normal                                         56  Mixed                      Organised                                           54  Normal                                              63  Normal                                               64  Normal                         Organised                                        47  Medium                                   44  Press                                     54  Normal                   Cover\n   3                 434           9930  2015-09-10 00:00:00                  47  Balanced                                     41  Normal                                         54  Mixed                      Organised                                           54  Normal                                              63  Normal                                               64  Normal                         Organised                                        47  Medium                                   44  Press                                     54  Normal                   Cover\n...\n", "sol_sql": ["WITH booking_days AS (SELECT *, CASE WHEN start_at::time = '00:00:00' THEN start_at ELSE date_trunc('day', start_at) + interval '1 day' END AS start_at_next_day, date_trunc('day', end_at) AS end_at_whole_day FROM stadium_bookings) SELECT booking_id, stadium_id, start_at, end_at FROM booking_days WHERE end_at_whole_day < start_at_next_day UNION ALL SELECT booking_id, stadium_id, start_at_next_day, end_at_whole_day FROM booking_days WHERE end_at_whole_day > start_at_next_day UNION ALL SELECT booking_id, stadium_id, start_at, start_at_next_day FROM booking_days WHERE end_at_whole_day >= start_at_next_day AND start_at::time > '00:00:00' UNION ALL SELECT booking_id, stadium_id, end_at_whole_day, end_at FROM booking_days WHERE end_at_whole_day >= start_at_next_day AND end_at::time > '00:00:00' ORDER BY booking_id, stadium_id, start_at;"], "test_cases": ["\ndef test_case(pred_sqls, sol_sqls, db_name, conn):\n    result = ex_base(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"ex_base returned {result} but expected 1.\"\n    ", "\ndef test_case(pred_sqls, sol_sqls, db_name, conn):\n    le = len(pred_sqls[0])\n    assert le <= 1212, f\"pred_sqls length is {le}, which is not simpler.\"\n    ", "\ndef test_case(pred_sqls, sol_sqls, db_name, conn):\n    result = performance_compare_by_qep(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"performance_check returned {result} but expected 1.\"\n    "]}
{"instance_id": "PostgreSQL_220", "dialect": "PostgreSQL", "version": "14.12", "db_id": "formula_1", "query": "We have a table in the formula_1 database that contains data detail categorized by country, metric code, and demographic groups (male, female, pensioners, teenagers). The table structure and data are as follows:\\n| country  | metric_code | male        | female      | pensioners  | teenagers   |\\n| -------- | ----------- | ----------- | ----------- | ----------- | ----------- |\\n| us       | metric_1    | 10          | 14          | 22          | 30          |\\n| us       | metric_2    | 105         | 142         | 222         | 309         |\\n| uk       | metric_1    | 15          | 13          | 9           | 21          |\\n| uk       | metric_2    | 212         | 264         | 440         | 165         |\\nWe need to transform this table to have the following structure:\\n| country  | predicate_code | metric_1    | metric_2    |\\n| -------- | -----------    | ----------- | ----------- |\\n| us       | male           | 10          | 105         |\\n| us       | female         | 14          | 142         |\\n| us       | pensioners     | 22          | 222         |\\n| us       | teenagers      | 30          | 309         |\\n| uk       | male           | 15          | 212         |\\n| uk       | female         | 13          | 264         |\\n| uk       | pensioners     | 9           | 440         |\\n| uk       | teenagers      | 21          | 165         |\\nThe user achieved this transformation using the following SQL query. Can you provide other ways that achieves the same goal and also improves query performance?", "issue_sql": ["select country, predicate_code, max(case when metric_code = 'metric_1' then value end) as metric_1, max(case when metric_code = 'metric_2' then value end) as metric_2 from data_detail t cross join lateral (values ('male', male), ('female', female), ('pensioners', pensioners), ('teenagers', teenagers)) as v(predicate_code, value) group by country, predicate_code order by 1, 2;"], "preprocess_sql": ["create table data_detail (country text, metric_code text, male int, female int, pensioners int, teenagers int);", "insert into data_detail(country, metric_code, male, female, pensioners, teenagers) values ('us', 'metric_1', 10, 14, 22, 30), ('us', 'metric_2', 105, 142, 222, 309), ('uk', 'metric_1', 15, 13, 9, 21), ('uk', 'metric_2', 212, 264, 440, 165);"], "clean_up_sql": ["DROP TABLE data_detail;"], "category": "Efficiency", "original_schema": "CREATE TABLE \"circuits\" (\ncircuitid bigint NOT NULL DEFAULT nextval('circuits_circuitid_seq'::regclass),\ncircuitref text NULL DEFAULT ''::text,\nname text NULL DEFAULT ''::text,\nlocation text NULL,\ncountry text NULL,\nlat real NULL,\nlng real NULL,\nalt bigint NULL,\nurl text NULL DEFAULT ''::text,\n    PRIMARY KEY (circuitid)\n);\n\nFirst 3 rows:\n  circuitid  circuitref    name                            location      country         lat        lng  alt    url\n-----------  ------------  ------------------------------  ------------  ---------  --------  ---------  -----  -----------------------------------------------------------\n          2  sepang        Sepang International Circuit    Kuala Lumpur  Malaysia    2.76083  101.738           http://en.wikipedia.org/wiki/Sepang_International_Circuit\n          3  bahrain       Bahrain International Circuit   Sakhir        Bahrain    26.0325    50.5106          http://en.wikipedia.org/wiki/Bahrain_International_Circuit\n          4  catalunya     Circuit de Barcelona-Catalunya  Montmeló      Spain      41.57       2.26111         http://en.wikipedia.org/wiki/Circuit_de_Barcelona-Catalunya\n...\n\n\nCREATE TABLE \"constructorresults\" (\nconstructorresultsid bigint NOT NULL DEFAULT nextval('constructorresults_constructorresultsid_seq'::regclass),\nraceid bigint NULL DEFAULT '0'::bigint,\nconstructorid bigint NULL DEFAULT '0'::bigint,\npoints real NULL,\nstatus text NULL,\n    PRIMARY KEY (constructorresultsid),\n    FOREIGN KEY (constructorid) REFERENCES constructors(constructorid)\n);\n\nFirst 3 rows:\n  constructorresultsid    raceid    constructorid    points  status\n----------------------  --------  ---------------  --------  --------\n                     1        18                1        14\n                     2        18                2         8\n                     3        18                3         9\n...\n\n\nCREATE TABLE \"constructors\" (\nconstructorid bigint NOT NULL DEFAULT nextval('constructors_constructorid_seq'::regclass),\nconstructorref text NULL DEFAULT ''::text,\nname text NULL DEFAULT ''::text,\nnationality text NULL,\nurl text NULL DEFAULT ''::text,\n    PRIMARY KEY (constructorid)\n);\n\nFirst 3 rows:\n  constructorid  constructorref    name        nationality    url\n---------------  ----------------  ----------  -------------  ------------------------------------------------------------\n              1  mclaren           McLaren     British        http://en.wikipedia.org/wiki/McLaren\n              2  bmw_sauber        BMW Sauber  German         http://en.wikipedia.org/wiki/BMW_Sauber\n              3  williams          Williams    British        http://en.wikipedia.org/wiki/Williams_Grand_Prix_Engineering\n...\n\n\nCREATE TABLE \"constructorstandings\" (\nconstructorstandingsid bigint NOT NULL DEFAULT nextval('constructorstandings_constructorstandingsid_seq'::regclass),\nraceid bigint NULL DEFAULT '0'::bigint,\nconstructorid bigint NULL DEFAULT '0'::bigint,\npoints real NULL DEFAULT '0'::real,\nposition bigint NULL,\npositiontext text NULL,\nwins bigint NULL DEFAULT '0'::bigint,\n    PRIMARY KEY (constructorstandingsid),\n    FOREIGN KEY (constructorid) REFERENCES constructors(constructorid)\n);\n\nFirst 3 rows:\n  constructorstandingsid    raceid    constructorid    points    position    positiontext    wins\n------------------------  --------  ---------------  --------  ----------  --------------  ------\n                       1        18                1        14           1               1       1\n                       2        18                2         8           3               3       0\n                       3        18                3         9           2               2       0\n...\n\n\nCREATE TABLE \"drivers\" (\ndriverid bigint NOT NULL DEFAULT nextval('drivers_driverid_seq'::regclass),\ndriverref text NULL DEFAULT ''::text,\nnumber bigint NULL,\ncode text NULL,\nforename text NULL DEFAULT ''::text,\nsurname text NULL DEFAULT ''::text,\ndob date NULL,\nnationality text NULL,\nurl text NULL DEFAULT ''::text,\n    PRIMARY KEY (driverid)\n);\n\nFirst 3 rows:\n  driverid  driverref      number  code    forename    surname    dob         nationality    url\n----------  -----------  --------  ------  ----------  ---------  ----------  -------------  -------------------------------------------\n         1  hamilton           44  HAM     Lewis       Hamilton   1985-01-07  British        http://en.wikipedia.org/wiki/Lewis_Hamilton\n         2  heidfeld          nan  HEI     Nick        Heidfeld   1977-05-10  German         http://en.wikipedia.org/wiki/Nick_Heidfeld\n         3  rosberg             6  ROS     Nico        Rosberg    1985-06-27  German         http://en.wikipedia.org/wiki/Nico_Rosberg\n...\n\n\nCREATE TABLE \"driverstandings\" (\ndriverstandingsid bigint NOT NULL DEFAULT nextval('driverstandings_driverstandingsid_seq'::regclass),\nraceid bigint NULL DEFAULT '0'::bigint,\ndriverid bigint NULL DEFAULT '0'::bigint,\npoints real NULL DEFAULT '0'::real,\nposition bigint NULL,\npositiontext text NULL,\nwins bigint NULL DEFAULT '0'::bigint,\n    PRIMARY KEY (driverstandingsid),\n    FOREIGN KEY (driverid) REFERENCES drivers(driverid)\n);\n\nFirst 3 rows:\n  driverstandingsid    raceid    driverid    points    position    positiontext    wins\n-------------------  --------  ----------  --------  ----------  --------------  ------\n                  1        18           1        10           1               1       1\n                  2        18           2         8           2               2       0\n                  3        18           3         6           3               3       0\n...\n\n\nCREATE TABLE \"laptimes\" (\nraceid bigint NOT NULL,\ndriverid bigint NOT NULL,\nlap bigint NOT NULL,\nposition bigint NULL,\ntime text NULL,\nmilliseconds bigint NULL,\n    PRIMARY KEY (raceid, driverid, lap),\n    FOREIGN KEY (driverid) REFERENCES drivers(driverid),\n    FOREIGN KEY (raceid) REFERENCES races(raceid)\n);\n\nFirst 3 rows:\n  raceid    driverid    lap    position  time        milliseconds\n--------  ----------  -----  ----------  --------  --------------\n       2           1      1          10  1:52.965          112965\n       2           1      2          10  1:41.865          101865\n       2           1      3          10  1:40.869          100869\n...\n\n\nCREATE TABLE \"pitstops\" (\nraceid bigint NOT NULL,\ndriverid bigint NOT NULL,\nstop bigint NOT NULL,\nlap bigint NULL,\ntime text NULL,\nduration text NULL,\nmilliseconds bigint NULL,\n    PRIMARY KEY (raceid, driverid, stop),\n    FOREIGN KEY (driverid) REFERENCES drivers(driverid),\n    FOREIGN KEY (raceid) REFERENCES races(raceid)\n);\n\nFirst 3 rows:\n  raceid    driverid    stop    lap  time        duration    milliseconds\n--------  ----------  ------  -----  --------  ----------  --------------\n     842           1       1     12  16:24:40      22.552           22552\n     842           1       2     24  16:45:48      22.611           22611\n     842           1       3     37  17:08:28      25.382           25382\n...\n\n\nCREATE TABLE \"qualifying\" (\nqualifyid bigint NOT NULL DEFAULT nextval('qualifying_qualifyid_seq'::regclass),\nraceid bigint NULL DEFAULT '0'::bigint,\ndriverid bigint NULL DEFAULT '0'::bigint,\nconstructorid bigint NULL DEFAULT '0'::bigint,\nnumber bigint NULL DEFAULT '0'::bigint,\nposition bigint NULL,\nq1 text NULL,\nq2 text NULL,\nq3 text NULL,\n    PRIMARY KEY (qualifyid),\n    FOREIGN KEY (constructorid) REFERENCES constructors(constructorid),\n    FOREIGN KEY (driverid) REFERENCES drivers(driverid),\n    FOREIGN KEY (raceid) REFERENCES races(raceid)\n);\n\nFirst 3 rows:\n  qualifyid    raceid    driverid    constructorid    number    position  q1        q2        q3\n-----------  --------  ----------  ---------------  --------  ----------  --------  --------  --------\n         23        19          13                6         2           1  1:35.347  1:34.412  1:35.748\n         24        19           8                6         1           2  1:35.645  1:34.188  1:36.230\n         25        19           5                1        23           3  1:35.227  1:34.759  1:36.613\n...\n\n\nCREATE TABLE \"races\" (\nraceid bigint NOT NULL DEFAULT nextval('races_raceid_seq'::regclass),\nyear bigint NULL DEFAULT '0'::bigint,\nround bigint NULL DEFAULT '0'::bigint,\ncircuitid bigint NULL DEFAULT '0'::bigint,\nname text NULL DEFAULT ''::text,\ndate date NULL,\ntime text NULL,\nurl text NULL,\n    PRIMARY KEY (raceid),\n    FOREIGN KEY (circuitid) REFERENCES circuits(circuitid),\n    FOREIGN KEY (year) REFERENCES seasons(year)\n);\n\nFirst 3 rows:\n  raceid    year    round    circuitid  name                  date        time      url\n--------  ------  -------  -----------  --------------------  ----------  --------  ------------------------------------------------------\n       2    2009        2            2  Malaysian Grand Prix  2009-04-05  09:00:00  http://en.wikipedia.org/wiki/2009_Malaysian_Grand_Prix\n       3    2009        3           17  Chinese Grand Prix    2009-04-19  07:00:00  http://en.wikipedia.org/wiki/2009_Chinese_Grand_Prix\n       4    2009        4            3  Bahrain Grand Prix    2009-04-26  12:00:00  http://en.wikipedia.org/wiki/2009_Bahrain_Grand_Prix\n...\n\n\nCREATE TABLE \"results\" (\nresultid bigint NOT NULL DEFAULT nextval('results_resultid_seq'::regclass),\nraceid bigint NULL DEFAULT '0'::bigint,\ndriverid bigint NULL DEFAULT '0'::bigint,\nconstructorid bigint NULL DEFAULT '0'::bigint,\nnumber bigint NULL,\ngrid bigint NULL DEFAULT '0'::bigint,\nposition bigint NULL,\npositiontext text NULL DEFAULT ''::text,\npositionorder bigint NULL DEFAULT '0'::bigint,\npoints real NULL DEFAULT '0'::real,\nlaps bigint NULL DEFAULT '0'::bigint,\ntime text NULL,\nmilliseconds bigint NULL,\nfastestlap bigint NULL,\nrank bigint NULL DEFAULT '0'::bigint,\nfastestlaptime text NULL,\nfastestlapspeed text NULL,\nstatusid bigint NULL DEFAULT '0'::bigint,\n    PRIMARY KEY (resultid),\n    FOREIGN KEY (constructorid) REFERENCES constructors(constructorid),\n    FOREIGN KEY (driverid) REFERENCES drivers(driverid),\n    FOREIGN KEY (raceid) REFERENCES races(raceid),\n    FOREIGN KEY (statusid) REFERENCES status(statusid)\n);\n\nFirst 3 rows:\n  resultid    raceid    driverid    constructorid    number    grid    position    positiontext    positionorder    points    laps  time           milliseconds    fastestlap    rank  fastestlaptime      fastestlapspeed    statusid\n----------  --------  ----------  ---------------  --------  ------  ----------  --------------  ---------------  --------  ------  -----------  --------------  ------------  ------  ----------------  -----------------  ----------\n        23        19           8                6         1       2           1               1                1        10      56  1:31:18.555         5478555            37       2  1:35.405                    209.158           1\n        24        19           9                2         4       4           2               2                2         8      56  +19.570             5498125            39       6  1:35.921                    208.033           1\n        25        19           5                1        23       8           3               3                3         6      56  +38.450             5517005            19       7  1:35.922                    208.031           1\n...\n\n\nCREATE TABLE \"seasons\" (\nyear bigint NOT NULL DEFAULT '0'::bigint,\nurl text NULL DEFAULT ''::text,\n    PRIMARY KEY (year)\n);\n\nFirst 3 rows:\n  year  url\n------  ----------------------------------------------------\n  1950  http://en.wikipedia.org/wiki/1950_Formula_One_season\n  1951  http://en.wikipedia.org/wiki/1951_Formula_One_season\n  1952  http://en.wikipedia.org/wiki/1952_Formula_One_season\n...\n\n\nCREATE TABLE \"status\" (\nstatusid bigint NOT NULL DEFAULT nextval('status_statusid_seq'::regclass),\nstatus text NULL DEFAULT ''::text,\n    PRIMARY KEY (statusid)\n);\n\nFirst 3 rows:\n  statusid  status\n----------  ------------\n         1  Finished\n         2  Disqualified\n         3  Accident\n...\n", "preprocess_schema": "CREATE TABLE \"circuits\" (\ncircuitid bigint NOT NULL DEFAULT nextval('circuits_circuitid_seq'::regclass),\ncircuitref text NULL DEFAULT ''::text,\nname text NULL DEFAULT ''::text,\nlocation text NULL,\ncountry text NULL,\nlat real NULL,\nlng real NULL,\nalt bigint NULL,\nurl text NULL DEFAULT ''::text,\n    PRIMARY KEY (circuitid)\n);\n\nFirst 3 rows:\n  circuitid  circuitref    name                            location      country         lat        lng  alt    url\n-----------  ------------  ------------------------------  ------------  ---------  --------  ---------  -----  -----------------------------------------------------------\n          2  sepang        Sepang International Circuit    Kuala Lumpur  Malaysia    2.76083  101.738           http://en.wikipedia.org/wiki/Sepang_International_Circuit\n          3  bahrain       Bahrain International Circuit   Sakhir        Bahrain    26.0325    50.5106          http://en.wikipedia.org/wiki/Bahrain_International_Circuit\n          4  catalunya     Circuit de Barcelona-Catalunya  Montmeló      Spain      41.57       2.26111         http://en.wikipedia.org/wiki/Circuit_de_Barcelona-Catalunya\n...\n\n\nCREATE TABLE \"constructorresults\" (\nconstructorresultsid bigint NOT NULL DEFAULT nextval('constructorresults_constructorresultsid_seq'::regclass),\nraceid bigint NULL DEFAULT '0'::bigint,\nconstructorid bigint NULL DEFAULT '0'::bigint,\npoints real NULL,\nstatus text NULL,\n    PRIMARY KEY (constructorresultsid),\n    FOREIGN KEY (constructorid) REFERENCES constructors(constructorid)\n);\n\nFirst 3 rows:\n  constructorresultsid    raceid    constructorid    points  status\n----------------------  --------  ---------------  --------  --------\n                     1        18                1        14\n                     2        18                2         8\n                     3        18                3         9\n...\n\n\nCREATE TABLE \"constructors\" (\nconstructorid bigint NOT NULL DEFAULT nextval('constructors_constructorid_seq'::regclass),\nconstructorref text NULL DEFAULT ''::text,\nname text NULL DEFAULT ''::text,\nnationality text NULL,\nurl text NULL DEFAULT ''::text,\n    PRIMARY KEY (constructorid)\n);\n\nFirst 3 rows:\n  constructorid  constructorref    name        nationality    url\n---------------  ----------------  ----------  -------------  ------------------------------------------------------------\n              1  mclaren           McLaren     British        http://en.wikipedia.org/wiki/McLaren\n              2  bmw_sauber        BMW Sauber  German         http://en.wikipedia.org/wiki/BMW_Sauber\n              3  williams          Williams    British        http://en.wikipedia.org/wiki/Williams_Grand_Prix_Engineering\n...\n\n\nCREATE TABLE \"constructorstandings\" (\nconstructorstandingsid bigint NOT NULL DEFAULT nextval('constructorstandings_constructorstandingsid_seq'::regclass),\nraceid bigint NULL DEFAULT '0'::bigint,\nconstructorid bigint NULL DEFAULT '0'::bigint,\npoints real NULL DEFAULT '0'::real,\nposition bigint NULL,\npositiontext text NULL,\nwins bigint NULL DEFAULT '0'::bigint,\n    PRIMARY KEY (constructorstandingsid),\n    FOREIGN KEY (constructorid) REFERENCES constructors(constructorid)\n);\n\nFirst 3 rows:\n  constructorstandingsid    raceid    constructorid    points    position    positiontext    wins\n------------------------  --------  ---------------  --------  ----------  --------------  ------\n                       1        18                1        14           1               1       1\n                       2        18                2         8           3               3       0\n                       3        18                3         9           2               2       0\n...\n\n\nCREATE TABLE \"data_detail\" (\ncountry text NULL,\nmetric_code text NULL,\nmale integer NULL,\nfemale integer NULL,\npensioners integer NULL,\nteenagers integer NULL\n);\n\nFirst 3 rows:\ncountry    metric_code      male    female    pensioners    teenagers\n---------  -------------  ------  --------  ------------  -----------\nus         metric_1           10        14            22           30\nus         metric_2          105       142           222          309\nuk         metric_1           15        13             9           21\n...\n\n\nCREATE TABLE \"drivers\" (\ndriverid bigint NOT NULL DEFAULT nextval('drivers_driverid_seq'::regclass),\ndriverref text NULL DEFAULT ''::text,\nnumber bigint NULL,\ncode text NULL,\nforename text NULL DEFAULT ''::text,\nsurname text NULL DEFAULT ''::text,\ndob date NULL,\nnationality text NULL,\nurl text NULL DEFAULT ''::text,\n    PRIMARY KEY (driverid)\n);\n\nFirst 3 rows:\n  driverid  driverref      number  code    forename    surname    dob         nationality    url\n----------  -----------  --------  ------  ----------  ---------  ----------  -------------  -------------------------------------------\n         1  hamilton           44  HAM     Lewis       Hamilton   1985-01-07  British        http://en.wikipedia.org/wiki/Lewis_Hamilton\n         2  heidfeld          nan  HEI     Nick        Heidfeld   1977-05-10  German         http://en.wikipedia.org/wiki/Nick_Heidfeld\n         3  rosberg             6  ROS     Nico        Rosberg    1985-06-27  German         http://en.wikipedia.org/wiki/Nico_Rosberg\n...\n\n\nCREATE TABLE \"driverstandings\" (\ndriverstandingsid bigint NOT NULL DEFAULT nextval('driverstandings_driverstandingsid_seq'::regclass),\nraceid bigint NULL DEFAULT '0'::bigint,\ndriverid bigint NULL DEFAULT '0'::bigint,\npoints real NULL DEFAULT '0'::real,\nposition bigint NULL,\npositiontext text NULL,\nwins bigint NULL DEFAULT '0'::bigint,\n    PRIMARY KEY (driverstandingsid),\n    FOREIGN KEY (driverid) REFERENCES drivers(driverid)\n);\n\nFirst 3 rows:\n  driverstandingsid    raceid    driverid    points    position    positiontext    wins\n-------------------  --------  ----------  --------  ----------  --------------  ------\n                  1        18           1        10           1               1       1\n                  2        18           2         8           2               2       0\n                  3        18           3         6           3               3       0\n...\n\n\nCREATE TABLE \"laptimes\" (\nraceid bigint NOT NULL,\ndriverid bigint NOT NULL,\nlap bigint NOT NULL,\nposition bigint NULL,\ntime text NULL,\nmilliseconds bigint NULL,\n    PRIMARY KEY (raceid, driverid, lap),\n    FOREIGN KEY (driverid) REFERENCES drivers(driverid),\n    FOREIGN KEY (raceid) REFERENCES races(raceid)\n);\n\nFirst 3 rows:\n  raceid    driverid    lap    position  time        milliseconds\n--------  ----------  -----  ----------  --------  --------------\n       2           1      1          10  1:52.965          112965\n       2           1      2          10  1:41.865          101865\n       2           1      3          10  1:40.869          100869\n...\n\n\nCREATE TABLE \"pitstops\" (\nraceid bigint NOT NULL,\ndriverid bigint NOT NULL,\nstop bigint NOT NULL,\nlap bigint NULL,\ntime text NULL,\nduration text NULL,\nmilliseconds bigint NULL,\n    PRIMARY KEY (raceid, driverid, stop),\n    FOREIGN KEY (driverid) REFERENCES drivers(driverid),\n    FOREIGN KEY (raceid) REFERENCES races(raceid)\n);\n\nFirst 3 rows:\n  raceid    driverid    stop    lap  time        duration    milliseconds\n--------  ----------  ------  -----  --------  ----------  --------------\n     842           1       1     12  16:24:40      22.552           22552\n     842           1       2     24  16:45:48      22.611           22611\n     842           1       3     37  17:08:28      25.382           25382\n...\n\n\nCREATE TABLE \"qualifying\" (\nqualifyid bigint NOT NULL DEFAULT nextval('qualifying_qualifyid_seq'::regclass),\nraceid bigint NULL DEFAULT '0'::bigint,\ndriverid bigint NULL DEFAULT '0'::bigint,\nconstructorid bigint NULL DEFAULT '0'::bigint,\nnumber bigint NULL DEFAULT '0'::bigint,\nposition bigint NULL,\nq1 text NULL,\nq2 text NULL,\nq3 text NULL,\n    PRIMARY KEY (qualifyid),\n    FOREIGN KEY (constructorid) REFERENCES constructors(constructorid),\n    FOREIGN KEY (driverid) REFERENCES drivers(driverid),\n    FOREIGN KEY (raceid) REFERENCES races(raceid)\n);\n\nFirst 3 rows:\n  qualifyid    raceid    driverid    constructorid    number    position  q1        q2        q3\n-----------  --------  ----------  ---------------  --------  ----------  --------  --------  --------\n         23        19          13                6         2           1  1:35.347  1:34.412  1:35.748\n         24        19           8                6         1           2  1:35.645  1:34.188  1:36.230\n         25        19           5                1        23           3  1:35.227  1:34.759  1:36.613\n...\n\n\nCREATE TABLE \"races\" (\nraceid bigint NOT NULL DEFAULT nextval('races_raceid_seq'::regclass),\nyear bigint NULL DEFAULT '0'::bigint,\nround bigint NULL DEFAULT '0'::bigint,\ncircuitid bigint NULL DEFAULT '0'::bigint,\nname text NULL DEFAULT ''::text,\ndate date NULL,\ntime text NULL,\nurl text NULL,\n    PRIMARY KEY (raceid),\n    FOREIGN KEY (circuitid) REFERENCES circuits(circuitid),\n    FOREIGN KEY (year) REFERENCES seasons(year)\n);\n\nFirst 3 rows:\n  raceid    year    round    circuitid  name                  date        time      url\n--------  ------  -------  -----------  --------------------  ----------  --------  ------------------------------------------------------\n       2    2009        2            2  Malaysian Grand Prix  2009-04-05  09:00:00  http://en.wikipedia.org/wiki/2009_Malaysian_Grand_Prix\n       3    2009        3           17  Chinese Grand Prix    2009-04-19  07:00:00  http://en.wikipedia.org/wiki/2009_Chinese_Grand_Prix\n       4    2009        4            3  Bahrain Grand Prix    2009-04-26  12:00:00  http://en.wikipedia.org/wiki/2009_Bahrain_Grand_Prix\n...\n\n\nCREATE TABLE \"results\" (\nresultid bigint NOT NULL DEFAULT nextval('results_resultid_seq'::regclass),\nraceid bigint NULL DEFAULT '0'::bigint,\ndriverid bigint NULL DEFAULT '0'::bigint,\nconstructorid bigint NULL DEFAULT '0'::bigint,\nnumber bigint NULL,\ngrid bigint NULL DEFAULT '0'::bigint,\nposition bigint NULL,\npositiontext text NULL DEFAULT ''::text,\npositionorder bigint NULL DEFAULT '0'::bigint,\npoints real NULL DEFAULT '0'::real,\nlaps bigint NULL DEFAULT '0'::bigint,\ntime text NULL,\nmilliseconds bigint NULL,\nfastestlap bigint NULL,\nrank bigint NULL DEFAULT '0'::bigint,\nfastestlaptime text NULL,\nfastestlapspeed text NULL,\nstatusid bigint NULL DEFAULT '0'::bigint,\n    PRIMARY KEY (resultid),\n    FOREIGN KEY (constructorid) REFERENCES constructors(constructorid),\n    FOREIGN KEY (driverid) REFERENCES drivers(driverid),\n    FOREIGN KEY (raceid) REFERENCES races(raceid),\n    FOREIGN KEY (statusid) REFERENCES status(statusid)\n);\n\nFirst 3 rows:\n  resultid    raceid    driverid    constructorid    number    grid    position    positiontext    positionorder    points    laps  time           milliseconds    fastestlap    rank  fastestlaptime      fastestlapspeed    statusid\n----------  --------  ----------  ---------------  --------  ------  ----------  --------------  ---------------  --------  ------  -----------  --------------  ------------  ------  ----------------  -----------------  ----------\n        23        19           8                6         1       2           1               1                1        10      56  1:31:18.555         5478555            37       2  1:35.405                    209.158           1\n        24        19           9                2         4       4           2               2                2         8      56  +19.570             5498125            39       6  1:35.921                    208.033           1\n        25        19           5                1        23       8           3               3                3         6      56  +38.450             5517005            19       7  1:35.922                    208.031           1\n...\n\n\nCREATE TABLE \"seasons\" (\nyear bigint NOT NULL DEFAULT '0'::bigint,\nurl text NULL DEFAULT ''::text,\n    PRIMARY KEY (year)\n);\n\nFirst 3 rows:\n  year  url\n------  ----------------------------------------------------\n  1950  http://en.wikipedia.org/wiki/1950_Formula_One_season\n  1951  http://en.wikipedia.org/wiki/1951_Formula_One_season\n  1952  http://en.wikipedia.org/wiki/1952_Formula_One_season\n...\n\n\nCREATE TABLE \"status\" (\nstatusid bigint NOT NULL DEFAULT nextval('status_statusid_seq'::regclass),\nstatus text NULL DEFAULT ''::text,\n    PRIMARY KEY (statusid)\n);\n\nFirst 3 rows:\n  statusid  status\n----------  ------------\n         1  Finished\n         2  Disqualified\n         3  Accident\n...\n", "sol_sql": ["SELECT country, predicate_code, MAX(value) FILTER (WHERE metric_code = 'metric_1') AS metric_1, MAX(value) FILTER (WHERE metric_code = 'metric_2') AS metric_2 FROM (SELECT country, metric_code, 'male' AS predicate_code, male AS value FROM data_detail UNION ALL SELECT country, metric_code, 'female', female FROM data_detail UNION ALL SELECT country, metric_code, 'pensioners', pensioners FROM data_detail UNION ALL SELECT country, metric_code, 'teenagers', teenagers FROM data_detail) AS unpivoted GROUP BY country, predicate_code ORDER BY country, predicate_code;"], "test_cases": ["\ndef test_case(pred_sqls, sol_sqls, db_name, conn):\n    result = ex_base(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"ex_base returned {result} but expected 1.\"\n    result = performance_compare_by_qep(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"performance_check returned {result} but expected 1.\"\n    return result\n\n    "]}
{"instance_id": "PostgreSQL_285", "dialect": "PostgreSQL", "version": "14.12", "db_id": "erolp", "query": "\nIn the erolp database, there is a table named learners_info which contains records of all learners, including their learner_code, Age, and Previous_Academic_Performance. The task is to find, for each learner, another learner who is older and has a lower academic performance. The original query provided by the user is inefficient and takes a long time to execute, especially with a large dataset. The user is seeking an optimized solution to improve the performance of the query.\n", "issue_sql": ["SELECT current_rec.*, compare_rec.learner_code AS lower_performance_learner\nFROM public.learners_info current_rec\nLEFT JOIN public.learners_info compare_rec\n  ON current_rec.\"Age\" < compare_rec.\"Age\"\n  AND current_rec.\"Previous_Academic_Performance\" > compare_rec.\"Previous_Academic_Performance\"\nORDER BY current_rec.learner_code;"], "preprocess_sql": ["\nCREATE TABLE public.learners_info (\n  learner_code INT PRIMARY KEY,\n  \"Age\" INT,\n  \"Previous_Academic_Performance\" INT \n);\n\nINSERT INTO public.learners_info (learner_code, \"Age\", \"Previous_Academic_Performance\")\nVALUES\n  (1, 17, 80),\n  (2, 20, 85),\n  (3, 22, 90),\n  (4, 24, 70),\n  (5, 26, 95),\n  (6, 28, 88),\n  (7, 30, 60),\n  (8, 32, 78),\n  (9, 19, 82),\n  (10, 27, 76);\n"], "clean_up_sql": ["drop table learners_info"], "category": "Efficiency", "original_schema": "CREATE TABLE \"curricula\" (\ncurriculum_id integer NOT NULL DEFAULT nextval('curricula_curriculum_id_seq'::regclass),\nModules integer NULL,\nSequence character varying NULL,\nCredit_Hours integer NULL,\nPolicy_Alignment character varying NULL,\nIntegration_Components character varying NULL,\nAssessment_Type character varying NULL,\nWeightage_Distribution character varying NULL,\n    PRIMARY KEY (curriculum_id)\n);\n\nFirst 3 rows:\n  curriculum_id    Modules    Sequence    Credit_Hours  Policy_Alignment    Integration_Components    Assessment_Type      Weightage_Distribution\n---------------  ---------  ----------  --------------  ------------------  ------------------------  -----------------  ------------------------\n              1          1           3               3  Aligned             Low                       Essay                              0.175169\n              2          1          10               3  Aligned             High                      Essay                              0.683832\n              3          1           4               3  Aligned             Medium                    MCQ                                0.143998\n...\n\n\nCREATE TABLE \"curriculum_resources\" (\ncurriculum_resource_id integer NOT NULL DEFAULT nextval('curriculum_resources_curriculum_resource_id_seq'::regclass),\ncurriculum_id integer NOT NULL,\nresource_key integer NOT NULL,\nrecommended boolean NULL DEFAULT true,\n    PRIMARY KEY (curriculum_resource_id),\n    FOREIGN KEY (curriculum_id) REFERENCES curricula(curriculum_id),\n    FOREIGN KEY (resource_key) REFERENCES educational_resources(resource_key)\n);\n\nFirst 3 rows:\n  curriculum_resource_id    curriculum_id    resource_key  recommended\n------------------------  ---------------  --------------  -------------\n                       1                1               1  True\n                       2                2               2  True\n                       3                3               3  True\n...\n\n\nCREATE TABLE \"educational_resources\" (\nresource_key integer NOT NULL DEFAULT nextval('educational_resources_resource_key_seq'::regclass),\nContent_Type character varying NULL,\nContent_Length integer NULL,\nDifficulty_Level character varying NULL,\nRelevance character varying NULL,\nPlatform_Used character varying NULL,\nOffline_Availability boolean NULL,\nInteractivity_Level character varying NULL,\nUser_Ratings numeric NULL,\nDownloads_Views integer NULL DEFAULT 0,\nUser_Feedback character varying NULL,\n    PRIMARY KEY (resource_key)\n);\n\nFirst 3 rows:\n  resource_key  Content_Type      Content_Length  Difficulty_Level    Relevance    Platform_Used    Offline_Availability    Interactivity_Level      User_Ratings    Downloads_Views  User_Feedback\n--------------  --------------  ----------------  ------------------  -----------  ---------------  ----------------------  ---------------------  --------------  -----------------  ---------------\n             1  Video                          3  Easy                Low          LMS              False                   Dynamic                           3                 5424  Negative\n             2  Text                          37  Easy                Medium       Mobile App       False                   Static                            3.2               3082  Positive\n             3  Case Study                    13  Easy                High         Mobile App       False                   Static                            3.9               9781  Positive\n...\n\n\nCREATE TABLE \"enrollment\" (\nenrollment_code integer NOT NULL DEFAULT nextval('enrollment_enrollment_code_seq'::regclass),\nlearner_code integer NOT NULL,\ninstitution_key integer NOT NULL,\ncurriculum_id integer NOT NULL,\nenrollment_date date NULL DEFAULT CURRENT_DATE,\n    PRIMARY KEY (enrollment_code),\n    FOREIGN KEY (institution_key) REFERENCES institutions(institution_key),\n    FOREIGN KEY (learner_code) REFERENCES learners(learner_code),\n    FOREIGN KEY (curriculum_id) REFERENCES curricula(curriculum_id)\n);\n\nFirst 3 rows:\n  enrollment_code    learner_code    institution_key    curriculum_id  enrollment_date\n-----------------  --------------  -----------------  ---------------  -----------------\n                1               1                  1                1  2025-02-01\n                2               2                  2                2  2025-02-01\n                3               3                  3                3  2025-02-01\n...\n\n\nCREATE TABLE \"external_factors\" (\nfactor_id integer NOT NULL DEFAULT nextval('external_factors_factor_id_seq'::regclass),\nSocial_Media_Influence numeric NULL,\nPeer_Influence character varying NULL,\nCultural_Values character varying NULL,\nPerception_of_IPE character varying NULL,\nAccess_to_Technology character varying NULL,\nUse_of_AI_ML boolean NULL,\n    PRIMARY KEY (factor_id)\n);\n\nFirst 3 rows:\n  factor_id    Social_Media_Influence  Peer_Influence    Cultural_Values    Perception_of_IPE    Access_to_Technology    Use_of_AI_ML\n-----------  ------------------------  ----------------  -----------------  -------------------  ----------------------  --------------\n          1                   70.9551  High              Modern             Negative             Medium                  True\n          2                   51.5388  High              Modern             Positive             High                    True\n          3                   89.7997  High              Traditional        Positive             High                    True\n...\n\n\nCREATE TABLE \"institutions\" (\ninstitution_key integer NOT NULL DEFAULT nextval('institutions_institution_key_seq'::regclass),\nInstitution_Type character varying NULL,\nRegion character varying NULL,\nPolicy_Implementation character varying NULL,\nBudget_Allocation numeric NULL,\nNumber_of_Instructors integer NULL,\nInstructor_Experience numeric NULL,\n    PRIMARY KEY (institution_key)\n);\n\nFirst 3 rows:\n  institution_key  Institution_Type    Region    Policy_Implementation      Budget_Allocation    Number_of_Instructors    Instructor_Experience\n-----------------  ------------------  --------  -----------------------  -------------------  -----------------------  -----------------------\n                1  Public              Urban     Strict                               3111.76                      255                     28.5\n                2  Public              Urban     Strict                              98781.8                       262                     13.9\n                3  Public              Urban     Strict                              52367.2                       247                     14.5\n...\n\n\nCREATE TABLE \"learners\" (\nlearner_code integer NOT NULL DEFAULT nextval('learners_learner_code_seq'::regclass),\nAge integer NULL,\nGender character varying NULL,\nGeographic_Location character varying NULL,\nSocioeconomic_Background character varying NULL,\nEducation_Level character varying NULL,\nPrevious_Academic_Performance numeric NULL,\nLanguage_Proficiency character varying NULL,\nPreferred_Learning_Medium character varying NULL,\nLearning_Pace character varying NULL,\nEngagement_History integer NULL DEFAULT 0,\n    PRIMARY KEY (learner_code)\n);\n\nFirst 3 rows:\n  learner_code    Age  Gender    Geographic_Location    Socioeconomic_Background    Education_Level      Previous_Academic_Performance  Language_Proficiency    Preferred_Learning_Medium    Learning_Pace      Engagement_History\n--------------  -----  --------  ---------------------  --------------------------  -----------------  -------------------------------  ----------------------  ---------------------------  ---------------  --------------------\n             1     18  Male      Urban                  Low                         Undergraduate                                88.55  Intermediate            Video                        Moderate                            6\n             2     53  Male      Rural                  Middle                      Undergraduate                                79.53  Basic                   Text                         Fast                               16\n             3     23  Male      Urban                  Low                         Undergraduate                                85.06  Intermediate            Video                        Fast                               11\n...\n\n\nCREATE TABLE \"outcomes\" (\noutcome_code integer NOT NULL DEFAULT nextval('outcomes_outcome_code_seq'::regclass),\nlearner_code integer NOT NULL,\nPre_Test_Score numeric NULL,\nPost_Test_Score numeric NULL,\nKnowledge_Improvement numeric NULL,\nBehavioral_Changes boolean NULL,\nCritical_Thinking_Skills integer NULL,\nAnalytical_Skills integer NULL,\nCommunication_Skills integer NULL,\nLearner_Satisfaction_Score numeric NULL,\nCourse_Completion_Rate numeric NULL,\n    PRIMARY KEY (outcome_code),\n    FOREIGN KEY (learner_code) REFERENCES learners(learner_code)\n);\n\nFirst 3 rows:\n  outcome_code    learner_code    Pre_Test_Score    Post_Test_Score    Knowledge_Improvement  Behavioral_Changes      Critical_Thinking_Skills    Analytical_Skills    Communication_Skills    Learner_Satisfaction_Score    Course_Completion_Rate\n--------------  --------------  ----------------  -----------------  -----------------------  --------------------  --------------------------  -------------------  ----------------------  ----------------------------  ------------------------\n             1               1             53.28              97.7                     13.22  True                                           2                    9                       9                           2.6                      0.9\n             2               2             36.07              76.42                    36.54  False                                          4                    7                       6                           4.7                      0.52\n             3               3             67.22              53.79                    42.37  False                                          1                    8                       4                           1.3                      0.62\n...\n\n\nCREATE TABLE \"performance_predictions\" (\nprediction_code integer NOT NULL DEFAULT nextval('performance_predictions_prediction_code_seq'::regclass),\nlearner_code integer NOT NULL,\ndate_recorded date NULL DEFAULT CURRENT_DATE,\nPerformance_Prediction numeric NULL,\n    PRIMARY KEY (prediction_code),\n    FOREIGN KEY (learner_code) REFERENCES learners(learner_code)\n);\n\nFirst 3 rows:\n  prediction_code    learner_code  date_recorded      Performance_Prediction\n-----------------  --------------  ---------------  ------------------------\n                1               1  2025-02-01                          70.73\n                2               2  2025-02-01                          74.32\n                3               3  2025-02-01                          58.61\n...\n\n\nCREATE TABLE \"resource_usage\" (\nusage_code integer NOT NULL DEFAULT nextval('resource_usage_usage_code_seq'::regclass),\nlearner_code integer NOT NULL,\nresource_key integer NOT NULL,\ntime_spent integer NULL DEFAULT 0,\nrating numeric NULL,\nfeedback character varying NULL,\nusage_date date NULL DEFAULT CURRENT_DATE,\n    PRIMARY KEY (usage_code),\n    FOREIGN KEY (learner_code) REFERENCES learners(learner_code),\n    FOREIGN KEY (resource_key) REFERENCES educational_resources(resource_key)\n);\n\nFirst 3 rows:\n  usage_code    learner_code    resource_key    time_spent    rating  feedback    usage_date\n------------  --------------  --------------  ------------  --------  ----------  ------------\n           1               1               1             0       3    Negative    2025-02-01\n           2               2               2             0       3.2  Positive    2025-02-01\n           3               3               3             0       3.9  Positive    2025-02-01\n...\n\n\nCREATE TABLE \"target_labels\" (\nlabel_code integer NOT NULL DEFAULT nextval('target_labels_label_code_seq'::regclass),\nlearner_code integer NOT NULL,\nEffectiveness_Score numeric NULL,\nEngagement_Level character varying NULL,\nKnowledge_Gain numeric NULL,\nBehavioral_Impact boolean NULL,\nSkill_Development character varying NULL,\nTalent_Identification character varying NULL,\nRetention_Rate numeric NULL,\nResource_Allocation_Efficiency numeric NULL,\nRelevance_Score numeric NULL,\nLearner_Satisfaction_Rating numeric NULL,\nCompletion_Likelihood numeric NULL,\n    PRIMARY KEY (label_code),\n    FOREIGN KEY (learner_code) REFERENCES learners(learner_code)\n);\n\nFirst 3 rows:\n  label_code    learner_code    Effectiveness_Score  Engagement_Level      Knowledge_Gain  Behavioral_Impact    Skill_Development    Talent_Identification      Retention_Rate    Resource_Allocation_Efficiency    Relevance_Score    Learner_Satisfaction_Rating    Completion_Likelihood\n------------  --------------  ---------------------  ------------------  ----------------  -------------------  -------------------  -----------------------  ----------------  --------------------------------  -----------------  -----------------------------  -----------------------\n           1               1                    7.7  High                           12.98  False                Communication        High                                 0.77                             36.62                2.2                            3.3                     0.93\n           2               2                    3.2  Low                            21.77  True                 Analytical           Medium                               0.94                             36.31                1.4                            2                       0.94\n           3               3                    3.5  Medium                         45.52  False                Communication        Medium                               0.66                             57.64                3.1                            2.1                     0.94\n...\n", "preprocess_schema": "CREATE TABLE \"curricula\" (\ncurriculum_id integer NOT NULL DEFAULT nextval('curricula_curriculum_id_seq'::regclass),\nModules integer NULL,\nSequence character varying NULL,\nCredit_Hours integer NULL,\nPolicy_Alignment character varying NULL,\nIntegration_Components character varying NULL,\nAssessment_Type character varying NULL,\nWeightage_Distribution character varying NULL,\n    PRIMARY KEY (curriculum_id)\n);\n\nFirst 3 rows:\n  curriculum_id    Modules    Sequence    Credit_Hours  Policy_Alignment    Integration_Components    Assessment_Type      Weightage_Distribution\n---------------  ---------  ----------  --------------  ------------------  ------------------------  -----------------  ------------------------\n              1          1           3               3  Aligned             Low                       Essay                              0.175169\n              2          1          10               3  Aligned             High                      Essay                              0.683832\n              3          1           4               3  Aligned             Medium                    MCQ                                0.143998\n...\n\n\nCREATE TABLE \"curriculum_resources\" (\ncurriculum_resource_id integer NOT NULL DEFAULT nextval('curriculum_resources_curriculum_resource_id_seq'::regclass),\ncurriculum_id integer NOT NULL,\nresource_key integer NOT NULL,\nrecommended boolean NULL DEFAULT true,\n    PRIMARY KEY (curriculum_resource_id),\n    FOREIGN KEY (curriculum_id) REFERENCES curricula(curriculum_id),\n    FOREIGN KEY (resource_key) REFERENCES educational_resources(resource_key)\n);\n\nFirst 3 rows:\n  curriculum_resource_id    curriculum_id    resource_key  recommended\n------------------------  ---------------  --------------  -------------\n                       1                1               1  True\n                       2                2               2  True\n                       3                3               3  True\n...\n\n\nCREATE TABLE \"educational_resources\" (\nresource_key integer NOT NULL DEFAULT nextval('educational_resources_resource_key_seq'::regclass),\nContent_Type character varying NULL,\nContent_Length integer NULL,\nDifficulty_Level character varying NULL,\nRelevance character varying NULL,\nPlatform_Used character varying NULL,\nOffline_Availability boolean NULL,\nInteractivity_Level character varying NULL,\nUser_Ratings numeric NULL,\nDownloads_Views integer NULL DEFAULT 0,\nUser_Feedback character varying NULL,\n    PRIMARY KEY (resource_key)\n);\n\nFirst 3 rows:\n  resource_key  Content_Type      Content_Length  Difficulty_Level    Relevance    Platform_Used    Offline_Availability    Interactivity_Level      User_Ratings    Downloads_Views  User_Feedback\n--------------  --------------  ----------------  ------------------  -----------  ---------------  ----------------------  ---------------------  --------------  -----------------  ---------------\n             1  Video                          3  Easy                Low          LMS              False                   Dynamic                           3                 5424  Negative\n             2  Text                          37  Easy                Medium       Mobile App       False                   Static                            3.2               3082  Positive\n             3  Case Study                    13  Easy                High         Mobile App       False                   Static                            3.9               9781  Positive\n...\n\n\nCREATE TABLE \"enrollment\" (\nenrollment_code integer NOT NULL DEFAULT nextval('enrollment_enrollment_code_seq'::regclass),\nlearner_code integer NOT NULL,\ninstitution_key integer NOT NULL,\ncurriculum_id integer NOT NULL,\nenrollment_date date NULL DEFAULT CURRENT_DATE,\n    PRIMARY KEY (enrollment_code),\n    FOREIGN KEY (institution_key) REFERENCES institutions(institution_key),\n    FOREIGN KEY (learner_code) REFERENCES learners(learner_code),\n    FOREIGN KEY (curriculum_id) REFERENCES curricula(curriculum_id)\n);\n\nFirst 3 rows:\n  enrollment_code    learner_code    institution_key    curriculum_id  enrollment_date\n-----------------  --------------  -----------------  ---------------  -----------------\n                1               1                  1                1  2025-02-01\n                2               2                  2                2  2025-02-01\n                3               3                  3                3  2025-02-01\n...\n\n\nCREATE TABLE \"external_factors\" (\nfactor_id integer NOT NULL DEFAULT nextval('external_factors_factor_id_seq'::regclass),\nSocial_Media_Influence numeric NULL,\nPeer_Influence character varying NULL,\nCultural_Values character varying NULL,\nPerception_of_IPE character varying NULL,\nAccess_to_Technology character varying NULL,\nUse_of_AI_ML boolean NULL,\n    PRIMARY KEY (factor_id)\n);\n\nFirst 3 rows:\n  factor_id    Social_Media_Influence  Peer_Influence    Cultural_Values    Perception_of_IPE    Access_to_Technology    Use_of_AI_ML\n-----------  ------------------------  ----------------  -----------------  -------------------  ----------------------  --------------\n          1                   70.9551  High              Modern             Negative             Medium                  True\n          2                   51.5388  High              Modern             Positive             High                    True\n          3                   89.7997  High              Traditional        Positive             High                    True\n...\n\n\nCREATE TABLE \"institutions\" (\ninstitution_key integer NOT NULL DEFAULT nextval('institutions_institution_key_seq'::regclass),\nInstitution_Type character varying NULL,\nRegion character varying NULL,\nPolicy_Implementation character varying NULL,\nBudget_Allocation numeric NULL,\nNumber_of_Instructors integer NULL,\nInstructor_Experience numeric NULL,\n    PRIMARY KEY (institution_key)\n);\n\nFirst 3 rows:\n  institution_key  Institution_Type    Region    Policy_Implementation      Budget_Allocation    Number_of_Instructors    Instructor_Experience\n-----------------  ------------------  --------  -----------------------  -------------------  -----------------------  -----------------------\n                1  Public              Urban     Strict                               3111.76                      255                     28.5\n                2  Public              Urban     Strict                              98781.8                       262                     13.9\n                3  Public              Urban     Strict                              52367.2                       247                     14.5\n...\n\n\nCREATE TABLE \"learners\" (\nlearner_code integer NOT NULL DEFAULT nextval('learners_learner_code_seq'::regclass),\nAge integer NULL,\nGender character varying NULL,\nGeographic_Location character varying NULL,\nSocioeconomic_Background character varying NULL,\nEducation_Level character varying NULL,\nPrevious_Academic_Performance numeric NULL,\nLanguage_Proficiency character varying NULL,\nPreferred_Learning_Medium character varying NULL,\nLearning_Pace character varying NULL,\nEngagement_History integer NULL DEFAULT 0,\n    PRIMARY KEY (learner_code)\n);\n\nFirst 3 rows:\n  learner_code    Age  Gender    Geographic_Location    Socioeconomic_Background    Education_Level      Previous_Academic_Performance  Language_Proficiency    Preferred_Learning_Medium    Learning_Pace      Engagement_History\n--------------  -----  --------  ---------------------  --------------------------  -----------------  -------------------------------  ----------------------  ---------------------------  ---------------  --------------------\n             1     18  Male      Urban                  Low                         Undergraduate                                88.55  Intermediate            Video                        Moderate                            6\n             2     53  Male      Rural                  Middle                      Undergraduate                                79.53  Basic                   Text                         Fast                               16\n             3     23  Male      Urban                  Low                         Undergraduate                                85.06  Intermediate            Video                        Fast                               11\n...\n\n\nCREATE TABLE \"learners_info\" (\nlearner_code integer NOT NULL,\nAge integer NULL,\nPrevious_Academic_Performance integer NULL,\n    PRIMARY KEY (learner_code)\n);\n\nFirst 3 rows:\n  learner_code    Age    Previous_Academic_Performance\n--------------  -----  -------------------------------\n             1     17                               80\n             2     20                               85\n             3     22                               90\n...\n\n\nCREATE TABLE \"outcomes\" (\noutcome_code integer NOT NULL DEFAULT nextval('outcomes_outcome_code_seq'::regclass),\nlearner_code integer NOT NULL,\nPre_Test_Score numeric NULL,\nPost_Test_Score numeric NULL,\nKnowledge_Improvement numeric NULL,\nBehavioral_Changes boolean NULL,\nCritical_Thinking_Skills integer NULL,\nAnalytical_Skills integer NULL,\nCommunication_Skills integer NULL,\nLearner_Satisfaction_Score numeric NULL,\nCourse_Completion_Rate numeric NULL,\n    PRIMARY KEY (outcome_code),\n    FOREIGN KEY (learner_code) REFERENCES learners(learner_code)\n);\n\nFirst 3 rows:\n  outcome_code    learner_code    Pre_Test_Score    Post_Test_Score    Knowledge_Improvement  Behavioral_Changes      Critical_Thinking_Skills    Analytical_Skills    Communication_Skills    Learner_Satisfaction_Score    Course_Completion_Rate\n--------------  --------------  ----------------  -----------------  -----------------------  --------------------  --------------------------  -------------------  ----------------------  ----------------------------  ------------------------\n             1               1             53.28              97.7                     13.22  True                                           2                    9                       9                           2.6                      0.9\n             2               2             36.07              76.42                    36.54  False                                          4                    7                       6                           4.7                      0.52\n             3               3             67.22              53.79                    42.37  False                                          1                    8                       4                           1.3                      0.62\n...\n\n\nCREATE TABLE \"performance_predictions\" (\nprediction_code integer NOT NULL DEFAULT nextval('performance_predictions_prediction_code_seq'::regclass),\nlearner_code integer NOT NULL,\ndate_recorded date NULL DEFAULT CURRENT_DATE,\nPerformance_Prediction numeric NULL,\n    PRIMARY KEY (prediction_code),\n    FOREIGN KEY (learner_code) REFERENCES learners(learner_code)\n);\n\nFirst 3 rows:\n  prediction_code    learner_code  date_recorded      Performance_Prediction\n-----------------  --------------  ---------------  ------------------------\n                1               1  2025-02-01                          70.73\n                2               2  2025-02-01                          74.32\n                3               3  2025-02-01                          58.61\n...\n\n\nCREATE TABLE \"resource_usage\" (\nusage_code integer NOT NULL DEFAULT nextval('resource_usage_usage_code_seq'::regclass),\nlearner_code integer NOT NULL,\nresource_key integer NOT NULL,\ntime_spent integer NULL DEFAULT 0,\nrating numeric NULL,\nfeedback character varying NULL,\nusage_date date NULL DEFAULT CURRENT_DATE,\n    PRIMARY KEY (usage_code),\n    FOREIGN KEY (learner_code) REFERENCES learners(learner_code),\n    FOREIGN KEY (resource_key) REFERENCES educational_resources(resource_key)\n);\n\nFirst 3 rows:\n  usage_code    learner_code    resource_key    time_spent    rating  feedback    usage_date\n------------  --------------  --------------  ------------  --------  ----------  ------------\n           1               1               1             0       3    Negative    2025-02-01\n           2               2               2             0       3.2  Positive    2025-02-01\n           3               3               3             0       3.9  Positive    2025-02-01\n...\n\n\nCREATE TABLE \"target_labels\" (\nlabel_code integer NOT NULL DEFAULT nextval('target_labels_label_code_seq'::regclass),\nlearner_code integer NOT NULL,\nEffectiveness_Score numeric NULL,\nEngagement_Level character varying NULL,\nKnowledge_Gain numeric NULL,\nBehavioral_Impact boolean NULL,\nSkill_Development character varying NULL,\nTalent_Identification character varying NULL,\nRetention_Rate numeric NULL,\nResource_Allocation_Efficiency numeric NULL,\nRelevance_Score numeric NULL,\nLearner_Satisfaction_Rating numeric NULL,\nCompletion_Likelihood numeric NULL,\n    PRIMARY KEY (label_code),\n    FOREIGN KEY (learner_code) REFERENCES learners(learner_code)\n);\n\nFirst 3 rows:\n  label_code    learner_code    Effectiveness_Score  Engagement_Level      Knowledge_Gain  Behavioral_Impact    Skill_Development    Talent_Identification      Retention_Rate    Resource_Allocation_Efficiency    Relevance_Score    Learner_Satisfaction_Rating    Completion_Likelihood\n------------  --------------  ---------------------  ------------------  ----------------  -------------------  -------------------  -----------------------  ----------------  --------------------------------  -----------------  -----------------------------  -----------------------\n           1               1                    7.7  High                           12.98  False                Communication        High                                 0.77                             36.62                2.2                            3.3                     0.93\n           2               2                    3.2  Low                            21.77  True                 Analytical           Medium                               0.94                             36.31                1.4                            2                       0.94\n           3               3                    3.5  Medium                         45.52  False                Communication        Medium                               0.66                             57.64                3.1                            2.1                     0.94\n...\n", "sol_sql": ["\nWITH filtered_learners AS (\n  SELECT learner_code, \"Age\", \"Previous_Academic_Performance\"\n  FROM public.learners_info\n  WHERE \"Age\" > 0 \n)\nSELECT \n  current_rec.learner_code, \n  current_rec.\"Age\", \n  current_rec.\"Previous_Academic_Performance\", \n  compare_rec.learner_code AS lower_performance_learner\nFROM filtered_learners current_rec\nLEFT JOIN filtered_learners compare_rec\n  ON current_rec.\"Age\" < compare_rec.\"Age\"\n  AND current_rec.\"Previous_Academic_Performance\" > compare_rec.\"Previous_Academic_Performance\"\nORDER BY current_rec.learner_code;\n"], "test_cases": ["\ndef test_case(pred_sqls, sol_sqls, db_name, conn):\n    result = ex_base(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"ex_base returned {result} but expected 1.\"\n    result = performance_compare_by_qep(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"performance_check returned {result} but expected 1.\"\n    return result\n    "]}
{"instance_id": "MySQL_63", "dialect": "MySQL", "version": "8.4.0", "db_id": "debit_card_specializing", "query": "Suppose we have a transactions data table within an e-commerce platform that records purchases made by various customers at different gas stations. The table 'sales' is like |id|slot|total|\nThere's an index on slot already. I want to sum the total up to the current moment in time (EDIT: WASN'T CLEAR INITIALLY, I WILL PROVIDE A LOWER SLOT BOUND, SO THE SUM WILL BE OVER SOME NUMBER OF DAYS/WEEKS, NOT OVER FULL TABLE). Let's say the time is currently 2022-12-01T12:45. If I run select * from my_table where slot < CURRENT_TIMESTAMP(), then I get back records 1 and 2. However, in my data, the records represent forecasted sales within a time slot. I want to find the forecasts as of 2022-12-01T12:45, and so I want to find the proportion of the half hour slot of record 2 that has elapsed, and return that proportion of the total. As of 2022-12-01T12:45 (assuming minute granularity), 50% of row 2 has elapsed, so I would expect the total to return as 150 / 2 = 75. My current query works, but is slow. What are some ways I can optimise this, or other approaches I can take? Also, how can we extend this solution to be generalised to any interval frequency? Maybe tomorrow we change our forecasting model and the data comes in sporadically. The hardcoded 30 would not work in that case.The platform tracks the sales forecasts for gas products, which are recorded in half-hour time slots. Due to recent platform updates, users want to calculate the total forecasted sales up to the current moment in time, taking into account the proportion of the current half-hour slot that has elapsed.", "issue_sql": ["SET @current_time = TIMESTAMP('2022-12-01 12:40:00');", "select sum(fraction * total) as t from (select total, LEAST(timestampdiff(minute, slot, @current_time), 30) / 30 as fraction from sales where slot <= @current_time) as temp;"], "preprocess_sql": ["CREATE TABLE sales (id INT, slot TIMESTAMP, total INT);", "INSERT INTO sales VALUES(1, '2022-12-01T12:00', 100), (2, '2022-12-01T12:30', 150), (3, '2022-12-01T13:00', 200);", "CREATE INDEX idx_test ON sales (slot);"], "clean_up_sql": ["SET @current_time := NULL;", "DROP TABLE sales;"], "category": "Efficiency", "original_schema": "CREATE TABLE `customers` (\n`CustomerID` int NOT NULL,\n`Segment` text NULL,\n`Currency` text NULL,\n  PRIMARY KEY (`CustomerID`)\n);\n\nFirst 3 rows:\n  CustomerID  Segment    Currency\n------------  ---------  ----------\n           3  SME        EUR\n           5  LAM        EUR\n           6  SME        EUR\n...\n\n\nCREATE TABLE `gasstations` (\n`GasStationID` int NOT NULL,\n`ChainID` int NULL,\n`Country` text NULL,\n`Segment` text NULL,\n  PRIMARY KEY (`GasStationID`)\n);\n\nFirst 3 rows:\n  GasStationID    ChainID  Country    Segment\n--------------  ---------  ---------  ---------------\n            44         13  CZE        Value for money\n            45          6  CZE        Premium\n            46         23  CZE        Other\n...\n\n\nCREATE TABLE `products` (\n`ProductID` int NOT NULL,\n`Description` text NULL,\n  PRIMARY KEY (`ProductID`)\n);\n\nFirst 3 rows:\n  ProductID  Description\n-----------  -------------\n          1  Rucní zadání\n          2  Nafta\n          3  Special\n...\n\n\nCREATE TABLE `transactions_1k` (\n`TransactionID` int NOT NULL,\n`Date` date NULL,\n`Time` text NULL,\n`CustomerID` int NULL,\n`CardID` int NULL,\n`GasStationID` int NULL,\n`ProductID` int NULL,\n`Amount` int NULL,\n`Price` double NULL,\n  PRIMARY KEY (`TransactionID`)\n);\n\nFirst 3 rows:\n  TransactionID  Date        Time        CustomerID    CardID    GasStationID    ProductID    Amount    Price\n---------------  ----------  --------  ------------  --------  --------------  -----------  --------  -------\n              1  2012-08-24  09:41:00         31543    486621            3704            2        28   672.64\n              2  2012-08-24  10:03:00         46707    550134            3704            2        18   430.72\n              3  2012-08-24  10:03:00         46707    550134            3704           23         1   121.99\n...\n\n\nCREATE TABLE `yearmonth` (\n`CustomerID` int NOT NULL,\n`Date` varchar(255) NOT NULL,\n`Consumption` double NULL,\n  PRIMARY KEY (`Date`, `CustomerID`),\n  FOREIGN KEY (`CustomerID`) REFERENCES `customers`(`CustomerID`)\n);\n\nFirst 3 rows:\n  CustomerID    Date    Consumption\n------------  ------  -------------\n          39  201112          29.24\n          63  201112          60.14\n         172  201112         575.79\n...\n", "preprocess_schema": "CREATE TABLE `customers` (\n`CustomerID` int NOT NULL,\n`Segment` text NULL,\n`Currency` text NULL,\n  PRIMARY KEY (`CustomerID`)\n);\n\nFirst 3 rows:\n  CustomerID  Segment    Currency\n------------  ---------  ----------\n           3  SME        EUR\n           5  LAM        EUR\n           6  SME        EUR\n...\n\n\nCREATE TABLE `gasstations` (\n`GasStationID` int NOT NULL,\n`ChainID` int NULL,\n`Country` text NULL,\n`Segment` text NULL,\n  PRIMARY KEY (`GasStationID`)\n);\n\nFirst 3 rows:\n  GasStationID    ChainID  Country    Segment\n--------------  ---------  ---------  ---------------\n            44         13  CZE        Value for money\n            45          6  CZE        Premium\n            46         23  CZE        Other\n...\n\n\nCREATE TABLE `products` (\n`ProductID` int NOT NULL,\n`Description` text NULL,\n  PRIMARY KEY (`ProductID`)\n);\n\nFirst 3 rows:\n  ProductID  Description\n-----------  -------------\n          1  Rucní zadání\n          2  Nafta\n          3  Special\n...\n\n\nCREATE TABLE `sales` (\n`id` int NULL,\n`slot` timestamp NULL,\n`total` int NULL\n);\n\nFirst 3 rows:\n  id  slot                   total\n----  -------------------  -------\n   1  2022-12-01 12:00:00      100\n   2  2022-12-01 12:30:00      150\n   3  2022-12-01 13:00:00      200\n...\n\n\nCREATE TABLE `transactions_1k` (\n`TransactionID` int NOT NULL,\n`Date` date NULL,\n`Time` text NULL,\n`CustomerID` int NULL,\n`CardID` int NULL,\n`GasStationID` int NULL,\n`ProductID` int NULL,\n`Amount` int NULL,\n`Price` double NULL,\n  PRIMARY KEY (`TransactionID`)\n);\n\nFirst 3 rows:\n  TransactionID  Date        Time        CustomerID    CardID    GasStationID    ProductID    Amount    Price\n---------------  ----------  --------  ------------  --------  --------------  -----------  --------  -------\n              1  2012-08-24  09:41:00         31543    486621            3704            2        28   672.64\n              2  2012-08-24  10:03:00         46707    550134            3704            2        18   430.72\n              3  2012-08-24  10:03:00         46707    550134            3704           23         1   121.99\n...\n\n\nCREATE TABLE `yearmonth` (\n`CustomerID` int NOT NULL,\n`Date` varchar(255) NOT NULL,\n`Consumption` double NULL,\n  PRIMARY KEY (`Date`, `CustomerID`),\n  FOREIGN KEY (`CustomerID`) REFERENCES `customers`(`CustomerID`)\n);\n\nFirst 3 rows:\n  CustomerID    Date    Consumption\n------------  ------  -------------\n          39  201112          29.24\n          63  201112          60.14\n         172  201112         575.79\n...\n", "sol_sql": ["SET @current_time = TIMESTAMP('2022-12-01 12:40:00');", "WITH cte AS (SELECT slot, SUM(total) OVER(ORDER BY slot) AS total, total AS rowtotal FROM sales WHERE slot < @current_time ORDER BY slot DESC LIMIT 1) SELECT total - (30 - TIMESTAMPDIFF(MINUTE, slot, @current_time))/30 * rowtotal AS total FROM cte"], "test_cases": ["\ndef test_case(pred_sqls, sol_sqls, db_name, conn):\n    result = ex_base(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"ex_base returned {result} but expected 1.\"\n    result = performance_compare_by_qep(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"performance_check returned {result} but expected 1.\"\n    return result\n"]}
{"instance_id": "MySQL_71", "dialect": "MySQL", "version": "8.4.0", "db_id": "debit_card_specializing", "query": "Imagine a scenario where a script logs the transaction data into the `status` table every thirty minutes, but due to various reasons, some intervals might be skipped, leading to gaps in the data. The goal is to fetch all transactions with timestamps rounded to the closest half-hour interval and include empty rows (all fields except for the timestamp should be null) for any intervals where no transaction data is available. The table structure, data, and script cannot be altered. The only solution I could come up with that yields the desired result doesn't scale. Can you help optimize my sql?", "issue_sql": ["WITH RECURSIVE `timestamps`(`timestamp`) AS ( SELECT ( SELECT FROM_UNIXTIME( UNIX_TIMESTAMP(MIN(`timestamp`)) - MOD(UNIX_TIMESTAMP(MIN(`timestamp`)), 1800)) FROM `statuses`) UNION ALL SELECT DATE_ADD(`timestamp`, INTERVAL 30 MINUTE) FROM `timestamps` WHERE `timestamp` < ( SELECT FROM_UNIXTIME( UNIX_TIMESTAMP(MAX(`timestamp`)) - MOD(UNIX_TIMESTAMP(MAX(`timestamp`)), 1800)) FROM `statuses`)) SELECT `t`.`timestamp`, `s`.`status` FROM `timestamps` AS `t` LEFT OUTER JOIN `statuses` AS `s` ON `t`.`timestamp` = FROM_UNIXTIME( UNIX_TIMESTAMP(`s`.`timestamp`) - MOD(UNIX_TIMESTAMP(`s`.`timestamp`), 1800)) ORDER BY `t`.`timestamp` ASC;"], "preprocess_sql": ["CREATE TABLE IF NOT EXISTS `statuses` (`timestamp` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP, `status` INT NOT NULL DEFAULT '0', PRIMARY KEY (`timestamp`) );", "INSERT IGNORE INTO `statuses` (`timestamp`, `status`) VALUES ('2023-01-01 00:03:34', '164850'), ('2023-01-01 00:31:23', '794088'), ('2023-01-01 03:31:28', '686754'), ('2023-01-01 04:01:15', '684711'), ('2023-01-01 05:31:35', '116777'), ('2023-01-01 06:01:52', '469332'), ('2023-01-01 06:31:55', '816300'), ('2023-01-01 08:33:53', '309583'), ('2023-01-01 09:03:54', '847976'), ('2023-01-01 09:31:33', '812517');"], "clean_up_sql": ["DROP TABLE IF EXISTS statuses;"], "category": "Efficiency", "original_schema": "CREATE TABLE `customers` (\n`CustomerID` int NOT NULL,\n`Segment` text NULL,\n`Currency` text NULL,\n  PRIMARY KEY (`CustomerID`)\n);\n\nFirst 3 rows:\n  CustomerID  Segment    Currency\n------------  ---------  ----------\n           3  SME        EUR\n           5  LAM        EUR\n           6  SME        EUR\n...\n\n\nCREATE TABLE `gasstations` (\n`GasStationID` int NOT NULL,\n`ChainID` int NULL,\n`Country` text NULL,\n`Segment` text NULL,\n  PRIMARY KEY (`GasStationID`)\n);\n\nFirst 3 rows:\n  GasStationID    ChainID  Country    Segment\n--------------  ---------  ---------  ---------------\n            44         13  CZE        Value for money\n            45          6  CZE        Premium\n            46         23  CZE        Other\n...\n\n\nCREATE TABLE `products` (\n`ProductID` int NOT NULL,\n`Description` text NULL,\n  PRIMARY KEY (`ProductID`)\n);\n\nFirst 3 rows:\n  ProductID  Description\n-----------  -------------\n          1  Rucní zadání\n          2  Nafta\n          3  Special\n...\n\n\nCREATE TABLE `transactions_1k` (\n`TransactionID` int NOT NULL,\n`Date` date NULL,\n`Time` text NULL,\n`CustomerID` int NULL,\n`CardID` int NULL,\n`GasStationID` int NULL,\n`ProductID` int NULL,\n`Amount` int NULL,\n`Price` double NULL,\n  PRIMARY KEY (`TransactionID`)\n);\n\nFirst 3 rows:\n  TransactionID  Date        Time        CustomerID    CardID    GasStationID    ProductID    Amount    Price\n---------------  ----------  --------  ------------  --------  --------------  -----------  --------  -------\n              1  2012-08-24  09:41:00         31543    486621            3704            2        28   672.64\n              2  2012-08-24  10:03:00         46707    550134            3704            2        18   430.72\n              3  2012-08-24  10:03:00         46707    550134            3704           23         1   121.99\n...\n\n\nCREATE TABLE `yearmonth` (\n`CustomerID` int NOT NULL,\n`Date` varchar(255) NOT NULL,\n`Consumption` double NULL,\n  PRIMARY KEY (`Date`, `CustomerID`),\n  FOREIGN KEY (`CustomerID`) REFERENCES `customers`(`CustomerID`)\n);\n\nFirst 3 rows:\n  CustomerID    Date    Consumption\n------------  ------  -------------\n          39  201112          29.24\n          63  201112          60.14\n         172  201112         575.79\n...\n", "preprocess_schema": "CREATE TABLE `customers` (\n`CustomerID` int NOT NULL,\n`Segment` text NULL,\n`Currency` text NULL,\n  PRIMARY KEY (`CustomerID`)\n);\n\nFirst 3 rows:\n  CustomerID  Segment    Currency\n------------  ---------  ----------\n           3  SME        EUR\n           5  LAM        EUR\n           6  SME        EUR\n...\n\n\nCREATE TABLE `gasstations` (\n`GasStationID` int NOT NULL,\n`ChainID` int NULL,\n`Country` text NULL,\n`Segment` text NULL,\n  PRIMARY KEY (`GasStationID`)\n);\n\nFirst 3 rows:\n  GasStationID    ChainID  Country    Segment\n--------------  ---------  ---------  ---------------\n            44         13  CZE        Value for money\n            45          6  CZE        Premium\n            46         23  CZE        Other\n...\n\n\nCREATE TABLE `products` (\n`ProductID` int NOT NULL,\n`Description` text NULL,\n  PRIMARY KEY (`ProductID`)\n);\n\nFirst 3 rows:\n  ProductID  Description\n-----------  -------------\n          1  Rucní zadání\n          2  Nafta\n          3  Special\n...\n\n\nCREATE TABLE `statuses` (\n`timestamp` timestamp NOT NULL DEFAULT 'CURRENT_TIMESTAMP',\n`status` int NOT NULL DEFAULT '0',\n  PRIMARY KEY (`timestamp`)\n);\n\nFirst 3 rows:\ntimestamp              status\n-------------------  --------\n2023-01-01 00:03:34    164850\n2023-01-01 00:31:23    794088\n2023-01-01 03:31:28    686754\n...\n\n\nCREATE TABLE `transactions_1k` (\n`TransactionID` int NOT NULL,\n`Date` date NULL,\n`Time` text NULL,\n`CustomerID` int NULL,\n`CardID` int NULL,\n`GasStationID` int NULL,\n`ProductID` int NULL,\n`Amount` int NULL,\n`Price` double NULL,\n  PRIMARY KEY (`TransactionID`)\n);\n\nFirst 3 rows:\n  TransactionID  Date        Time        CustomerID    CardID    GasStationID    ProductID    Amount    Price\n---------------  ----------  --------  ------------  --------  --------------  -----------  --------  -------\n              1  2012-08-24  09:41:00         31543    486621            3704            2        28   672.64\n              2  2012-08-24  10:03:00         46707    550134            3704            2        18   430.72\n              3  2012-08-24  10:03:00         46707    550134            3704           23         1   121.99\n...\n\n\nCREATE TABLE `yearmonth` (\n`CustomerID` int NOT NULL,\n`Date` varchar(255) NOT NULL,\n`Consumption` double NULL,\n  PRIMARY KEY (`Date`, `CustomerID`),\n  FOREIGN KEY (`CustomerID`) REFERENCES `customers`(`CustomerID`)\n);\n\nFirst 3 rows:\n  CustomerID    Date    Consumption\n------------  ------  -------------\n          39  201112          29.24\n          63  201112          60.14\n         172  201112         575.79\n...\n", "sol_sql": ["WITH RECURSIVE data AS (SELECT FROM_UNIXTIME(FLOOR(UNIX_TIMESTAMP(`timestamp`) / 1800) * 1800) as ts, MAX(status) AS status FROM statuses GROUP BY FROM_UNIXTIME(FLOOR(UNIX_TIMESTAMP(`timestamp`) / 1800) * 1800)), timestamps (ts, tsmax) AS (SELECT MIN(ts), MAX(ts) FROM data UNION ALL SELECT ts + INTERVAL 30 MINUTE, tsmax FROM timestamps WHERE ts < tsmax) SELECT t.ts, d.status FROM timestamps t LEFT OUTER JOIN data d ON d.ts = t.ts ORDER BY t.ts;"], "test_cases": ["\ndef test_case(pred_sqls, sol_sqls, db_name, conn):\n    result = ex_base(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"ex_base returned {result} but expected 1.\"\n    result = performance_compare_by_qep(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"performance_check returned {result} but expected 1.\"\n    return result\n    "]}
{"instance_id": "Oracle_23", "dialect": "Oracle", "version": "19.3.0", "db_id": "california_schools", "query": "We have two tables in our database: 'ply' and 'pnt'. The 'ply' table contains information about various schools in California, including their geographical coordinates (Latitude and Longitude). The 'pnt' table contains data about the free and reduced-price meal (FRPM) eligibility of students in these schools. We need to find a list of unique schools that have at least one student eligible for FRPM (selects polygons that intersect at least one point). The query should be optimized to run efficiently, as the tables contain a large number of records.", "issue_sql": ["select distinct c.objectid as objectid from sdo_join('PNT','SHAPE','PLY','SHAPE','MASK=anyinteract') a, pnt b, ply c where a.rowid1 = b.rowid and a.rowid2 = c.rowid"], "preprocess_sql": ["CREATE TABLE ply (objectid NUMBER(*,0), query_source NVARCHAR2(255), shape SDO_GEOMETRY)", "CREATE UNIQUE INDEX ply_objectid ON ply (objectid)", "INSERT INTO user_sdo_geom_metadata (table_name,column_name,diminfo,srid) VALUES ('ply', 'SHAPE', sdo_dim_array(sdo_dim_element(NULL, 0, 100, 0.001), sdo_dim_element(NULL, 0, 100, 0.001)), 26917)", "CREATE INDEX ply_shape ON ply (shape) INDEXTYPE IS mdsys.spatial_index_v2", "insert into ply select * from (select cast(rownum as number(38,0)) as objectid, 'Query - Polygons' as query_source, sdo_geometry('polygon(('||startpoint_x||' '||startpoint_y||', '||endpoint_x||' '||endpoint_y||', '||endpoint_x||' '||(endpoint_y+1)||', '||startpoint_x||' '||(startpoint_y+1)||', '||startpoint_x||' '||startpoint_y||'))',26917) as shape from (with dimension as (select 0 as point from dual union all select level from dual connect by level <= 70), points as (select a.point as startpoint, b.point as endpoint, c.point as fixed from dimension a cross join dimension b cross join dimension c where b.point - a.point = 1) select startpoint_x + 2.25 as startpoint_x, startpoint_y + 2.25 as startpoint_y, endpoint_x + 2.25 as endpoint_x, endpoint_y + 2.25 as endpoint_y from (select startpoint as startpoint_x, fixed as startpoint_y, endpoint as endpoint_x, fixed as endpoint_y from points union all select fixed as startpoint_x, startpoint as startpoint_y, fixed as endpoint_x, endpoint as endpoint_y from points)) where startpoint_y = endpoint_y)", "CREATE TABLE pnt (objectid NUMBER(*,0), query_source NVARCHAR2(255), shape SDO_GEOMETRY)", "CREATE UNIQUE INDEX pnt_objectid ON pnt (objectid)", "INSERT INTO user_sdo_geom_metadata (table_name,column_name,diminfo,srid) VALUES ('PNT', 'SHAPE', sdo_dim_array(sdo_dim_element(NULL, 0, 100, 0.001), sdo_dim_element(NULL, 0, 100, 0.001)), 26917)", "CREATE INDEX pnt_shape ON pnt (shape) INDEXTYPE IS mdsys.spatial_index_v2", "INSERT INTO pnt SELECT * FROM (WITH dimension AS (SELECT 0 AS point FROM dual UNION ALL SELECT LEVEL FROM dual CONNECT BY LEVEL <= 40), points AS (SELECT a.point AS startpoint, b.point AS endpoint, c.point AS fixed FROM dimension a CROSS JOIN dimension b CROSS JOIN dimension c WHERE b.point - a.point = 1) SELECT CAST(ROWNUM AS NUMBER(38,0)) AS objectid, 'Query - Points 1' AS query_source, SDO_GEOMETRY('point('||x||' '||y||')', 26917) AS shape FROM (SELECT startpoint AS x, fixed AS y FROM points UNION ALL SELECT fixed AS x, startpoint AS y FROM points))", "INSERT INTO pnt SELECT * FROM (WITH dimension AS (SELECT 0 AS point FROM dual UNION ALL SELECT LEVEL FROM dual CONNECT BY LEVEL <= 10), points AS (SELECT a.point AS startpoint, b.point AS endpoint, c.point AS fixed FROM dimension a CROSS JOIN dimension b CROSS JOIN dimension c WHERE b.point - a.point = 1) SELECT CAST(ROWNUM + 10000 AS NUMBER(38,0)) AS objectid, 'Query - Points 2' AS query_source, SDO_GEOMETRY('point('||x||' '||y||')', 26917) AS shape FROM (SELECT endpoint + 0.5 AS x, fixed + 0.5 AS y FROM points UNION ALL SELECT fixed + 0.5 AS x, endpoint + 0.5 AS y FROM points))"], "clean_up_sql": ["DROP TABLE ply", "DROP TABLE pnt"], "category": "Efficiency", "original_schema": "\n\nCREATE TABLE \"schools\" (\n    \"CDSCode\" NVARCHAR2(512) NOT NULL,\n    \"NCESDist\" NCLOB NULL,\n    \"NCESSchool\" NCLOB NULL,\n    \"StatusType\" NCLOB NOT NULL,\n    \"County\" NCLOB NOT NULL,\n    \"District\" NCLOB NOT NULL,\n    \"School\" NCLOB NULL,\n    \"Street\" NCLOB NULL,\n    \"StreetAbr\" NCLOB NULL,\n    \"City\" NCLOB NULL,\n    \"Zip\" NCLOB NULL,\n    \"State\" NCLOB NULL,\n    \"MailStreet\" NCLOB NULL,\n    \"MailStrAbr\" NCLOB NULL,\n    \"MailCity\" NCLOB NULL,\n    \"MailZip\" NCLOB NULL,\n    \"MailState\" NCLOB NULL,\n    \"Phone\" NCLOB NULL,\n    \"Ext\" NCLOB NULL,\n    \"Website\" NCLOB NULL,\n    \"OpenDate\" DATE NULL,\n    \"ClosedDate\" DATE NULL,\n    \"Charter\" NUMBER(11,0) NULL,\n    \"CharterNum\" NCLOB NULL,\n    \"FundingType\" NCLOB NULL,\n    \"DOC\" NCLOB NOT NULL,\n    \"DOCType\" NCLOB NOT NULL,\n    \"SOC\" NCLOB NULL,\n    \"SOCType\" NCLOB NULL,\n    \"EdOpsCode\" NCLOB NULL,\n    \"EdOpsName\" NCLOB NULL,\n    \"EILCode\" NCLOB NULL,\n    \"EILName\" NCLOB NULL,\n    \"GSoffered\" NCLOB NULL,\n    \"GSserved\" NCLOB NULL,\n    \"Virtual\" NCLOB NULL,\n    \"Magnet\" NUMBER(11,0) NULL,\n    \"Latitude\" NUMBER NULL,\n    \"Longitude\" NUMBER NULL,\n    \"AdmFName1\" NCLOB NULL,\n    \"AdmLName1\" NCLOB NULL,\n    \"AdmEmail1\" NCLOB NULL,\n    \"AdmFName2\" NCLOB NULL,\n    \"AdmLName2\" NCLOB NULL,\n    \"AdmEmail2\" NCLOB NULL,\n    \"AdmFName3\" NCLOB NULL,\n    \"AdmLName3\" NCLOB NULL,\n    \"AdmEmail3\" NCLOB NULL,\n    \"LastUpdate\" DATE NOT NULL,\n    PRIMARY KEY (\"CDSCode\")\n);\nFirst 3 rows:\n       CDSCode    NCESDist    NCESSchool  StatusType    County    District                            School                              Street                  StreetAbr             City         Zip         State    MailStreet              MailStrAbr            MailCity     MailZip     MailState    Phone           Ext    Website       OpenDate             ClosedDate             Charter  CharterNum    FundingType      DOC  DOCType                             SOC  SOCType                 EdOpsCode    EdOpsName                EILCode    EILName      GSoffered    GSserved    Virtual      Magnet    Latitude    Longitude  AdmFName1    AdmLName1    AdmEmail1             AdmFName2    AdmLName2    AdmEmail2    AdmFName3    AdmLName3    AdmEmail3    LastUpdate\n--------------  ----------  ------------  ------------  --------  ----------------------------------  ----------------------------------  ----------------------  --------------------  -----------  ----------  -------  ----------------------  --------------------  -----------  ----------  -----------  --------------  -----  ------------  -------------------  -------------------  ---------  ------------  -------------  -----  --------------------------------  -----  ----------------------  -----------  -----------------------  ---------  -----------  -----------  ----------  ---------  --------  ----------  -----------  -----------  -----------  --------------------  -----------  -----------  -----------  -----------  -----------  -----------  -------------------\n01100170130401     0691051         09264  Active        Alameda   Alameda County Office of Education  Alameda County Juvenile Hall/Court  2500 Fairmont Avenue    2500 Fairmont Ave.    San Leandro  94578-1005  CA       2500 Fairmont Avenue    2500 Fairmont Ave.    San Leandro  94578-1005  CA           (510) 667-7435         www.acoe.org  1980-07-01 00:00:00  NaT                          0                                  00  County Office of Education (COE)     14  Juvenile Court Schools  JUV          Juvenile Court School    HS         High School  K-12         8-12        N                 0     37.7129     -122.112  Michael      Hermosillo   mhermosillo@acoe.org                                                                                2016-05-10 00:00:00\n01100170130419     0691051         06830  Active        Alameda   Alameda County Office of Education  Alameda County Community            313 West Winton Avenue  313 West Winton Ave.  Hayward      94544-1136  CA       313 West Winton Avenue  313 West Winton Ave.  Hayward      94544-1136  CA           (510) 670-4590         www.acoe.org  1980-07-01 00:00:00  NaT                          0                                  00  County Office of Education (COE)     10  County Community        COMM         County Community School  HS         High School  K-12         7-12        P                 0     37.6582     -122.097  Carolyn      Hobbs        chobbs@acoe.org                                                                                     2016-10-06 00:00:00\n01100170130427     0691051         09265  Closed        Alameda   Alameda County Office of Education  Alameda County Opportunity          313 West Winton Avenue  313 West Winton Ave.  Hayward      94544-1136  CA       313 West Winton Avenue  313 West Winton Ave.  Hayward      94544-1136  CA                                  www.acoe.org  1980-07-01 00:00:00  2013-06-30 00:00:00          0                                  00  County Office of Education (COE)     13  Opportunity Schools     OPP          Opportunity School       HS         High School  7-12         8-12                        nan     37.6582     -122.097                                                                                                                                2014-04-28 00:00:00\n...\n\n\nCREATE TABLE \"frpm\" (\n    \"CDSCode\" NVARCHAR2(512) NOT NULL,\n    \"Academic Year\" NCLOB NULL,\n    \"County Code\" NCLOB NULL,\n    \"District Code\" NUMBER(11,0) NULL,\n    \"School Code\" NCLOB NULL,\n    \"County Name\" NCLOB NULL,\n    \"District Name\" NCLOB NULL,\n    \"School Name\" NCLOB NULL,\n    \"District Type\" NCLOB NULL,\n    \"School Type\" NCLOB NULL,\n    \"Educational Option Type\" NCLOB NULL,\n    \"NSLP Provision Status\" NCLOB NULL,\n    \"Charter School (Y/N)\" NUMBER(11,0) NULL,\n    \"Charter School Number\" NCLOB NULL,\n    \"Charter Funding Type\" NCLOB NULL,\n    \"IRC\" NUMBER(11,0) NULL,\n    \"Low Grade\" NCLOB NULL,\n    \"High Grade\" NCLOB NULL,\n    \"Enrollment (K-12)\" NUMBER NULL,\n    \"Free Meal Count (K-12)\" NUMBER NULL,\n    \"Percent (%) Eligible Free (K-12)\" NUMBER NULL,\n    \"FRPM Count (K-12)\" NUMBER NULL,\n    \"Percent (%) Eligible FRPM (K-12)\" NUMBER NULL,\n    \"Enrollment (Ages 5-17)\" NUMBER NULL,\n    \"Free Meal Count (Ages 5-17)\" NUMBER NULL,\n    \"Percent (%) Eligible Free (Ages 5-17)\" NUMBER NULL,\n    \"FRPM Count (Ages 5-17)\" NUMBER NULL,\n    \"Percent (%) Eligible FRPM (Ages 5-17)\" NUMBER NULL,\n    \"2013-14 CALPADS Fall 1 Certification Status\" NUMBER(11,0) NULL,\n    PRIMARY KEY (\"CDSCode\"),\n    FOREIGN KEY (\"CDSCode\") REFERENCES \"schools\"(\"CDSCode\")\n);\nFirst 3 rows:\n       CDSCode  Academic Year      County Code    District Code    School Code  County Name    District Name    School Name                        District Type            School Type                           Educational Option Type    NSLP Provision Status      Charter School (Y/N)    Charter School Number  Charter Funding Type      IRC    Low Grade    High Grade    Enrollment (K-12)    Free Meal Count (K-12)    Percent (%) Eligible Free (K-12)    FRPM Count (K-12)    Percent (%) Eligible FRPM (K-12)    Enrollment (Ages 5-17)    Free Meal Count (Ages 5-17)    Percent (%) Eligible Free (Ages 5-17)    FRPM Count (Ages 5-17)    Percent (%) Eligible FRPM (Ages 5-17)    2013-14 CALPADS Fall 1 Certification Status\n--------------  ---------------  -------------  ---------------  -------------  -------------  ---------------  ---------------------------------  -----------------------  ------------------------------------  -------------------------  -----------------------  ----------------------  -----------------------  ----------------------  -----  -----------  ------------  -------------------  ------------------------  ----------------------------------  -------------------  ----------------------------------  ------------------------  -----------------------------  ---------------------------------------  ------------------------  ---------------------------------------  ---------------------------------------------\n01611190128199  2014-2015                   01            61119        0128199  Alameda        Alameda Unified  Encinal Junior Jets                Unified School District  Intermediate/Middle Schools (Public)  Traditional                                                              0                                                       0            6             8                  229                       103                           0.449782                   128                            0.558952                       229                            103                                0.449782                        128                                 0.558952                                              1\n01611190130229  2014-2015                   01            61119        0130229  Alameda        Alameda Unified  Alameda High                       Unified School District  High Schools (Public)                 Traditional                                                              0                                                       0            9            12                 1746                       320                           0.183276                   396                            0.226804                      1675                            307                                0.183284                        378                                 0.225672                                              1\n01611190130609  2014-2015                   01            61119        0130609  Alameda        Alameda Unified  Alameda Community Learning Center  Unified School District  High Schools (Public)                 Traditional                                                              1                     0352  Directly funded             1            6            12                  376                        35                           0.0930851                   47                            0.125                          374                             33                                0.0882353                        45                                 0.120321                                              1\n...\n\n\nCREATE TABLE \"satscores\" (\n    \"cds\" NVARCHAR2(512) NOT NULL,\n    \"rtype\" NCLOB NOT NULL,\n    \"sname\" NCLOB NULL,\n    \"dname\" NCLOB NULL,\n    \"cname\" NCLOB NULL,\n    \"enroll12\" NUMBER(11,0) NOT NULL,\n    \"NumTstTakr\" NUMBER(11,0) NOT NULL,\n    \"AvgScrRead\" NUMBER(11,0) NULL,\n    \"AvgScrMath\" NUMBER(11,0) NULL,\n    \"AvgScrWrite\" NUMBER(11,0) NULL,\n    \"NumGE1500\" NUMBER(11,0) NULL,\n    PRIMARY KEY (\"cds\"),\n    FOREIGN KEY (\"cds\") REFERENCES \"schools\"(\"CDSCode\")\n);\nFirst 3 rows:\n           cds  rtype    sname                          dname            cname      enroll12    NumTstTakr    AvgScrRead    AvgScrMath    AvgScrWrite    NumGE1500\n--------------  -------  -----------------------------  ---------------  -------  ----------  ------------  ------------  ------------  -------------  -----------\n01612590115238  S        ARISE High                     Oakland Unified  Alameda          36            39           359           367            369            1\n01612590115386  S        Civicorps Corpsmember Academy  Oakland Unified  Alameda          80             0           nan           nan            nan          nan\n01612590115667  S        Oakland International High     Oakland Unified  Alameda          90            19           308           352            327            0\n...\n", "preprocess_schema": "\n\nCREATE TABLE \"PLY\" (\n    \"OBJECTID\" NUMBER NULL,\n    \"QUERY_SOURCE\" NVARCHAR2(510) NULL,\n    \"SHAPE\" SDO_GEOMETRY NULL\n);\nFirst 3 rows:\n  OBJECTID  QUERY_SOURCE      SHAPE\n----------  ----------------  --------------------------------------------------------\n       165  Query - Polygons  <oracledb.DbObject MDSYS.SDO_GEOMETRY at 0xffffa27212a0>\n       166  Query - Polygons  <oracledb.DbObject MDSYS.SDO_GEOMETRY at 0xffffa2721a20>\n       167  Query - Polygons  <oracledb.DbObject MDSYS.SDO_GEOMETRY at 0xffffa27212d0>\n...\n\n\nCREATE TABLE \"MDRT_124B2$\" (\n    \"NODE_ID\" NUMBER NULL,\n    \"NODE_LEVEL\" NUMBER NULL,\n    \"INFO\" BLOB NULL\n);\nError getting sample data: __str__ returned non-string (type bytes)\n\nCREATE TABLE \"PNT\" (\n    \"OBJECTID\" NUMBER NULL,\n    \"QUERY_SOURCE\" NVARCHAR2(510) NULL,\n    \"SHAPE\" SDO_GEOMETRY NULL\n);\nFirst 3 rows:\n  OBJECTID  QUERY_SOURCE      SHAPE\n----------  ----------------  --------------------------------------------------------\n       494  Query - Points 1  <oracledb.DbObject MDSYS.SDO_GEOMETRY at 0xffffa2721a50>\n       495  Query - Points 1  <oracledb.DbObject MDSYS.SDO_GEOMETRY at 0xffffa2721270>\n       496  Query - Points 1  <oracledb.DbObject MDSYS.SDO_GEOMETRY at 0xffffa2721a80>\n...\n\n\nCREATE TABLE \"MDRT_124BF$\" (\n    \"NODE_ID\" NUMBER NULL,\n    \"NODE_LEVEL\" NUMBER NULL,\n    \"INFO\" BLOB NULL\n);\nError getting sample data: __str__ returned non-string (type bytes)\n\nCREATE TABLE \"schools\" (\n    \"CDSCode\" NVARCHAR2(512) NOT NULL,\n    \"NCESDist\" NCLOB NULL,\n    \"NCESSchool\" NCLOB NULL,\n    \"StatusType\" NCLOB NOT NULL,\n    \"County\" NCLOB NOT NULL,\n    \"District\" NCLOB NOT NULL,\n    \"School\" NCLOB NULL,\n    \"Street\" NCLOB NULL,\n    \"StreetAbr\" NCLOB NULL,\n    \"City\" NCLOB NULL,\n    \"Zip\" NCLOB NULL,\n    \"State\" NCLOB NULL,\n    \"MailStreet\" NCLOB NULL,\n    \"MailStrAbr\" NCLOB NULL,\n    \"MailCity\" NCLOB NULL,\n    \"MailZip\" NCLOB NULL,\n    \"MailState\" NCLOB NULL,\n    \"Phone\" NCLOB NULL,\n    \"Ext\" NCLOB NULL,\n    \"Website\" NCLOB NULL,\n    \"OpenDate\" DATE NULL,\n    \"ClosedDate\" DATE NULL,\n    \"Charter\" NUMBER(11,0) NULL,\n    \"CharterNum\" NCLOB NULL,\n    \"FundingType\" NCLOB NULL,\n    \"DOC\" NCLOB NOT NULL,\n    \"DOCType\" NCLOB NOT NULL,\n    \"SOC\" NCLOB NULL,\n    \"SOCType\" NCLOB NULL,\n    \"EdOpsCode\" NCLOB NULL,\n    \"EdOpsName\" NCLOB NULL,\n    \"EILCode\" NCLOB NULL,\n    \"EILName\" NCLOB NULL,\n    \"GSoffered\" NCLOB NULL,\n    \"GSserved\" NCLOB NULL,\n    \"Virtual\" NCLOB NULL,\n    \"Magnet\" NUMBER(11,0) NULL,\n    \"Latitude\" NUMBER NULL,\n    \"Longitude\" NUMBER NULL,\n    \"AdmFName1\" NCLOB NULL,\n    \"AdmLName1\" NCLOB NULL,\n    \"AdmEmail1\" NCLOB NULL,\n    \"AdmFName2\" NCLOB NULL,\n    \"AdmLName2\" NCLOB NULL,\n    \"AdmEmail2\" NCLOB NULL,\n    \"AdmFName3\" NCLOB NULL,\n    \"AdmLName3\" NCLOB NULL,\n    \"AdmEmail3\" NCLOB NULL,\n    \"LastUpdate\" DATE NOT NULL,\n    PRIMARY KEY (\"CDSCode\")\n);\nFirst 3 rows:\n       CDSCode    NCESDist    NCESSchool  StatusType    County    District                            School                              Street                  StreetAbr             City         Zip         State    MailStreet              MailStrAbr            MailCity     MailZip     MailState    Phone           Ext    Website       OpenDate             ClosedDate             Charter  CharterNum    FundingType      DOC  DOCType                             SOC  SOCType                 EdOpsCode    EdOpsName                EILCode    EILName      GSoffered    GSserved    Virtual      Magnet    Latitude    Longitude  AdmFName1    AdmLName1    AdmEmail1             AdmFName2    AdmLName2    AdmEmail2    AdmFName3    AdmLName3    AdmEmail3    LastUpdate\n--------------  ----------  ------------  ------------  --------  ----------------------------------  ----------------------------------  ----------------------  --------------------  -----------  ----------  -------  ----------------------  --------------------  -----------  ----------  -----------  --------------  -----  ------------  -------------------  -------------------  ---------  ------------  -------------  -----  --------------------------------  -----  ----------------------  -----------  -----------------------  ---------  -----------  -----------  ----------  ---------  --------  ----------  -----------  -----------  -----------  --------------------  -----------  -----------  -----------  -----------  -----------  -----------  -------------------\n01100170130401     0691051         09264  Active        Alameda   Alameda County Office of Education  Alameda County Juvenile Hall/Court  2500 Fairmont Avenue    2500 Fairmont Ave.    San Leandro  94578-1005  CA       2500 Fairmont Avenue    2500 Fairmont Ave.    San Leandro  94578-1005  CA           (510) 667-7435         www.acoe.org  1980-07-01 00:00:00  NaT                          0                                  00  County Office of Education (COE)     14  Juvenile Court Schools  JUV          Juvenile Court School    HS         High School  K-12         8-12        N                 0     37.7129     -122.112  Michael      Hermosillo   mhermosillo@acoe.org                                                                                2016-05-10 00:00:00\n01100170130419     0691051         06830  Active        Alameda   Alameda County Office of Education  Alameda County Community            313 West Winton Avenue  313 West Winton Ave.  Hayward      94544-1136  CA       313 West Winton Avenue  313 West Winton Ave.  Hayward      94544-1136  CA           (510) 670-4590         www.acoe.org  1980-07-01 00:00:00  NaT                          0                                  00  County Office of Education (COE)     10  County Community        COMM         County Community School  HS         High School  K-12         7-12        P                 0     37.6582     -122.097  Carolyn      Hobbs        chobbs@acoe.org                                                                                     2016-10-06 00:00:00\n01100170130427     0691051         09265  Closed        Alameda   Alameda County Office of Education  Alameda County Opportunity          313 West Winton Avenue  313 West Winton Ave.  Hayward      94544-1136  CA       313 West Winton Avenue  313 West Winton Ave.  Hayward      94544-1136  CA                                  www.acoe.org  1980-07-01 00:00:00  2013-06-30 00:00:00          0                                  00  County Office of Education (COE)     13  Opportunity Schools     OPP          Opportunity School       HS         High School  7-12         8-12                        nan     37.6582     -122.097                                                                                                                                2014-04-28 00:00:00\n...\n\n\nCREATE TABLE \"frpm\" (\n    \"CDSCode\" NVARCHAR2(512) NOT NULL,\n    \"Academic Year\" NCLOB NULL,\n    \"County Code\" NCLOB NULL,\n    \"District Code\" NUMBER(11,0) NULL,\n    \"School Code\" NCLOB NULL,\n    \"County Name\" NCLOB NULL,\n    \"District Name\" NCLOB NULL,\n    \"School Name\" NCLOB NULL,\n    \"District Type\" NCLOB NULL,\n    \"School Type\" NCLOB NULL,\n    \"Educational Option Type\" NCLOB NULL,\n    \"NSLP Provision Status\" NCLOB NULL,\n    \"Charter School (Y/N)\" NUMBER(11,0) NULL,\n    \"Charter School Number\" NCLOB NULL,\n    \"Charter Funding Type\" NCLOB NULL,\n    \"IRC\" NUMBER(11,0) NULL,\n    \"Low Grade\" NCLOB NULL,\n    \"High Grade\" NCLOB NULL,\n    \"Enrollment (K-12)\" NUMBER NULL,\n    \"Free Meal Count (K-12)\" NUMBER NULL,\n    \"Percent (%) Eligible Free (K-12)\" NUMBER NULL,\n    \"FRPM Count (K-12)\" NUMBER NULL,\n    \"Percent (%) Eligible FRPM (K-12)\" NUMBER NULL,\n    \"Enrollment (Ages 5-17)\" NUMBER NULL,\n    \"Free Meal Count (Ages 5-17)\" NUMBER NULL,\n    \"Percent (%) Eligible Free (Ages 5-17)\" NUMBER NULL,\n    \"FRPM Count (Ages 5-17)\" NUMBER NULL,\n    \"Percent (%) Eligible FRPM (Ages 5-17)\" NUMBER NULL,\n    \"2013-14 CALPADS Fall 1 Certification Status\" NUMBER(11,0) NULL,\n    PRIMARY KEY (\"CDSCode\"),\n    FOREIGN KEY (\"CDSCode\") REFERENCES \"schools\"(\"CDSCode\")\n);\nFirst 3 rows:\n       CDSCode  Academic Year      County Code    District Code    School Code  County Name    District Name    School Name                        District Type            School Type                           Educational Option Type    NSLP Provision Status      Charter School (Y/N)    Charter School Number  Charter Funding Type      IRC    Low Grade    High Grade    Enrollment (K-12)    Free Meal Count (K-12)    Percent (%) Eligible Free (K-12)    FRPM Count (K-12)    Percent (%) Eligible FRPM (K-12)    Enrollment (Ages 5-17)    Free Meal Count (Ages 5-17)    Percent (%) Eligible Free (Ages 5-17)    FRPM Count (Ages 5-17)    Percent (%) Eligible FRPM (Ages 5-17)    2013-14 CALPADS Fall 1 Certification Status\n--------------  ---------------  -------------  ---------------  -------------  -------------  ---------------  ---------------------------------  -----------------------  ------------------------------------  -------------------------  -----------------------  ----------------------  -----------------------  ----------------------  -----  -----------  ------------  -------------------  ------------------------  ----------------------------------  -------------------  ----------------------------------  ------------------------  -----------------------------  ---------------------------------------  ------------------------  ---------------------------------------  ---------------------------------------------\n01611190128199  2014-2015                   01            61119        0128199  Alameda        Alameda Unified  Encinal Junior Jets                Unified School District  Intermediate/Middle Schools (Public)  Traditional                                                              0                                                       0            6             8                  229                       103                           0.449782                   128                            0.558952                       229                            103                                0.449782                        128                                 0.558952                                              1\n01611190130229  2014-2015                   01            61119        0130229  Alameda        Alameda Unified  Alameda High                       Unified School District  High Schools (Public)                 Traditional                                                              0                                                       0            9            12                 1746                       320                           0.183276                   396                            0.226804                      1675                            307                                0.183284                        378                                 0.225672                                              1\n01611190130609  2014-2015                   01            61119        0130609  Alameda        Alameda Unified  Alameda Community Learning Center  Unified School District  High Schools (Public)                 Traditional                                                              1                     0352  Directly funded             1            6            12                  376                        35                           0.0930851                   47                            0.125                          374                             33                                0.0882353                        45                                 0.120321                                              1\n...\n\n\nCREATE TABLE \"satscores\" (\n    \"cds\" NVARCHAR2(512) NOT NULL,\n    \"rtype\" NCLOB NOT NULL,\n    \"sname\" NCLOB NULL,\n    \"dname\" NCLOB NULL,\n    \"cname\" NCLOB NULL,\n    \"enroll12\" NUMBER(11,0) NOT NULL,\n    \"NumTstTakr\" NUMBER(11,0) NOT NULL,\n    \"AvgScrRead\" NUMBER(11,0) NULL,\n    \"AvgScrMath\" NUMBER(11,0) NULL,\n    \"AvgScrWrite\" NUMBER(11,0) NULL,\n    \"NumGE1500\" NUMBER(11,0) NULL,\n    PRIMARY KEY (\"cds\"),\n    FOREIGN KEY (\"cds\") REFERENCES \"schools\"(\"CDSCode\")\n);\nFirst 3 rows:\n           cds  rtype    sname                          dname            cname      enroll12    NumTstTakr    AvgScrRead    AvgScrMath    AvgScrWrite    NumGE1500\n--------------  -------  -----------------------------  ---------------  -------  ----------  ------------  ------------  ------------  -------------  -----------\n01612590115238  S        ARISE High                     Oakland Unified  Alameda          36            39           359           367            369            1\n01612590115386  S        Civicorps Corpsmember Academy  Oakland Unified  Alameda          80             0           nan           nan            nan          nan\n01612590115667  S        Oakland International High     Oakland Unified  Alameda          90            19           308           352            327            0\n...\n", "sol_sql": ["SELECT objectid FROM (SELECT ply.objectid, row_number() OVER (PARTITION BY ply.objectid ORDER BY NULL) rn FROM ply CROSS JOIN pnt WHERE sdo_anyinteract(ply.shape, pnt.shape) = 'TRUE') WHERE rn = 1"], "test_cases": ["\ndef test_case(pred_sqls, sol_sqls, db_name, conn):\n    result = ex_base(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"ex_base returned {result} but expected 1.\"\n    result = performance_compare_by_execution_plan(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"performance_check returned {result} but expected 1.\"\n    "]}
{"instance_id": "Oracle_28", "dialect": "Oracle", "version": "19.3.0", "db_id": "european_football_2", "query": "In the context of the European Football database, we have a table named 'Team_Attributes' that records various attributes of teams over time. The table is partitioned by the 'date' column and has an index on the 'team_api_id' column. We need to find the most recent date when a specific team (identified by 'team_api_id' = 123) had its attributes recorded. The query to find the maximum date for a specific team should execute quickly, but it takes a long time when there are no records for that team. Can you identify the issue and provide an optimized query?", "issue_sql": ["SELECT MAX(CASE WHEN \"team_api_id\" = 10261 THEN \"date\" ELSE NULL END) FROM \"Team_Attributes\" WHERE \"team_api_id\" = 123 OR \"team_api_id\" IS NOT NULL"], "preprocess_sql": ["CREATE INDEX idx ON \"Team_Attributes\" (\"team_api_id\", \"date\")"], "clean_up_sql": ["DROP INDEX \"Team_Attributes\".idx"], "category": "Efficiency", "original_schema": "\n\nCREATE TABLE \"Country\" (\n    \"id\" NUMBER(11,0) NOT NULL,\n    \"name\" NVARCHAR2(512) NULL,\n    PRIMARY KEY (\"id\")\n);\nFirst 3 rows:\n  id  name\n----  -------\n   1  Belgium\n1729  England\n4769  France\n...\n\n\nCREATE TABLE \"League\" (\n    \"id\" NUMBER(11,0) NOT NULL,\n    \"country_id\" NUMBER(11,0) NULL,\n    \"name\" NVARCHAR2(512) NULL,\n    PRIMARY KEY (\"id\")\n);\nFirst 3 rows:\n  id    country_id  name\n----  ------------  ----------------------\n   1             1  Belgium Jupiler League\n1729          1729  England Premier League\n4769          4769  France Ligue 1\n...\n\n\nCREATE TABLE \"Match\" (\n    \"id\" NUMBER(11,0) NOT NULL,\n    \"country_id\" NUMBER(11,0) NULL,\n    \"league_id\" NUMBER(11,0) NULL,\n    \"season\" NCLOB NULL,\n    \"stage\" NUMBER(11,0) NULL,\n    \"date\" DATE NULL,\n    \"match_api_id\" NUMBER(11,0) NULL,\n    \"home_team_api_id\" NUMBER(11,0) NULL,\n    \"away_team_api_id\" NUMBER(11,0) NULL,\n    \"home_team_goal\" NUMBER(11,0) NULL,\n    \"away_team_goal\" NUMBER(11,0) NULL,\n    \"home_player_X1\" NUMBER(11,0) NULL,\n    \"home_player_X2\" NUMBER(11,0) NULL,\n    \"home_player_X3\" NUMBER(11,0) NULL,\n    \"home_player_X4\" NUMBER(11,0) NULL,\n    \"home_player_X5\" NUMBER(11,0) NULL,\n    \"home_player_X6\" NUMBER(11,0) NULL,\n    \"home_player_X7\" NUMBER(11,0) NULL,\n    \"home_player_X8\" NUMBER(11,0) NULL,\n    \"home_player_X9\" NUMBER(11,0) NULL,\n    \"home_player_X10\" NUMBER(11,0) NULL,\n    \"home_player_X11\" NUMBER(11,0) NULL,\n    \"away_player_X1\" NUMBER(11,0) NULL,\n    \"away_player_X2\" NUMBER(11,0) NULL,\n    \"away_player_X3\" NUMBER(11,0) NULL,\n    \"away_player_X4\" NUMBER(11,0) NULL,\n    \"away_player_X5\" NUMBER(11,0) NULL,\n    \"away_player_X6\" NUMBER(11,0) NULL,\n    \"away_player_X7\" NUMBER(11,0) NULL,\n    \"away_player_X8\" NUMBER(11,0) NULL,\n    \"away_player_X9\" NUMBER(11,0) NULL,\n    \"away_player_X10\" NUMBER(11,0) NULL,\n    \"away_player_X11\" NUMBER(11,0) NULL,\n    \"home_player_Y1\" NUMBER(11,0) NULL,\n    \"home_player_Y2\" NUMBER(11,0) NULL,\n    \"home_player_Y3\" NUMBER(11,0) NULL,\n    \"home_player_Y4\" NUMBER(11,0) NULL,\n    \"home_player_Y5\" NUMBER(11,0) NULL,\n    \"home_player_Y6\" NUMBER(11,0) NULL,\n    \"home_player_Y7\" NUMBER(11,0) NULL,\n    \"home_player_Y8\" NUMBER(11,0) NULL,\n    \"home_player_Y9\" NUMBER(11,0) NULL,\n    \"home_player_Y10\" NUMBER(11,0) NULL,\n    \"home_player_Y11\" NUMBER(11,0) NULL,\n    \"away_player_Y1\" NUMBER(11,0) NULL,\n    \"away_player_Y2\" NUMBER(11,0) NULL,\n    \"away_player_Y3\" NUMBER(11,0) NULL,\n    \"away_player_Y4\" NUMBER(11,0) NULL,\n    \"away_player_Y5\" NUMBER(11,0) NULL,\n    \"away_player_Y6\" NUMBER(11,0) NULL,\n    \"away_player_Y7\" NUMBER(11,0) NULL,\n    \"away_player_Y8\" NUMBER(11,0) NULL,\n    \"away_player_Y9\" NUMBER(11,0) NULL,\n    \"away_player_Y10\" NUMBER(11,0) NULL,\n    \"away_player_Y11\" NUMBER(11,0) NULL,\n    \"home_player_1\" NUMBER(11,0) NULL,\n    \"home_player_2\" NUMBER(11,0) NULL,\n    \"home_player_3\" NUMBER(11,0) NULL,\n    \"home_player_4\" NUMBER(11,0) NULL,\n    \"home_player_5\" NUMBER(11,0) NULL,\n    \"home_player_6\" NUMBER(11,0) NULL,\n    \"home_player_7\" NUMBER(11,0) NULL,\n    \"home_player_8\" NUMBER(11,0) NULL,\n    \"home_player_9\" NUMBER(11,0) NULL,\n    \"home_player_10\" NUMBER(11,0) NULL,\n    \"home_player_11\" NUMBER(11,0) NULL,\n    \"away_player_1\" NUMBER(11,0) NULL,\n    \"away_player_2\" NUMBER(11,0) NULL,\n    \"away_player_3\" NUMBER(11,0) NULL,\n    \"away_player_4\" NUMBER(11,0) NULL,\n    \"away_player_5\" NUMBER(11,0) NULL,\n    \"away_player_6\" NUMBER(11,0) NULL,\n    \"away_player_7\" NUMBER(11,0) NULL,\n    \"away_player_8\" NUMBER(11,0) NULL,\n    \"away_player_9\" NUMBER(11,0) NULL,\n    \"away_player_10\" NUMBER(11,0) NULL,\n    \"away_player_11\" NUMBER(11,0) NULL,\n    \"goal\" NCLOB NULL,\n    \"shoton\" NCLOB NULL,\n    \"shotoff\" NCLOB NULL,\n    \"foulcommit\" NCLOB NULL,\n    \"card\" NCLOB NULL,\n    \"cross\" NCLOB NULL,\n    \"corner\" NCLOB NULL,\n    \"possession\" NCLOB NULL,\n    \"B365H\" NUMBER NULL,\n    \"B365D\" NUMBER NULL,\n    \"B365A\" NUMBER NULL,\n    \"BWH\" NUMBER NULL,\n    \"BWD\" NUMBER NULL,\n    \"BWA\" NUMBER NULL,\n    \"IWH\" NUMBER NULL,\n    \"IWD\" NUMBER NULL,\n    \"IWA\" NUMBER NULL,\n    \"LBH\" NUMBER NULL,\n    \"LBD\" NUMBER NULL,\n    \"LBA\" NUMBER NULL,\n    \"PSH\" NUMBER NULL,\n    \"PSD\" NUMBER NULL,\n    \"PSA\" NUMBER NULL,\n    \"WHH\" NUMBER NULL,\n    \"WHD\" NUMBER NULL,\n    \"WHA\" NUMBER NULL,\n    \"SJH\" NUMBER NULL,\n    \"SJD\" NUMBER NULL,\n    \"SJA\" NUMBER NULL,\n    \"VCH\" NUMBER NULL,\n    \"VCD\" NUMBER NULL,\n    \"VCA\" NUMBER NULL,\n    \"GBH\" NUMBER NULL,\n    \"GBD\" NUMBER NULL,\n    \"GBA\" NUMBER NULL,\n    \"BSH\" NUMBER NULL,\n    \"BSD\" NUMBER NULL,\n    \"BSA\" NUMBER NULL\n);\nFirst 3 rows:\n  id    country_id    league_id  season       stage  date                   match_api_id    home_team_api_id    away_team_api_id    home_team_goal    away_team_goal  home_player_X1    home_player_X2    home_player_X3    home_player_X4    home_player_X5    home_player_X6    home_player_X7    home_player_X8    home_player_X9    home_player_X10    home_player_X11    away_player_X1    away_player_X2    away_player_X3    away_player_X4    away_player_X5    away_player_X6    away_player_X7    away_player_X8    away_player_X9    away_player_X10    away_player_X11    home_player_Y1    home_player_Y2    home_player_Y3    home_player_Y4    home_player_Y5    home_player_Y6    home_player_Y7    home_player_Y8    home_player_Y9    home_player_Y10    home_player_Y11    away_player_Y1    away_player_Y2    away_player_Y3    away_player_Y4    away_player_Y5    away_player_Y6    away_player_Y7    away_player_Y8    away_player_Y9    away_player_Y10    away_player_Y11    home_player_1    home_player_2    home_player_3    home_player_4    home_player_5    home_player_6    home_player_7    home_player_8    home_player_9    home_player_10    home_player_11    away_player_1    away_player_2    away_player_3    away_player_4    away_player_5    away_player_6    away_player_7    away_player_8    away_player_9    away_player_10    away_player_11      B365H    B365D    B365A    BWH    BWD    BWA    IWH    IWD    IWA    LBH    LBD    LBA  PSH    PSD    PSA      WHH    WHD    WHA    SJH    SJD    SJA    VCH    VCD    VCA    GBH    GBD    GBA    BSH    BSD    BSA\n----  ------------  -----------  ---------  -------  -------------------  --------------  ------------------  ------------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  -----------------  -----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  -----------------  -----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  -----------------  -----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  -----------------  -----------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ----------------  ----------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ----------------  ----------------  -------  -------  -------  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----\n  43             1            1  2008/2009       13  2008-11-22 00:00:00          492631                9999                7947                 2                 2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               2.4       3.3     2.88   2.3     3.2    2.8    2.2    3.1    2.8    2.2   3.25   2.75                        2.5    3.15   2.6    2.38   3.25   2.88   2.25   3.25   2.75   2.3    3.25   2.9     2.5    3.2   2.5\n  44             1            1  2008/2009       13  2008-12-16 00:00:00          492636                8571               10000                 1                 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               2.38      3.4     2.88   2.25    3.1    2.9    2.3    3      2.7    2.2   3.25   2.75                        2.3    3.2    2.62   2.38   3.2    3      2.25   3.25   2.8    2.3    3.2    2.75    2.3    3.2   2.75\n  45             1            1  2008/2009       13  2008-11-22 00:00:00          492638                9993                9994                 0                 2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               2.2       3.3     3.3    2.25    3      3      2.3    3.1    2.6    2.2   3      3                           2.25   3.2    2.9    2.25   3.25   3      2.25   3.25   2.8    2.25   3.2    3       2.3    3.2   2.75\n...\n\n\nCREATE TABLE \"Player\" (\n    \"id\" NUMBER(11,0) NOT NULL,\n    \"player_api_id\" NUMBER(11,0) NULL,\n    \"player_name\" NCLOB NULL,\n    \"player_fifa_api_id\" NUMBER(11,0) NULL,\n    \"birthday\" DATE NULL,\n    \"height\" NUMBER(11,0) NULL,\n    \"weight\" NUMBER(11,0) NULL,\n    PRIMARY KEY (\"id\")\n);\nFirst 3 rows:\n  id    player_api_id  player_name      player_fifa_api_id  birthday               height    weight\n----  ---------------  -------------  --------------------  -------------------  --------  --------\n  94           365666  Adam Campbell                206567  1995-01-01 00:00:00       170       161\n  95           180197  Adam Collin                   53363  1984-12-09 00:00:00       191       172\n  96           310346  Adam Cummins                 200743  1993-03-03 00:00:00       188       172\n...\n\n\nCREATE TABLE \"Player_Attributes\" (\n    \"id\" NUMBER(11,0) NOT NULL,\n    \"player_fifa_api_id\" NUMBER(11,0) NULL,\n    \"player_api_id\" NUMBER(11,0) NULL,\n    \"date\" DATE NULL,\n    \"overall_rating\" NUMBER(11,0) NULL,\n    \"potential\" NUMBER(11,0) NULL,\n    \"preferred_foot\" NCLOB NULL,\n    \"attacking_work_rate\" NCLOB NULL,\n    \"defensive_work_rate\" NCLOB NULL,\n    \"crossing\" NUMBER(11,0) NULL,\n    \"finishing\" NUMBER(11,0) NULL,\n    \"heading_accuracy\" NUMBER(11,0) NULL,\n    \"short_passing\" NUMBER(11,0) NULL,\n    \"volleys\" NUMBER(11,0) NULL,\n    \"dribbling\" NUMBER(11,0) NULL,\n    \"curve\" NUMBER(11,0) NULL,\n    \"free_kick_accuracy\" NUMBER(11,0) NULL,\n    \"long_passing\" NUMBER(11,0) NULL,\n    \"ball_control\" NUMBER(11,0) NULL,\n    \"acceleration\" NUMBER(11,0) NULL,\n    \"sprint_speed\" NUMBER(11,0) NULL,\n    \"agility\" NUMBER(11,0) NULL,\n    \"reactions\" NUMBER(11,0) NULL,\n    \"balance\" NUMBER(11,0) NULL,\n    \"shot_power\" NUMBER(11,0) NULL,\n    \"jumping\" NUMBER(11,0) NULL,\n    \"stamina\" NUMBER(11,0) NULL,\n    \"strength\" NUMBER(11,0) NULL,\n    \"long_shots\" NUMBER(11,0) NULL,\n    \"aggression\" NUMBER(11,0) NULL,\n    \"interceptions\" NUMBER(11,0) NULL,\n    \"positioning\" NUMBER(11,0) NULL,\n    \"vision\" NUMBER(11,0) NULL,\n    \"penalties\" NUMBER(11,0) NULL,\n    \"marking\" NUMBER(11,0) NULL,\n    \"standing_tackle\" NUMBER(11,0) NULL,\n    \"sliding_tackle\" NUMBER(11,0) NULL,\n    \"gk_diving\" NUMBER(11,0) NULL,\n    \"gk_handling\" NUMBER(11,0) NULL,\n    \"gk_kicking\" NUMBER(11,0) NULL,\n    \"gk_positioning\" NUMBER(11,0) NULL,\n    \"gk_reflexes\" NUMBER(11,0) NULL,\n    PRIMARY KEY (\"id\")\n);\nFirst 3 rows:\n  id    player_fifa_api_id    player_api_id  date                   overall_rating    potential  preferred_foot    attacking_work_rate    defensive_work_rate      crossing    finishing    heading_accuracy    short_passing    volleys    dribbling    curve    free_kick_accuracy    long_passing    ball_control    acceleration    sprint_speed    agility    reactions    balance    shot_power    jumping    stamina    strength    long_shots    aggression    interceptions    positioning    vision    penalties    marking    standing_tackle    sliding_tackle    gk_diving    gk_handling    gk_kicking    gk_positioning    gk_reflexes\n----  --------------------  ---------------  -------------------  ----------------  -----------  ----------------  ---------------------  ---------------------  ----------  -----------  ------------------  ---------------  ---------  -----------  -------  --------------------  --------------  --------------  --------------  --------------  ---------  -----------  ---------  ------------  ---------  ---------  ----------  ------------  ------------  ---------------  -------------  --------  -----------  ---------  -----------------  ----------------  -----------  -------------  ------------  ----------------  -------------\n  45                186170           162549  2014-03-14 00:00:00                68           77  right             medium                 medium                         67           52                  59               66         51           69       68                    62              64              68              82              80         81           50         92            60         71         72          71            56            59               54             67        71           60         22                 21                21           15             10            11                 8             12\n  46                186170           162549  2014-01-31 00:00:00                69           78  right             medium                 medium                         69           52                  62               68         51           70       71                    64              64              71              82              80         81           50         92            60         71         72          71            56            59               54             67        72           63         22                 21                21           15             10            11                 8             12\n  47                186170           162549  2013-11-29 00:00:00                70           78  right             medium                 medium                         72           52                  62               71         51           72       72                    64              64              71              82              80         81           50         92            60         71         72          71            56            59               54             67        72           63         22                 21                21           15             10            11                 8             12\n...\n\n\nCREATE TABLE \"Team\" (\n    \"id\" NUMBER(11,0) NOT NULL,\n    \"team_api_id\" NUMBER(11,0) NULL,\n    \"team_fifa_api_id\" NUMBER(11,0) NULL,\n    \"team_long_name\" NCLOB NULL,\n    \"team_short_name\" NCLOB NULL,\n    PRIMARY KEY (\"id\")\n);\nFirst 3 rows:\n   id    team_api_id    team_fifa_api_id  team_long_name    team_short_name\n-----  -------------  ------------------  ----------------  -----------------\n20519           8533                 192  Chievo Verona     CHI\n20520           8690                 203  Reggio Calabria   REG\n20521           8535              110374  Fiorentina        FIO\n...\n\n\nCREATE TABLE \"Team_Attributes\" (\n    \"id\" NUMBER(11,0) NOT NULL,\n    \"team_fifa_api_id\" NUMBER(11,0) NULL,\n    \"team_api_id\" NUMBER(11,0) NULL,\n    \"date\" DATE NULL,\n    \"buildUpPlaySpeed\" NUMBER(11,0) NULL,\n    \"buildUpPlaySpeedClass\" NCLOB NULL,\n    \"buildUpPlayDribbling\" NUMBER(11,0) NULL,\n    \"buildUpPlayDribblingClass\" NCLOB NULL,\n    \"buildUpPlayPassing\" NUMBER(11,0) NULL,\n    \"buildUpPlayPassingClass\" NCLOB NULL,\n    \"buildUpPlayPositioningClass\" NCLOB NULL,\n    \"chanceCreationPassing\" NUMBER(11,0) NULL,\n    \"chanceCreationPassingClass\" NCLOB NULL,\n    \"chanceCreationCrossing\" NUMBER(11,0) NULL,\n    \"chanceCreationCrossingClass\" NCLOB NULL,\n    \"chanceCreationShooting\" NUMBER(11,0) NULL,\n    \"chanceCreationShootingClass\" NCLOB NULL,\n    \"chanceCreationPositioningClass\" NCLOB NULL,\n    \"defencePressure\" NUMBER(11,0) NULL,\n    \"defencePressureClass\" NCLOB NULL,\n    \"defenceAggression\" NUMBER(11,0) NULL,\n    \"defenceAggressionClass\" NCLOB NULL,\n    \"defenceTeamWidth\" NUMBER(11,0) NULL,\n    \"defenceTeamWidthClass\" NCLOB NULL,\n    \"defenceDefenderLineClass\" NCLOB NULL,\n    PRIMARY KEY (\"id\")\n);\nFirst 3 rows:\n  id    team_fifa_api_id    team_api_id  date                   buildUpPlaySpeed  buildUpPlaySpeedClass    buildUpPlayDribbling    buildUpPlayDribblingClass      buildUpPlayPassing  buildUpPlayPassingClass    buildUpPlayPositioningClass      chanceCreationPassing  chanceCreationPassingClass      chanceCreationCrossing  chanceCreationCrossingClass      chanceCreationShooting  chanceCreationShootingClass    chanceCreationPositioningClass      defencePressure  defencePressureClass      defenceAggression  defenceAggressionClass      defenceTeamWidth  defenceTeamWidthClass    defenceDefenderLineClass\n----  ------------------  -------------  -------------------  ------------------  -----------------------  ----------------------  ---------------------------  --------------------  -------------------------  -----------------------------  -----------------------  ----------------------------  ------------------------  -----------------------------  ------------------------  -----------------------------  --------------------------------  -----------------  ----------------------  -------------------  ------------------------  ------------------  -----------------------  --------------------------\n  23                1901          10215  2011-02-22 00:00:00                  30  Slow                                             Little                                         50  Mixed                      Organised                                           50  Normal                                              50  Normal                                               55  Normal                         Organised                                        30  Deep                                     45  Press                                     65  Normal                   Cover\n  24                1901          10215  2012-02-22 00:00:00                  45  Balanced                                         Little                                         44  Mixed                      Organised                                           55  Normal                                              57  Normal                                               60  Normal                         Organised                                        52  Medium                                   38  Press                                     61  Normal                   Cover\n  25                1901          10215  2013-09-20 00:00:00                  45  Balanced                                         Little                                         44  Mixed                      Organised                                           55  Normal                                              57  Normal                                               60  Normal                         Organised                                        52  Medium                                   38  Press                                     61  Normal                   Cover\n...\n", "preprocess_schema": "\n\nCREATE TABLE \"Country\" (\n    \"id\" NUMBER(11,0) NOT NULL,\n    \"name\" NVARCHAR2(512) NULL,\n    PRIMARY KEY (\"id\")\n);\nFirst 3 rows:\n  id  name\n----  -------\n   1  Belgium\n1729  England\n4769  France\n...\n\n\nCREATE TABLE \"League\" (\n    \"id\" NUMBER(11,0) NOT NULL,\n    \"country_id\" NUMBER(11,0) NULL,\n    \"name\" NVARCHAR2(512) NULL,\n    PRIMARY KEY (\"id\")\n);\nFirst 3 rows:\n  id    country_id  name\n----  ------------  ----------------------\n   1             1  Belgium Jupiler League\n1729          1729  England Premier League\n4769          4769  France Ligue 1\n...\n\n\nCREATE TABLE \"Match\" (\n    \"id\" NUMBER(11,0) NOT NULL,\n    \"country_id\" NUMBER(11,0) NULL,\n    \"league_id\" NUMBER(11,0) NULL,\n    \"season\" NCLOB NULL,\n    \"stage\" NUMBER(11,0) NULL,\n    \"date\" DATE NULL,\n    \"match_api_id\" NUMBER(11,0) NULL,\n    \"home_team_api_id\" NUMBER(11,0) NULL,\n    \"away_team_api_id\" NUMBER(11,0) NULL,\n    \"home_team_goal\" NUMBER(11,0) NULL,\n    \"away_team_goal\" NUMBER(11,0) NULL,\n    \"home_player_X1\" NUMBER(11,0) NULL,\n    \"home_player_X2\" NUMBER(11,0) NULL,\n    \"home_player_X3\" NUMBER(11,0) NULL,\n    \"home_player_X4\" NUMBER(11,0) NULL,\n    \"home_player_X5\" NUMBER(11,0) NULL,\n    \"home_player_X6\" NUMBER(11,0) NULL,\n    \"home_player_X7\" NUMBER(11,0) NULL,\n    \"home_player_X8\" NUMBER(11,0) NULL,\n    \"home_player_X9\" NUMBER(11,0) NULL,\n    \"home_player_X10\" NUMBER(11,0) NULL,\n    \"home_player_X11\" NUMBER(11,0) NULL,\n    \"away_player_X1\" NUMBER(11,0) NULL,\n    \"away_player_X2\" NUMBER(11,0) NULL,\n    \"away_player_X3\" NUMBER(11,0) NULL,\n    \"away_player_X4\" NUMBER(11,0) NULL,\n    \"away_player_X5\" NUMBER(11,0) NULL,\n    \"away_player_X6\" NUMBER(11,0) NULL,\n    \"away_player_X7\" NUMBER(11,0) NULL,\n    \"away_player_X8\" NUMBER(11,0) NULL,\n    \"away_player_X9\" NUMBER(11,0) NULL,\n    \"away_player_X10\" NUMBER(11,0) NULL,\n    \"away_player_X11\" NUMBER(11,0) NULL,\n    \"home_player_Y1\" NUMBER(11,0) NULL,\n    \"home_player_Y2\" NUMBER(11,0) NULL,\n    \"home_player_Y3\" NUMBER(11,0) NULL,\n    \"home_player_Y4\" NUMBER(11,0) NULL,\n    \"home_player_Y5\" NUMBER(11,0) NULL,\n    \"home_player_Y6\" NUMBER(11,0) NULL,\n    \"home_player_Y7\" NUMBER(11,0) NULL,\n    \"home_player_Y8\" NUMBER(11,0) NULL,\n    \"home_player_Y9\" NUMBER(11,0) NULL,\n    \"home_player_Y10\" NUMBER(11,0) NULL,\n    \"home_player_Y11\" NUMBER(11,0) NULL,\n    \"away_player_Y1\" NUMBER(11,0) NULL,\n    \"away_player_Y2\" NUMBER(11,0) NULL,\n    \"away_player_Y3\" NUMBER(11,0) NULL,\n    \"away_player_Y4\" NUMBER(11,0) NULL,\n    \"away_player_Y5\" NUMBER(11,0) NULL,\n    \"away_player_Y6\" NUMBER(11,0) NULL,\n    \"away_player_Y7\" NUMBER(11,0) NULL,\n    \"away_player_Y8\" NUMBER(11,0) NULL,\n    \"away_player_Y9\" NUMBER(11,0) NULL,\n    \"away_player_Y10\" NUMBER(11,0) NULL,\n    \"away_player_Y11\" NUMBER(11,0) NULL,\n    \"home_player_1\" NUMBER(11,0) NULL,\n    \"home_player_2\" NUMBER(11,0) NULL,\n    \"home_player_3\" NUMBER(11,0) NULL,\n    \"home_player_4\" NUMBER(11,0) NULL,\n    \"home_player_5\" NUMBER(11,0) NULL,\n    \"home_player_6\" NUMBER(11,0) NULL,\n    \"home_player_7\" NUMBER(11,0) NULL,\n    \"home_player_8\" NUMBER(11,0) NULL,\n    \"home_player_9\" NUMBER(11,0) NULL,\n    \"home_player_10\" NUMBER(11,0) NULL,\n    \"home_player_11\" NUMBER(11,0) NULL,\n    \"away_player_1\" NUMBER(11,0) NULL,\n    \"away_player_2\" NUMBER(11,0) NULL,\n    \"away_player_3\" NUMBER(11,0) NULL,\n    \"away_player_4\" NUMBER(11,0) NULL,\n    \"away_player_5\" NUMBER(11,0) NULL,\n    \"away_player_6\" NUMBER(11,0) NULL,\n    \"away_player_7\" NUMBER(11,0) NULL,\n    \"away_player_8\" NUMBER(11,0) NULL,\n    \"away_player_9\" NUMBER(11,0) NULL,\n    \"away_player_10\" NUMBER(11,0) NULL,\n    \"away_player_11\" NUMBER(11,0) NULL,\n    \"goal\" NCLOB NULL,\n    \"shoton\" NCLOB NULL,\n    \"shotoff\" NCLOB NULL,\n    \"foulcommit\" NCLOB NULL,\n    \"card\" NCLOB NULL,\n    \"cross\" NCLOB NULL,\n    \"corner\" NCLOB NULL,\n    \"possession\" NCLOB NULL,\n    \"B365H\" NUMBER NULL,\n    \"B365D\" NUMBER NULL,\n    \"B365A\" NUMBER NULL,\n    \"BWH\" NUMBER NULL,\n    \"BWD\" NUMBER NULL,\n    \"BWA\" NUMBER NULL,\n    \"IWH\" NUMBER NULL,\n    \"IWD\" NUMBER NULL,\n    \"IWA\" NUMBER NULL,\n    \"LBH\" NUMBER NULL,\n    \"LBD\" NUMBER NULL,\n    \"LBA\" NUMBER NULL,\n    \"PSH\" NUMBER NULL,\n    \"PSD\" NUMBER NULL,\n    \"PSA\" NUMBER NULL,\n    \"WHH\" NUMBER NULL,\n    \"WHD\" NUMBER NULL,\n    \"WHA\" NUMBER NULL,\n    \"SJH\" NUMBER NULL,\n    \"SJD\" NUMBER NULL,\n    \"SJA\" NUMBER NULL,\n    \"VCH\" NUMBER NULL,\n    \"VCD\" NUMBER NULL,\n    \"VCA\" NUMBER NULL,\n    \"GBH\" NUMBER NULL,\n    \"GBD\" NUMBER NULL,\n    \"GBA\" NUMBER NULL,\n    \"BSH\" NUMBER NULL,\n    \"BSD\" NUMBER NULL,\n    \"BSA\" NUMBER NULL\n);\nFirst 3 rows:\n  id    country_id    league_id  season       stage  date                   match_api_id    home_team_api_id    away_team_api_id    home_team_goal    away_team_goal  home_player_X1    home_player_X2    home_player_X3    home_player_X4    home_player_X5    home_player_X6    home_player_X7    home_player_X8    home_player_X9    home_player_X10    home_player_X11    away_player_X1    away_player_X2    away_player_X3    away_player_X4    away_player_X5    away_player_X6    away_player_X7    away_player_X8    away_player_X9    away_player_X10    away_player_X11    home_player_Y1    home_player_Y2    home_player_Y3    home_player_Y4    home_player_Y5    home_player_Y6    home_player_Y7    home_player_Y8    home_player_Y9    home_player_Y10    home_player_Y11    away_player_Y1    away_player_Y2    away_player_Y3    away_player_Y4    away_player_Y5    away_player_Y6    away_player_Y7    away_player_Y8    away_player_Y9    away_player_Y10    away_player_Y11    home_player_1    home_player_2    home_player_3    home_player_4    home_player_5    home_player_6    home_player_7    home_player_8    home_player_9    home_player_10    home_player_11    away_player_1    away_player_2    away_player_3    away_player_4    away_player_5    away_player_6    away_player_7    away_player_8    away_player_9    away_player_10    away_player_11      B365H    B365D    B365A    BWH    BWD    BWA    IWH    IWD    IWA    LBH    LBD    LBA  PSH    PSD    PSA      WHH    WHD    WHA    SJH    SJD    SJA    VCH    VCD    VCA    GBH    GBD    GBA    BSH    BSD    BSA\n----  ------------  -----------  ---------  -------  -------------------  --------------  ------------------  ------------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  -----------------  -----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  -----------------  -----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  -----------------  -----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  ----------------  -----------------  -----------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ----------------  ----------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ---------------  ----------------  ----------------  -------  -------  -------  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----  -----\n  43             1            1  2008/2009       13  2008-11-22 00:00:00          492631                9999                7947                 2                 2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               2.4       3.3     2.88   2.3     3.2    2.8    2.2    3.1    2.8    2.2   3.25   2.75                        2.5    3.15   2.6    2.38   3.25   2.88   2.25   3.25   2.75   2.3    3.25   2.9     2.5    3.2   2.5\n  44             1            1  2008/2009       13  2008-12-16 00:00:00          492636                8571               10000                 1                 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               2.38      3.4     2.88   2.25    3.1    2.9    2.3    3      2.7    2.2   3.25   2.75                        2.3    3.2    2.62   2.38   3.2    3      2.25   3.25   2.8    2.3    3.2    2.75    2.3    3.2   2.75\n  45             1            1  2008/2009       13  2008-11-22 00:00:00          492638                9993                9994                 0                 2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               2.2       3.3     3.3    2.25    3      3      2.3    3.1    2.6    2.2   3      3                           2.25   3.2    2.9    2.25   3.25   3      2.25   3.25   2.8    2.25   3.2    3       2.3    3.2   2.75\n...\n\n\nCREATE TABLE \"Player\" (\n    \"id\" NUMBER(11,0) NOT NULL,\n    \"player_api_id\" NUMBER(11,0) NULL,\n    \"player_name\" NCLOB NULL,\n    \"player_fifa_api_id\" NUMBER(11,0) NULL,\n    \"birthday\" DATE NULL,\n    \"height\" NUMBER(11,0) NULL,\n    \"weight\" NUMBER(11,0) NULL,\n    PRIMARY KEY (\"id\")\n);\nFirst 3 rows:\n  id    player_api_id  player_name      player_fifa_api_id  birthday               height    weight\n----  ---------------  -------------  --------------------  -------------------  --------  --------\n  94           365666  Adam Campbell                206567  1995-01-01 00:00:00       170       161\n  95           180197  Adam Collin                   53363  1984-12-09 00:00:00       191       172\n  96           310346  Adam Cummins                 200743  1993-03-03 00:00:00       188       172\n...\n\n\nCREATE TABLE \"Player_Attributes\" (\n    \"id\" NUMBER(11,0) NOT NULL,\n    \"player_fifa_api_id\" NUMBER(11,0) NULL,\n    \"player_api_id\" NUMBER(11,0) NULL,\n    \"date\" DATE NULL,\n    \"overall_rating\" NUMBER(11,0) NULL,\n    \"potential\" NUMBER(11,0) NULL,\n    \"preferred_foot\" NCLOB NULL,\n    \"attacking_work_rate\" NCLOB NULL,\n    \"defensive_work_rate\" NCLOB NULL,\n    \"crossing\" NUMBER(11,0) NULL,\n    \"finishing\" NUMBER(11,0) NULL,\n    \"heading_accuracy\" NUMBER(11,0) NULL,\n    \"short_passing\" NUMBER(11,0) NULL,\n    \"volleys\" NUMBER(11,0) NULL,\n    \"dribbling\" NUMBER(11,0) NULL,\n    \"curve\" NUMBER(11,0) NULL,\n    \"free_kick_accuracy\" NUMBER(11,0) NULL,\n    \"long_passing\" NUMBER(11,0) NULL,\n    \"ball_control\" NUMBER(11,0) NULL,\n    \"acceleration\" NUMBER(11,0) NULL,\n    \"sprint_speed\" NUMBER(11,0) NULL,\n    \"agility\" NUMBER(11,0) NULL,\n    \"reactions\" NUMBER(11,0) NULL,\n    \"balance\" NUMBER(11,0) NULL,\n    \"shot_power\" NUMBER(11,0) NULL,\n    \"jumping\" NUMBER(11,0) NULL,\n    \"stamina\" NUMBER(11,0) NULL,\n    \"strength\" NUMBER(11,0) NULL,\n    \"long_shots\" NUMBER(11,0) NULL,\n    \"aggression\" NUMBER(11,0) NULL,\n    \"interceptions\" NUMBER(11,0) NULL,\n    \"positioning\" NUMBER(11,0) NULL,\n    \"vision\" NUMBER(11,0) NULL,\n    \"penalties\" NUMBER(11,0) NULL,\n    \"marking\" NUMBER(11,0) NULL,\n    \"standing_tackle\" NUMBER(11,0) NULL,\n    \"sliding_tackle\" NUMBER(11,0) NULL,\n    \"gk_diving\" NUMBER(11,0) NULL,\n    \"gk_handling\" NUMBER(11,0) NULL,\n    \"gk_kicking\" NUMBER(11,0) NULL,\n    \"gk_positioning\" NUMBER(11,0) NULL,\n    \"gk_reflexes\" NUMBER(11,0) NULL,\n    PRIMARY KEY (\"id\")\n);\nFirst 3 rows:\n  id    player_fifa_api_id    player_api_id  date                   overall_rating    potential  preferred_foot    attacking_work_rate    defensive_work_rate      crossing    finishing    heading_accuracy    short_passing    volleys    dribbling    curve    free_kick_accuracy    long_passing    ball_control    acceleration    sprint_speed    agility    reactions    balance    shot_power    jumping    stamina    strength    long_shots    aggression    interceptions    positioning    vision    penalties    marking    standing_tackle    sliding_tackle    gk_diving    gk_handling    gk_kicking    gk_positioning    gk_reflexes\n----  --------------------  ---------------  -------------------  ----------------  -----------  ----------------  ---------------------  ---------------------  ----------  -----------  ------------------  ---------------  ---------  -----------  -------  --------------------  --------------  --------------  --------------  --------------  ---------  -----------  ---------  ------------  ---------  ---------  ----------  ------------  ------------  ---------------  -------------  --------  -----------  ---------  -----------------  ----------------  -----------  -------------  ------------  ----------------  -------------\n  45                186170           162549  2014-03-14 00:00:00                68           77  right             medium                 medium                         67           52                  59               66         51           69       68                    62              64              68              82              80         81           50         92            60         71         72          71            56            59               54             67        71           60         22                 21                21           15             10            11                 8             12\n  46                186170           162549  2014-01-31 00:00:00                69           78  right             medium                 medium                         69           52                  62               68         51           70       71                    64              64              71              82              80         81           50         92            60         71         72          71            56            59               54             67        72           63         22                 21                21           15             10            11                 8             12\n  47                186170           162549  2013-11-29 00:00:00                70           78  right             medium                 medium                         72           52                  62               71         51           72       72                    64              64              71              82              80         81           50         92            60         71         72          71            56            59               54             67        72           63         22                 21                21           15             10            11                 8             12\n...\n\n\nCREATE TABLE \"Team\" (\n    \"id\" NUMBER(11,0) NOT NULL,\n    \"team_api_id\" NUMBER(11,0) NULL,\n    \"team_fifa_api_id\" NUMBER(11,0) NULL,\n    \"team_long_name\" NCLOB NULL,\n    \"team_short_name\" NCLOB NULL,\n    PRIMARY KEY (\"id\")\n);\nFirst 3 rows:\n   id    team_api_id    team_fifa_api_id  team_long_name    team_short_name\n-----  -------------  ------------------  ----------------  -----------------\n20519           8533                 192  Chievo Verona     CHI\n20520           8690                 203  Reggio Calabria   REG\n20521           8535              110374  Fiorentina        FIO\n...\n\n\nCREATE TABLE \"Team_Attributes\" (\n    \"id\" NUMBER(11,0) NOT NULL,\n    \"team_fifa_api_id\" NUMBER(11,0) NULL,\n    \"team_api_id\" NUMBER(11,0) NULL,\n    \"date\" DATE NULL,\n    \"buildUpPlaySpeed\" NUMBER(11,0) NULL,\n    \"buildUpPlaySpeedClass\" NCLOB NULL,\n    \"buildUpPlayDribbling\" NUMBER(11,0) NULL,\n    \"buildUpPlayDribblingClass\" NCLOB NULL,\n    \"buildUpPlayPassing\" NUMBER(11,0) NULL,\n    \"buildUpPlayPassingClass\" NCLOB NULL,\n    \"buildUpPlayPositioningClass\" NCLOB NULL,\n    \"chanceCreationPassing\" NUMBER(11,0) NULL,\n    \"chanceCreationPassingClass\" NCLOB NULL,\n    \"chanceCreationCrossing\" NUMBER(11,0) NULL,\n    \"chanceCreationCrossingClass\" NCLOB NULL,\n    \"chanceCreationShooting\" NUMBER(11,0) NULL,\n    \"chanceCreationShootingClass\" NCLOB NULL,\n    \"chanceCreationPositioningClass\" NCLOB NULL,\n    \"defencePressure\" NUMBER(11,0) NULL,\n    \"defencePressureClass\" NCLOB NULL,\n    \"defenceAggression\" NUMBER(11,0) NULL,\n    \"defenceAggressionClass\" NCLOB NULL,\n    \"defenceTeamWidth\" NUMBER(11,0) NULL,\n    \"defenceTeamWidthClass\" NCLOB NULL,\n    \"defenceDefenderLineClass\" NCLOB NULL,\n    PRIMARY KEY (\"id\")\n);\nFirst 3 rows:\n  id    team_fifa_api_id    team_api_id  date                   buildUpPlaySpeed  buildUpPlaySpeedClass    buildUpPlayDribbling    buildUpPlayDribblingClass      buildUpPlayPassing  buildUpPlayPassingClass    buildUpPlayPositioningClass      chanceCreationPassing  chanceCreationPassingClass      chanceCreationCrossing  chanceCreationCrossingClass      chanceCreationShooting  chanceCreationShootingClass    chanceCreationPositioningClass      defencePressure  defencePressureClass      defenceAggression  defenceAggressionClass      defenceTeamWidth  defenceTeamWidthClass    defenceDefenderLineClass\n----  ------------------  -------------  -------------------  ------------------  -----------------------  ----------------------  ---------------------------  --------------------  -------------------------  -----------------------------  -----------------------  ----------------------------  ------------------------  -----------------------------  ------------------------  -----------------------------  --------------------------------  -----------------  ----------------------  -------------------  ------------------------  ------------------  -----------------------  --------------------------\n  23                1901          10215  2011-02-22 00:00:00                  30  Slow                                             Little                                         50  Mixed                      Organised                                           50  Normal                                              50  Normal                                               55  Normal                         Organised                                        30  Deep                                     45  Press                                     65  Normal                   Cover\n  24                1901          10215  2012-02-22 00:00:00                  45  Balanced                                         Little                                         44  Mixed                      Organised                                           55  Normal                                              57  Normal                                               60  Normal                         Organised                                        52  Medium                                   38  Press                                     61  Normal                   Cover\n  25                1901          10215  2013-09-20 00:00:00                  45  Balanced                                         Little                                         44  Mixed                      Organised                                           55  Normal                                              57  Normal                                               60  Normal                         Organised                                        52  Medium                                   38  Press                                     61  Normal                   Cover\n...\n", "sol_sql": ["select \"date\" from \"Team_Attributes\" where \"team_api_id\" = 123 order by \"date\" desc fetch first 1 rows only"], "test_cases": ["\ndef test_case(pred_sqls, sol_sqls, db_name, conn):\n    result = performance_compare_by_execution_plan(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"performance_check returned {result} but expected 1.\"\n    "]}
{"instance_id": "SQLServer_2", "dialect": "SQLServer", "version": "2022", "db_id": "debit_card_specializing", "query": "I'm working with a table that contains thousands of transaction records, and I need to implement pagination for a reporting interface. I've been using a CTE with ROW_NUMBER() to handle this, but I've heard there might be more efficient approaches in SQL Server. The challenge is that I need to display transactions 301-320 when sorted by TransactionID in descending order.\n\nI've tried using the following approach, but I'm concerned about performance as the dataset grows:\n\nMy current query works, but I'm wondering if there are better built-in pagination features in SQL Server that would be more efficient than using a CTE with ROW_NUMBER(). What would be the recommended approach for handling pagination in SQL Server, especially for large datasets?", "issue_sql": ["WITH TransCTE AS\n(\n    SELECT\n        ROW_NUMBER() OVER (ORDER BY TransactionID DESC) AS RowNum,\n        t.*\n    FROM transactions_1k t\n)\nSELECT \"TransactionID\",\"CustomerID\"\nFROM TransCTE\nWHERE RowNum BETWEEN 301 AND 320\nORDER BY TransactionID DESC;"], "preprocess_sql": [], "clean_up_sql": [], "category": "Efficiency", "original_schema": "CREATE TABLE [customers] (\n[CustomerID] int NOT NULL,\n[Segment] nvarchar(MAX) NULL,\n[Currency] nvarchar(MAX) NULL,\n  PRIMARY KEY ([CustomerID])\n);\n\nFirst 3 rows:\n  CustomerID  Segment    Currency\n------------  ---------  ----------\n           3  SME        EUR\n           5  LAM        EUR\n           6  SME        EUR\n...\n\n\nCREATE TABLE [gasstations] (\n[GasStationID] int NOT NULL,\n[ChainID] int NULL,\n[Country] nvarchar(MAX) NULL,\n[Segment] nvarchar(MAX) NULL,\n  PRIMARY KEY ([GasStationID])\n);\n\nFirst 3 rows:\n  GasStationID    ChainID  Country    Segment\n--------------  ---------  ---------  ---------------\n            44         13  CZE        Value for money\n            45          6  CZE        Premium\n            46         23  CZE        Other\n...\n\n\nCREATE TABLE [products] (\n[ProductID] int NOT NULL,\n[Description] nvarchar(MAX) NULL,\n  PRIMARY KEY ([ProductID])\n);\n\nFirst 3 rows:\n  ProductID  Description\n-----------  -------------\n          1  Rucní zadání\n          2  Nafta\n          3  Special\n...\n\n\nCREATE TABLE [transactions_1k] (\n[TransactionID] int NOT NULL,\n[Date] date NULL,\n[Time] nvarchar(MAX) NULL,\n[CustomerID] int NULL,\n[CardID] int NULL,\n[GasStationID] int NULL,\n[ProductID] int NULL,\n[Amount] int NULL,\n[Price] float NULL,\n  PRIMARY KEY ([TransactionID])\n);\n\nFirst 3 rows:\n  TransactionID  Date        Time        CustomerID    CardID    GasStationID    ProductID    Amount    Price\n---------------  ----------  --------  ------------  --------  --------------  -----------  --------  -------\n              1  2012-08-24  09:41:00         31543    486621            3704            2        28   672.64\n              2  2012-08-24  10:03:00         46707    550134            3704            2        18   430.72\n              3  2012-08-24  10:03:00         46707    550134            3704           23         1   121.99\n...\n\n\nCREATE TABLE [yearmonth] (\n[CustomerID] int NOT NULL,\n[Date] nvarchar(255) NOT NULL,\n[Consumption] float NULL,\n  PRIMARY KEY ([Date], [CustomerID]),\n  FOREIGN KEY ([CustomerID]) REFERENCES [customers]([CustomerID])\n);\n\nFirst 3 rows:\n  CustomerID    Date    Consumption\n------------  ------  -------------\n          39  201112          29.24\n          63  201112          60.14\n         172  201112         575.79\n...\n", "preprocess_schema": "CREATE TABLE [customers] (\n[CustomerID] int NOT NULL,\n[Segment] nvarchar(MAX) NULL,\n[Currency] nvarchar(MAX) NULL,\n  PRIMARY KEY ([CustomerID])\n);\n\nFirst 3 rows:\n  CustomerID  Segment    Currency\n------------  ---------  ----------\n           3  SME        EUR\n           5  LAM        EUR\n           6  SME        EUR\n...\n\n\nCREATE TABLE [gasstations] (\n[GasStationID] int NOT NULL,\n[ChainID] int NULL,\n[Country] nvarchar(MAX) NULL,\n[Segment] nvarchar(MAX) NULL,\n  PRIMARY KEY ([GasStationID])\n);\n\nFirst 3 rows:\n  GasStationID    ChainID  Country    Segment\n--------------  ---------  ---------  ---------------\n            44         13  CZE        Value for money\n            45          6  CZE        Premium\n            46         23  CZE        Other\n...\n\n\nCREATE TABLE [products] (\n[ProductID] int NOT NULL,\n[Description] nvarchar(MAX) NULL,\n  PRIMARY KEY ([ProductID])\n);\n\nFirst 3 rows:\n  ProductID  Description\n-----------  -------------\n          1  Rucní zadání\n          2  Nafta\n          3  Special\n...\n\n\nCREATE TABLE [transactions_1k] (\n[TransactionID] int NOT NULL,\n[Date] date NULL,\n[Time] nvarchar(MAX) NULL,\n[CustomerID] int NULL,\n[CardID] int NULL,\n[GasStationID] int NULL,\n[ProductID] int NULL,\n[Amount] int NULL,\n[Price] float NULL,\n  PRIMARY KEY ([TransactionID])\n);\n\nFirst 3 rows:\n  TransactionID  Date        Time        CustomerID    CardID    GasStationID    ProductID    Amount    Price\n---------------  ----------  --------  ------------  --------  --------------  -----------  --------  -------\n              1  2012-08-24  09:41:00         31543    486621            3704            2        28   672.64\n              2  2012-08-24  10:03:00         46707    550134            3704            2        18   430.72\n              3  2012-08-24  10:03:00         46707    550134            3704           23         1   121.99\n...\n\n\nCREATE TABLE [yearmonth] (\n[CustomerID] int NOT NULL,\n[Date] nvarchar(255) NOT NULL,\n[Consumption] float NULL,\n  PRIMARY KEY ([Date], [CustomerID]),\n  FOREIGN KEY ([CustomerID]) REFERENCES [customers]([CustomerID])\n);\n\nFirst 3 rows:\n  CustomerID    Date    Consumption\n------------  ------  -------------\n          39  201112          29.24\n          63  201112          60.14\n         172  201112         575.79\n...\n", "sol_sql": ["SELECT \"TransactionID\",\"CustomerID\" FROM transactions_1k ORDER BY TransactionID DESC OFFSET 300 ROWS FETCH NEXT 20 ROWS ONLY;"], "test_cases": ["\ndef test_case(pred_sqls, sol_sqls, db_name, conn):\n    result = ex_base(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"ex_base returned {result} but expected 1.\"\n    result = performance_compare_by_qep(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"performance_check returned {result} but expected 1.\"\n    return result\n    "]}
{"instance_id": "SQLServer_16", "dialect": "SQLServer", "version": "2022", "db_id": "superhero", "query": "There is a superhero_name table in the superhero database, which contains columns id and superhero_name. The structure of this table is a heap with ~10M rows. I am trying to retrieve a paginated list of superheroe_names based on a large list of superhero IDs. When I include the total count of these superheroes in the query, the performance degrades significantly. The query without the total count executes in less than a second, but with the total count, it takes much longer. Is there a more efficient way to get the total row count?", "issue_sql": ["DECLARE\n            @PageSize INT = 10,\n            @PageNum  INT = 1;\n\n        WITH TempResult AS(\n            SELECT id, superhero_name\n            FROM superhero_name\n            Where id in ( 1 ,2, 3, 4, 5, 6, 7, 8, 9 ,10)\n        ), TempCount AS (\n            SELECT COUNT(*) AS MaxRows FROM TempResult\n        )\n        SELECT *\n        FROM TempResult,\n        TempCount\n        ORDER BY TempResult.superhero_name\n            OFFSET (@PageNum-1)*@PageSize ROWS\n            FETCH NEXT @PageSize ROWS ONLY"], "preprocess_sql": ["\n        DECLARE @MaxRowCount bigint = 10000000;\n        DECLARE @Offset      bigint = 0;\n\n        DROP TABLE IF EXISTS superhero_name;\n        CREATE TABLE superhero_name\n        (\n        id   BIGINT      NOT NULL,\n        superhero_name VARCHAR(50) COLLATE DATABASE_DEFAULT NOT NULL\n        );\n\n        WHILE @Offset < @MaxRowCount\n        BEGIN\n        INSERT INTO superhero_name (ID, superhero_name)\n            SELECT \n            ROW_NUMBER() OVER (ORDER BY SV.number) + @Offset AS ID,\n            CAST(ROW_NUMBER() OVER (ORDER BY SV.number) + @Offset AS VARCHAR(50)) AS superhero_name\n            FROM master.dbo.spt_values SV\n                , master.dbo.spt_values SV2;\n        SET @Offset = @Offset + ROWCOUNT_BIG();\n        END;\n        "], "clean_up_sql": [], "category": "Efficiency", "original_schema": "CREATE TABLE [alignment] (\n[id] int NOT NULL,\n[alignment] nvarchar(MAX) NULL,\n  PRIMARY KEY ([id])\n);\n\nFirst 3 rows:\n  id  alignment\n----  -----------\n   1  Good\n   2  Bad\n   3  Neutral\n...\n\n\nCREATE TABLE [attribute] (\n[id] int NOT NULL,\n[attribute_name] nvarchar(MAX) NULL,\n  PRIMARY KEY ([id])\n);\n\nFirst 3 rows:\n  id  attribute_name\n----  ----------------\n   1  Intelligence\n   2  Strength\n   3  Speed\n...\n\n\nCREATE TABLE [colour] (\n[id] int NOT NULL,\n[colour] nvarchar(MAX) NULL,\n  PRIMARY KEY ([id])\n);\n\nFirst 3 rows:\n  id  colour\n----  ---------\n   1  No Colour\n   2  Amber\n   3  Auburn\n...\n\n\nCREATE TABLE [gender] (\n[id] int NOT NULL,\n[gender] nvarchar(MAX) NULL,\n  PRIMARY KEY ([id])\n);\n\nFirst 3 rows:\n  id  gender\n----  --------\n   1  Male\n   2  Female\n   3  N/A\n...\n\n\nCREATE TABLE [hero_attribute] (\n[hero_id] int NULL,\n[attribute_id] int NULL,\n[attribute_value] int NULL,\n  FOREIGN KEY ([attribute_id]) REFERENCES [attribute]([id]),\n  FOREIGN KEY ([hero_id]) REFERENCES [superhero]([id])\n);\n\nFirst 3 rows:\n  hero_id    attribute_id    attribute_value\n---------  --------------  -----------------\n        1               1                 80\n        2               1                 75\n        3               1                 95\n...\n\n\nCREATE TABLE [hero_power] (\n[hero_id] int NULL,\n[power_id] int NULL,\n  FOREIGN KEY ([hero_id]) REFERENCES [superhero]([id]),\n  FOREIGN KEY ([power_id]) REFERENCES [superpower]([id])\n);\n\nFirst 3 rows:\n  hero_id    power_id\n---------  ----------\n        1           1\n        1          18\n        1          26\n...\n\n\nCREATE TABLE [publisher] (\n[id] int NOT NULL,\n[publisher_name] nvarchar(MAX) NULL,\n  PRIMARY KEY ([id])\n);\n\nFirst 3 rows:\n  id  publisher_name\n----  -----------------\n   1\n   2  ABC Studios\n   3  Dark Horse Comics\n...\n\n\nCREATE TABLE [race] (\n[id] int NOT NULL,\n[race] nvarchar(MAX) NULL,\n  PRIMARY KEY ([id])\n);\n\nFirst 3 rows:\n  id  race\n----  ------\n   1  -\n   2  Alien\n   3  Alpha\n...\n\n\nCREATE TABLE [superhero] (\n[id] int NOT NULL,\n[superhero_name] nvarchar(MAX) NULL,\n[full_name] nvarchar(MAX) NULL,\n[gender_id] int NULL,\n[eye_colour_id] int NULL,\n[hair_colour_id] int NULL,\n[skin_colour_id] int NULL,\n[race_id] int NULL,\n[publisher_id] int NULL,\n[alignment_id] int NULL,\n[height_cm] int NULL,\n[weight_kg] int NULL,\n  PRIMARY KEY ([id]),\n  FOREIGN KEY ([alignment_id]) REFERENCES [alignment]([id]),\n  FOREIGN KEY ([eye_colour_id]) REFERENCES [colour]([id]),\n  FOREIGN KEY ([hair_colour_id]) REFERENCES [colour]([id]),\n  FOREIGN KEY ([skin_colour_id]) REFERENCES [colour]([id]),\n  FOREIGN KEY ([gender_id]) REFERENCES [gender]([id]),\n  FOREIGN KEY ([publisher_id]) REFERENCES [publisher]([id]),\n  FOREIGN KEY ([race_id]) REFERENCES [race]([id])\n);\n\nFirst 3 rows:\n  id  superhero_name    full_name                 gender_id    eye_colour_id    hair_colour_id    skin_colour_id    race_id    publisher_id    alignment_id    height_cm    weight_kg\n----  ----------------  ----------------------  -----------  ---------------  ----------------  ----------------  ---------  --------------  --------------  -----------  -----------\n   1  3-D Man           Charles Chandler                  1                9                13                 1          1              13               1          188           90\n   2  A-Bomb            Richard Milhouse Jones            1               33                 1                 1         24              13               1          203          441\n   3  Abe Sapien        Abraham Sapien                    1                7                 1                 7         33               3               1          191           65\n...\n\n\nCREATE TABLE [superpower] (\n[id] int NOT NULL,\n[power_name] nvarchar(MAX) NULL,\n  PRIMARY KEY ([id])\n);\n\nFirst 3 rows:\n  id  power_name\n----  -------------------\n   1  Agility\n   2  Accelerated Healing\n   3  Lantern Power Ring\n...\n", "preprocess_schema": "CREATE TABLE [alignment] (\n[id] int NOT NULL,\n[alignment] nvarchar(MAX) NULL,\n  PRIMARY KEY ([id])\n);\n\nFirst 3 rows:\n  id  alignment\n----  -----------\n   1  Good\n   2  Bad\n   3  Neutral\n...\n\n\nCREATE TABLE [attribute] (\n[id] int NOT NULL,\n[attribute_name] nvarchar(MAX) NULL,\n  PRIMARY KEY ([id])\n);\n\nFirst 3 rows:\n  id  attribute_name\n----  ----------------\n   1  Intelligence\n   2  Strength\n   3  Speed\n...\n\n\nCREATE TABLE [colour] (\n[id] int NOT NULL,\n[colour] nvarchar(MAX) NULL,\n  PRIMARY KEY ([id])\n);\n\nFirst 3 rows:\n  id  colour\n----  ---------\n   1  No Colour\n   2  Amber\n   3  Auburn\n...\n\n\nCREATE TABLE [gender] (\n[id] int NOT NULL,\n[gender] nvarchar(MAX) NULL,\n  PRIMARY KEY ([id])\n);\n\nFirst 3 rows:\n  id  gender\n----  --------\n   1  Male\n   2  Female\n   3  N/A\n...\n\n\nCREATE TABLE [hero_attribute] (\n[hero_id] int NULL,\n[attribute_id] int NULL,\n[attribute_value] int NULL,\n  FOREIGN KEY ([attribute_id]) REFERENCES [attribute]([id]),\n  FOREIGN KEY ([hero_id]) REFERENCES [superhero]([id])\n);\n\nFirst 3 rows:\n  hero_id    attribute_id    attribute_value\n---------  --------------  -----------------\n        1               1                 80\n        2               1                 75\n        3               1                 95\n...\n\n\nCREATE TABLE [hero_power] (\n[hero_id] int NULL,\n[power_id] int NULL,\n  FOREIGN KEY ([hero_id]) REFERENCES [superhero]([id]),\n  FOREIGN KEY ([power_id]) REFERENCES [superpower]([id])\n);\n\nFirst 3 rows:\n  hero_id    power_id\n---------  ----------\n        1           1\n        1          18\n        1          26\n...\n\n\nCREATE TABLE [publisher] (\n[id] int NOT NULL,\n[publisher_name] nvarchar(MAX) NULL,\n  PRIMARY KEY ([id])\n);\n\nFirst 3 rows:\n  id  publisher_name\n----  -----------------\n   1\n   2  ABC Studios\n   3  Dark Horse Comics\n...\n\n\nCREATE TABLE [race] (\n[id] int NOT NULL,\n[race] nvarchar(MAX) NULL,\n  PRIMARY KEY ([id])\n);\n\nFirst 3 rows:\n  id  race\n----  ------\n   1  -\n   2  Alien\n   3  Alpha\n...\n\n\nCREATE TABLE [superhero] (\n[id] int NOT NULL,\n[superhero_name] nvarchar(MAX) NULL,\n[full_name] nvarchar(MAX) NULL,\n[gender_id] int NULL,\n[eye_colour_id] int NULL,\n[hair_colour_id] int NULL,\n[skin_colour_id] int NULL,\n[race_id] int NULL,\n[publisher_id] int NULL,\n[alignment_id] int NULL,\n[height_cm] int NULL,\n[weight_kg] int NULL,\n  PRIMARY KEY ([id]),\n  FOREIGN KEY ([alignment_id]) REFERENCES [alignment]([id]),\n  FOREIGN KEY ([eye_colour_id]) REFERENCES [colour]([id]),\n  FOREIGN KEY ([hair_colour_id]) REFERENCES [colour]([id]),\n  FOREIGN KEY ([skin_colour_id]) REFERENCES [colour]([id]),\n  FOREIGN KEY ([gender_id]) REFERENCES [gender]([id]),\n  FOREIGN KEY ([publisher_id]) REFERENCES [publisher]([id]),\n  FOREIGN KEY ([race_id]) REFERENCES [race]([id])\n);\n\nFirst 3 rows:\n  id  superhero_name    full_name                 gender_id    eye_colour_id    hair_colour_id    skin_colour_id    race_id    publisher_id    alignment_id    height_cm    weight_kg\n----  ----------------  ----------------------  -----------  ---------------  ----------------  ----------------  ---------  --------------  --------------  -----------  -----------\n   1  3-D Man           Charles Chandler                  1                9                13                 1          1              13               1          188           90\n   2  A-Bomb            Richard Milhouse Jones            1               33                 1                 1         24              13               1          203          441\n   3  Abe Sapien        Abraham Sapien                    1                7                 1                 7         33               3               1          191           65\n...\n\n\nCREATE TABLE [superhero_name] (\n[id] bigint NOT NULL,\n[superhero_name] varchar(50) NOT NULL\n);\n\nFirst 3 rows:\n    id    superhero_name\n------  ----------------\n181267            181267\n181268            181268\n181269            181269\n...\n\n\nCREATE TABLE [superpower] (\n[id] int NOT NULL,\n[power_name] nvarchar(MAX) NULL,\n  PRIMARY KEY ([id])\n);\n\nFirst 3 rows:\n  id  power_name\n----  -------------------\n   1  Agility\n   2  Accelerated Healing\n   3  Lantern Power Ring\n...\n", "sol_sql": ["\n        DECLARE\n        @PageSize INT = 10\n        , @PageNum  INT = 1;\n\n        WITH TempResult AS (SELECT\n                                id\n                                , superhero_name\n                            FROM  superhero_name\n                            WHERE id IN (1, 2, 3, 4, 5, 6, 7, 8, 9, 10)\n        )\n        SELECT\n                *, MaxRows = COUNT(*) OVER()\n        FROM     TempResult\n        ORDER BY TempResult.superhero_name OFFSET (@PageNum - 1) * @PageSize ROWS\n        FETCH NEXT @PageSize ROWS ONLY;\n        "], "test_cases": ["\ndef test_case(pred_sqls, sol_sqls, db_name, conn):\n    result = ex_base(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"ex_base returned {result} but expected 1.\"\n    result = performance_compare_by_qep(pred_sqls, sol_sqls, db_name, conn)\n    assert result == 1, f\"performance_check returned {result} but expected 1.\"\n    "]}
